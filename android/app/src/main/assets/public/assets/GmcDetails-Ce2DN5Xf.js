import{u as O,h as $,k as G,c as A,o as B,j as a,C as d,p as g,d as F,e as l,R as f,S as E,q as T}from"./index-D5q3SS3D.js";import{m as U,b as i}from"./react-vendor-BUaIliXj.js";import{F as q}from"./FormHeader-CSy2Sh-o.js";import{U as S}from"./UploadDocument-BAL6UInC.js";import"./ui-vendor-B8EvWqdc.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./utils-vendor-DmorxLnX.js";import"./supabase-7WG3J4rU.js";import"./CameraCaptureModal-DQDGRnEP.js";const R=F({isOptedIn:f().nullable().required("Please choose whether you want to avail Group Medical Cover."),selectedSpouseId:l().optional(),selectedChildIds:T().of(l().required()).optional(),gmcPolicyCopy:E().when("isOptedIn",{is:!1,then:o=>o.required("Please upload GMC policy copy (PNG, JPG, PDF up to 5MB)."),otherwise:o=>o.optional().nullable()}),declarationAccepted:f().when("isOptedIn",{is:!1,then:o=>o.oneOf([!0],"Please accept the declaration to proceed."),otherwise:o=>o.optional()}),policyAmount:l().optional().nullable(),nomineeName:l().optional().nullable(),nomineeRelation:l().optional().nullable(),wantsToAddDependents:f().optional().nullable(),optOutReason:l().optional().nullable(),alternateInsuranceProvider:l().optional().nullable(),alternateInsuranceStartDate:l().optional().nullable(),alternateInsuranceEndDate:l().optional().nullable(),alternateInsuranceCoverage:l().optional().nullable()}).defined(),_=()=>{const{onValidated:o}=U(),{user:V}=O(),{data:t,updateGmc:x}=$(),k=G("(max-width: 767px)"),{control:r,handleSubmit:y,formState:{errors:C},watch:m,reset:j,setValue:u,getValues:D}=A({resolver:B(R),defaultValues:t.gmc}),h=m("isOptedIn"),I=m("selectedSpouseId"),v=m("selectedChildIds")||[],c=i.useMemo(()=>t.family.find(e=>e.relation==="Spouse"),[t.family]),p=i.useMemo(()=>t.family.filter(e=>e.relation==="Child"),[t.family]),b=i.useMemo(()=>{const e=[];return c&&e.push(c),e.push(...p),e},[c,p]);i.useEffect(()=>{if(t.gmc.isOptedIn===!0){const e=!t.gmc.selectedSpouseId&&(!t.gmc.selectedChildIds||t.gmc.selectedChildIds.length===0),s=c||p.length>0;e&&s&&(u("selectedSpouseId",c?.id||"",{shouldDirty:!0}),u("selectedChildIds",p.map(n=>n.id),{shouldDirty:!0}))}},[t.gmc.isOptedIn,c,p,u,t.gmc.selectedSpouseId,t.gmc.selectedChildIds]),i.useEffect(()=>{j(t.gmc)},[t.gmc,j]),i.useEffect(()=>{let e;const s=m(n=>{clearTimeout(e),e=window.setTimeout(()=>{x(n)},500)});return()=>{s.unsubscribe(),clearTimeout(e)}},[m,x]);const N=async e=>{const s={...e};e.isOptedIn?(s.gmcPolicyCopy=null,s.declarationAccepted=!1):(s.selectedSpouseId="",s.selectedChildIds=[]),x(s),await o()},w=(e,s)=>{if(e.relation==="Spouse")u("selectedSpouseId",s?e.id:"",{shouldDirty:!0});else{const n=D("selectedChildIds")||[],P=s?[...n,e.id]:n.filter(M=>M!==e.id);u("selectedChildIds",P,{shouldDirty:!0})}};return k?a.jsxs("form",{onSubmit:y(N),id:"gmc-form",children:[a.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"Please choose whether to enroll in the company's insurance plan."}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("p",{className:"text-md font-semibold",children:"Would you like to Avail Group Medical Cover?"}),a.jsx(d,{name:"isOptedIn",control:r,render:({field:e})=>a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[a.jsxs("label",{className:`flex items-center p-4 rounded-lg border-2 cursor-pointer flex-1 ${e.value===!0?"border-[#32cd32] bg-[#243524]":"border-[#374151]"}`,children:[a.jsx("input",{type:"radio",name:e.name,onBlur:e.onBlur,ref:e.ref,onChange:()=>e.onChange(!0),checked:e.value===!0,className:"h-4 w-4 text-accent focus:ring-accent bg-transparent border-muted"}),a.jsx("span",{className:"ml-3 text-sm font-medium",children:"Yes"})]}),a.jsxs("label",{className:`flex items-center p-4 rounded-lg border-2 cursor-pointer flex-1 ${e.value===!1?"border-[#32cd32] bg-[#243524]":"border-[#374151]"}`,children:[a.jsx("input",{type:"radio",name:e.name,onBlur:e.onBlur,ref:e.ref,onChange:()=>e.onChange(!1),checked:e.value===!1,className:"h-4 w-4 text-accent focus:ring-accent bg-transparent border-muted"}),a.jsx("span",{className:"ml-3 text-sm font-medium",children:"No"})]})]})}),h===!0&&a.jsxs("div",{className:"pt-4 space-y-4 animate-fade-in-down",children:[a.jsx("label",{className:"text-sm font-medium text-gray-400",children:"Select Dependents"}),b.map(e=>{const s=e.relation==="Spouse"?I===e.id:v.includes(e.id);return a.jsx(g,{id:`dep-mob-${e.id}`,label:`${e.name} (${e.relation})`,checked:s,onChange:n=>w(e,n)},e.id)})]}),h===!1&&a.jsxs("div",{className:"pt-4 space-y-4 animate-fade-in-down",children:[a.jsx(d,{name:"gmcPolicyCopy",control:r,render:({field:e,fieldState:s})=>a.jsx(S,{label:"Upload GMC Policy Copy",file:e.value,onFileChange:e.onChange,error:s.error?.message,allowCapture:!0})}),a.jsx(d,{name:"declarationAccepted",control:r,render:({field:e,fieldState:s})=>a.jsxs("label",{className:"flex items-center gap-3 p-4 bg-[#243524] rounded-lg border border-[#374151]",children:[a.jsx("input",{type:"checkbox",checked:e.value??!1,onChange:e.onChange,className:"h-5 w-5 rounded text-accent focus:ring-accent bg-transparent border-[#9ca89c]"}),a.jsx("span",{children:"I declare I will not avail company GMC and the uploaded policy is valid."})]})})]})]})]}):a.jsxs("form",{onSubmit:y(N),id:"gmc-form",children:[a.jsx(q,{title:"Group Medical Cover (GMC)",subtitle:"Please choose whether to enroll in the company's insurance plan."}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-md font-semibold text-primary-text mb-2 block",children:"Would you like to Avail Group Medical Cover?"}),a.jsx(d,{name:"isOptedIn",control:r,render:({field:e})=>a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[a.jsxs("label",{className:`flex items-center p-4 rounded-lg border-2 cursor-pointer flex-1 ${e.value===!0?"border-accent bg-accent-light":"border-border"}`,children:[a.jsx("input",{type:"radio",name:e.name,onBlur:e.onBlur,ref:e.ref,onChange:()=>e.onChange(!0),checked:e.value===!0,className:"h-4 w-4 text-accent focus:ring-accent"}),a.jsx("span",{className:"ml-3 text-sm font-medium",children:"Yes"})]}),a.jsxs("label",{className:`flex items-center p-4 rounded-lg border-2 cursor-pointer flex-1 ${e.value===!1?"border-accent bg-accent-light":"border-border"}`,children:[a.jsx("input",{type:"radio",name:e.name,onBlur:e.onBlur,ref:e.ref,onChange:()=>e.onChange(!1),checked:e.value===!1,className:"h-4 w-4 text-accent focus:ring-accent"}),a.jsx("span",{className:"ml-3 text-sm font-medium",children:"No"})]})]})}),C.isOptedIn&&a.jsx("p",{className:"mt-1 text-xs text-red-600",children:C.isOptedIn.message})]}),h===!0&&a.jsxs("div",{className:"pt-4 border-t space-y-4 animate-fade-in-down",children:[a.jsx("label",{className:"text-md font-semibold text-primary-text mb-2 block",children:"Select Dependents for Policy"}),a.jsx("p",{className:"text-sm text-muted -mt-2 mb-2",children:"Spouse and children are included by default. Uncheck any dependents you do not want to include."}),a.jsx("div",{className:"space-y-2 p-4 border rounded-lg bg-page",children:b.length>0?b.map(e=>{const s=e.relation==="Spouse"?I===e.id:v.includes(e.id);return a.jsx(g,{id:`dep-${e.id}`,label:`${e.name} (${e.relation})`,checked:s,onChange:n=>w(e,n)},e.id)}):a.jsx("p",{className:"text-sm text-muted",children:'No spouse or children added. Please add them in the "Family Details" section to include them in the policy.'})})]}),h===!1&&a.jsxs("div",{className:"pt-4 border-t space-y-4 animate-fade-in-down",children:[a.jsx(d,{name:"gmcPolicyCopy",control:r,render:({field:e,fieldState:s})=>a.jsx(S,{label:"Upload GMC Policy Copy",file:e.value,onFileChange:e.onChange,allowedTypes:["image/png","image/jpeg","application/pdf"],error:s.error?.message})}),a.jsx(d,{name:"declarationAccepted",control:r,render:({field:e,fieldState:s})=>a.jsxs("div",{className:"space-y-1",children:[a.jsx(g,{id:"declarationAccepted",label:"I declare that I will not avail company GMC and the uploaded policy is valid.",checked:e.value??!1,onChange:e.onChange}),s.error&&a.jsx("p",{className:"text-xs text-red-600",children:s.error.message})]})})]})]})]})};export{_ as default};
