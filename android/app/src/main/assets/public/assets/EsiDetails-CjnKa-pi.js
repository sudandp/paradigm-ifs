import{d as v,S as F,e as b,R as O,u as $,h as k,l as U,k as M,c as A,o as P,_ as C,j as e,C as x,I as L}from"./index-D5q3SS3D.js";import{m as G,b as f}from"./react-vendor-BUaIliXj.js";import{F as g}from"./FormHeader-CSy2Sh-o.js";import{D as H}from"./DatePicker-D2ulOwJx.js";import{U as D}from"./UploadDocument-BAL6UInC.js";import{V as J}from"./VerifiedInput-CBziK85I.js";import{m as E}from"./ui-vendor-B8EvWqdc.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./utils-vendor-DmorxLnX.js";import"./supabase-7WG3J4rU.js";import"./CameraCaptureModal-DQDGRnEP.js";const Q=v({hasEsi:O().required(),esiNumber:b().when("hasEsi",{is:!0,then:t=>t.required("ESI Number is required").matches(/^(\d{10}|\d{17})$/,"ESI number must be 10 or 17 digits"),otherwise:t=>t.optional().nullable()}),esiRegistrationDate:b().when("hasEsi",{is:!0,then:t=>t.required("Registration date is required").test("not-in-future","Registration date cannot be in the future",l=>l?new Date(l.replace(/-/g,"/"))<=new Date:!0),otherwise:t=>t.optional().nullable()}),esicBranch:b().when("hasEsi",{is:!0,then:t=>t.required("ESIC Branch is required"),otherwise:t=>t.optional().nullable()}),document:F().optional().nullable(),verifiedStatus:v().optional()}),ne=()=>{const{onValidated:t,setToast:l}=G(),{user:_}=$(),{data:i,updateEsi:n,setEsiVerifiedStatus:S}=k(),{esiCtcThreshold:u,enableEsiRule:m}=U(),R=M("(max-width: 767px)"),{register:r,control:d,handleSubmit:N,formState:{errors:h},reset:j,setValue:y,watch:o}=A({resolver:P(Q),defaultValues:i.esi}),I=o("hasEsi"),T=o(),c=i.personal.salary!=null&&i.personal.salary<=u;f.useEffect(()=>{j(i.esi)},[i.esi,j]),f.useEffect(()=>{let s;const a=o(p=>{clearTimeout(s),s=window.setTimeout(()=>{n(p)},500)});return()=>{a.unsubscribe(),clearTimeout(s)}},[o,n]),f.useEffect(()=>{c||i.esi.hasEsi&&n({hasEsi:!1,esiNumber:"",esiRegistrationDate:"",esicBranch:""})},[c,i.esi.hasEsi,n]);const w=async s=>{n(s),await t()},B=()=>{S({esiNumber:!1})},V=s=>{if(s.esiNumber){const a=s.esiNumber.replace(/\D/g,"");if(a.length===10||a.length===17){const p={esiNumber:a,hasEsi:!0};y("esiNumber",a,{shouldValidate:!0}),y("hasEsi",!0,{shouldValidate:!0}),n(p),S({esiNumber:!0}),l({message:"ESI Number extracted successfully.",type:"success"})}}},q={type:C.OBJECT,properties:{esiNumber:{type:C.STRING,description:"The 10 or 17-digit ESI number."}},required:["esiNumber"]};if(R){if(!m||!c){const s=m?`Employee is not eligible for ESI as their gross salary is above the ₹${u.toLocaleString()} threshold.`:"ESI enrollment is currently disabled by company policy. This step is not applicable.";return e.jsx("form",{onSubmit:async a=>{a.preventDefault(),await t()},id:"esi-form",children:e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-blue-900/40 rounded-lg border border-blue-500/50",children:[e.jsx(E,{className:"h-5 w-5 text-blue-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-blue-300",children:s})]})})}return e.jsxs("form",{onSubmit:N(w),id:"esi-form",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"Provide your Employee's State Insurance number if applicable."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"flex items-center gap-3 p-4 bg-[#243524] rounded-lg border border-[#374151]",children:[e.jsx("input",{type:"checkbox",...r("hasEsi"),className:"h-5 w-5 rounded text-accent focus:ring-accent bg-transparent border-[#9ca89c]"}),e.jsx("span",{children:"Are you covered under ESI?"})]}),I&&e.jsxs("div",{className:"space-y-4 animate-fade-in-down",children:[e.jsx("input",{placeholder:"ESI Number",...r("esiNumber"),className:"form-input"}),e.jsx("input",{type:"date",...r("esiRegistrationDate"),className:"form-input"}),e.jsx("input",{placeholder:"ESIC Branch",...r("esicBranch"),className:"form-input"}),e.jsx(x,{name:"document",control:d,render:({field:s})=>e.jsx(D,{label:"Upload ESI Card",file:s.value,onFileChange:s.onChange,allowCapture:!0,costingItemName:"ESI Card OCR"})})]})]})]})}return m?c?e.jsxs("form",{onSubmit:N(w),id:"esi-form",children:[e.jsx(g,{title:"ESI Details",subtitle:"Provide your Employee's State Insurance number if applicable."}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"hasEsi",type:"checkbox",...r("hasEsi"),className:"h-4 w-4 text-accent"}),e.jsx("label",{htmlFor:"hasEsi",className:"ml-2 block text-sm text-muted",children:"Are you covered under ESI?"})]}),I&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 animate-fade-in-down",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(J,{label:"ESI Number",id:"esiNumber",hasValue:!!T.esiNumber,isVerified:i.esi.verifiedStatus?.esiNumber===!0,onManualInput:B,registration:r("esiNumber"),error:h.esiNumber?.message}),e.jsx(x,{name:"esiRegistrationDate",control:d,render:({field:s})=>e.jsx(H,{label:"ESI Registration Date",id:"esiRegistrationDate",error:h.esiRegistrationDate?.message,value:s.value,onChange:s.onChange,maxDate:new Date})}),e.jsx(L,{label:"ESIC Branch",id:"esicBranch",registration:r("esicBranch"),error:h.esicBranch?.message})]}),e.jsx(x,{name:"document",control:d,render:({field:s})=>e.jsx(D,{label:"Upload ESI Card",file:s.value,onFileChange:s.onChange,onOcrComplete:V,ocrSchema:q,setToast:l,costingItemName:"ESI Card OCR"})})]})]})]}):e.jsxs("form",{onSubmit:async s=>{s.preventDefault(),await t()},id:"esi-form",children:[e.jsx(g,{title:"ESI Details",subtitle:"Employee's State Insurance eligibility."}),e.jsxs("div",{className:"mt-4 flex items-center bg-blue-50 p-4 rounded-lg",children:[e.jsx(E,{className:"h-5 w-5 text-blue-500 mr-3"}),e.jsxs("p",{className:"text-sm text-blue-700",children:["Employee is not eligible for ESI as their gross salary is above the ₹$",u.toLocaleString()," threshold."]})]})]}):e.jsxs("form",{onSubmit:async s=>{s.preventDefault(),await t()},id:"esi-form",children:[e.jsx(g,{title:"ESI Details",subtitle:"Employee's State Insurance eligibility."}),e.jsxs("div",{className:"mt-4 flex items-center bg-blue-50 p-4 rounded-lg",children:[e.jsx(E,{className:"h-5 w-5 text-blue-500 mr-3"}),e.jsx("p",{className:"text-sm text-blue-700",children:"ESI enrollment is currently disabled by company policy. This step is not applicable."})]})]})};export{ne as default,Q as esiDetailsSchema};
