import{k as Z,c as L,o as U,d as m,O as C,j as e,I as o,C as s,B as N,q as j,Q as b,e as i,R as h,S as p}from"./index-D5q3SS3D.js";import{b as S}from"./react-vendor-BUaIliXj.js";import{S as v}from"./Select-Dz12MdxG.js";import{U as A}from"./UploadDocument-BAL6UInC.js";import{D as c}from"./DatePicker-D2ulOwJx.js";import{at as z,ao as Q,C as Y}from"./ui-vendor-B8EvWqdc.js";const I=["Apartment","Villa","Vilament","Rowhouse","Combined","Commercial Office","Commercial Retail","Commercial","Public",""],K=m({organizationId:i().required(),location:i().optional().nullable(),entityId:i().optional(),billingName:i().optional().nullable(),registeredAddress:i().optional().nullable(),gstNumber:i().optional().nullable().matches(/^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/,{message:"Invalid GST Number format",excludeEmptyString:!0}),panNumber:i().optional().nullable().transform(l=>l?.toUpperCase()||"").matches(/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/,{message:"Invalid PAN format",excludeEmptyString:!0}),email1:i().email("Invalid email format").optional().nullable(),email2:i().email("Invalid email format").optional().nullable(),email3:i().email("Invalid email format").optional().nullable(),eShramNumber:i().optional().nullable(),shopAndEstablishmentCode:i().optional().nullable(),keyAccountManager:i().optional(),siteAreaSqFt:b().typeError("Must be a number").nullable().optional(),projectType:i().oneOf(I).optional(),apartmentCount:b().typeError("Must be a number").nullable().optional(),agreementDetails:m({fromDate:i().optional().nullable(),toDate:i().optional().nullable().test("is-after-from","To Date must be after From Date",function(l){const{fromDate:u}=this.parent;return!u||!l?!0:new Date(l.replace(/-/g,"/"))>=new Date(u.replace(/-/g,"/"))}),renewalIntervalDays:b().typeError("Must be a number").nullable().optional().min(0,"Cannot be negative"),softCopy:p().nullable().optional(),scannedCopy:p().nullable().optional(),agreementDate:i().optional().nullable(),addendum1Date:i().optional().nullable(),addendum2Date:i().optional().nullable()}).optional(),siteOperations:m({form6Applicable:h().default(!1),form6RenewalTaskCreation:h().optional(),form6ValidityFrom:i().nullable().when("form6Applicable",{is:!0,then:l=>l.required("From Date is required")}),form6ValidityTo:i().nullable().when("form6Applicable",{is:!0,then:l=>l.required("To Date is required")}),form6Document:p().nullable().when("form6Applicable",{is:!0,then:l=>l.required("Document is required")}),minWageRevisionApplicable:h().default(!1),minWageRevisionTaskCreation:h().optional(),minWageRevisionValidityFrom:i().nullable().when("minWageRevisionApplicable",{is:!0,then:l=>l.required("From Date is required")}),minWageRevisionValidityTo:i().nullable().when("minWageRevisionApplicable",{is:!0,then:l=>l.required("To Date is required")}),minWageRevisionDocument:p().nullable().when("minWageRevisionApplicable",{is:!0,then:l=>l.required("Document is required")}),holidays:m({numberOfDays:b().nullable().min(0),list:j().of(m({id:i(),date:i().required(),description:i().required()})),salaryPayment:i().oneOf(["Full Payment","Duty Payment","Nil Payment",""]),billing:i().oneOf(["Full Payment","Duty Payment","Nil Payment",""])}).optional(),costingSheetLink:i().url("Must be a valid URL").nullable().optional(),tools:m({dcCopy1:p().nullable().optional(),dcCopy2:p().nullable().optional(),list:j().of(m({id:i(),name:i().required(),brand:i().optional(),size:i().optional(),quantity:b().nullable().min(0),issueDate:i().required(),picture:p().nullable().optional()}))}).optional(),sims:m({issuedCount:b().nullable().min(0),details:j().of(m({id:i(),mobileNumber:i().required().matches(/^[6-9][0-9]{9}$/,"Must be a valid 10-digit number"),allocatedTo:i().optional(),plan:i().optional(),ownerName:i().optional()}))}).optional(),equipment:m({issued:j().of(m({id:i(),name:i().required(),brand:i().optional(),modelNumber:i().optional(),serialNumber:i().optional(),accessories:i().optional(),condition:i().oneOf(["New","Old",""]),issueDate:i().required(),picture:p().nullable().optional()})),intermittent:m({billing:i().oneOf(["To Be Billed","Not to be Billed",""]),frequency:i().oneOf(["Monthly","Bi-Monthly","Quarterly","Half Yearly","Yearly",""]),taskCreation:h().default(!1),durationDays:b().nullable().min(0)}).optional()}).optional(),billingCycleFrom:i().nullable().optional(),uniformDeductions:h().default(!1)}).optional(),insuranceStatus:m({isCompliant:h().required()}).optional().nullable(),assets:j().optional(),issuedTools:j().optional()}).defined(),P=({title:l,children:u})=>{const[f,x]=S.useState(!1);return e.jsxs("div",{className:"border border-border rounded-lg bg-page",children:[e.jsxs("button",{type:"button",onClick:()=>x(!f),className:"w-full flex justify-between items-center p-3 font-medium text-left text-primary-text",children:[e.jsx("span",{children:l}),e.jsx(Y,{className:`h-5 w-5 transform transition-transform ${f?"rotate-180":""}`})]}),f&&e.jsx("div",{className:"p-4 border-t border-border bg-card",children:u})]})},ne=({isOpen:l,onClose:u,onSave:f,organization:x,allClients:O,initialData:q})=>{const[y,T]=S.useState("General"),E=Z("(max-width: 767px)"),{register:r,handleSubmit:V,control:t,watch:F,setValue:g,formState:{errors:n},reset:R}=L({resolver:U(K),defaultValues:{siteOperations:{form6Applicable:!1,minWageRevisionApplicable:!1,uniformDeductions:!1}}}),{fields:W,append:M,remove:$}=C({control:t,name:"siteOperations.holidays.list"});C({control:t,name:"siteOperations.tools.list"}),C({control:t,name:"siteOperations.sims.details"}),C({control:t,name:"siteOperations.equipment.issued"}),S.useEffect(()=>{l&&R(q||{organizationId:x.id})},[l,q,x.id,R]);const w=F("entityId"),B=F("siteOperations.form6Applicable"),H=F("siteOperations.minWageRevisionApplicable");S.useEffect(()=>{if(w){const a=O.find(d=>d.id===w);a&&(g("registeredAddress",a.registeredAddress||""),g("gstNumber",a.gstNumber||""),g("panNumber",a.panNumber||""),g("email1",a.email||""),g("eShramNumber",a.eShramNumber||""),g("shopAndEstablishmentCode",a.shopAndEstablishmentCode||""))}},[w,O,g]);const G=a=>{f(x.id,a)},D=({tabName:a})=>e.jsx("button",{type:"button",onClick:()=>T(a),className:`px-4 py-2 text-sm font-medium rounded-t-lg border-b-2 ${y===a?"border-accent text-accent":"border-transparent text-muted hover:text-primary-text"}`,children:a});return l?e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto bg-black bg-opacity-50 p-4 flex items-center justify-center",onClick:u,children:e.jsx("div",{className:"bg-card rounded-xl shadow-card w-full max-w-4xl my-8 animate-fade-in-scale",onClick:a=>a.stopPropagation(),children:e.jsxs("form",{onSubmit:V(G),className:"p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-primary-text",children:"Site Configuration"}),e.jsxs("p",{className:"text-sm text-muted mb-4",children:["For: ",x.shortName]}),e.jsx("div",{className:"mb-6",children:E?e.jsxs(v,{label:"Configuration Section",id:"site-config-tabs",value:y,onChange:a=>T(a.target.value),className:"pro-select pro-select-arrow",children:[e.jsx("option",{value:"General",children:"General"}),e.jsx("option",{value:"Compliance",children:"Compliance"}),e.jsx("option",{value:"Agreement",children:"Agreement"}),e.jsx("option",{value:"Site Operations",children:"Site Operations"})]}):e.jsx("div",{className:"border-b border-border",children:e.jsxs("nav",{className:"-mb-px flex space-x-4",children:[e.jsx(D,{tabName:"General"}),e.jsx(D,{tabName:"Compliance"}),e.jsx(D,{tabName:"Agreement"}),e.jsx(D,{tabName:"Site Operations"})]})})}),e.jsxs("div",{className:"max-h-[60vh] overflow-y-auto pr-2 space-y-4",children:[y==="General"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4",children:[e.jsx(o,{label:"Location",id:"location",registration:r("location"),error:n.location?.message}),e.jsx(o,{label:"Billing Name",id:"billingName",registration:r("billingName"),error:n.billingName?.message}),e.jsx(o,{label:"Key Account Manager",id:"keyAccountManager",registration:r("keyAccountManager"),error:n.keyAccountManager?.message}),e.jsx(o,{label:"Site Area (Sq.ft)",id:"siteAreaSqFt",type:"number",registration:r("siteAreaSqFt"),error:n.siteAreaSqFt?.message}),e.jsxs(v,{label:"Type of Project",id:"projectType",registration:r("projectType"),error:n.projectType?.message,children:[e.jsx("option",{value:"",children:"-- Select Type --"}),I.filter(Boolean).map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsx(o,{label:"No of Apartments/Villas",id:"apartmentCount",type:"number",registration:r("apartmentCount"),error:n.apartmentCount?.message})]}),y==="Compliance"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(s,{name:"entityId",control:t,render:({field:a})=>e.jsxs(v,{label:"Link to Client (Prefills data)",id:"entityId",...a,error:n.entityId?.message,children:[e.jsx("option",{value:"",children:"-- Select Client --"}),O.map(d=>e.jsxs("option",{value:d.id,children:[d.name," (",d.companyName,")"]},d.id))]})})}),e.jsx(o,{label:"GST Number",id:"gstNumber",registration:r("gstNumber"),error:n.gstNumber?.message}),e.jsx(o,{label:"PAN Number",id:"panNumber",registration:r("panNumber"),error:n.panNumber?.message}),e.jsx(o,{label:"Email Address 1",id:"email1",registration:r("email1"),error:n.email1?.message}),e.jsx(o,{label:"Email Address 2",id:"email2",registration:r("email2"),error:n.email2?.message}),e.jsx(o,{label:"Email Address 3",id:"email3",registration:r("email3"),error:n.email3?.message}),e.jsx(o,{label:"E-Shram Number",id:"eShramNumber",registration:r("eShramNumber"),error:n.eShramNumber?.message}),e.jsx(o,{label:"Shop & Establishment Code",id:"shopAndEstablishmentCode",registration:r("shopAndEstablishmentCode"),error:n.shopAndEstablishmentCode?.message})]}),y==="Agreement"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4",children:[e.jsx(s,{name:"agreementDetails.fromDate",control:t,render:({field:a})=>e.jsx(c,{label:"From Date",id:"agreementDetails.fromDate",value:a.value,onChange:a.onChange,error:n.agreementDetails?.fromDate?.message})}),e.jsx(s,{name:"agreementDetails.toDate",control:t,render:({field:a})=>e.jsx(c,{label:"To Date",id:"agreementDetails.toDate",value:a.value,onChange:a.onChange,error:n.agreementDetails?.toDate?.message})}),e.jsx(o,{label:"Renewal Interval (Days)",id:"agreementDetails.renewalIntervalDays",type:"number",registration:r("agreementDetails.renewalIntervalDays"),error:n.agreementDetails?.renewalIntervalDays?.message}),e.jsxs("div",{className:"md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(s,{name:"agreementDetails.softCopy",control:t,render:({field:a})=>e.jsx(A,{label:"Soft Copy",file:a.value,onFileChange:a.onChange})}),e.jsx(s,{name:"agreementDetails.scannedCopy",control:t,render:({field:a})=>e.jsx(A,{label:"Scanned Copy",file:a.value,onFileChange:a.onChange})})]}),e.jsx(s,{name:"agreementDetails.agreementDate",control:t,render:({field:a})=>e.jsx(c,{label:"Agreement Dated",id:"agreementDetails.agreementDate",value:a.value,onChange:a.onChange,error:n.agreementDetails?.agreementDate?.message})}),e.jsx(s,{name:"agreementDetails.addendum1Date",control:t,render:({field:a})=>e.jsx(c,{label:"Addendum 1 Dated",id:"agreementDetails.addendum1Date",value:a.value,onChange:a.onChange,error:n.agreementDetails?.addendum1Date?.message})}),e.jsx(s,{name:"agreementDetails.addendum2Date",control:t,render:({field:a})=>e.jsx(c,{label:"Addendum 2 Dated",id:"agreementDetails.addendum2Date",value:a.value,onChange:a.onChange,error:n.agreementDetails?.addendum2Date?.message})})]}),y==="Site Operations"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(P,{title:"Compliance Forms",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(s,{name:"siteOperations.form6Applicable",control:t,render:({field:a})=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.value,onChange:a.onChange})," Form 6 Applicable"]})}),B&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-2 pl-6",children:[e.jsx(s,{name:"siteOperations.form6ValidityFrom",control:t,render:({field:a})=>e.jsx(c,{label:"Valid From",id:"form6from",value:a.value,onChange:a.onChange,error:n.siteOperations?.form6ValidityFrom?.message})}),e.jsx(s,{name:"siteOperations.form6ValidityTo",control:t,render:({field:a})=>e.jsx(c,{label:"Valid To",id:"form6to",value:a.value,onChange:a.onChange,error:n.siteOperations?.form6ValidityTo?.message})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(s,{name:"siteOperations.form6Document",control:t,render:({field:a})=>e.jsx(A,{label:"Form 6 Document",file:a.value,onFileChange:a.onChange,error:n.siteOperations?.form6Document?.message})})})]})]}),e.jsxs("div",{children:[e.jsx(s,{name:"siteOperations.minWageRevisionApplicable",control:t,render:({field:a})=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.value,onChange:a.onChange})," Min. Wage Revision Applicable"]})}),H&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-2 pl-6",children:[e.jsx(s,{name:"siteOperations.minWageRevisionValidityFrom",control:t,render:({field:a})=>e.jsx(c,{label:"Valid From",id:"minwagefrom",value:a.value,onChange:a.onChange,error:n.siteOperations?.minWageRevisionValidityFrom?.message})}),e.jsx(s,{name:"siteOperations.minWageRevisionValidityTo",control:t,render:({field:a})=>e.jsx(c,{label:"Valid To",id:"minwageto",value:a.value,onChange:a.onChange,error:n.siteOperations?.minWageRevisionValidityTo?.message})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(s,{name:"siteOperations.minWageRevisionDocument",control:t,render:({field:a})=>e.jsx(A,{label:"Min. Wage Document",file:a.value,onFileChange:a.onChange,error:n.siteOperations?.minWageRevisionDocument?.message})})})]})]})]})}),e.jsx(P,{title:"Holidays",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(o,{label:"Number of National & Festival Holidays",id:"holiday-count",type:"number",registration:r("siteOperations.holidays.numberOfDays")}),e.jsxs(v,{label:"Salary Payment for Holiday",id:"holiday-salary",registration:r("siteOperations.holidays.salaryPayment"),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"Full Payment"}),e.jsx("option",{children:"Duty Payment"}),e.jsx("option",{children:"Nil Payment"})]}),e.jsxs(v,{label:"Billing for Holiday",id:"holiday-billing",registration:r("siteOperations.holidays.billing"),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"Full Payment"}),e.jsx("option",{children:"Duty Payment"}),e.jsx("option",{children:"Nil Payment"})]}),e.jsx("h5",{className:"font-semibold pt-2 border-t",children:"Holiday List"}),W.map((a,d)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-end",children:[e.jsx("div",{className:"col-span-6",children:e.jsx(o,{label:"Description",id:`holiday-desc-${d}`,...r(`siteOperations.holidays.list.${d}.description`)})}),e.jsx("div",{className:"col-span-5",children:e.jsx(s,{name:`siteOperations.holidays.list.${d}.date`,control:t,render:({field:k})=>e.jsx(c,{label:"Date",id:`holiday-date-${d}`,value:k.value,onChange:k.onChange})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(N,{type:"button",variant:"icon",size:"sm",onClick:()=>$(d),children:e.jsx(z,{className:"h-4 text-red-500"})})})]},a.id)),e.jsxs(N,{type:"button",variant:"outline",size:"sm",onClick:()=>M({id:`hol_${Date.now()}`,date:"",description:""}),children:[e.jsx(Q,{className:"h-4 mr-1"})," Add Holiday"]})]})})]})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-border flex justify-end space-x-3",children:[e.jsx(N,{type:"button",onClick:u,variant:"secondary",children:"Cancel"}),e.jsx(N,{type:"submit",children:"Save Configuration"})]})]})})}):null};export{ne as S};
