import{h as j,u as R,k,c as v,o as I,j as e,C as u,d as h,S as r,m as L}from"./index-D5q3SS3D.js";import{m as F,b as p}from"./react-vendor-BUaIliXj.js";import{F as C}from"./FormHeader-CSy2Sh-o.js";import{U as g}from"./UploadDocument-BAL6UInC.js";import"./ui-vendor-B8EvWqdc.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./utils-vendor-DmorxLnX.js";import"./supabase-7WG3J4rU.js";import"./CameraCaptureModal-DQDGRnEP.js";const M=h({signatureImage:r().required("A signature image is mandatory.").nullable(),fingerprints:h().shape({leftThumb:r().optional().nullable(),leftIndex:r().optional().nullable(),leftMiddle:r().optional().nullable(),leftRing:r().optional().nullable(),leftLittle:r().optional().nullable(),rightThumb:r().optional().nullable(),rightIndex:r().optional().nullable(),rightMiddle:r().optional().nullable(),rightRing:r().optional().nullable(),rightLittle:r().optional().nullable()})}).defined(),N=[{hand:"Left",key:"leftThumb",name:"Thumb"},{hand:"Left",key:"leftIndex",name:"Index"},{hand:"Left",key:"leftMiddle",name:"Middle"},{hand:"Left",key:"leftRing",name:"Ring"},{hand:"Left",key:"leftLittle",name:"Little"},{hand:"Right",key:"rightThumb",name:"Thumb"},{hand:"Right",key:"rightIndex",name:"Index"},{hand:"Right",key:"rightMiddle",name:"Middle"},{hand:"Right",key:"rightRing",name:"Ring"},{hand:"Right",key:"rightLittle",name:"Little"}],D=()=>{const{onValidated:f}=F(),{data:s,updateBiometrics:l}=j(),{user:S}=R(),i=k("(max-width: 767px)"),{control:o,handleSubmit:b,formState:{errors:w},reset:d,watch:m}=v({resolver:I(M),defaultValues:s.biometrics});p.useEffect(()=>{d(s.biometrics)},[s.biometrics,d]),p.useEffect(()=>{const t=m(a=>{l(a)});return()=>t.unsubscribe()},[m,l]);const x=async(t,a)=>{try{const n=await L.verifyFingerprintImage(t,a);return n.containsFingerprints?{success:!0,reason:""}:{success:!1,reason:n.reason||"Image does not appear to contain fingerprints. Please upload a clear scan."}}catch(n){return{success:!1,reason:n.message||"AI verification failed."}}},y=async t=>{l(t),await f()},c=t=>N.filter(a=>a.hand===t).map(a=>e.jsx(u,{name:`fingerprints.${a.key}`,control:o,render:({field:n})=>e.jsx(g,{label:`${t} ${a.name}`,file:n.value,onFileChange:n.onChange,onVerification:x,allowCapture:!0})},a.key));return e.jsxs("form",{onSubmit:b(y),id:"biometrics-form",children:[!i&&e.jsx(C,{title:"Biometrics",subtitle:"Please provide fingerprint scans and a mandatory signature."}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:`text-lg font-semibold text-center mb-4 ${i?"form-header-title":"text-primary-text"}`,children:["Signature ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"w-full",children:e.jsx(u,{name:"signatureImage",control:o,render:({field:t,fieldState:a})=>e.jsx(g,{label:"Upload or capture a signature",file:t.value,onFileChange:t.onChange,allowCapture:!0,error:a.error?.message})})})]}),e.jsx("div",{className:i?"":"my-8 border-t border-border"}),e.jsxs("div",{children:[e.jsx("h4",{className:`text-lg font-semibold text-center mb-4 ${i?"form-header-title":"text-primary-text"}`,children:"Fingerprints (Optional)"}),e.jsx("p",{className:`text-center mb-6 ${i?"text-gray-400":"text-muted"}`,children:"Upload scans for all 10 fingerprints, one image per finger."}),e.jsxs("div",{className:"w-full grid grid-cols-2 md:grid-cols-5 gap-4",children:[c("Left"),c("Right")]})]})]})]})};export{D as default};
