import{u as re,n as V,j as e,B as J,m as H,M as ve,F as ye,k as _e,D as Ae,T as Pe}from"./index-D5q3SS3D.js";import{b as r,u as Be}from"./react-vendor-BUaIliXj.js";import{i as ge,j as be,a2 as le,aN as Ie,b9 as We,aO as ze,aP as Ye,aQ as qe,aR as Ue,aX as Je,aY as Ke,b as we,f as ce,M as Ge,t as Qe,af as Ve,ba as Xe,bb as Ze,ao as Ee,as as et,at as tt,T as st}from"./ui-vendor-B8EvWqdc.js";import{c as Y,h as Q,b as Z,f,g as ne,y as Ne,z as ke,i as K,s as pe,e as Re,r as at,d as Fe,w as nt,x as rt,A as He,B as Te}from"./utils-vendor-DmorxLnX.js";import{H as lt}from"./HolidayCalendar-ycAr_EbJ.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./supabase-7WG3J4rU.js";const ot=({leaveRequests:i=[],userHolidays:d=[],currentDate:h,setCurrentDate:j})=>{const{user:p}=re(),{officeHolidays:N,fieldHolidays:F,attendance:m,recurringHolidays:B}=V(),[k,L]=r.useState([]),[O,T]=r.useState(!1),S=r.useMemo(()=>p?.role==="field_staff"?F:N,[p,F,N]),C=r.useMemo(()=>{const s=p?.role==="field_staff"?"field":"office";return B.filter(a=>(a.type||"office")===s)},[p,B]);r.useEffect(()=>{console.log("Active Recurring Rules:",C)},[C]);const n=r.useMemo(()=>{const s=[],a=Y(h),c=Q(h),x=Z({start:a,end:c}),w=(p?.role==="field_staff"?m?.field?.monthlyFloatingLeaves:m?.office?.monthlyFloatingLeaves)??0;let _=0;return C.forEach(E=>{if(_>=w)return;let v=0;for(const $ of x)if(f($,"EEEE").toLowerCase()===E.day.toLowerCase()&&(v++,v===E.n)){s.push($),_++;break}}),s},[h,C,m,p]);r.useEffect(()=>{console.log("Calculated Recurring Holiday Dates:",n)},[n]),r.useEffect(()=>{const s=async()=>{if(p){T(!0);try{const x=Y(h).toISOString(),w=Q(h).toISOString(),_=await H.getAttendanceEvents(p.id,x,w);L(_)}catch(x){console.error("Failed to fetch attendance events",x)}finally{T(!1)}}},a=async()=>{try{const x=V.getState().attendance;if(!x||Object.keys(x).length===0){console.log("Fetching attendance settings...");const w=await H.getAttendanceSettings();console.log("Fetched settings:",w),V.getState().updateAttendanceSettings(w)}}catch(x){console.error("Failed to fetch attendance settings",x)}},c=async()=>{try{const x=V.getState().recurringHolidays;if(!x||x.length===0){console.log("Fetching recurring holidays...");const w=await H.getRecurringHolidays();console.log("Fetched recurring holidays:",w),V.setState({recurringHolidays:w})}}catch(x){console.error("Failed to fetch recurring holidays",x)}};s(),a(),c()},[p,h]);const t=r.useMemo(()=>Z({start:Y(h),end:Q(h)}),[h]),l=s=>{const a=s.getFullYear(),c=p?.role==="field_staff"?"field":"office";m?.[c]?.holidayPool||ve;const x=k.some(u=>K(new Date(u.timestamp),s)&&(u.type.toLowerCase().includes("check")||u.type.toLowerCase().includes("in"))),w=n.some(u=>K(u,s)),_=m?.[c]?.floatingLeavesExpiryDate,E=_&&f(s,"yyyy-MM-dd")>_,v=f(s,"yyyy-MM-dd"),$=m?.[c]?.earnedLeavesExpiryDate,g=m?.[c]?.sickLeavesExpiryDate,q=m?.[c]?.compOffLeavesExpiryDate,A=$&&v>$,W=g&&v>g,P=q&&v>q,I=S.some(u=>{const[z,R,b]=u.date.split("-").map(Number);return K(new Date(z,R-1,b),s)}),G=ye.some(u=>{const[z,R]=u.date.split("-").map(Number),b=new Date(a,z-1,R);return K(b,s)}),X=d.some(u=>{const[z,R,b]=u.holidayDate.split("-").map(Number),me=new Date(z,R-1,b);return K(me,s)}),ee=I||G||X,U=ne(s)===0,te=E&&A&&W&&P,oe=i.some(u=>{if(u.status!=="approved"&&u.status!=="pending_hr_confirmation")return!1;const z=new Date(u.startDate),R=new Date(u.endDate);return s>=pe(z)&&s<=Re(R)});return(w||ee||U)&&x?"holiday-present":oe?"leave":x?"present":te?"neutral":w&&!E?"floating-holiday":I||G||X?"company-holiday":U?"sunday":at(pe(new Date),pe(s))?"absent":"neutral"},y=s=>{switch(s){case"present":return"bg-emerald-500 text-white border-emerald-600 shadow-sm";case"absent":return"bg-red-500 text-white border-red-600 shadow-sm";case"sunday":return"bg-rose-300 text-gray-800 border-rose-400 shadow-sm";case"company-holiday":return"bg-sky-400 text-white border-sky-500 shadow-sm";case"floating-holiday":return"bg-amber-500 text-white border-amber-600 shadow-sm";case"holiday-present":return"bg-violet-600 text-white border-violet-700 shadow-sm";case"leave":return"bg-blue-600 text-white border-blue-700 shadow-sm";default:return"bg-gray-50 text-gray-400 border-gray-100"}},D=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],M=ne(Y(h));return e.jsxs("div",{className:"bg-card p-5 rounded-xl shadow-card border border-border w-full md:max-w-[350px] flex flex-col min-h-[460px]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 flex-shrink-0",children:[e.jsx("h3",{className:"text-sm font-semibold text-primary-text",children:"Attendance Calendar"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{variant:"secondary",size:"sm",className:"btn-icon !p-1 h-6 w-6",onClick:()=>j(Ne(h)),children:e.jsx(ge,{className:"h-3 w-3"})}),e.jsx("span",{className:"font-medium min-w-[80px] text-center text-sm",children:f(h,"MMMM yyyy")}),e.jsx(J,{variant:"secondary",size:"sm",className:"btn-icon !p-1 h-6 w-6",onClick:()=>j(ke(h,1)),children:e.jsx(be,{className:"h-3 w-3"})})]})]}),O?e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx(le,{className:"h-5 w-5 animate-spin text-muted"})}):e.jsxs("div",{className:"grid grid-cols-7 gap-1 flex-1",children:[D.map(s=>e.jsx("div",{className:"text-center text-[10px] font-bold text-muted uppercase tracking-wider py-1",children:s},s)),Array.from({length:M}).map((s,a)=>e.jsx("div",{className:"aspect-square"},`empty-${a}`)),t.map(s=>{const a=l(s),c=y(a);return e.jsx("div",{className:`aspect-square rounded border flex flex-col items-center justify-center ${c} transition-colors`,children:e.jsx("span",{className:"text-xs font-bold",children:f(s,"d")})},s.toISOString())})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-border/50 grid grid-cols-3 gap-x-2 gap-y-2 text-[11px] text-muted-foreground uppercase font-bold tracking-tight",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full flex-shrink-0"})," Present"]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full flex-shrink-0"})," Absent"]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 bg-rose-300 rounded-full flex-shrink-0"})," W.O"]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 bg-sky-400 rounded-full flex-shrink-0"})," Holiday"]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 bg-amber-500 rounded-full flex-shrink-0"})," Floating Holiday"]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 bg-violet-600 rounded-full flex-shrink-0"})," C.O"]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full flex-shrink-0"})," Leave"]})]})]})},it=({logs:i,leaveRequests:d=[],userHolidays:h=[],isLoading:j=!1})=>{const{user:p}=re(),{officeHolidays:N,fieldHolidays:F,recurringHolidays:m,attendance:B}=V(),[k,L]=r.useState(new Date),[O,T]=r.useState([]),[S,C]=r.useState(!1),n=r.useMemo(()=>p?.role==="field_staff"?F:N,[p,F,N]);r.useEffect(()=>{(async()=>{if(p){C(!0);try{const c=Y(k).toISOString(),x=Q(k).toISOString(),w=await H.getAttendanceEvents(p.id,c,x);T(w)}catch(c){console.error("Failed to fetch attendance events for CompOffCalendar",c)}finally{C(!1)}}})()},[p,k]);const t=r.useMemo(()=>Z({start:Y(k),end:Q(k)}),[k]),l=a=>{const c=a.getFullYear(),x=p?.role==="field_staff"?"field":"office";if(B?.[x]?.holidayPool||ve,d.some(v=>{if(v.leaveType!=="Comp Off"||v.status!=="approved")return!1;const $=new Date(v.startDate.replace(/-/g,"/")),g=new Date(v.endDate.replace(/-/g,"/"));return a>=$&&a<=g}))return"taken";if(i.some(v=>{const $=new Date(v.dateEarned.replace(/-/g,"/"));return K($,a)}))return"earned";if(O.some(v=>K(new Date(v.timestamp),a)&&(v.type.toLowerCase().includes("check")||v.type.toLowerCase().includes("in")))){const v=ne(a)===0,$=ye.some(A=>{const[W,P]=A.date.split("-").map(Number),I=new Date(c,W-1,P);return K(I,a)}),g=h.some(A=>{const[W,P,I]=A.holidayDate.split("-").map(Number),G=new Date(W,P-1,I);return K(G,a)}),q=n.some(A=>{const[W,P,I]=A.date.split("-").map(Number);return K(new Date(W,P-1,I),a)});if(v||$||g||q)return"earned"}return"neutral"},y=a=>{switch(a){case"earned":return"bg-emerald-500 text-white border-emerald-600 shadow-sm";case"taken":return"bg-red-500 text-white border-red-600 shadow-sm";default:return"bg-gray-50 text-gray-400 border-gray-100"}},D=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],M=ne(Y(k)),s=j||S;return e.jsxs("div",{className:"bg-card p-5 rounded-xl shadow-card border border-border w-full md:max-w-[350px] flex flex-col min-h-[460px]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 flex-shrink-0",children:[e.jsx("h3",{className:"text-sm font-semibold text-primary-text",children:"Comp Off Tracker"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{variant:"secondary",size:"sm",className:"btn-icon !p-1 h-6 w-6",onClick:()=>L(Ne(k)),children:e.jsx(ge,{className:"h-3 w-3"})}),e.jsx("span",{className:"font-medium min-w-[80px] text-center text-sm",children:f(k,"MMMM yyyy")}),e.jsx(J,{variant:"secondary",size:"sm",className:"btn-icon !p-1 h-6 w-6",onClick:()=>L(ke(k,1)),children:e.jsx(be,{className:"h-3 w-3"})})]})]}),s?e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx(le,{className:"h-5 w-5 animate-spin text-muted"})}):e.jsxs("div",{className:"grid grid-cols-7 gap-1 flex-1",children:[D.map(a=>e.jsx("div",{className:"text-center text-[10px] font-bold text-muted uppercase tracking-wider py-1",children:a},a)),Array.from({length:M}).map((a,c)=>e.jsx("div",{className:"aspect-square"},`empty-${c}`)),t.map(a=>{const c=l(a),x=y(c);return e.jsx("div",{className:`aspect-square rounded border flex flex-col items-center justify-center ${x} transition-colors`,children:e.jsx("span",{className:"text-xs font-bold",children:f(a,"d")})},a.toISOString())})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-border/50 grid grid-cols-2 gap-x-3 gap-y-2 text-[11px] text-muted-foreground uppercase font-bold tracking-tight",children:[e.jsxs("div",{className:"flex items-center gap-1.5 justify-center",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full flex-shrink-0"})," Earned"]}),e.jsxs("div",{className:"flex items-center gap-1.5 justify-center",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full flex-shrink-0"})," Taken"]})]})]})},dt=()=>{const{user:i}=re(),[d,h]=r.useState(new Date),[j,p]=r.useState([]),[N,F]=r.useState(!1),[m,B]=r.useState(8);r.useEffect(()=>{(async()=>{if(i){F(!0);try{const t=Y(d).toISOString(),l=Q(d).toISOString(),[y,D]=await Promise.all([H.getAttendanceEvents(i.id,t,l),H.getAttendanceSettings()]);p(y);let M="field";const s=i.role.toLowerCase();["admin","hr","finance","developer","management","office_staff","back_office_staff","bd","operation_manager","field_staff","finance_manager","hr_ops","business developer","unverified","operation manager","field staff","finance manager","hr ops"].includes(s)?M="office":["site_manager","site_supervisor","site manager","site supervisor"].includes(s)&&(M="site");const c=D[M]?.dailyWorkingHours?.max||8;B(c)}catch(t){console.error("Failed to fetch attendance data",t)}finally{F(!1)}}})()},[i,d]);const k=r.useMemo(()=>Z({start:Y(d),end:Q(d)}),[d]),L=n=>{const t=j.filter(a=>K(new Date(a.timestamp),n));if(t.length===0)return{hoursOT:0,hasOtPunch:!1};const l=[...t].sort((a,c)=>new Date(a.timestamp).getTime()-new Date(c.timestamp).getTime());let y=0,D=null,M=!1;l.forEach(a=>{const c=new Date(a.timestamp);a.type==="check-in"?(D=c,a.isOt&&(M=!0)):a.type==="check-out"&&D&&(y+=Fe(c,D),D=null)});const s=Math.max(0,y-m*60);return{hoursOT:Math.floor(s/60),minutesOT:Math.round(s%60),hasOtPunch:M}},O=(n,t)=>{if(n===0&&t===0)return"";const l=t.toString().padStart(2,"0");return`${n.toString().padStart(2,"0")}:${l}`},T=r.useMemo(()=>{let n=0;const t=new Set;return j.forEach(l=>{const y=f(new Date(l.timestamp),"yyyy-MM-dd");if(!t.has(y)){const{hoursOT:D,minutesOT:M}=L(new Date(l.timestamp));n+=D*60+M,t.add(y)}}),{h:Math.floor(n/60),m:n%60,totalMins:n}},[j,m]),S=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],C=ne(Y(d));return e.jsxs("div",{className:"bg-card p-5 rounded-xl shadow-card border border-border w-full md:max-w-[350px] flex flex-col min-h-[460px]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 flex-shrink-0",children:[e.jsx("h3",{className:"text-sm font-semibold text-primary-text",children:"OT Calendar"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{variant:"secondary",size:"sm",className:"btn-icon !p-1 h-6 w-6",onClick:()=>h(Ne(d)),children:e.jsx(ge,{className:"h-3 w-3"})}),e.jsx("span",{className:"font-medium min-w-[80px] text-center text-sm",children:f(d,"MMMM yyyy")}),e.jsx(J,{variant:"secondary",size:"sm",className:"btn-icon !p-1 h-6 w-6",onClick:()=>h(ke(d,1)),children:e.jsx(be,{className:"h-3 w-3"})})]})]}),N?e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx(le,{className:"h-5 w-5 animate-spin text-muted"})}):e.jsxs("div",{className:"grid grid-cols-7 gap-1 flex-1",children:[S.map(n=>e.jsx("div",{className:"text-center text-[10px] font-bold text-muted uppercase tracking-wider py-1",children:n},n)),Array.from({length:C}).map((n,t)=>e.jsx("div",{className:"aspect-square"},`empty-${t}`)),k.map(n=>{const{hoursOT:t,minutesOT:l,hasOtPunch:y}=L(n),D=t+l>0,M=y?"bg-orange-600 text-white border-orange-700 shadow-sm":D?"bg-blue-600 text-white border-blue-700 shadow-sm":"bg-gray-50 text-gray-400 border-gray-100";return e.jsxs("div",{className:`aspect-square rounded border flex flex-col items-center justify-center transition-colors ${M}`,children:[e.jsx("span",{className:"text-xs font-bold",children:f(n,"d")}),t+l>0&&e.jsx("span",{className:"text-[10px] font-bold mt-1",children:O(t,l)}),y&&!D&&e.jsx("span",{className:"text-[9px] font-bold",children:"OT"})]},n.toISOString())})]}),e.jsxs("div",{className:"mb-4 p-3 bg-accent-light/30 rounded-lg border border-accent-light/50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm font-semibold text-primary-text",children:"This Month's OT"}),e.jsxs("span",{className:"text-lg font-bold text-accent-dark",children:[T.h,"h ",T.m,"m"]})]}),e.jsxs("div",{className:"flex justify-between items-center text-[11px] text-muted",children:[e.jsx("span",{children:"Pending in Bank"}),e.jsxs("span",{className:"font-medium",children:[Math.floor(i?.otHoursBank||0),"h ",Math.round((i?.otHoursBank||0)%1*60),"m / 8h"]})]}),e.jsx("div",{className:"w-full bg-border/30 h-1.5 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"bg-accent-dark h-full transition-all duration-500",style:{width:`${Math.min(100,(i?.otHoursBank||0)/8*100)}%`}})}),e.jsx("p",{className:"text-[10px] text-muted italic mt-2",children:"Every 8h of OT earns you 1 Comp Off automatically."})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-border/50 flex flex-wrap gap-2 text-[11px] text-muted-foreground uppercase font-bold tracking-tight",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full flex-shrink-0"})," Overtime (>",m,"h)"]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-600 rounded-full flex-shrink-0"})," OT Punch"]})]})]})};Ie.register(ze,Ye,qe,Ue,Je,Ke);const ct=()=>{const{user:i}=re(),{recurringHolidays:d,attendance:h,fieldHolidays:j,officeHolidays:p}=V(),[N,F]=r.useState([]),[m,B]=r.useState([]),[k,L]=r.useState([]),[O,T]=r.useState(!1),[S,C]=r.useState(new Date().getFullYear()),n=r.useRef(null),t=r.useRef(null);r.useEffect(()=>{(async()=>{if(i){T(!0);try{const a=nt(new Date(S,0,1)).toISOString(),c=rt(new Date(S,0,1)).toISOString(),[x,w,_]=await Promise.all([H.getAttendanceEvents(i.id,a,c),H.getUserHolidays(i.id),H.getLeaveRequests({userId:i.id,status:"approved",startDate:a,endDate:c})]);F(x),B(w.map(E=>E.holidayName)),L(_.data)}catch(a){console.error("Failed to fetch yearly chart data",a)}finally{T(!1)}}})()},[i,S]);const l=r.useMemo(()=>{const s=Array(12).fill(0),a=Array(12).fill(0),c=Array(12).fill(0),x=Array(12).fill(0),w=new Set;N.forEach(g=>{g.type.toLowerCase().includes("check-in")&&w.add(f(new Date(g.timestamp),"yyyy-MM-dd"))});const _=new Set;k.forEach(g=>{const q=new Date(g.startDate),A=new Date(g.endDate);Z({start:q,end:A}).forEach(P=>_.add(f(P,"yyyy-MM-dd")))});const E=d.filter(g=>(g.type||"office")===(i?.role==="field_staff"?"field":"office")),v=(i?.role==="field_staff"?h?.field?.monthlyFloatingLeaves:h?.office?.monthlyFloatingLeaves)??0,$=i?.role==="field_staff"?j:p;for(let g=0;g<12;g++){const q=Y(new Date(S,g,1)),A=Q(new Date(S,g,1)),W=Z({start:q,end:A});let P=0,I=0,G=0,X=0,ee=0;W.forEach(U=>{const te=f(U,"yyyy-MM-dd");if(w.has(te)){I++;return}if(_.has(te)){G++;return}const oe=$.some(b=>K(new Date(b.date),U)),o=ye.some(b=>b.date===f(U,"MM-dd")),u=ye.find(b=>b.date===f(U,"MM-dd")),z=u?m.includes(u.name):!1;let R=!1;if(P<v){for(const b of E)if(f(U,"EEEE").toLowerCase()===b.day.toLowerCase()&&Z({start:q,end:U}).filter(se=>f(se,"EEEE").toLowerCase()===b.day.toLowerCase()).length===b.n){R=!0;break}}if(oe||o||z||R){X++,R&&P++;return}if(ne(U)===0){ee++;return}}),s[g]=I,a[g]=G,c[g]=X,x[g]=ee}return{monthlyWorked:s,monthlyLeaves:a,monthlyHolidays:c,monthlySundays:x}},[N,m,k,d,h,i,S,j,p]),y=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];r.useEffect(()=>{if(n.current&&!O){t.current&&t.current.destroy();const s=n.current.getContext("2d");s&&(t.current=new Ie(s,{type:"bar",data:{labels:y,datasets:[{label:"WORKED",data:l.monthlyWorked,backgroundColor:"#6366f1",stack:"payable",borderRadius:4},{label:"LEAVES",data:l.monthlyLeaves,backgroundColor:"#8b5cf6",stack:"payable",borderRadius:4},{label:"HOLIDAYS",data:l.monthlyHolidays,backgroundColor:"#10b981",stack:"payable",borderRadius:4},{label:"WEEK OFFS",data:l.monthlySundays,backgroundColor:"#f59e0b",stack:"payable",borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"bottom",labels:{boxWidth:8,padding:10,font:{size:10,weight:700}}},tooltip:{backgroundColor:"#1e293b",padding:10,cornerRadius:8,callbacks:{footer:a=>`Total Paydays: ${a.reduce((x,w)=>x+w.raw,0)} days`}}},scales:{y:{stacked:!0,beginAtZero:!0,max:31,ticks:{stepSize:5,font:{size:10}},grid:{color:"rgba(0,0,0,0.05)"}},x:{stacked:!0,grid:{display:!1},ticks:{font:{size:10,weight:500},color:"#64748b"}}}}}))}return()=>{t.current&&t.current.destroy()}},[l,O]);const D=s=>{C(a=>a+s)},M=l.monthlyWorked.reduce((s,a)=>s+a,0)+l.monthlyLeaves.reduce((s,a)=>s+a,0)+l.monthlyHolidays.reduce((s,a)=>s+a,0)+l.monthlySundays.reduce((s,a)=>s+a,0);return e.jsxs("div",{className:"bg-card p-5 rounded-xl shadow-card border border-border w-full md:max-w-[350px] flex flex-col min-h-[460px]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-indigo-50 rounded-lg",children:e.jsx(We,{className:"h-4 w-4 text-indigo-600"})}),e.jsx("h3",{className:"text-sm font-semibold text-primary-text",children:"Yearly Attendance"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>D(-1),className:"p-1 hover:bg-gray-100 rounded-md transition-colors",children:e.jsx(ge,{className:"h-4 w-4 text-muted"})}),e.jsx("span",{className:"text-sm font-bold text-gray-700 min-w-[40px] text-center",children:S}),e.jsx("button",{onClick:()=>D(1),className:"p-1 hover:bg-gray-100 rounded-md transition-colors",disabled:S>=new Date().getFullYear(),children:e.jsx(be,{className:"h-4 w-4 text-muted"})})]})]}),e.jsxs("div",{className:"flex-1 relative min-h-[250px]",children:[O?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/50 z-10",children:e.jsx(le,{className:"h-6 w-6 animate-spin text-indigo-600"})}):null,e.jsx("canvas",{ref:n})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-border/50 flex flex-col gap-1 text-[11px] text-muted",children:[e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Total Paydays:"}),e.jsxs("span",{className:"font-bold text-indigo-600 text-sm",children:[M," days"]})]}),e.jsxs("div",{className:"flex justify-between items-center opacity-80",children:[e.jsxs("span",{title:"Worked + Leaves + Holidays + Week Offs",children:["(W: ",l.monthlyWorked.reduce((s,a)=>s+a,0)," + L: ",l.monthlyLeaves.reduce((s,a)=>s+a,0)," + H: ",l.monthlyHolidays.reduce((s,a)=>s+a,0)," + WO: ",l.monthlySundays.reduce((s,a)=>s+a,0),")"]}),e.jsxs("span",{children:["Avg: ",(M/(S<new Date().getFullYear()?12:new Date().getMonth()+1)).toFixed(1),"/mo"]})]})]})]})},mt=()=>{const{user:i}=re(),[d,h]=r.useState([]),[j,p]=r.useState(!0),[N,F]=r.useState("day"),[m,B]=r.useState(new Date);_e("(max-width: 767px)");const k=async()=>{if(i){p(!0);try{let n,t;switch(N){case"day":n=pe(m),t=Re(m);break;case"week":n=He(m,{weekStartsOn:1}),t=Te(m,{weekStartsOn:1});break;case"month":n=Y(m),t=Q(m);break}const l=await H.getAttendanceEvents(i.id,n.toISOString(),t.toISOString());h(l)}catch(n){console.error("Failed to fetch attendance events:",n)}finally{p(!1)}}};r.useEffect(()=>{k()},[i,N,m]);const L=r.useMemo(()=>{const n={};return d.forEach(t=>{const l=f(new Date(t.timestamp),"yyyy-MM-dd");n[l]||(n[l]={date:l,events:[],checkIns:[],checkOuts:[],totalWorkMinutes:0,totalBreakMinutes:0}),n[l].events.push(t),t.type==="check-in"?n[l].checkIns.push(t):t.type==="check-out"&&n[l].checkOuts.push(t)}),Object.values(n).forEach(t=>{const{totalHours:l,breakHours:y}=Ae(t.events);t.totalWorkMinutes=l*60-y*60,t.totalBreakMinutes=y*60}),Object.values(n).sort((t,l)=>l.date.localeCompare(t.date))},[d]),O=n=>{const t=Math.floor(n/60),l=n%60;return`${t}h ${l}m`},T=n=>{F(n)},S=n=>{const t=new Date(m);switch(N){case"day":t.setDate(t.getDate()+(n==="next"?1:-1));break;case"week":t.setDate(t.getDate()+(n==="next"?7:-7));break;case"month":t.setMonth(t.getMonth()+(n==="next"?1:-1));break}B(t)},C=()=>{switch(N){case"day":return f(m,"dd MMM, yyyy");case"week":const n=He(m,{weekStartsOn:1}),t=Te(m,{weekStartsOn:1});return`${f(n,"dd MMM")} - ${f(t,"dd MMM, yyyy")}`;case"month":return f(m,"MMMM yyyy")}};return i?e.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card w-full",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[e.jsx("div",{className:"p-1.5 bg-indigo-50 rounded-lg",children:e.jsx(we,{className:"h-5 w-5 text-indigo-600"})}),e.jsx("h3",{className:"text-lg md:text-xl font-bold text-gray-900",children:"Employee Log"})]}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>T("day"),className:`flex-1 px-4 py-2 rounded-lg font-medium transition-all ${N==="day"?"bg-indigo-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Day"}),e.jsx("button",{onClick:()=>T("week"),className:`flex-1 px-4 py-2 rounded-lg font-medium transition-all ${N==="week"?"bg-indigo-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Week"}),e.jsx("button",{onClick:()=>T("month"),className:`flex-1 px-4 py-2 rounded-lg font-medium transition-all ${N==="month"?"bg-indigo-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Month"})]}),e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 rounded-lg p-3",children:[e.jsx("button",{onClick:()=>S("prev"),className:"px-3 py-1 bg-white rounded-md shadow-sm hover:bg-gray-100 transition-colors",children:"←"}),e.jsxs("div",{className:"flex items-center gap-2 font-semibold text-gray-900",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx("span",{children:C()})]}),e.jsx("button",{onClick:()=>S("next"),className:"px-3 py-1 bg-white rounded-md shadow-sm hover:bg-gray-100 transition-colors",children:"→"})]})]}),e.jsx("div",{className:"space-y-4",children:j?e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx(le,{className:"h-8 w-8 animate-spin text-indigo-600"})}):L.length===0?e.jsxs("div",{className:"text-center py-10 text-gray-500",children:[e.jsx(ce,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-medium",children:"No attendance records found"}),e.jsx("p",{className:"text-sm mt-1",children:"Check-in to start tracking your attendance"})]}):L.map(n=>e.jsxs("div",{className:"bg-gradient-to-br from-white to-gray-50 rounded-xl border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-indigo-600 to-indigo-500 px-4 py-3 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-white",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx("span",{className:"font-semibold",children:f(new Date(n.date),"EEEE, dd MMMM yyyy")})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"text-white text-xs font-medium bg-emerald-500/20 border border-emerald-400/30 px-2 py-1 rounded-md flex items-center gap-1",children:[e.jsx("span",{className:"opacity-75",children:"Work:"})," ",O(n.totalWorkMinutes)]}),e.jsxs("div",{className:"text-white text-xs font-medium bg-amber-500/20 border border-amber-400/30 px-2 py-1 rounded-md flex items-center gap-1",children:[e.jsx("span",{className:"opacity-75",children:"Break:"})," ",O(n.totalBreakMinutes)]})]})]}),e.jsx("div",{className:"p-4 space-y-3",children:n.events.sort((t,l)=>new Date(t.timestamp).getTime()-new Date(l.timestamp).getTime()).map((t,l)=>e.jsx("div",{className:`p-3 rounded-lg border-l-4 ${t.type==="check-in"?"bg-emerald-50 border-emerald-500":t.type==="check-out"?"bg-rose-50 border-rose-500":t.type==="break-in"?"bg-amber-50 border-amber-500":"bg-sky-50 border-sky-500"}`,children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${t.type==="check-in"?"bg-emerald-100 text-emerald-700":t.type==="check-out"?"bg-rose-100 text-rose-700":t.type==="break-in"?"bg-amber-100 text-amber-700":"bg-sky-100 text-sky-700"}`,children:e.jsx(we,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:`font-semibold capitalize ${t.type==="check-in"?"text-emerald-900":t.type==="check-out"?"text-rose-900":t.type==="break-in"?"text-amber-900":"text-sky-900"}`,children:t.type==="check-in"?t.workType==="field"?"Check In":"Punch In":t.type==="check-out"?t.workType==="field"?"Check Out":"Punch Out":t.type.replace("-"," ")}),e.jsx("div",{className:`text-sm font-medium ${t.type==="check-in"?"text-emerald-700":t.type==="check-out"?"text-rose-700":t.type==="break-in"?"text-amber-700":"text-sky-700"}`,children:f(new Date(t.timestamp),"hh:mm a")})]})]}),(t.locationName||t.latitude&&t.longitude)&&e.jsxs("div",{className:"flex items-start gap-2 text-sm bg-white px-3 py-1.5 rounded-lg border border-gray-200 max-w-md",children:[e.jsx(Ge,{className:"h-4 w-4 text-indigo-400 md:text-indigo-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-xs break-words text-gray-700",children:t.locationName||`${t.latitude?.toFixed(4)}, ${t.longitude?.toFixed(4)}`})]})]})},`${t.timestamp}-${l}`))}),e.jsx("div",{className:"bg-gray-50 px-4 py-3 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 text-xs",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Punch Ins:"}),e.jsx("span",{className:"ml-1 font-bold text-emerald-600",children:n.checkIns.length})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Punch Outs:"}),e.jsx("span",{className:"ml-1 font-bold text-rose-600",children:n.checkOuts.length})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Breaks In:"}),e.jsx("span",{className:"ml-1 font-bold text-amber-600",children:n.events.filter(t=>t.type==="break-in").length})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Breaks Out:"}),e.jsx("span",{className:"ml-1 font-bold text-sky-600",children:n.events.filter(t=>t.type==="break-out").length})]})]})})]},n.date))})]}):null},Le=({title:i,value:d,icon:h,isExpired:j})=>e.jsxs("div",{className:`bg-card p-3 md:p-4 rounded-xl flex flex-col md:flex-row items-center md:items-center gap-2 md:gap-4 border text-center md:text-left w-full ${j?"border-amber-500/50 bg-amber-500/5":"border-border"}`,children:[e.jsx("div",{className:`${j?"bg-amber-100":"bg-accent-light"} p-2 md:p-3 rounded-full flex-shrink-0`,children:e.jsx(h,{className:`h-5 w-5 md:h-6 md:w-6 ${j?"text-amber-600":"text-accent-dark"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-center md:justify-start gap-2",children:[e.jsx("p",{className:"text-xs md:text-sm text-muted font-medium",children:i}),j&&e.jsx("span",{className:"text-[10px] bg-amber-500 text-white px-1.5 py-0.5 rounded-full font-bold uppercase",children:"Expired"})]}),e.jsx("p",{className:`text-lg md:text-2xl font-bold ${j?"text-amber-600":"text-primary-text"}`,children:d})]})]}),xt=({status:i})=>{const d={pending_manager_approval:"leave-status-chip--pending_manager_approval",pending_hr_confirmation:"leave-status-chip--pending_hr_confirmation",approved:"leave-status-chip--approved",rejected:"leave-status-chip--rejected",cancelled:"leave-status-chip--cancelled",withdrawn:"leave-status-chip--withdrawn"},h=i.replace(/_/g," ");return e.jsx("span",{className:`leave-status-chip ${d[i]}`,children:h})},wt=()=>{const{user:i}=re(),[d,h]=r.useState(null),[j,p]=r.useState([]),[N,F]=r.useState([]),[m,B]=r.useState(!0),[k,L]=r.useState(!1),[O,T]=r.useState("all"),[S,C]=r.useState(null),[n,t]=r.useState(null),l=_e("(max-width: 767px)"),y=Be(),[D,M]=r.useState(0),[s,a]=r.useState([]),[c,x]=r.useState(!1),[w,_]=r.useState([]),[E,v]=r.useState(new Date),[$,g]=r.useState(8);E.getFullYear();const q=o=>{const u=Math.round((o||0)*60),z=Math.floor(u/60),R=u%60;return`${z}h ${R}m`},{officeHolidays:A,fieldHolidays:W}=V(),P=r.useMemo(()=>i?i.role==="field_staff"?W:A:[],[i,W,A]),I=r.useCallback(async()=>{if(i){B(!0),L(!1);try{const o=f(E,"yyyy-MM-dd"),[u,z,R]=await Promise.all([H.getLeaveBalancesForUser(i.id,o),H.getLeaveRequests({userId:i.id,status:O==="all"?void 0:O}).then(b=>b.data),H.getCompOffLogs(i.id).catch(b=>{if(b&&b.message&&(b.message.includes("comp_off_logs")||b.message.includes('relation "public.comp_off_logs" does not exist')))return L(!0),[];throw b})]);if(h(u),p(z),F(R),i.role==="field_staff"){const b=Y(E).toISOString(),me=Q(E).toISOString(),Se=await H.getAttendanceEvents(i.id,b,me),se={};Se.forEach(ae=>{const ie=f(new Date(ae.timestamp),"yyyy-MM-dd");se[ie]||(se[ie]=[]),se[ie].push(ae)});const $e=await H.getAttendanceSettings();let xe="field";const De=i.role.toLowerCase();["admin","hr","finance","developer","management","office_staff","back_office_staff","bd","operation_manager","field_staff","finance_manager","hr_ops","business developer","unverified","operation manager","field staff","finance manager","hr ops"].includes(De)?xe="office":["site_manager","site_supervisor","site manager","site supervisor"].includes(De)?xe="site":xe="field";const he=$e[xe],je=he?.dailyWorkingHours?.max||8;g(je);let Me=0;if(Object.values(se).forEach(ae=>{const ie=[...ae].sort((de,fe)=>new Date(de.timestamp).getTime()-new Date(fe.timestamp).getTime());let Ce=0,ue=null;ie.forEach(de=>{const fe=new Date(de.timestamp);de.type==="check-in"?ue=fe:de.type==="check-out"&&ue&&(Ce+=Fe(fe,ue),ue=null)});const Oe=Ce/60;Oe>je&&(Me+=Oe-je)}),M(parseFloat(Me.toFixed(1))),x(he?.enableCustomHolidays||!1),_(he?.holidayPool||ve),he?.enableCustomHolidays){const ae=await H.getUserHolidays(i.id);a(ae)}}}catch(o){let u="Failed to load leave data.";o&&typeof o.message=="string"&&o.message.includes('relation "leave_requests" does not exist')&&(u='Database setup error: The "leave_requests" table is missing.'),console.error("Failed to load leave data",o),k||C({message:u,type:"error"})}finally{B(!1)}}},[i,O,E]);r.useEffect(()=>{I()},[I]);const G=()=>{y("/leaves/apply")},X=o=>{y(`/leaves/apply?edit=${o}`)},ee=async o=>{if(window.confirm("Are you sure you want to withdraw this leave request?")){t(o);try{await H.withdrawLeaveRequest(o,i.id),C({message:"Leave request withdrawn successfully.",type:"success"}),I()}catch{C({message:"Failed to withdraw leave request.",type:"error"})}finally{t(null)}}},U=o=>o.replace(/_/g," ").replace(/\b\w/g,u=>u.toUpperCase()),te=["all","pending_manager_approval","pending_hr_confirmation","approved","rejected"],oe=d?[{title:"Earned Leave",value:`${Math.max(0,d.earnedTotal-d.earnedUsed)} / ${d.earnedTotal}`,icon:Qe,isExpired:d.expiryStates?.earned},{title:"Sick Leave",value:`${Math.max(0,d.sickTotal-d.sickUsed)} / ${d.sickTotal}`,icon:Ve,isExpired:d.expiryStates?.sick},{title:"Floating Holiday",value:`${Math.max(0,d.floatingTotal-d.floatingUsed)} / ${d.floatingTotal}`,icon:Xe,isExpired:d.expiryStates?.floating},{title:"Compensatory Off",value:`${Math.max(0,d.compOffTotal-d.compOffUsed)} / ${d.compOffTotal}`,icon:Ze,isExpired:d.expiryStates?.compOff}].filter(o=>!o.isExpired):[];return e.jsxs("div",{className:"p-4 space-y-6",children:[S&&e.jsx(Pe,{message:S.message,type:S.type,onDismiss:()=>C(null)}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-primary-text",children:"My Leave Requests"}),!l&&e.jsx("div",{className:"flex gap-2",children:e.jsxs(J,{onClick:G,children:[e.jsx(Ee,{className:"mr-2 h-4"})," New Request"]})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-6 justify-items-center md:justify-items-start",children:[oe.map(o=>e.jsx(Le,{...o},o.title)),e.jsxs("div",{className:"relative group w-full",children:[e.jsx(Le,{title:"Monthly OT Hours",value:q(i?.monthlyOtHours||0),icon:we}),e.jsx("div",{className:"absolute top-0 right-0 p-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs("div",{className:"bg-popover text-popover-foreground text-[10px] p-2 rounded shadow-lg border border-border w-48 pointer-events-none",children:[e.jsx("p",{className:"font-bold border-b border-border mb-1 pb-1",children:"OT Accumulation"}),e.jsxs("p",{children:["Current Bank: ",e.jsx("span",{className:"text-accent-dark font-bold",children:q(i?.otHoursBank||0)})]}),e.jsx("p",{className:"mt-1 text-muted-foreground italic",children:"Every 8h of accumulated OT is automatically converted to 1 Comp Off."})]})})]})]}),c&&(l?e.jsxs("div",{className:"bg-[#0f291e]/80 backdrop-blur-md rounded-2xl border border-white/5 p-5 shadow-xl relative overflow-hidden group mb-6",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-emerald-500/10 rounded-full blur-3xl -mr-10 -mt-10 pointer-events-none"}),e.jsxs("div",{className:"flex flex-col gap-4 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-emerald-500/20 rounded-xl",children:e.jsx(ce,{className:"h-6 w-6 text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"Holiday Selection"}),e.jsx("p",{className:"text-emerald-100/60 text-xs text-left",children:"Pick 6 holidays from the company list"})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-3 w-full",children:[e.jsx("div",{className:"px-3 py-1 bg-black/40 rounded-full border border-white/10",children:e.jsxs("span",{className:`text-sm font-bold ${s.length===6?"text-emerald-400":"text-amber-400"}`,children:[s.length," / 6 Selected"]})}),e.jsx(J,{onClick:()=>y("/leaves/holiday-selection"),className:"w-full justify-center",children:s.length>0?"Update Selection":"Select Holidays"})]})]})]}):e.jsxs("div",{className:"bg-white p-5 rounded-2xl border border-gray-100 shadow-sm flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx("div",{className:"p-3 bg-emerald-50 rounded-xl",children:e.jsx(ce,{className:"h-7 w-7 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Holiday Selection"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Pick 6 holidays from the company list to complete your allowance."})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex flex-col items-end mr-2",children:[e.jsxs("span",{className:`text-sm font-bold ${s.length===6?"text-emerald-600":"text-amber-600"}`,children:[s.length," / 6 Selected"]}),e.jsx("div",{className:"w-32 h-1.5 bg-gray-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-500 ${s.length===6?"bg-emerald-500":"bg-amber-500"}`,style:{width:`${s.length/6*100}%`}})})]}),e.jsx(J,{onClick:()=>y("/leaves/holiday-selection"),className:"px-8 py-2.5",children:s.length>0?"Update Selection":"Select Holidays"})]})]})),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 items-start overflow-x-auto pb-4 custom-scrollbar-horizontal",children:[e.jsx(ot,{leaveRequests:j,userHolidays:s,currentDate:E,setCurrentDate:v}),e.jsx(it,{logs:N,leaveRequests:j,userHolidays:s,isLoading:m}),e.jsx(lt,{adminHolidays:P,userSelectedHolidays:s,isLoading:m}),e.jsx(ct,{}),e.jsx(dt,{})]}),l&&e.jsx("div",{className:"my-4 w-full",children:e.jsxs(J,{onClick:G,size:"lg",className:"w-full justify-center text-lg",children:[e.jsx(Ee,{className:"mr-2 h-5"})," New Request"]})}),e.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card w-full md:w-full",children:[e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"w-full sm:w-auto md:border-b border-border",children:e.jsx("nav",{className:"flex flex-col md:flex-row md:space-x-6 space-y-2 md:space-y-0","aria-label":"Tabs",children:te.map(o=>e.jsx("button",{onClick:()=>T(o),className:`whitespace-nowrap font-medium text-base rounded-lg md:rounded-none w-full md:w-auto text-left px-4 py-2 md:px-1 md:py-3 md:bg-transparent md:border-b-2
                                    ${O===o?"bg-accent-light text-accent-dark md:border-accent":"text-muted hover:bg-accent-light hover:text-accent-dark md:border-transparent md:hover:border-accent"}`,children:U(o)},o))})})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full responsive-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted uppercase",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted uppercase",children:"Dates"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted uppercase",children:"Reason"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-border md:bg-card md:divide-y-0",children:m?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-10 text-muted",children:"Loading..."})}):j.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-10 text-muted text-lg",children:"No requests found."})}):j.map(o=>e.jsxs("tr",{children:[e.jsxs("td",{"data-label":"Type",className:"px-4 py-3 font-medium text-base",children:[o.leaveType," ",o.dayOption&&`(${o.dayOption})`]}),e.jsxs("td",{"data-label":"Dates",className:"px-4 py-3 text-muted text-base",children:[f(new Date(o.startDate.replace(/-/g,"/")),"dd MMM")," - ",f(new Date(o.endDate.replace(/-/g,"/")),"dd MMM")]}),e.jsx("td",{"data-label":"Reason",className:"px-4 py-3 text-muted max-w-xs truncate text-base",children:o.reason}),e.jsx("td",{"data-label":"Status",className:"px-4 py-3 text-base",children:e.jsx(xt,{status:o.status})}),e.jsx("td",{"data-label":"Actions",className:"px-4 py-3",children:o.status==="pending_manager_approval"?e.jsx("div",{className:"flex md:justify-start justify-end gap-2",children:n===o.id?e.jsx(le,{className:"h-5 w-5 animate-spin text-accent"}):e.jsxs(e.Fragment,{children:[e.jsx(J,{size:"sm",variant:"icon",onClick:()=>X(o.id),title:"Edit Request",children:e.jsx(et,{className:"h-4 w-4 text-emerald-600"})}),e.jsx(J,{size:"sm",variant:"icon",onClick:()=>ee(o.id),title:"Cancel Request",children:e.jsx(tt,{className:"h-4 w-4 text-red-500"})})]})}):e.jsx("span",{className:"text-[10px] text-muted italic",children:"No actions available"})})]},o.id))})]})})]}),e.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card w-full md:w-full",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary-text",children:"Compensatory Off Tracker"}),k?e.jsxs("div",{className:"text-center py-10 text-muted bg-page rounded-lg",children:[e.jsx(st,{className:"h-8 w-8 mx-auto mb-2 text-yellow-500"}),e.jsx("p",{className:"font-semibold",children:"Feature Unavailable"}),e.jsx("p",{className:"text-sm",children:"The Compensatory Off feature is disabled because the required 'comp_off_logs' table is missing in the database."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full responsive-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Date Earned"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Reason for Comp-Off"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Granted By"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-border md:bg-card md:divide-y-0",children:m?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-10 text-muted",children:"Loading..."})}):N.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-10 text-muted text-lg",children:"No comp-off history found."})}):N.map(o=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Date Earned",className:"px-4 py-3 font-medium",children:f(new Date(o.dateEarned.replace(/-/g,"/")),"dd MMM, yyyy")}),e.jsx("td",{"data-label":"Reason",className:"px-4 py-3 text-muted",children:o.reason}),e.jsx("td",{"data-label":"Granted By",className:"px-4 py-3 text-muted",children:o.grantedByName||"-"}),e.jsx("td",{"data-label":"Status",className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full capitalize ${o.status==="earned"?"bg-blue-100 text-blue-800":"bg-gray-200 text-gray-800"}`,children:o.status})})]},o.id))})]})})]}),e.jsx(mt,{})]})};export{wt as default};
