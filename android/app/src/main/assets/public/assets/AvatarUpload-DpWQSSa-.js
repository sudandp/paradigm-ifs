import{j as e,P as y}from"./index-D5q3SS3D.js";import{b as n}from"./react-vendor-BUaIliXj.js";import{C as N}from"./CameraCaptureModal-DQDGRnEP.js";import{a2 as C,at as k,as as L,b2 as R,T as U}from"./ui-vendor-B8EvWqdc.js";const E=({file:r,onFileChange:i})=>{const[o,A]=n.useState(!1),[d,p]=n.useState(""),[x,h]=n.useState(!1),u=n.useCallback(async(t,a)=>{if(t&&t.type.startsWith("image/")){p("");const s=a?`data:${t.type};base64,${a}`:URL.createObjectURL(t),c={name:t.name,type:t.type,size:t.size,preview:s,file:t};i(c)}},[i]),f=async t=>{const a=t.target.files?.[0];a&&u(a)},b=n.useCallback(async(t,a)=>{try{const s=atob(t),c=new ArrayBuffer(s.length),v=new Uint8Array(c);for(let l=0;l<s.length;l++)v[l]=s.charCodeAt(l);const j=new Blob([c],{type:a}),w=new File([j],`capture-${Date.now()}.jpg`,{type:a});u(w,t)}catch(s){console.error("Error processing captured avatar:",s),p("Failed to process captured photo.")}},[u]),g=()=>{r&&!r.preview.startsWith("data:")&&URL.revokeObjectURL(r.preview),i(null),p("")},m="avatar-upload";return e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[x&&e.jsx(N,{isOpen:x,onClose:()=>h(!1),onCapture:b,captureGuidance:"profile"}),e.jsxs("div",{className:"relative w-40 h-40 group",children:[e.jsx("div",{className:`
          w-full h-full rounded-full bg-page flex items-center justify-center overflow-hidden 
          border-2 transition-all duration-300 ring-4 ring-white shadow-2xl
          ${d?"border-red-500":"border-accent/20 group-hover:border-accent/40"}
        `,children:o?e.jsxs("div",{className:"flex flex-col items-center text-muted",children:[e.jsx(C,{className:"h-10 w-10 animate-spin text-accent"}),e.jsx("span",{className:"text-xs mt-2 font-medium",children:"Processing..."})]}):r?.preview?e.jsx("img",{src:r.preview,alt:"Profile preview",className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"}):e.jsx(y,{})}),r&&!o&&e.jsx("button",{type:"button",onClick:g,id:"avatar-delete-button",className:"avatar-delete-btn btn-icon absolute -top-1 -right-1 p-2 rounded-full transition-all !bg-white !text-red-600 shadow-lg hover:!bg-red-50 hover:scale-110 z-10","aria-label":"Remove photo",children:e.jsx(k,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("label",{htmlFor:m,className:`cursor-pointer inline-flex items-center justify-center font-semibold focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors duration-200 rounded-full bg-accent text-white hover:bg-accent-dark focus:ring-accent px-4 py-2 text-sm ${o?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),r?"Change":"Upload"]}),e.jsx("input",{id:m,name:m,type:"file",className:"sr-only",onChange:f,accept:"image/*",disabled:o}),e.jsxs("button",{type:"button",onClick:()=>h(!0),disabled:o,className:`avatar-capture-btn inline-flex items-center justify-center px-4 py-2 font-semibold rounded-full transition-colors duration-200 text-sm border border-red-200 !text-red-600 hover:!bg-red-50 !bg-card/70 backdrop-blur-sm ${o?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Capture"]})]}),d&&e.jsxs("p",{className:"text-xs text-red-600 text-center max-w-[160px] flex items-center gap-1",children:[e.jsx(U,{className:"h-3 w-3 flex-shrink-0"})," ",d]})]})};export{E as A};
