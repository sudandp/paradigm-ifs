import{k as E,c as B,j as e,T as U,B as D,m as j,C as $,I as M}from"./index-D5q3SS3D.js";import{u as H,l as O,b as g,R as A}from"./react-vendor-BUaIliXj.js";import{S as L}from"./Select-Dz12MdxG.js";import{a2 as _,J as G}from"./ui-vendor-B8EvWqdc.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./utils-vendor-DmorxLnX.js";import"./supabase-7WG3J4rU.js";const p=({title:u,sizes:c,headers:h,control:I,quantityType:k,quantities:z,readOnly:i=!1})=>{const v=Array.from(new Set(c.map(t=>t.fit))),F=Array.from(new Set(c.map(t=>t.size))).sort((t,n)=>{const y=parseInt(String(t)),a=parseInt(String(n));return!isNaN(y)&&!isNaN(a)?y-a:String(t).localeCompare(String(n))});return e.jsxs("div",{className:"border rounded-lg flex flex-col overflow-hidden bg-card",children:[e.jsx("h4",{className:"p-3 font-semibold bg-gray-50 dark:bg-white/5 border-b flex-shrink-0",children:u}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-white/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 text-left font-medium text-muted",children:"Size"}),h.map(t=>e.jsx("th",{className:"px-2 py-2 text-left font-medium text-muted",children:t.label},String(t.key))),e.jsx("th",{className:"px-2 py-2 text-left font-medium text-muted w-20",children:"Qty"})]})}),e.jsx("tbody",{className:"divide-y dark:divide-white/10",children:F.map(t=>e.jsx(A.Fragment,{children:v.map((n,y)=>{const a=c.find(s=>s.size===t&&s.fit===n);return a?e.jsxs("tr",{children:[y===0&&e.jsx("td",{rowSpan:v.filter(s=>c.some(x=>x.size===t&&x.fit===s)).length,className:"px-2 py-2 align-middle font-semibold border-r dark:border-white/10",children:t}),h.map(s=>e.jsx("td",{className:"px-2 py-2",children:a[s.key]},String(s.key))),e.jsx("td",{className:"px-2 py-2",children:i?e.jsx("span",{className:"font-semibold block text-center pr-4",children:z?.[a.id]||0}):e.jsx($,{name:`${k}.${a.id}`,control:I,render:({field:s})=>e.jsx(M,{"aria-label":`Quantity for ${u} size ${t} ${n}`,type:"number",...s,value:s.value||"",onChange:x=>s.onChange(parseInt(x.target.value)||null),className:"!py-1.5"})})})]},a.id):null})},t))})]})})]})},te=()=>{const u=H(),{id:c}=O(),h=!!c,I=E("(max-width: 767px)"),[k,z]=g.useState([]),[i,v]=g.useState(null),[F,t]=g.useState(!0),[n,y]=g.useState(!1),[a,s]=g.useState(null),[x,P]=g.useState(null),{register:w,control:f,handleSubmit:T,watch:W,reset:C}=B({defaultValues:{siteId:"",gender:"Gents",pantsQuantities:{},shirtsQuantities:{}}}),Q=W("gender");g.useEffect(()=>{(async()=>{t(!0);try{const[S,b,N]=await Promise.all([j.getOrganizations(),j.getMasterGentsUniforms(),j.getMasterLadiesUniforms()]);if(z(S),v({gents:b,ladies:N}),h&&c){const d=(await j.getUniformRequests()).find(r=>r.id===c);if(d){P(d);const r={},o={};d.items.forEach(m=>{m.category==="Pants"?r[m.sizeId]=m.quantity:o[m.sizeId]=m.quantity}),C({siteId:d.siteId,gender:d.gender,pantsQuantities:r,shirtsQuantities:o})}else s({message:"Request not found.",type:"error"}),setTimeout(()=>u("/uniforms"),2e3)}}catch{s({message:"Failed to load data.",type:"error"})}finally{t(!1)}})()},[c,h,u,C]);const R=async l=>{if(!i)return;const S=k.find(b=>b.id===l.siteId);if(S){y(!0);try{const b=Q==="Gents"?[...i.gents.pants,...i.gents.shirts]:[...i.ladies.pants,...i.ladies.shirts],N=[];for(const[d,r]of Object.entries(l.pantsQuantities))if(r&&r>0){const o=b.find(m=>m.id===d);o&&N.push({sizeId:d,quantity:r,category:"Pants",sizeLabel:o.size,fit:o.fit})}for(const[d,r]of Object.entries(l.shirtsQuantities))if(r&&r>0){const o=b.find(m=>m.id===d);o&&N.push({sizeId:d,quantity:r,category:"Shirts",sizeLabel:o.size,fit:o.fit})}const q={id:x?.id||`new_${Date.now()}`,siteId:l.siteId,siteName:S.shortName,gender:l.gender,requestedDate:x?.requestedDate||new Date().toISOString(),status:x?.status||"Pending",items:N};q.id.startsWith("new_")?(await j.submitUniformRequest(q),s({message:"New request submitted.",type:"success"})):(await j.updateUniformRequest(q),s({message:"Request updated.",type:"success"})),setTimeout(()=>u("/uniforms"),1500)}catch{s({message:"Failed to save request.",type:"error"})}finally{y(!1)}}};return F?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(_,{className:"h-8 w-8 animate-spin text-emerald-600"})}):i?I?e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("header",{className:"p-4 flex-shrink-0 fo-mobile-header",children:e.jsx("h1",{children:h?"Edit Request":"New Request"})}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4",children:e.jsxs("div",{className:"bg-card rounded-2xl p-6 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block bg-accent-light p-3 rounded-full mb-2",children:e.jsx(G,{className:"h-8 w-8 text-accent-dark"})}),e.jsx("h2",{className:"text-xl font-bold text-primary-text",children:h?"Edit Uniform Request":"New Uniform Request"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Submit a request for new uniforms."})]}),e.jsxs("form",{onSubmit:T(R),className:"space-y-6",children:[e.jsxs(L,{label:"Select Site",...w("siteId"),required:!0,children:[e.jsx("option",{value:"",children:"-- Select a Site --"}),k.map(l=>e.jsx("option",{value:l.id,children:l.shortName},l.id))]}),e.jsxs(L,{label:"Select Uniform Type",...w("gender"),children:[e.jsx("option",{children:"Gents"}),e.jsx("option",{children:"Ladies"})]}),e.jsx("div",{className:"space-y-6",children:Q==="Gents"?e.jsxs(e.Fragment,{children:[e.jsx(p,{title:"Gents' Pants",sizes:i.gents.pants,headers:[{key:"length",label:"L"},{key:"waist",label:"W"},{key:"hip",label:"H"},{key:"tilesLoose",label:"TL"},{key:"bottomWaist",label:"BW"},{key:"fit",label:"Fit"}],control:f,quantityType:"pantsQuantities"}),e.jsx(p,{title:"Gents' Shirts",sizes:i.gents.shirts,headers:[{key:"length",label:"L"},{key:"sleeves",label:"S"},{key:"chest",label:"C"},{key:"shoulder",label:"Sh"},{key:"collar",label:"Co"},{key:"fit",label:"Fit"}],control:f,quantityType:"shirtsQuantities"})]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{title:"Ladies' Pants",sizes:i.ladies.pants,headers:[{key:"length",label:"L"},{key:"waist",label:"W"},{key:"hip",label:"H"},{key:"fit",label:"Fit"}],control:f,quantityType:"pantsQuantities"}),e.jsx(p,{title:"Ladies' Shirts",sizes:i.ladies.shirts,headers:[{key:"length",label:"L"},{key:"sleeves",label:"S"},{key:"bust",label:"B"},{key:"shoulder",label:"Sh"},{key:"fit",label:"Fit"}],control:f,quantityType:"shirtsQuantities"})]})})]})]})}),e.jsxs("footer",{className:"p-4 flex-shrink-0 flex items-center gap-4",children:[e.jsx("button",{type:"button",onClick:()=>u("/uniforms"),disabled:n,className:"fo-btn-secondary px-6",children:"Cancel"}),e.jsx("button",{type:"submit",onClick:T(R),disabled:n,className:"fo-btn-primary flex-1",children:n?"Saving...":"Save Request"})]}),a&&e.jsx(U,{message:a.message,type:a.type,onDismiss:()=>s(null)})]}):e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"bg-card p-8 rounded-xl shadow-card w-full max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"bg-accent-light p-3 rounded-full mr-4",children:e.jsx(G,{className:"h-8 w-8 text-accent-dark"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-primary-text",children:h?"Edit Uniform Request":"New Uniform Request"}),e.jsx("p",{className:"text-muted",children:"Submit a request for new uniforms."})]})]}),e.jsxs("form",{onSubmit:T(R),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(L,{label:"Select Site",...w("siteId"),required:!0,children:[e.jsx("option",{value:"",children:"-- Select a Site --"}),k.map(l=>e.jsx("option",{value:l.id,children:l.shortName},l.id))]}),e.jsxs(L,{label:"Select Uniform Type",...w("gender"),children:[e.jsx("option",{children:"Gents"}),e.jsx("option",{children:"Ladies"})]})]}),e.jsx("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:Q==="Gents"?e.jsxs(e.Fragment,{children:[e.jsx(p,{title:"Gents' Pants",sizes:i.gents.pants,headers:[{key:"length",label:"L"},{key:"waist",label:"W"},{key:"hip",label:"H"},{key:"tilesLoose",label:"TL"},{key:"bottomWaist",label:"BW"},{key:"fit",label:"Fit"}],control:f,quantityType:"pantsQuantities"}),e.jsx(p,{title:"Gents' Shirts",sizes:i.gents.shirts,headers:[{key:"length",label:"L"},{key:"sleeves",label:"S"},{key:"chest",label:"C"},{key:"shoulder",label:"Sh"},{key:"collar",label:"Co"},{key:"fit",label:"Fit"}],control:f,quantityType:"shirtsQuantities"})]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{title:"Ladies' Pants",sizes:i.ladies.pants,headers:[{key:"length",label:"L"},{key:"waist",label:"W"},{key:"hip",label:"H"},{key:"fit",label:"Fit"}],control:f,quantityType:"pantsQuantities"}),e.jsx(p,{title:"Ladies' Shirts",sizes:i.ladies.shirts,headers:[{key:"length",label:"L"},{key:"sleeves",label:"S"},{key:"bust",label:"B"},{key:"shoulder",label:"Sh"},{key:"fit",label:"Fit"}],control:f,quantityType:"shirtsQuantities"})]})}),e.jsxs("div",{className:"mt-8 pt-6 border-t flex justify-end gap-3",children:[e.jsx(D,{type:"button",onClick:()=>u("/uniforms"),variant:"secondary",disabled:n,children:"Cancel"}),e.jsx(D,{type:"submit",isLoading:n,children:n?"Saving...":"Save Request"})]})]})]}),a&&e.jsx(U,{message:a.message,type:a.type,onDismiss:()=>s(null)})]}):null};export{te as default};
