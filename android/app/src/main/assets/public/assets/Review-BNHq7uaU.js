import{u as I,h as w,n as $,j as e,B as S,m as f}from"./index-D5q3SS3D.js";import{m as M,u as R,b as u}from"./react-vendor-BUaIliXj.js";import{F as U}from"./FormHeader-CSy2Sh-o.js";import{A as E,d as N,F as H,a2 as G,e as L}from"./ui-vendor-B8EvWqdc.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./utils-vendor-DmorxLnX.js";import"./supabase-7WG3J4rU.js";const l=({label:r,value:d})=>e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-muted",children:r}),e.jsx("dd",{className:"mt-1 text-sm text-primary-text",children:d||"-"})]}),n=({label:r,value:d,status:x,isVerifying:s})=>e.jsxs("div",{children:[e.jsxs("dt",{className:"text-sm font-medium text-muted flex items-center",children:[r,s&&e.jsx(G,{className:"h-4 w-4 text-muted animate-spin ml-2"}),!s&&x===!0&&e.jsx("span",{title:"Verified from document",className:"ml-2",children:e.jsx(N,{className:"h-4 w-4 text-green-500"})}),!s&&x===!1&&e.jsx("span",{title:"Verification Failed",className:"ml-2",children:e.jsx(L,{className:"h-4 w-4 text-red-500"})})]}),e.jsx("dd",{className:"mt-1 text-sm text-primary-text",children:d||"-"})]}),t=({label:r,value:d})=>e.jsxs("div",{className:"flex justify-between items-start py-2",children:[e.jsx("span",{className:"text-sm text-gray-400",children:r}),e.jsx("span",{className:"text-sm text-white font-medium text-right max-w-[60%]",children:d||"-"})]}),Z=()=>{const{onSubmit:r,isSubmitting:d}=M(),{user:x}=I(),{data:s,logVerificationUsage:h,setPersonalVerifiedStatus:k,setBankVerifiedStatus:D,setUanVerifiedStatus:F}=w(),{perfiosApi:v}=$(),V=R(),[A,C]=u.useState(window.innerWidth<768);u.useEffect(()=>{const a=()=>C(window.innerWidth<768);return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]);const P=x?.role==="field_staff"&&A,[i,g]=u.useState("idle"),[y,j]=u.useState(""),b=u.useMemo(()=>Object.entries(s.biometrics.fingerprints).filter(([,a])=>a!==null).map(([a])=>a.replace(/([A-Z])/g," $1").replace(/^./,o=>o.toUpperCase())),[s.biometrics.fingerprints]),z=async()=>{g("verifying"),j("");let a=!0;const o=[];try{h("Bank AC Verification Advanced");const m=await f.verifyBankAccountWithPerfios({name:s.bank.accountHolderName,dob:s.personal.dob,aadhaar:s.personal.idProofNumber||null,pan:null,bank:{accountNumber:s.bank.accountNumber,ifsc:s.bank.ifscCode},uan:s.uan.uanNumber||null,esi:s.esi.esiNumber||null});if(o.push(`Bank: ${m.message}`),D({accountNumber:m.verifiedFields.accountNumber,accountHolderName:m.verifiedFields.accountHolderName}),m.success||(a=!1),s.personal.idProofType==="Aadhaar"&&s.personal.idProofNumber){h("Aadhaar Verification");const c=await f.verifyAadhaar(s.personal.idProofNumber);o.push(`Aadhaar: ${c.message}`),k({idProofNumber:c.success}),c.success||(a=!1)}if(s.uan.hasPreviousPf&&s.uan.uanNumber){h("EPF UAN Lookup");const c=await f.lookupUan(s.uan.uanNumber);o.push(`UAN: ${c.message}`),F({uanNumber:c.verifiedFields.uan}),c.success||(a=!1)}await f.updateOnboarding(w.getState().data),j(o.join(`
`)),g(a?"success":"failed")}catch(m){g("failed"),j(m.message||"An unexpected error occurred during verification.")}},B=()=>{V(`/onboarding/pdf/${s.id||"draft"}`)},p=(i==="success"||!v.enabled)&&s.formsGenerated;return P?e.jsxs("form",{onSubmit:async a=>{a.preventDefault(),await r()},id:"review-form",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"Please review all your details carefully before submitting."}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{children:[e.jsx("h4",{className:"fo-section-title mb-2",children:"Personal Details"}),e.jsxs("div",{className:"divide-y divide-border",children:[e.jsx(t,{label:"Full Name",value:`${s.personal.firstName} ${s.personal.lastName}`}),e.jsx(t,{label:"Email",value:s.personal.email}),e.jsx(t,{label:"Mobile",value:s.personal.mobile}),e.jsx(t,{label:"Date of Birth",value:s.personal.dob})]})]}),e.jsxs("section",{children:[e.jsx("h4",{className:"fo-section-title mb-2",children:"Organization Details"}),e.jsxs("div",{className:"divide-y divide-border",children:[e.jsx(t,{label:"Site",value:s.organization.organizationName}),e.jsx(t,{label:"Designation",value:s.organization.designation}),e.jsx(t,{label:"Department",value:s.organization.department})]})]}),e.jsxs("section",{children:[e.jsx("h4",{className:"fo-section-title mb-2",children:"Bank Details"}),e.jsxs("div",{className:"divide-y divide-border",children:[e.jsx(t,{label:"Account Holder",value:s.bank.accountHolderName}),e.jsx(t,{label:"Account Number",value:"*".repeat(Math.max(0,s.bank.accountNumber.length-4))+s.bank.accountNumber.slice(-4)}),e.jsx(t,{label:"IFSC Code",value:s.bank.ifscCode})]})]}),e.jsxs("section",{children:[e.jsx("h4",{className:"fo-section-title mb-2",children:"Uniform Details"}),e.jsxs("div",{className:"divide-y divide-border",children:[e.jsx(t,{label:"Uniform Required",value:s.uniforms.length>0?"Yes":"No"}),s.uniforms.map(a=>e.jsx(t,{label:a.itemName,value:`${a.quantity} x Size ${a.sizeLabel} (${a.fit})`},a.itemId))]})]}),e.jsxs("section",{children:[e.jsx("h4",{className:"fo-section-title mb-2",children:"Biometrics"}),s.biometrics.signatureImage&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"fo-section-title mb-2 text-base",children:"Signature"}),e.jsx("img",{src:s.biometrics.signatureImage.preview,alt:"Signature",className:"h-24 bg-white border rounded-md mx-auto"})]}),b.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"fo-section-title mb-2 text-base",children:"Fingerprints"}),e.jsx("ul",{className:"text-sm text-center text-gray-400 list-disc list-inside",children:b.map(a=>e.jsx("li",{children:a},a))})]})]})]})]}):e.jsxs("form",{onSubmit:async a=>{a.preventDefault(),await r()},id:"review-form",children:[e.jsx(U,{title:"Review & Submit",subtitle:"Please review all your details carefully before submitting."}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("section",{children:[e.jsx("h4",{className:"text-md font-semibold text-primary-text mb-4 border-b pb-2",children:"Personal Details"}),e.jsxs("dl",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-4 gap-y-6",children:[e.jsx(n,{label:"Full Name",value:`${s.personal.firstName} ${s.personal.lastName}`,status:s.personal.verifiedStatus?.name,isVerifying:!1}),e.jsx(l,{label:"Email",value:s.personal.email}),e.jsx(l,{label:"Mobile",value:s.personal.mobile}),e.jsx(n,{label:"Date of Birth",value:s.personal.dob,status:s.personal.verifiedStatus?.dob,isVerifying:!1}),e.jsx(l,{label:"Gender",value:s.personal.gender}),e.jsx(n,{label:"Aadhaar Number",value:s.personal.idProofNumber,status:s.personal.verifiedStatus?.idProofNumber,isVerifying:i==="verifying"})]})]}),e.jsxs("section",{children:[e.jsx("h4",{className:"text-md font-semibold text-primary-text mb-4 border-b pb-2",children:"Organization Details"}),e.jsxs("dl",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-4 gap-y-6",children:[e.jsx(l,{label:"Site / Client",value:s.organization.organizationName}),e.jsx(l,{label:"Designation",value:s.organization.designation}),e.jsx(l,{label:"Department",value:s.organization.department}),e.jsx(l,{label:"Joining Date",value:s.organization.joiningDate})]})]}),e.jsxs("section",{children:[e.jsx("h4",{className:"text-md font-semibold text-primary-text mb-4 border-b pb-2",children:"Bank & Statutory Details"}),e.jsxs("dl",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-4 gap-y-6",children:[e.jsx(n,{label:"Account Holder",value:s.bank.accountHolderName,status:s.bank.verifiedStatus?.accountHolderName,isVerifying:i==="verifying"}),e.jsx(n,{label:"Account Number",value:"*".repeat(Math.max(0,s.bank.accountNumber.length-4))+s.bank.accountNumber.slice(-4),status:s.bank.verifiedStatus?.accountNumber,isVerifying:i==="verifying"}),e.jsx(n,{label:"IFSC Code",value:s.bank.ifscCode,status:s.bank.verifiedStatus?.ifscCode,isVerifying:i==="verifying"}),e.jsx(l,{label:"Bank Name",value:s.bank.bankName}),s.uan.hasPreviousPf&&e.jsx(n,{label:"UAN",value:s.uan.uanNumber,status:s.uan.verifiedStatus?.uanNumber,isVerifying:i==="verifying"}),s.esi.hasEsi&&e.jsx(n,{label:"ESI Number",value:s.esi.esiNumber,status:s.esi.verifiedStatus?.esiNumber,isVerifying:i==="verifying"})]})]}),s.uniforms.length>0&&e.jsxs("section",{children:[e.jsx("h4",{className:"text-md font-semibold text-primary-text mb-4 border-b pb-2",children:"Uniform Details"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:s.uniforms.map(a=>e.jsxs("div",{className:"bg-page p-3 rounded-md",children:[e.jsx("p",{className:"font-semibold text-sm",children:a.itemName}),e.jsxs("p",{className:"text-xs text-muted",children:["Size: ",a.sizeLabel," (",a.fit,")"]}),e.jsxs("p",{className:"text-xs text-muted",children:["Qty: ",a.quantity]})]},a.itemId))})]}),s.biometrics.signatureImage&&e.jsxs("section",{children:[e.jsx("h4",{className:"text-md font-semibold text-primary-text mb-4 border-b pb-2",children:"Biometrics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-primary-text",children:"Signature"}),e.jsx("div",{className:"mt-2 p-2 border rounded-lg inline-block bg-page",children:e.jsx("img",{src:s.biometrics.signatureImage.preview,alt:"Signature",className:"h-24"})})]}),b.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-primary-text",children:"Fingerprints Uploaded"}),e.jsx("ul",{className:"mt-2 list-disc list-inside text-sm text-muted columns-2",children:b.map(a=>e.jsx("li",{children:a},a))})]})]})]})]}),v.enabled&&e.jsxs("div",{className:"mt-8 pt-6 border-t",children:[e.jsx("h3",{className:"text-lg font-semibold text-primary-text mb-4",children:"Third-Party Verification"}),e.jsxs("div",{className:"p-4 bg-page rounded-lg flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:"Run a background check against official records."}),e.jsx("p",{className:"text-sm text-muted",children:"This step is required before you can submit the application."}),i==="failed"&&e.jsx("p",{className:"text-sm text-red-600 mt-2",children:y}),i==="success"&&e.jsx("p",{className:"text-sm text-green-600 mt-2",children:y})]}),e.jsxs(S,{onClick:z,isLoading:i==="verifying",disabled:i==="success",children:[i==="idle"&&e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"mr-2 h-4 w-4"})," Verify Details"]}),i==="verifying"&&"Verifying...",i==="failed"&&"Retry Verification",i==="success"&&e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"mr-2 h-4 w-4"})," Verified"]})]})]})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t",children:[e.jsx("h3",{className:"text-lg font-semibold text-primary-text mb-4",children:"Generate Official Forms"}),e.jsxs("div",{className:"p-4 bg-page rounded-lg flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:"Generate and review the official PDF documents."}),e.jsx("p",{className:"text-sm text-muted",children:"This step is mandatory before final submission."})]}),s.formsGenerated?e.jsxs("div",{className:"flex items-center gap-2 font-semibold text-green-600",children:[e.jsx(N,{className:"h-5 w-5"}),e.jsx("span",{children:"Forms Generated & Confirmed"})]}):e.jsxs(S,{onClick:B,children:[e.jsx(H,{className:"mr-2 h-4 w-4"})," Generate & Review Forms"]})]})]}),e.jsx("div",{className:"mt-8 pt-6 border-t",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex items-center h-5",children:e.jsx("input",{id:"confirmation",name:"confirmation",type:"checkbox",required:!0,className:"focus:ring-accent h-4 w-4 text-accent border-gray-300 rounded",disabled:!p})}),e.jsxs("div",{className:"ml-3 text-sm",children:[e.jsx("label",{htmlFor:"confirmation",className:`font-medium ${p?"text-gray-700":"text-gray-400"}`,children:"Declaration"}),e.jsx("p",{className:`${p?"text-muted":"text-gray-400"}`,children:"I hereby declare that the information provided is true and correct to the best of my knowledge."})]})]})})]})};export{Z as default};
