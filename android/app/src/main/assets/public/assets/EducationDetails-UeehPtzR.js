import{u as z,h as D,k as P,d as T,S as _,e as d,Q as H,q as J,c as K,o as W,O as X,_ as p,j as e,C as n,B as q,I as u}from"./index-D5q3SS3D.js";import{m as Z,b as l}from"./react-vendor-BUaIliXj.js";import{M as ee}from"./Modal-CR2aBU6L.js";import{F as te}from"./FormHeader-CSy2Sh-o.js";import{U as O}from"./UploadDocument-BAL6UInC.js";import{at as R,ao as E}from"./ui-vendor-B8EvWqdc.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./utils-vendor-DmorxLnX.js";import"./supabase-7WG3J4rU.js";import"./CameraCaptureModal-DQDGRnEP.js";const he=()=>{const{onValidated:M,setToast:j}=Z(),{user:ae}=z(),{data:m,updateEducation:h,updateEducationRecord:I}=D(),k=P("(max-width: 767px)"),c=l.useMemo(()=>/manager|admin|head/i.test(m.organization.designation),[m.organization.designation]),A=l.useMemo(()=>T({id:d().required(),degree:d().required("Degree is required"),institution:d().required("Institution is required"),startYear:d().required("Start year is required").matches(/^\d{4}$/,"Must be a 4-digit year"),endYear:d().required("End year is required").matches(/^\d{4}$/,"Must be a 4-digit year").test("is-after-start-year","End year must be on or after start year",function(r){const{startYear:t}=this.parent;return!t||!r||parseInt(r)>=parseInt(t)}),percentage:H().nullable().min(0).max(100).optional(),grade:d().optional(),document:_().nullable().when([],{is:()=>c,then:r=>r.required("Certificate is mandatory for this role.").nullable(),otherwise:r=>r.optional().nullable()})}).defined(),[c]),F=T({education:J().of(A).required()}),{control:o,handleSubmit:y,formState:{errors:s},setValue:g,reset:x,watch:v}=K({resolver:W(F),context:{isAdminOrManager:c},mode:"onBlur"}),{fields:f,append:L,remove:U}=X({control:o,name:"education"}),[V,b]=l.useState(!1),[C,$]=l.useState(null);l.useEffect(()=>{x({education:m.education})},[m.education,x]),l.useEffect(()=>{let r;const t=v(a=>{clearTimeout(r),r=window.setTimeout(()=>{h(a.education)},500)});return()=>{t.unsubscribe(),clearTimeout(r)}},[v,h]);const N=()=>{L({id:`edu_${Date.now()}`,degree:"",institution:"",startYear:"",endYear:""})},S=r=>{$(r),b(!0)},B=()=>{C!==null&&(U(C),b(!1),$(null))},Y=async r=>{h(r.education),await M()},G=r=>t=>{const a=f[r].id,i={};if(t.degree&&(g(`education.${r}.degree`,t.degree,{shouldValidate:!0}),i.degree=t.degree),t.institution&&(g(`education.${r}.institution`,t.institution,{shouldValidate:!0}),i.institution=t.institution),t.endYear){const w=t.endYear.toString();g(`education.${r}.endYear`,w,{shouldValidate:!0}),i.endYear=w}Object.keys(i).length>0&&(I(a,i),j({message:"Education details auto-filled.",type:"success"}))},Q={type:p.OBJECT,properties:{degree:{type:p.STRING,description:"The name of the degree, diploma, or certificate."},institution:{type:p.STRING,description:"The name of the university, college, or institution."},endYear:{type:p.STRING,description:"The year of completion or graduation as a 4-digit number."}},required:["degree","institution","endYear"]};return k?e.jsxs("form",{onSubmit:y(Y),id:"education-form",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"List educational qualifications, starting with the most recent."}),e.jsx("div",{className:"space-y-4",children:f.map((r,t)=>e.jsxs("div",{className:"p-4 border border-border rounded-xl relative space-y-4",children:[e.jsx("button",{type:"button",onClick:()=>S(t),className:"absolute top-2 right-2 p-1 text-red-500 rounded-full z-10","aria-label":"Remove qualification",children:e.jsx(R,{className:"h-5 w-5"})}),e.jsx(n,{name:`education.${t}.degree`,control:o,render:({field:a})=>e.jsx("input",{placeholder:"Degree / Certificate",...a,className:"form-input"})}),e.jsx(n,{name:`education.${t}.institution`,control:o,render:({field:a})=>e.jsx("input",{placeholder:"Institution / University",...a,className:"form-input"})}),e.jsx(n,{name:`education.${t}.endYear`,control:o,render:({field:a})=>e.jsx("input",{placeholder:"Year of Completion",type:"text",maxLength:4,...a,className:"form-input"})}),e.jsx(n,{name:`education.${t}.document`,control:o,render:({field:a,fieldState:i})=>e.jsx(O,{label:`Certificate ${c?"(Mandatory)":"(Optional)"}`,file:a.value,onFileChange:a.onChange,error:i.error?.message,allowCapture:!0})})]},r.id))}),e.jsxs(q,{type:"button",onClick:N,variant:"secondary",className:"mt-6 w-full flex items-center justify-center",children:[e.jsx(E,{className:"mr-2 h-4 w-4"})," Add Qualification"]})]}):e.jsxs("form",{onSubmit:y(Y),id:"education-form",children:[e.jsx(ee,{isOpen:V,onClose:()=>b(!1),onConfirm:B,title:"Confirm Deletion",children:"Are you sure you want to remove this education record? This action cannot be undone."}),e.jsx(te,{title:"Education Details",subtitle:"List your educational qualifications, starting with the most recent."}),e.jsx("div",{className:"space-y-6",children:f.map((r,t)=>e.jsxs("div",{className:"p-4 border border-border rounded-xl relative",children:[e.jsx("button",{type:"button",onClick:()=>S(t),className:"absolute top-2 right-2 p-1 text-red-500 hover:bg-red-100 rounded-full","aria-label":`Remove ${r.degree}`,children:e.jsx(R,{className:"h-4 w-4"})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(n,{name:`education.${t}.degree`,control:o,render:({field:a})=>e.jsx(u,{label:"Degree / Certificate",id:a.name,error:s.education?.[t]?.degree?.message,...a})}),e.jsx(n,{name:`education.${t}.institution`,control:o,render:({field:a})=>e.jsx(u,{label:"Institution / University",id:a.name,error:s.education?.[t]?.institution?.message,...a})}),e.jsx(n,{name:`education.${t}.startYear`,control:o,render:({field:a})=>e.jsx(u,{label:"Start Year",id:a.name,type:"text",maxLength:4,error:s.education?.[t]?.startYear?.message,...a})}),e.jsx(n,{name:`education.${t}.endYear`,control:o,render:({field:a})=>e.jsx(u,{label:"End Year",id:a.name,type:"text",maxLength:4,error:s.education?.[t]?.endYear?.message,...a})}),e.jsx(n,{name:`education.${t}.percentage`,control:o,render:({field:a})=>e.jsx(u,{label:"Percentage (Optional)",id:a.name,type:"number",error:s.education?.[t]?.percentage?.message,...a,value:a.value??""})}),e.jsx(n,{name:`education.${t}.grade`,control:o,render:({field:a})=>e.jsx(u,{label:"Grade (Optional)",id:a.name,type:"text",error:s.education?.[t]?.grade?.message,...a,value:a.value??""})}),e.jsx("div",{className:"sm:col-span-2",children:e.jsx(n,{name:`education.${t}.document`,control:o,render:({field:a,fieldState:i})=>e.jsx(O,{label:`Upload Certificate ${c?"(Mandatory)":"(Optional)"}`,file:a.value,onFileChange:a.onChange,onOcrComplete:G(t),ocrSchema:Q,setToast:j,error:i.error?.message})})})]})]},r.id))}),e.jsxs(q,{type:"button",onClick:N,variant:"outline",className:"mt-6",children:[e.jsx(E,{className:"mr-2 h-4 w-4"})," Add Qualification"]})]})};export{he as default};
