import{u as L,k as U,j as e,T as B,B as x,I as D,m as N,P as O}from"./index-D5q3SS3D.js";import{u as R,b as l,R as $}from"./react-vendor-BUaIliXj.js";import{S as v}from"./Select-Dz12MdxG.js";import{M as z}from"./Modal-CR2aBU6L.js";import{z as w,s as C,ar as S,ao as q,a2 as F,aj as k,aD as E,aI as Q,bK as Y}from"./ui-vendor-B8EvWqdc.js";import{m as H}from"./utils-vendor-DmorxLnX.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./supabase-7WG3J4rU.js";const V=({priority:t})=>{const r={Low:"bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.5)]",Medium:"bg-yellow-500 shadow-[0_0_8px_rgba(234,179,8,0.5)]",High:"bg-orange-500 shadow-[0_0_8px_rgba(249,115,22,0.5)]",Urgent:"bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.5)]"};return e.jsx("span",{className:`w-3 h-3 rounded-full ${r[t]}`,title:`Priority: ${t}`})},K=({status:t})=>{const r={Open:"bg-emerald-500/10 text-emerald-500 border-emerald-500/20","In Progress":"bg-blue-500/10 text-blue-500 border-blue-500/20","Pending Requester":"bg-yellow-500/10 text-yellow-500 border-yellow-500/20",Resolved:"bg-purple-500/10 text-purple-500 border-purple-500/20",Closed:"bg-gray-500/10 text-gray-500 border-gray-500/20"};return e.jsx("span",{className:`px-2.5 py-0.5 rounded-full text-xs font-medium border ${r[t]}`,children:t})},W=({ticket:t,onClick:r})=>e.jsxs("div",{onClick:r,className:"group bg-card hover:bg-accent/5 p-5 rounded-xl border border-border hover:border-accent cursor-pointer transition-all duration-300 flex flex-col justify-between h-full shadow-sm hover:shadow-md",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-start gap-3 mb-2",children:[e.jsx("h4",{className:"font-bold text-primary-text leading-snug group-hover:text-accent transition-colors line-clamp-2",children:t.title}),e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx(V,{priority:t.priority})})]}),e.jsxs("p",{className:"text-xs text-muted font-mono",children:["#",t.ticketNumber]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-border/50",children:[e.jsxs("div",{className:"flex justify-between items-center text-xs text-muted mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-gray-700 flex items-center justify-center text-[10px] text-white font-bold",children:t.raisedByName.charAt(0)}),e.jsx("span",{children:t.raisedByName})]}),e.jsx("span",{children:H(new Date(t.raisedAt),{addSuffix:!0})})]}),e.jsx("div",{className:"flex justify-between items-center",children:e.jsx(K,{status:t.status})})]})]}),T=({user:t,onAction:r})=>e.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-xl bg-card border border-border hover:border-accent/50 transition-colors",children:[e.jsxs("div",{className:"relative",children:[e.jsx(O,{photoUrl:t.photoUrl,seed:t.id,className:"w-12 h-12 rounded-full shadow-sm"}),e.jsx("span",{className:`absolute -bottom-0.5 -right-0.5 block h-4 w-4 rounded-full ${t.isAvailable?"bg-green-500 shadow-[0_0_10px_rgba(34,197,94,0.8)]":"bg-rose-600 shadow-[0_0_6px_rgba(225,29,72,0.6)]"} ring-2 ring-white`})]}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsx("p",{className:"text-sm font-bold text-primary-text truncate",children:t.name}),e.jsx("p",{className:"text-xs text-muted truncate",children:t.role.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase())})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(x,{variant:"icon",size:"sm",className:"hover:opacity-90 transition-opacity border",style:{backgroundColor:"#006B3F",color:"#FFFFFF",borderColor:"#005632"},title:"Call",onClick:()=>r(t.phone),children:e.jsx(E,{className:"h-4 w-4"})}),e.jsx(x,{variant:"icon",size:"sm",className:"hover:opacity-90 transition-opacity border",style:{backgroundColor:"#006B3F",color:"#FFFFFF",borderColor:"#005632"},title:"Message",onClick:()=>r(t.phone),children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsx(x,{variant:"icon",size:"sm",className:"hover:opacity-90 transition-opacity border",style:{backgroundColor:"#006B3F",color:"#FFFFFF",borderColor:"#005632"},title:"Video",onClick:()=>r(t.phone),children:e.jsx(Y,{className:"h-4 w-4"})})]})]}),pe=()=>{const t=R(),{user:r}=L(),[i,_]=l.useState([]),[c,P]=l.useState([]),[A,j]=l.useState(!0),[p,m]=l.useState(null),[G,J]=l.useState("All"),[X,Z]=l.useState("All"),[ee,se]=l.useState(""),[te,ae]=l.useState(!1),[M,h]=l.useState(!1),I=U("(max-width: 767px)"),[o,u]=l.useState({status:"all",priority:"all",searchTerm:""});l.useEffect(()=>{(async()=>{if(r){j(!0);try{const[a,d]=await Promise.all([N.getSupportTickets(),N.getNearbyUsers()]);_(a),P(d.filter(n=>n.id!==r.id))}catch{m({message:"Failed to load support data.",type:"error"})}finally{j(!1)}}})()},[r]);const f=l.useMemo(()=>i.filter(s=>{const a=o.status==="all"||s.status===o.status,d=o.priority==="all"||s.priority===o.priority,n=o.searchTerm===""||s.title.toLowerCase().includes(o.searchTerm.toLowerCase())||s.ticketNumber.toLowerCase().includes(o.searchTerm.toLowerCase())||s.description.toLowerCase().includes(o.searchTerm.toLowerCase());return a&&d&&n}),[i,o]),g=l.useMemo(()=>{const s=i.filter(a=>a.status==="Resolved"&&a.raisedById===r?.id);return{open:i.filter(a=>a.status==="Open").length,inProgress:i.filter(a=>a.status==="In Progress").length,pendingYourAction:s.length}},[i,r]),y=s=>{if(!s){m({message:"User does not have a phone number.",type:"error"});return}let a=s.replace(/\D/g,"");if(a.length>10&&(a=a.slice(-10)),a.length!==10){m({message:"Invalid phone number format.",type:"error"});return}window.open(`https://wa.me/91${a}`,"_blank")},b=({title:s,value:a,icon:d,colorClass:n})=>e.jsxs("div",{className:"bg-transparent p-5 rounded-2xl flex items-center justify-between transition-all",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted mb-1",children:s}),e.jsx("p",{className:`text-3xl font-bold ${n.replace("bg-","text-").split(" ")[0]}`,children:a})]}),e.jsx("div",{className:`p-3 rounded-full ${n.replace("text-","bg-")} bg-opacity-90 shadow-sm`,children:$.cloneElement(d,{className:"h-6 w-6 text-white"})})]});return e.jsxs("div",{className:"w-full p-4 lg:p-8 space-y-8",children:[p&&e.jsx(B,{message:p.message,type:p.type,onDismiss:()=>m(null)}),e.jsx(z,{isOpen:M,onClose:()=>h(!1),title:"Nearby Available Support",onConfirm:()=>h(!1),confirmButtonText:"Close",children:e.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-y-auto pr-1",children:c.length>0?c.map(s=>e.jsx(T,{user:s,onAction:y},s.id)):e.jsxs("div",{className:"text-center py-8 text-muted",children:[e.jsx(w,{className:"h-10 w-10 mx-auto mb-2 opacity-20"}),e.jsx("p",{children:"No support staff found nearby."})]})})}),e.jsx("div",{className:"relative overflow-hidden rounded-3xl bg-transparent p-6 lg:p-10 transition-all",children:e.jsxs("div",{className:"relative z-10 flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-emerald-50 rounded-lg backdrop-blur-sm",children:e.jsx(C,{className:"h-6 w-6 text-emerald-600"})}),e.jsx("h2",{className:"text-2xl lg:text-3xl font-bold text-primary-text",children:"Support & Audit"})]}),e.jsx("p",{className:"text-muted max-w-xl text-sm",children:"Track issues, request audits, and connect with support staff in real-time."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 w-full lg:w-auto",children:[I&&e.jsxs(x,{onClick:()=>h(!0),variant:"secondary",className:"flex-1 lg:flex-none bg-gray-100 text-gray-900 hover:bg-gray-200 border-none shadow-none p-0 text-sm transition-colors",children:[e.jsx(S,{className:"mr-1.5 h-3.5 w-3.5"})," Nearby"]}),e.jsxs(x,{onClick:()=>t("/support/ticket/new"),className:"flex-1 lg:flex-none",children:[e.jsx(q,{className:"mr-1.5 h-3.5 w-3.5"})," New Ticket"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 lg:gap-6",children:[e.jsx(b,{title:"Open Tickets",value:g.open,icon:e.jsx(C,{className:"h-6 w-6"}),colorClass:"text-rose-500"}),e.jsx(b,{title:"In Progress",value:g.inProgress,icon:e.jsx(F,{className:"h-6 w-6"}),colorClass:"text-blue-500"}),e.jsx(b,{title:"Pending Your Action",value:g.pendingYourAction,icon:e.jsx(S,{className:"h-6 w-6"}),colorClass:"text-amber-500"})]}),e.jsxs("div",{className:"lg:grid lg:grid-cols-3 lg:gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-transparent p-5 rounded-2xl",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(k,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(D,{id:"search",placeholder:"Search tickets...",className:"!pl-10 bg-gray-50 border-gray-200",value:o.searchTerm,onChange:s=>u(a=>({...a,searchTerm:s.target.value}))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-32 sm:w-40",children:e.jsxs(v,{value:o.status,onChange:s=>u(a=>({...a,status:s.target.value})),className:"bg-gray-50 border-gray-200",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{children:"Open"}),e.jsx("option",{children:"In Progress"}),e.jsx("option",{value:"Pending Requester",children:"Pending"}),e.jsx("option",{children:"Resolved"}),e.jsx("option",{children:"Closed"})]})}),e.jsx("div",{className:"w-32 sm:w-40",children:e.jsxs(v,{value:o.priority,onChange:s=>u(a=>({...a,priority:s.target.value})),className:"bg-gray-50 border-gray-200",children:[e.jsx("option",{value:"all",children:"All Priority"}),e.jsx("option",{children:"Low"}),e.jsx("option",{children:"Medium"}),e.jsx("option",{children:"High"}),e.jsx("option",{children:"Urgent"})]})})]})]}),A?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(F,{className:"h-8 w-8 animate-spin text-accent"})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:f.length>0?f.map(s=>e.jsx(W,{ticket:s,onClick:()=>t(`/support/ticket/${s.id}`)},s.id)):e.jsxs("div",{className:"col-span-full flex flex-col items-center justify-center py-12 text-muted",children:[e.jsx("div",{className:"p-4 bg-accent/5 rounded-full mb-3",children:e.jsx(k,{className:"h-8 w-8 opacity-50"})}),e.jsx("p",{children:"No tickets match your filters."})]})})]})}),e.jsx("aside",{className:"hidden lg:block space-y-6",children:e.jsxs("div",{className:"bg-card p-6 rounded-2xl border border-border shadow-sm sticky top-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"font-bold text-lg text-primary-text flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5 text-accent"})," Nearby Support"]}),e.jsxs("span",{className:"text-xs font-medium bg-accent/10 text-accent px-2 py-1 rounded-full",children:[c.filter(s=>s.isAvailable).length," Online"]})]}),e.jsx("div",{className:"space-y-3 max-h-[calc(100vh-200px)] overflow-y-auto pr-1 custom-scrollbar",children:c.length>0?c.map(s=>e.jsx(T,{user:s,onAction:y},s.id)):e.jsx("div",{className:"text-center py-8 text-muted",children:e.jsx("p",{children:"No support staff found nearby."})})})]})})]})]})};export{pe as default};
