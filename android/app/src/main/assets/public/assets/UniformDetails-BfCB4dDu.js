import{u as M,h as O,k as R,c as k,O as A,j as e,B as U,C as g,I as Q,m as z}from"./index-D5q3SS3D.js";import{m as B,u as G,b as u}from"./react-vendor-BUaIliXj.js";import{F as S}from"./FormHeader-CSy2Sh-o.js";import{S as H}from"./Select-Dz12MdxG.js";import{a2 as J,as as V,J as Y,ao as K}from"./ui-vendor-B8EvWqdc.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./utils-vendor-DmorxLnX.js";import"./supabase-7WG3J4rU.js";const oe=()=>{const{onValidated:h,setToast:I}=B(),{user:W}=M(),v=G(),{data:c,updateUniforms:b}=O(),o=R("(max-width: 767px)"),[L,q]=u.useState(!0),[r,T]=u.useState(null),{gender:l}=c.personal,{organizationId:j,department:y,designation:N}=c.organization,{control:f,handleSubmit:w,reset:X,watch:C}=k(),{fields:D,replace:P}=A({control:f,name:"uniforms"});u.useEffect(()=>{(async()=>{q(!0);try{const[i,n,s]=await Promise.all([z.getAllSiteUniformDetails(),z.getMasterGentsUniforms(),z.getMasterLadiesUniforms()]);T({details:i,gents:n,ladies:s})}catch{I({message:"Failed to load uniform configuration.",type:"error"})}finally{q(!1)}})()},[I]);const p=u.useMemo(()=>{if(!r||!j||!y||!N)return[];const t=r.details[j];if(!t)return[];const i=t.departments.find(s=>s.department===y);return i?i.designations.find(s=>s.designation===N)?.items||[]:[]},[r,j,y,N]);u.useEffect(()=>{const t=p.map(i=>{const n=c.uniforms.find(a=>a.itemId===i.id),s=i.name.toLowerCase().includes("pant")?"Pants":"Shirts";return{itemId:i.id,itemName:i.name,category:s,sizeId:n?.sizeId||"",quantity:n?.quantity||1}});P(t)},[p,c.uniforms,P]),u.useEffect(()=>{let t;const i=C(n=>{clearTimeout(t),t=window.setTimeout(()=>{const s=n,a=l==="Female"?[...r?.ladies.pants||[],...r?.ladies.shirts||[]]:[...r?.gents.pants||[],...r?.gents.shirts||[]],m=(s.uniforms||[]).filter(d=>d.sizeId&&d.quantity>0).map(d=>{const F=a.find(E=>E.id===d.sizeId);return{itemId:d.itemId,itemName:d.itemName,sizeId:d.sizeId,sizeLabel:F?.size||"",fit:F?.fit||"",quantity:d.quantity}});b(m)},500)});return()=>{i.unsubscribe(),clearTimeout(t)}},[C,b,l,r]);const $=async t=>{const i=l==="Female"?[...r?.ladies.pants||[],...r?.ladies.shirts||[]]:[...r?.gents.pants||[],...r?.gents.shirts||[]],n=t.uniforms.filter(s=>s.sizeId&&s.quantity>0).map(s=>{const a=i.find(m=>m.id===s.sizeId);return{itemId:s.itemId,itemName:s.itemName,sizeId:s.sizeId,sizeLabel:a?.size||"",fit:a?.fit||"",quantity:s.quantity}});b(n),await h()};if(L)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(J,{className:"h-8 w-8 animate-spin text-accent"})});if(p.length===0&&c.uniforms.length>0)return e.jsxs("form",{onSubmit:async t=>{t.preventDefault(),await h()},id:"uniform-form",children:[!o&&e.jsx(S,{title:"Uniform Details",subtitle:"The following items have been selected for this employee."}),e.jsxs("div",{className:"space-y-4",children:[c.uniforms.map(t=>e.jsx("div",{className:`p-4 border rounded-lg flex justify-between items-center ${o?"bg-[#243524] border-border":"bg-page"}`,children:e.jsxs("div",{children:[e.jsx("p",{className:`font-semibold ${o?"text-white":"text-primary-text"}`,children:t.itemName}),e.jsxs("p",{className:`text-sm ${o?"text-gray-400":"text-muted"}`,children:["Size: ",t.sizeLabel,", Fit: ",t.fit,", Quantity: ",t.quantity]})]})},t.itemId+t.sizeId)),e.jsxs(U,{type:"button",variant:"outline",onClick:()=>v("/onboarding/uniforms?from=onboarding"),children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),"Edit Uniform Selection"]})]})]});if(!l||p.length===0){const t=l?"No uniform requirements found for the selected site, department, and designation.":"Please select a gender in 'Personal Details' to view uniform options.",i=l&&p.length===0;return e.jsxs("form",{onSubmit:async n=>{n.preventDefault(),await h()},id:"uniform-form",children:[!o&&e.jsx(S,{title:"Uniform Details",subtitle:"Provide uniform measurements for the employee."}),e.jsxs("div",{className:`text-center p-8 rounded-lg ${o?"":"bg-page"}`,children:[e.jsx(Y,{className:`h-12 w-12 mx-auto ${o?"text-gray-500":"text-muted"}`}),e.jsx("p",{className:`mt-4 ${o?"text-gray-400":"text-muted"}`,children:t}),i&&e.jsxs("div",{className:"mt-6",children:[e.jsx("p",{className:`text-sm mb-4 ${o?"text-gray-500":"text-muted"}`,children:"You can proceed to the next step, or create a new site-level request if uniforms are needed."}),e.jsxs(U,{type:"button",onClick:()=>v("/onboarding/uniforms?from=onboarding"),children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Create Site Uniform Request"]})]})]})]})}const x=l==="Female"?r?.ladies:r?.gents;return o?e.jsxs("form",{onSubmit:w($),id:"uniform-form",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"Provide uniform measurements for the employee."}),e.jsx("div",{className:"space-y-4",children:D.map((t,i)=>{const n=t.category==="Pants"?x?.pants:x?.shirts;return e.jsxs("div",{className:"p-4 border border-border rounded-xl space-y-4",children:[e.jsx("h4",{className:"font-semibold text-primary-text",children:t.itemName}),e.jsx(g,{name:`uniforms.${i}.sizeId`,control:f,render:({field:s})=>e.jsxs("select",{...s,className:"pro-select pro-select-arrow",children:[e.jsx("option",{value:"",children:"-- Select Size --"}),n?.map(a=>e.jsxs("option",{value:a.id,children:["Size: ",a.size," - ",a.fit]},a.id))]})}),e.jsx(g,{name:`uniforms.${i}.quantity`,control:f,render:({field:s})=>e.jsx("input",{type:"number",min:"1",...s,className:"form-input"})})]},t.id)})})]}):e.jsxs("form",{onSubmit:w($),id:"uniform-form",children:[e.jsx(S,{title:"Uniform Details",subtitle:"Provide uniform measurements for the employee."}),e.jsx("div",{className:"space-y-6",children:D.map((t,i)=>{const n=t.category==="Pants"?x?.pants:x?.shirts;return e.jsxs("div",{className:"p-4 border border-border rounded-xl bg-page/50",children:[e.jsx("h4",{className:"font-semibold text-primary-text mb-2",children:t.itemName}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(g,{name:`uniforms.${i}.sizeId`,control:f,rules:{required:"Please select a size"},render:({field:s,fieldState:a})=>e.jsxs(H,{label:"Size & Fit",error:a.error?.message,...s,children:[e.jsx("option",{value:"",children:"-- Select Size --"}),n?.map(m=>e.jsxs("option",{value:m.id,children:["Size: ",m.size," - ",m.fit]},m.id))]})}),e.jsx(g,{name:`uniforms.${i}.quantity`,control:f,rules:{required:!0,min:1},render:({field:s})=>e.jsx(Q,{label:"Quantity",type:"number",min:"1",...s})})]})]},t.id)})})]})};export{oe as default};
