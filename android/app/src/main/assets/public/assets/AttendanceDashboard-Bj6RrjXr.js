import{j as e,s as bt,L as wt,A as Je,n as Ft,m as oe,F as pt,D as Gt,B as Ue,k as qt,u as Vt,a as Yt,i as Tt,T as Xt,w as Zt}from"./index-D5q3SS3D.js";import{b as n}from"./react-vendor-BUaIliXj.js";import{X as Jt,U as Qt,f as gt,F as _t,b as jt,a2 as Ze,aJ as Kt,a7 as es,$ as ts,ar as Ht,aG as Et,aK as It,z as ss,aL as rs,aM as as,aN as Lt,aO as ns,aP as ds,aQ as os,aR as ls,aS as is,aT as cs,aU as ms,aV as xs,aW as us,aX as hs,aY as ps,aZ as fs}from"./ui-vendor-B8EvWqdc.js";import{f as d,c as Ut,h as $t,o as Wt,q as ft,s as lt,e as yt,r as ys,i as bs,t as Pt,u as Ct,b as ot,d as ht,v as At,w as gs,x as js}from"./utils-vendor-DmorxLnX.js";import{d as Rt}from"./index-BKlf32TQ.js";import{e as ws,a as Ns}from"./excelExport-B_NduTpG.js";import{L as vs}from"./LoadingScreen-_hPz2y_i.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./supabase-7WG3J4rU.js";import"./FileSaver.min-C7cHFFkD.js";const Ds=({isOpen:o,onClose:D,onSuccess:g,users:w,currentUserRole:l,currentUserId:u})=>{const[k,B]=n.useState(""),[fe,ae]=n.useState(d(new Date,"yyyy-MM-dd")),[I,X]=n.useState("Present"),[$e,ye]=n.useState("09:00"),[ke,K]=n.useState("18:00"),[Ee,Me]=n.useState("Office"),[le,m]=n.useState(""),[Se,Ie]=n.useState(!1),[Z,x]=n.useState(null);n.useEffect(()=>{o&&(B(""),ae(d(new Date,"yyyy-MM-dd")),X("Present"),ye("09:00"),K("18:00"),Me("Office"),m(""),x(null))},[o]);const c=async S=>{if(S.preventDefault(),!k){x("Please select an employee.");return}if(!le){x("Please provide a reason or note for this manual entry.");return}Ie(!0),x(null);try{const z=w.find(G=>G.id===k),A=fe,ee=[];if(I==="Present"||I==="W/H"){const G=new Date(`${A}T${$e}:00`);ee.push({user_id:k,timestamp:G.toISOString(),type:"check-in",location_name:I==="W/H"?"Work From Home":Ee,is_manual:!0,created_by:u,reason:le});const be=new Date(`${A}T${ke}:00`);ee.push({user_id:k,timestamp:be.toISOString(),type:"check-out",location_name:I==="W/H"?"Work From Home":Ee,is_manual:!0,created_by:u,reason:le})}if(ee.length>0){const{error:G}=await bt.from("attendance_events").insert(ee);if(G)throw G}const U={action:"MANUAL_ENTRY_ADDED",performed_by:u,target_user_id:k,details:{date:fe,status:I,checkIn:I==="Present"||I==="W/H"?$e:"N/A",checkOut:I==="Present"||I==="W/H"?ke:"N/A",reason:le,userName:z?.name}},{error:te}=await bt.from("attendance_audit_logs").insert([U]);if(te)throw te;g(),D()}catch(z){console.error("Manual attendance error:",z);let A="Failed to save manual entry.";z.message&&(A=z.message),z.details&&(A+=` (${z.details})`),z.hint&&(A+=` Hint: ${z.hint}`),x(A)}finally{Ie(!1)}};return o?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg overflow-hidden flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"flex justify-between items-center p-5 border-b border-gray-100 bg-gray-50/50",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Manual Attendance Entry"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Add missing attendance records"})]}),e.jsx("button",{onClick:D,className:"text-gray-400 hover:text-gray-600 transition-colors p-1 hover:bg-gray-100 rounded-full",children:e.jsx(Jt,{size:20})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto custom-scrollbar",children:[Z&&e.jsxs("div",{className:"mb-4 p-3 text-sm text-red-600 bg-red-50 border border-red-200 rounded-lg flex items-center",children:[e.jsx("span",{className:"mr-2",children:"⚠️"})," ",Z]}),e.jsxs("form",{onSubmit:c,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 flex items-center",children:[e.jsx(Qt,{className:"w-3.5 h-3.5 mr-1.5 text-blue-600"})," Employee ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:k,onChange:S=>B(S.target.value),className:"w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all bg-gray-50/30 text-sm",required:!0,children:[e.jsx("option",{value:"",children:"Select Employee"}),w.map(S=>e.jsx("option",{value:S.id,children:S.name},S.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 flex items-center",children:[e.jsx(gt,{className:"w-3.5 h-3.5 mr-1.5 text-blue-600"})," Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:fe,onChange:S=>ae(S.target.value),className:"w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all bg-gray-50/30 text-sm",required:!0})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 flex items-center",children:[e.jsx(_t,{className:"w-3.5 h-3.5 mr-1.5 text-blue-600"})," Status ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:I,onChange:S=>X(S.target.value),className:"w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all bg-gray-50/30 text-sm",children:[e.jsx("option",{value:"Present",children:"Present (Office)"}),e.jsx("option",{value:"W/H",children:"Work From Home"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 bg-blue-50/50 p-4 rounded-lg border border-blue-100",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 flex items-center",children:[e.jsx(jt,{className:"w-3.5 h-3.5 mr-1.5 text-green-600"})," Punch In ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"time",value:$e,onChange:S=>ye(S.target.value),className:"w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all bg-white text-sm",required:!0})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 flex items-center",children:[e.jsx(jt,{className:"w-3.5 h-3.5 mr-1.5 text-red-600"})," Punch Out ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"time",value:ke,onChange:S=>K(S.target.value),className:"w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all bg-white text-sm",required:!0})]})]}),I==="Present"&&e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"Location Name"}),e.jsx("input",{type:"text",value:Ee,onChange:S=>Me(S.target.value),placeholder:"e.g. Head Office, Client Site",className:"w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all bg-gray-50/30 text-sm"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700",children:["Reason / Notes ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:le,onChange:S=>m(S.target.value),placeholder:"Why is this being added manually? e.g. 'Forgot to punch in', 'Biometric issue'",className:"w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all bg-gray-50/30 text-sm h-20 resize-none",required:!0})]})]})]}),e.jsxs("div",{className:"p-5 border-t border-gray-100 bg-gray-50/50 flex justify-end gap-3",children:[e.jsx("button",{onClick:D,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors shadow-sm",disabled:Se,children:"Cancel"}),e.jsx("button",{onClick:c,disabled:Se,className:"px-6 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-all shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:Se?e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Kt,{className:"w-4 h-4 mr-2"}),"Add Punch"]})})]})]})}):null},ks=({logs:o,generatedBy:D})=>o.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-gray-500 bg-gray-50 rounded-xl border border-dashed border-gray-300",children:[e.jsx(es,{className:"w-10 h-10 mb-3 text-gray-400"}),e.jsx("p",{children:"No audit logs found."})]}):e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden p-8",children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-4 mb-6",children:[e.jsx(wt,{className:"h-10",localPath:Je}),e.jsxs("div",{className:"text-right",children:[e.jsx("h1",{className:"text-xl font-bold",children:"Audit Log Report"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Generated: ",d(new Date,"dd MMM yyyy HH:mm")]}),D&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Generated by: ",D]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"Date & Time"}),e.jsx("th",{className:"px-6 py-3",children:"Action"}),e.jsx("th",{className:"px-6 py-3",children:"Performed By"}),e.jsx("th",{className:"px-6 py-3",children:"Target Employee"}),e.jsx("th",{className:"px-6 py-3",children:"Details"})]})}),e.jsx("tbody",{children:o.map(g=>e.jsxs("tr",{className:"bg-white border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-500",children:d(new Date(g.created_at),"dd MMM yyyy, HH:mm")}),e.jsx("td",{className:"px-6 py-4 font-medium text-gray-900",children:e.jsx("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 rounded-md text-xs border border-blue-100",children:g.action})}),e.jsx("td",{className:"px-6 py-4 font-medium text-gray-900",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 mr-2 text-xs",children:g.performer_name?.charAt(0)}),g.performer_name]})}),e.jsx("td",{className:"px-6 py-4 text-gray-900",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-700 mr-2 text-xs",children:g.target_name?.charAt(0)}),g.target_name]})}),e.jsx("td",{className:"px-6 py-4 text-gray-600 max-w-xs truncate",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[g.details.date&&e.jsxs("span",{className:"flex items-center text-xs",children:[e.jsx(gt,{className:"w-3 h-3 mr-1"})," ",g.details.date]}),g.details.reason&&e.jsxs("span",{className:"flex items-center text-xs italic text-gray-500",title:g.details.reason,children:[e.jsx(_t,{className:"w-3 h-3 mr-1"})," ",g.details.reason]})]})})]},g.id))})]})})]}),Ms=({month:o,year:D,userId:g,data:w})=>{const[l,u]=n.useState([]),[k,B]=n.useState(!w),[fe,ae]=n.useState([]),[I,X]=n.useState([]),[$e,ye]=n.useState([]),{attendance:ke,officeHolidays:K,fieldHolidays:Ee,siteHolidays:Me,recurringHolidays:le}=Ft(),m=x=>{const c=x.toLowerCase();return["admin","developer","hr","operations_manager","back_office"].includes(c)?"office":["field_staff","site_manager"].includes(c)?"field":"site"};n.useEffect(()=>{w?(u(w),B(!1)):Se()},[o,D,g,w]);const Se=async()=>{B(!0);try{const x=await oe.getUsers();ae(x);const c=g?x.filter(te=>te.id===g):x,S=Ut(new Date(D,o-1)),z=$t(new Date(D,o-1)),A=[],{data:ee}=await oe.getLeaveRequests();X(ee||[]);const U=await oe.getAllUserHolidays();ye(U||[]);for(const te of c){const G=await oe.getAttendanceEvents(te.id,d(S,"yyyy-MM-dd"),d(z,"yyyy-MM-dd HH:mm:ss")),be=(ee||[]).filter(He=>He.userId===te.id&&He.status==="approved"),Be=Ie(te,G,be,U||[],D,o);A.push(Be)}u(A)}catch(x){console.error("Error loading monthly report:",x)}finally{B(!1)}},Ie=(x,c,S,z,A,ee)=>{const U=Wt(new Date(A,ee-1)),te=[];let G=0,be=0,Be=0,He=0,me=0,We=0,Pe=0,Qe=0,Ce=0,Nt=0,E=0,Ke=0,Ae=0,ze=0,Re=0,Le=0,et=0,Ge=0,qe=0;const it={};let xe=0;const ge=m(x.role),Fe=ke[ge],ct=ge==="office"?K:ge==="field"?Ee:Me;for(let ue=1;ue<=U;ue++){const se=new Date(A,ee-1,ue),st=se.getDay()===0,mt=`${A}-${String(ee).padStart(2,"0")}-${String(ue).padStart(2,"0")}`,rt=c.filter(a=>a.timestamp.startsWith(mt)),at=S.find(a=>ft(se,{start:lt(new Date(a.startDate)),end:yt(new Date(a.endDate))})),nt=(a,H)=>{if(!a)return!1;try{const O=d(H,"yyyy-MM-dd"),q=d(H,"-MM-dd");return typeof a=="string"?a.includes(O)||a.includes(q)||a.endsWith(q)?!0:a.startsWith("-")?O.endsWith(a):a.split(" ")[0].split("T")[0]===O:a instanceof Date?d(a,"yyyy-MM-dd")===O:!1}catch{return!1}},xt=pt.some(a=>{const[H,O]=a.date.split("-").map(Number);return se.getMonth()===H-1&&se.getDate()===O}),dt=z.some(a=>{const H=a.userId||a.user_id,O=a.holidayDate||a.holiday_date;return String(H)===String(x.id)&&nt(O,se)}),Ve=ct.some(a=>nt(a.date,se)),Ye=le.some(a=>{if(a.day.toLowerCase()!==d(se,"EEEE").toLowerCase())return!1;const H=Math.ceil(se.getDate()/7),O=a.type||"office";return a.n===H&&O===(ge==="site"?"office":ge)}),Xe=xt||dt||Ve,Oe=rt.length>0;let $="-";const ut=lt(new Date),Ne=ys(se,ut),Dt=bs(se,ut);se.getDay()===1&&(xe=0);let t="-",s="-",f="-",r="-",M="-",y="-",p="-",L="-",J="-";const ne=a=>{const H=Math.round(a*60),O=Math.floor(H/60),q=H%60;return`${O}:${String(q).padStart(2,"0")}`};if(Xe)Oe?($="HP",Ne||Ae++):($="H",Ne||Ce++);else if(Ye)Oe?($="HP",Ne||Ae++):($="F/H",Ne||E++);else if(at){const a=(at.leaveType||at.leave_type||"").toLowerCase();a==="sick"||a==="sick leave"?($="S/L",Re++):a==="comp off"||a==="comp-off"||a==="compoff"||a==="c/o"?($="C/O",et++):a==="floating"||a==="floating holiday"?($="F/H",E++):a==="loss of pay"||a==="lop"?($="A",Ke++):($="E/L",Le++)}else if(Oe){const{checkIn:a,checkOut:H,firstBreakIn:O,lastBreakIn:q,breakOut:re,workingHours:V,breakHours:j,totalHours:F}=Gt(rt);let W=V;r=O?d(new Date(O),"HH:mm"):"-",M=re?d(new Date(re),"HH:mm"):"-";let Q=0;if(a&&H){const h=Fe.dailyWorkingHours?.max||9;Q=Math.max(0,V-h),be+=W,G+=F,Be+=j,He+=Q,W>=(Fe.minimumHoursHalfDay||4)&&me++}W>=(Fe.minimumHoursHalfDay||4)&&xe++;let v="-";if(a){const h=new Date(a),P=h.getHours(),T=h.getMinutes(),C=P+T/60;C>=5&&C<8.5?v="Shift A":C>=8.5&&C<11.5?v="GS":C>=11.5&&C<20?v="Shift B":v="Shift C"}v!=="-"&&(it[v]=(it[v]||0)+1);const he=Fe.minimumHoursFullDay||8,pe=Fe.minimumHoursHalfDay||4;st?($="WOP",Ne||ze++):W>=he?$="P":W>=pe?($="1/2P",Pe++):$="P",t=a?d(new Date(a),"HH:mm"):"-",s=H?d(new Date(H),"HH:mm"):"-",f=F>0?ne(F):"-",y=j>0?ne(j):"-",p=V>0?ne(V):"-",L=Q>0?ne(Q):"-",J=v||"-"}else if(st){const a=ue<=7;Ne||(a||xe>=4?($="W/O",Qe++):($="A",We++)),xe=0}else!Ne&&!Dt&&($="A",We++);te.push({date:ue,status:$,inTime:t,outTime:s,grossDuration:f,breakIn:r,breakOut:M,breakDuration:y,netWorkedHours:p,ot:L,shift:J})}const vt=me>0?be/me:0,tt=me+Qe+Ce+ze+Ae+Pe*.5+Re+Le+E+et+Ge;return{employeeId:x.id,employeeName:x.name,userName:x.name,statuses:te.map(ue=>ue.status),totalGrossWorkDuration:G,totalNetWorkDuration:be,totalBreakDuration:Be,totalOT:He,presentDays:me,halfDays:Pe,absentDays:We,weekOffs:qe,holidays:Ce,holidayPresents:Ae,weekendPresents:ze,sickLeaves:Re,earnedLeaves:Le,floatingHolidays:E,compOffs:et,lossOfPays:Ke,workFromHomeDays:Ge,totalPayableDays:tt,averageWorkingHrs:Math.round(vt*100)/100,totalDurationPlusOT:be,shiftCounts:it,dailyData:te,present:me,absent:We,weeklyOff:qe,leaves:Nt,lossOfPay:Ke}},Z=()=>{console.log("Export to Excel",l)};return k?e.jsx("div",{className:"p-8 text-center",children:"Loading report..."}):e.jsxs("div",{className:"p-6 bg-white min-h-screen",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Monthly Status Report (Detailed Work Duration)"}),e.jsxs("p",{className:"text-gray-600",children:[d(new Date(D,o-1,1),"MMM dd yyyy")," To ",d(new Date(D,o-1,Wt(new Date(D,o-1))),"MMM dd yyyy")]})]}),e.jsxs(Ue,{onClick:Z,children:[e.jsx(ts,{className:"mr-2 h-4 w-4"})," Download CSV"]})]}),l.map(x=>e.jsxs("div",{className:"mb-12 border border-gray-300 rounded-lg p-6 bg-white",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Employee: ",x.employeeId," - ",x.employeeName]}),e.jsxs("div",{className:"text-sm text-gray-700 mt-2",children:[e.jsxs("p",{children:["Total Gross Work Duration: ",x.totalGrossWorkDuration.toFixed(2)," Hrs, Total Net Work Duration: ",x.totalNetWorkDuration.toFixed(2)," Hrs, Total Break Time: ",x.totalBreakDuration.toFixed(2)," Hrs, Total OT: ",x.totalOT.toFixed(2)," Hrs"]}),e.jsxs("p",{children:["Present: ",x.presentDays,", Half Days: ",x.halfDays,", Absent: ",x.absentDays,", WeeklyOff: ",x.weekOffs,", Holidays: ",x.holidays,", Leaves: ",x.leaves,", F/H: ",x.floatingHolidays,", LOP: ",x.lossOfPay,", HP: ",x.holidayPresents,", WOP: ",x.weekendPresents,", Total Payable Days: ",x.totalPayableDays]}),e.jsxs("p",{children:["Average Working Hrs: ",x.averageWorkingHrs.toFixed(2)," Hrs"]}),e.jsxs("p",{children:["Shift Count: ",Object.entries(x.shiftCounts).map(([c,S])=>`${c} ${S}`).join(" ")]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs border-collapse border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-300",children:[e.jsx("th",{className:"p-2 text-left font-semibold bg-gray-200 text-gray-900 border-r border-gray-300",children:"Status"}),x.dailyData.map(c=>e.jsx("th",{className:"p-1 text-center font-normal border-l border-gray-300 bg-white text-gray-900",children:c.date},c.date))]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b border-gray-300",children:[e.jsx("td",{className:"p-2 font-semibold bg-gray-200 text-gray-900 border-r border-gray-300",children:"Status"}),x.dailyData.map(c=>e.jsx("td",{className:"p-1 text-center border-l border-gray-300 font-bold text-gray-900",children:e.jsx("span",{className:c.status==="P"?"text-green-600":c.status==="1/2P"||c.status==="C/O"?"text-blue-600":c.status==="W/O"?"text-gray-500":c.status==="H"?"text-orange-600":c.status==="F/H"?"text-yellow-600":c.status==="LOP"?"text-red-400":"text-red-600",children:c.status})},c.date))]}),e.jsxs("tr",{className:"border-b border-gray-300",children:[e.jsx("td",{className:"p-2 font-semibold bg-gray-200 text-gray-900 border-r border-gray-300",children:"InTime"}),x.dailyData.map(c=>e.jsx("td",{className:"p-1 text-center border-l border-gray-300 text-gray-900",children:c.inTime},c.date))]}),e.jsxs("tr",{className:"border-b border-gray-300",children:[e.jsx("td",{className:"p-2 font-semibold bg-gray-200 text-gray-900 border-r border-gray-300",children:"OutTime"}),x.dailyData.map(c=>e.jsx("td",{className:"p-1 text-center border-l border-gray-300 text-gray-900",children:c.outTime},c.date))]}),e.jsxs("tr",{className:"border-b border-gray-300",children:[e.jsx("td",{className:"p-2 font-semibold bg-gray-200 text-gray-900 border-r border-gray-300 whitespace-nowrap",children:"Gross Dur"}),x.dailyData.map(c=>e.jsx("td",{className:"p-1 text-center border-l border-gray-300 text-gray-900",children:c.grossDuration},c.date))]}),e.jsxs("tr",{className:"border-b border-gray-300",children:[e.jsx("td",{className:"p-2 font-semibold bg-gray-200 text-gray-900 border-r border-gray-300 whitespace-nowrap",children:"Break In"}),x.dailyData.map(c=>e.jsx("td",{className:"p-1 text-center border-l border-gray-300 text-gray-900",children:c.breakIn},c.date))]}),e.jsxs("tr",{className:"border-b border-gray-300",children:[e.jsx("td",{className:"p-2 font-semibold bg-gray-200 text-gray-900 border-r border-gray-300",children:"Break Out"}),x.dailyData.map(c=>e.jsx("td",{className:"p-1 text-center border-l border-gray-300 text-gray-900",children:c.breakOut},c.date))]}),e.jsxs("tr",{className:"border-b border-gray-300",children:[e.jsx("td",{className:"p-2 font-semibold bg-gray-200 text-gray-900 border-r border-gray-300 whitespace-nowrap",children:"Break Dur"}),x.dailyData.map(c=>e.jsx("td",{className:"p-1 text-center border-l border-gray-300 text-gray-900",children:c.breakDuration},c.date))]}),e.jsxs("tr",{className:"border-b border-gray-300",children:[e.jsx("td",{className:"p-2 font-semibold bg-gray-200 text-gray-900 border-r border-gray-300 whitespace-nowrap",children:"Net Worked Hrs"}),x.dailyData.map(c=>e.jsx("td",{className:"p-1 text-center border-l border-gray-300 text-gray-900",children:c.netWorkedHours},c.date))]}),e.jsxs("tr",{className:"border-b border-gray-300",children:[e.jsx("td",{className:"p-2 font-semibold bg-gray-200 text-gray-900 border-r border-gray-300 whitespace-nowrap",children:"OT"}),x.dailyData.map(c=>e.jsx("td",{className:"p-1 text-center border-l border-gray-300 text-gray-900",children:c.ot},c.date))]}),e.jsxs("tr",{className:"border-b border-gray-300",children:[e.jsx("td",{className:"p-2 font-semibold bg-gray-200 text-gray-900 border-r border-gray-300 whitespace-nowrap",children:"Shift"}),x.dailyData.map(c=>e.jsx("td",{className:"p-1 text-center border-l border-gray-300 text-gray-900",children:c.shift},c.date))]})]})]})})]},x.employeeId))]})};Lt.register(ns,ds,os,ls,is,cs,ms,xs,us,hs,ps,fs);const Ss=({data:o})=>{const D=n.useRef(null),g=n.useRef(null);return n.useEffect(()=>{if(D.current){g.current&&g.current.destroy();const w=D.current.getContext("2d");w&&(g.current=new Lt(w,{type:"bar",data:{labels:o.labels,datasets:[{label:"Present",data:o.present,backgroundColor:"#005D22",borderColor:"#004218",borderWidth:1,borderRadius:4},{label:"Absent",data:o.absent,backgroundColor:"#EF4444",borderColor:"#DC2626",borderWidth:1,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,grid:{color:"rgba(128,128,128,0.1)"}},x:{grid:{display:!1},ticks:{maxRotation:0,minRotation:0,autoSkip:!0,maxTicksLimit:7}}},plugins:{legend:{display:!0,position:"bottom",align:"center",labels:{usePointStyle:!0,pointStyle:"rectRounded",boxWidth:12,padding:20,font:{family:"'Manrope', sans-serif",size:12}}},tooltip:{backgroundColor:"#0F172A",titleFont:{family:"'Manrope', sans-serif"},bodyFont:{family:"'Manrope', sans-serif"},cornerRadius:8,padding:10,displayColors:!0,boxPadding:4}}}}))}return()=>{g.current&&g.current.destroy()}},[o]),e.jsx("div",{className:"h-full w-full flex flex-col",children:e.jsx("div",{className:"flex-grow relative",children:e.jsx("canvas",{ref:D})})})},Hs=({data:o})=>{const D=n.useRef(null),g=n.useRef(null);return n.useEffect(()=>{if(D.current){g.current&&g.current.destroy();const w=D.current.getContext("2d");if(w){const l=w.createLinearGradient(0,0,0,200);l.addColorStop(0,"rgba(0, 93, 34, 0.4)"),l.addColorStop(1,"rgba(0, 93, 34, 0)"),g.current=new Lt(w,{type:"line",data:{labels:o.labels,datasets:[{label:"Average Hours Worked",data:o.hours,borderColor:"#005D22",backgroundColor:l,fill:!0,tension:.4,pointBackgroundColor:"#005D22",pointRadius:0,pointHoverRadius:5}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,grid:{color:"rgba(128,128,128,0.1)"},ticks:{stepSize:1,precision:0,callback:u=>{const k=typeof u=="string"?parseFloat(u):u;return Math.round(k)}}},x:{grid:{display:!1},ticks:{maxRotation:0,minRotation:0,autoSkip:!0,maxTicksLimit:7}}},plugins:{legend:{display:!0,position:"bottom",align:"center",labels:{usePointStyle:!0,pointStyle:"rectRounded",boxWidth:12,padding:20,font:{family:"'Manrope', sans-serif",size:12}}},tooltip:{backgroundColor:"#0F172A",titleFont:{family:"'Manrope', sans-serif"},bodyFont:{family:"'Manrope', sans-serif"},cornerRadius:8,padding:10,displayColors:!0,boxPadding:4}}}})}}return()=>{g.current&&g.current.destroy()}},[o]),e.jsx("div",{className:"h-full w-full flex flex-col",children:e.jsx("div",{className:"flex-grow relative",children:e.jsx("canvas",{ref:D})})})},Ps=({data:o,dateRange:D,generatedBy:g})=>e.jsxs("div",{className:"p-8 font-sans text-sm text-black bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-4 mb-6",children:[e.jsx(wt,{className:"h-10",localPath:Je}),e.jsxs("div",{className:"text-right",children:[e.jsx("h1",{className:"text-xl font-bold",children:"Attendance Log"}),e.jsxs("p",{className:"text-gray-600",children:[d(D.startDate,"dd MMM yyyy")," to ",d(D.endDate,"dd MMM yyyy")]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Generated: ",d(new Date,"dd MMM yyyy HH:mm")]}),g&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Generated by: ",g]})]})]}),e.jsxs("table",{className:"w-full mt-6 text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"p-2 border border-gray-300",children:"User"}),e.jsx("th",{className:"p-2 border border-gray-300",children:"Date"}),e.jsx("th",{className:"p-2 border border-gray-300",children:"Time"}),e.jsx("th",{className:"p-2 border border-gray-300",children:"Event"}),e.jsx("th",{className:"p-2 border border-gray-300",children:"Location"})]})}),e.jsx("tbody",{children:o.map((w,l)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-2 border border-gray-300",children:w.userName}),e.jsx("td",{className:"p-2 border border-gray-300",children:w.date}),e.jsx("td",{className:"p-2 border border-gray-300",children:w.time}),e.jsx("td",{className:"p-2 border border-gray-300 capitalize",children:w.type.replace("-"," ")}),e.jsx("td",{className:"p-2 border border-gray-300",children:w.locationName||(w.latitude?`${w.latitude?.toFixed(4)}, ${w.longitude?.toFixed(4)}`:"N/A")})]},`${w.userName}-${w.date}-${w.time}-${l}`))})]})]}),Cs=({data:o,dateRange:D,generatedBy:g,isPreview:w=!1})=>{const u=[];for(let k=0;k<o.length;k+=15)u.push(o.slice(k,k+15));return u.length===0?null:e.jsx("div",{children:u.map((k,B)=>{const fe=15-k.length,ae=B===u.length-1;return e.jsxs("div",{style:{padding:B===0?"40px":"0px 40px 40px 40px",paddingTop:B===0?"40px":"0px",marginTop:B===0?"0px":"-40px",fontFamily:'"Courier New", Courier, monospace',fontSize:"14px",color:"#000",backgroundColor:"#fff",width:w?"100%":"1123px",height:w?"auto":"794px",boxSizing:"border-box",letterSpacing:"0.5px",pageBreakAfter:ae?"auto":"always",position:"relative",display:"flex",flexDirection:"column"},children:[e.jsx("table",{style:{width:"100%",borderBottom:"2px solid #000",marginBottom:"16px",paddingBottom:"8px"},children:e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{style:{width:"50%",verticalAlign:"top",textAlign:"left"},children:e.jsx(wt,{className:"h-14",localPath:Je})}),e.jsxs("td",{style:{width:"50%",verticalAlign:"top",textAlign:"right"},children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",marginBottom:"6px",textTransform:"uppercase",letterSpacing:"1px"},children:"Basic Attendance Report"}),e.jsxs("div",{style:{fontSize:"12px",color:"#333",marginBottom:"4px"},children:[d(D.startDate,"dd MMM yyyy")," -"," ",d(D.endDate,"dd MMM yyyy")]}),e.jsxs("div",{style:{fontSize:"10px",color:"#666"},children:["Generated: ",d(new Date,"dd MMM yyyy HH:mm")]}),g&&e.jsxs("div",{style:{fontSize:"10px",color:"#666"},children:["Generated by: ",g]})]})]})})}),e.jsx("div",{style:{flexGrow:1},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",border:"1px solid #000",tableLayout:"fixed"},children:[e.jsx("thead",{style:{display:"table-header-group"},children:e.jsxs("tr",{style:{backgroundColor:"#f2f2f2"},children:[e.jsx("th",{style:{border:"1px solid #000",padding:"10px 5px",textAlign:"center",width:"28%",fontSize:"11px",fontWeight:"bold"},children:"Employee Name"}),e.jsx("th",{style:{border:"1px solid #000",padding:"10px 5px",textAlign:"center",width:"14%",fontSize:"11px",fontWeight:"bold"},children:"Date"}),e.jsx("th",{style:{border:"1px solid #000",padding:"10px 5px",textAlign:"center",width:"14%",fontSize:"11px",fontWeight:"bold"},children:"Status"}),e.jsx("th",{style:{border:"1px solid #000",padding:"10px 5px",textAlign:"center",width:"12%",fontSize:"11px",fontWeight:"bold"},children:"Punch In"}),e.jsx("th",{style:{border:"1px solid #000",padding:"10px 5px",textAlign:"center",width:"12%",fontSize:"11px",fontWeight:"bold"},children:"Punch Out"}),e.jsx("th",{style:{border:"1px solid #000",padding:"10px 5px",textAlign:"center",width:"15%",fontSize:"11px",fontWeight:"bold"},children:"Hours"})]})}),e.jsxs("tbody",{children:[k.map((I,X)=>e.jsxs("tr",{style:{backgroundColor:X%2===0?"#fff":"#fafafa"},children:[e.jsx("td",{style:{border:"1px solid #ccc",padding:"8px 5px",textAlign:"center",verticalAlign:"middle",wordWrap:"break-word",whiteSpace:"normal",lineHeight:"1.4"},children:I.userName}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"8px 5px",textAlign:"center",verticalAlign:"middle"},children:d(new Date(String(I.date).replace(/-/g,"/")),"dd MMM yyyy")}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"8px 5px",textAlign:"center",verticalAlign:"middle"},children:I.status}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"8px 5px",textAlign:"center",verticalAlign:"middle"},children:I.checkIn||"-"}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"8px 5px",textAlign:"center",verticalAlign:"middle"},children:I.checkOut||"-"}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"8px 5px",textAlign:"center",verticalAlign:"middle"},children:I.duration||"-"})]},`${I.userName}-${I.date}-${X}`)),Array.from({length:fe}).map((I,X)=>e.jsxs("tr",{style:{backgroundColor:"#fff"},children:[e.jsx("td",{style:{border:"1px solid #ccc",padding:"8px 5px",height:"33px"},children:" "}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"8px 5px"},children:" "}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"8px 5px"},children:" "}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"8px 5px"},children:" "}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"8px 5px"},children:" "}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"8px 5px"},children:" "})]},`empty-${X}`))]})]})}),e.jsxs("div",{style:{marginTop:"10px",borderTop:"1px solid #ccc",paddingTop:"8px",textAlign:"center",fontSize:"10px",color:"#888"},children:["Paradigm Services - Confidential Report - Page ",B+1," of ",u.length]})]},B)})})},As=({data:o,dateRange:D,generatedBy:g})=>{const w=ot({start:D.startDate,end:D.endDate});return e.jsxs("div",{className:"p-8 font-sans text-[9px] text-black bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-4 mb-4",children:[e.jsx(wt,{className:"h-8",localPath:Je}),e.jsxs("div",{className:"text-right",children:[e.jsx("h1",{className:"text-lg font-bold",children:"Monthly Attendance Report"}),e.jsxs("p",{className:"text-gray-600",children:[d(D.startDate,"dd MMM yyyy")," to ",d(D.endDate,"dd MMM yyyy")]}),e.jsxs("p",{className:"text-[10px] text-gray-500 mt-1",children:["Generated: ",d(new Date,"dd MMM yyyy HH:mm")]}),g&&e.jsxs("p",{className:"text-[10px] text-gray-500",children:["Generated by: ",g]})]})]}),e.jsxs("table",{className:"w-full border-collapse border border-gray-400 text-center",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-200 font-bold",children:[e.jsx("td",{className:"border p-1 border-gray-400 text-left",children:"Employee Name"}),w.map((l,u)=>e.jsx("td",{className:"border p-1 border-gray-400",children:d(l,"d")},u)),e.jsx("td",{className:"border p-1 border-gray-400",children:"P"}),e.jsx("td",{className:"border p-1 border-gray-400",children:"1/2P"}),e.jsx("td",{className:"border p-1 border-gray-400",children:"W/H"}),e.jsx("td",{className:"border p-1 border-gray-400",children:"A"}),e.jsx("td",{className:"border p-1 border-gray-400",children:"WO"}),e.jsx("td",{className:"border p-1 border-gray-400",children:"H"}),e.jsx("td",{className:"border p-1 border-gray-400",children:"WOP"}),e.jsx("td",{className:"border p-1 border-gray-400",children:"HP"}),e.jsx("td",{className:"border p-1 border-gray-400 bg-green-50 text-green-800",children:"S/L"}),e.jsx("td",{className:"border p-1 border-gray-400 bg-blue-50 text-blue-800",children:"E/L"}),e.jsx("td",{className:"border p-1 border-gray-400 bg-yellow-50 text-yellow-800",children:"F/H"}),e.jsx("td",{className:"border p-1 border-gray-400 bg-purple-50 text-purple-800",children:"C/O"}),e.jsx("td",{className:"border p-1 border-gray-400 font-bold",children:"Total"})]})}),e.jsx("tbody",{children:o.map((l,u)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-1 border-gray-400 text-left",children:l.userName}),l.statuses.map((k,B)=>e.jsx("td",{className:"border p-1 border-gray-400",children:k},B)),e.jsx("td",{className:"border p-1 border-gray-400",children:l.presentDays}),e.jsx("td",{className:"border p-1 border-gray-400",children:l.halfDays}),e.jsx("td",{className:"border p-1 border-gray-400 font-medium text-blue-700",children:l.workFromHomeDays}),e.jsx("td",{className:"border p-1 border-gray-400",children:l.absentDays}),e.jsx("td",{className:"border p-1 border-gray-400",children:l.weekOffs}),e.jsx("td",{className:"border p-1 border-gray-400",children:l.holidays}),e.jsx("td",{className:"border p-1 border-gray-400",children:l.weekendPresents}),e.jsx("td",{className:"border p-1 border-gray-400",children:l.holidayPresents}),e.jsx("td",{className:"border p-1 border-gray-400 bg-green-50",children:l.sickLeaves}),e.jsx("td",{className:"border p-1 border-gray-400 bg-blue-50",children:l.earnedLeaves}),e.jsx("td",{className:"border p-1 border-gray-400 bg-yellow-50",children:l.floatingHolidays}),e.jsx("td",{className:"border p-1 border-gray-400 bg-purple-50",children:l.compOffs}),e.jsx("td",{className:"border p-1 border-gray-400 font-bold",children:l.totalPayableDays})]},u))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-gray-100 font-bold",children:[e.jsx("td",{className:"border p-1 border-gray-400 text-left",colSpan:w.length+1,children:"Total"}),e.jsx("td",{className:"border p-1 border-gray-400",children:o.reduce((l,u)=>l+u.presentDays,0)}),e.jsx("td",{className:"border p-1 border-gray-400",children:o.reduce((l,u)=>l+u.halfDays,0)}),e.jsx("td",{className:"border p-1 border-gray-400 text-blue-700",children:o.reduce((l,u)=>l+u.workFromHomeDays,0)}),e.jsx("td",{className:"border p-1 border-gray-400",children:o.reduce((l,u)=>l+u.absentDays,0)}),e.jsx("td",{className:"border p-1 border-gray-400",children:o.reduce((l,u)=>l+u.weekOffs,0)}),e.jsx("td",{className:"border p-1 border-gray-400",children:o.reduce((l,u)=>l+u.holidays,0)}),e.jsx("td",{className:"border p-1 border-gray-400",children:o.reduce((l,u)=>l+u.weekendPresents,0)}),e.jsx("td",{className:"border p-1 border-gray-400",children:o.reduce((l,u)=>l+u.holidayPresents,0)}),e.jsx("td",{className:"border p-1 border-gray-400 text-green-800",children:o.reduce((l,u)=>l+u.sickLeaves,0)}),e.jsx("td",{className:"border p-1 border-gray-400 text-blue-800",children:o.reduce((l,u)=>l+u.earnedLeaves,0)}),e.jsx("td",{className:"border p-1 border-gray-400 text-yellow-800",children:o.reduce((l,u)=>l+u.floatingHolidays,0)}),e.jsx("td",{className:"border p-1 border-gray-400 text-purple-800",children:o.reduce((l,u)=>l+u.compOffs,0)}),e.jsx("td",{className:"border p-1 border-gray-400 font-bold",children:o.reduce((l,u)=>l+u.totalPayableDays,0)})]})})]})]})},Bs=()=>{qt("(max-width: 639px)");const{user:o}=Vt(),D=o?.role,{permissions:g}=Yt(),{recurringHolidays:w,officeHolidays:l,fieldHolidays:u}=Ft(),[k,B]=n.useState([]),fe=n.useRef([]);n.useEffect(()=>{fe.current=k},[k]);const[ae,I]=n.useState([]),[X,$e]=n.useState([]),[ye,ke]=n.useState([]),[K,Ee]=n.useState(null),[Me,le]=n.useState(!0),[m,Se]=n.useState({startDate:Ct(),endDate:Pt(),key:"selection"}),Ie=n.useMemo(()=>[m],[m]),[Z,x]=n.useState("Today"),[c,S]=n.useState(!1),z=n.useRef(null),[A,ee]=n.useState("all"),[U,te]=n.useState("all"),[G,be]=n.useState("all"),[Be,He]=n.useState(!1),[me,We]=n.useState("summary"),[Pe,Qe]=n.useState([]),[Ce,Nt]=n.useState("all"),[E,Ke]=n.useState("basic"),[Ae,ze]=n.useState(!1),[Re,Le]=n.useState(null),et=n.useRef(null),Ge=n.useCallback(async()=>{try{const{data:t,error:s}=await bt.from("attendance_audit_logs").select("*").order("created_at",{ascending:!1}).limit(100);if(s)throw s;const f=new Set;if(t?.forEach(r=>{r.performed_by&&f.add(r.performed_by),r.target_user_id&&f.add(r.target_user_id)}),f.size>0){const{data:r}=await bt.from("users").select("id, name").in("id",Array.from(f)),M=new Map;r?.forEach(p=>M.set(p.id,p.name));const y=t.map(p=>({...p,performer_name:M.get(p.performed_by)||"Unknown",target_name:M.get(p.target_user_id)||"Unknown"}));Qe(y)}else Qe(t||[])}catch(t){console.error("Error fetching audit logs",t)}},[]);n.useEffect(()=>{E==="audit"&&Ge()},[E,Ge]);const qe=o&&(Tt(o.role)||g[o.role]?.includes("download_attendance_report")),xe=!(o&&(Tt(o.role)||g[o.role]?.includes("view_all_attendance"))),[ge,Fe]=n.useState({present:0,absent:0,ot:0,compOff:0}),[ct,vt]=n.useState([]);n.useEffect(()=>{const t=s=>{z.current&&!z.current.contains(s.target)&&S(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]),n.useEffect(()=>{qe&&oe.getUsers().then(B)},[qe]),n.useEffect(()=>{(async()=>{if(!(!xe||!o||!m.startDate||!m.endDate)){le(!0);try{const s=At(m.startDate,7),f=s.toISOString(),r=m.endDate.toISOString(),[M,y,p,L]=await Promise.all([oe.getAttendanceEvents(o.id,f,r),oe.getCompOffLogs(o.id),oe.getUserHolidays(o.id),oe.getLeaveRequests({userId:o.id,startDate:f,endDate:r,status:"approved"})]),J=Array.isArray(L)?L:L.data||[];ke(p||[]);let a=ot({start:s,end:m.endDate}).map(j=>{const F=d(j,"yyyy-MM-dd"),W=M.filter(b=>d(new Date(b.timestamp),"yyyy-MM-dd")===F),Q=(b,N)=>{if(!b)return!1;try{const i=d(N,"yyyy-MM-dd"),_=d(N,"-MM-dd");return typeof b=="string"?b.includes(i)||b.includes(_)||b.endsWith(_)?!0:b.startsWith("-")?i.endsWith(b):b.split(" ")[0].split("T")[0]===i:b instanceof Date?d(b,"yyyy-MM-dd")===i:!1}catch{return!1}};let v="A",he="-",pe="-",h=0;const P=d(j,"EEEE"),T=P==="Sunday",je=["admin","super_admin","hr","finance"].includes(o.role?.toLowerCase()||""),ie=w.some(b=>{if(b.day.toLowerCase()!==P.toLowerCase())return!1;const N=Math.ceil(j.getDate()/7),i=je?"office":"field";return b.n===N&&(b.type||"office")===i}),ve=pt.some(b=>{const[N,i]=b.date.split("-").map(Number);return j.getMonth()===N-1&&j.getDate()===i}),de=p.some(b=>{const N=b.holidayDate||b.holiday_date;return Q(N,j)}),Te=ie||ve||de,R=J.find(b=>ft(j,{start:lt(new Date(b.startDate)),end:yt(new Date(b.endDate))})),we=W.length>0;if(Te)v=we?"HP":"H";else if(R){const b=R.leaveType?.toLowerCase();b==="sick"?v="S/L":b==="comp off"||b==="compoff"||b==="c/o"?v="C/O":b==="loss of pay"||b==="lop"?v="A":v="E/L"}else we?T?v="W/P":v="P":T&&(v="W/O");if(we){W.sort((i,_)=>new Date(i.timestamp).getTime()-new Date(_.timestamp).getTime());const b=W.find(i=>i.type==="check-in"),N=[...W].reverse().find(i=>i.type==="check-out");if(b&&(he=d(new Date(b.timestamp),"hh:mm a")),N&&(pe=d(new Date(N.timestamp),"hh:mm a"),b)){const _=ht(new Date(N.timestamp),new Date(b.timestamp))/60;_>8&&(h=Math.round((_-8)*10)/10)}}return{rawDate:j,date:d(j,"dd MMM, yyyy"),day:P,checkIn:he,checkOut:pe,status:v,ot:h}});a.forEach((j,F)=>{if(j.status==="W/O"&&j.day==="Sunday"){let W=0;const Q=Math.max(0,F-6);for(let v=F-1;v>=Q;v--)a[v].status==="A"&&W++;W>=4&&(j.status="A")}});const H=a.filter(j=>j.rawDate>=m.startDate),O=H.filter(j=>j.status==="P"||j.status==="W/H"||j.status==="W/P"||j.status==="H/P"||j.status==="0.5P").length,q=H.filter(j=>j.status==="A"&&j.rawDate<=new Date).length,re=H.reduce((j,F)=>j+F.ot,0),V=y.filter(j=>{const F=new Date(j.dateEarned);return F>=m.startDate&&F<=m.endDate&&j.status==="earned"}).length;Fe({present:O,absent:q,ot:Math.round(re*10)/10,compOff:V}),vt(H.reverse())}catch(s){console.error("Failed to fetch employee attendance",s)}finally{await new Promise(s=>setTimeout(s,1e4)),le(!1)}}})()},[xe,o,m,w]);const tt=n.useCallback(async(t,s)=>{if(!xe){le(!0);try{let f=fe.current;f.length===0&&(f=await oe.getUsers(),B(f),fe.current=f);const r=f.filter(h=>h.role!=="management"),M=new Date,y=t<M?t:Ct(),p=s>M?s:Pt(),[L,J,ne]=await Promise.all([oe.getAllAttendanceEvents(y.toISOString(),p.toISOString()),oe.getLeaveRequests({startDate:y.toISOString(),endDate:p.toISOString(),status:"approved"}),oe.getAllUserHolidays()]);I(L);const a=Array.isArray(J)?J:J.data;$e(a),ke(ne||[]);const H=d(M,"yyyy-MM-dd"),O=L.filter(h=>d(new Date(h.timestamp),"yyyy-MM-dd")===H),q=new Set(O.map(h=>h.userId)).size,re=a.filter(h=>{const P=new Date(h.startDate),T=new Date(h.endDate);return M>=P&&M<=T}),V=new Set(re.map(h=>h.userId)).size,j=r.length,F=Math.max(0,j-q-V),W=ot({start:t,end:s}),Q=W.map(h=>d(h,"dd MMM")),v=[],he=[],pe=[];W.forEach(h=>{const P=d(h,"yyyy-MM-dd"),T=L.filter(R=>d(new Date(R.timestamp),"yyyy-MM-dd")===P),C=new Set(T.map(R=>R.userId)).size,je=a.filter(R=>{const we=new Date(R.startDate),b=new Date(R.endDate);return h>=we&&h<=b}),ie=new Set(je.map(R=>R.userId)).size,ve=Math.max(0,j-C-ie);v.push(C),he.push(ve);let de=0;const Te={};T.forEach(R=>{Te[R.userId]||(Te[R.userId]=[]),Te[R.userId].push(R)}),Object.values(Te).forEach(R=>{R.sort((N,i)=>new Date(N.timestamp).getTime()-new Date(i.timestamp).getTime());const we=R.find(N=>N.type==="check-in"),b=[...R].reverse().find(N=>N.type==="check-out");if(we&&b){const N=ht(new Date(b.timestamp),new Date(we.timestamp));de+=N/60}}),pe.push(C>0?parseFloat((de/C).toFixed(1)):0)}),Ee({totalEmployees:j,presentToday:q,absentToday:F,onLeaveToday:V,attendanceTrend:{labels:Q,present:v,absent:he},productivityTrend:{labels:Q,hours:pe}})}catch(f){console.error("Failed to load dashboard data",f)}finally{await new Promise(f=>setTimeout(f,1e4)),le(!1)}}},[xe]),ue=n.useId(),se=n.useId(),st=n.useId(),mt=n.useId(),rt=n.useId();n.useId(),n.useId(),n.useEffect(()=>{m.startDate&&m.endDate&&tt(m.startDate,m.endDate)},[m,tt]);const at=n.useMemo(()=>{const t=new Set(k.map(s=>s.role).filter(Boolean));return Array.from(t).sort()},[k]),nt=t=>{x(t);const s=new Date;let f=Ct(),r=Pt();t==="This Month"?(f=Ut(s),r=$t(s)):t==="This Year"?(f=gs(s),r=js(s)):t==="Last 7 Days"?f=At(s,6):t==="Last 30 Days"&&(f=At(s,29)),r>s&&(r=s),Se({startDate:f,endDate:r,key:"selection"})},xt=t=>{Se(t.selection),x("Custom"),S(!1)},dt=n.useMemo(()=>{const t=m.endDate,s=new Date;return d(t,"yyyy-MM-dd")===d(s,"yyyy-MM-dd")?"Today":`on ${d(t,"MMM d")}`},[m]),Ve=n.useMemo(()=>{if(!m.startDate||!m.endDate)return[];const t=[],s=ot({start:m.startDate,end:m.endDate});let f=k.filter(y=>y.role!=="management");A!=="all"&&(f=f.filter(y=>y.id===A)),U!=="all"&&(f=f.filter(y=>y.role===U)),f.forEach(y=>{s.forEach(p=>{const L=d(p,"yyyy-MM-dd"),J=ae.filter(h=>h.userId===y.id&&d(new Date(h.timestamp),"yyyy-MM-dd")===L),ne=X.some(h=>h.userId===y.id&&h.status==="approved"&&ft(p,{start:lt(new Date(h.startDate)),end:yt(new Date(h.endDate))}));let a="A",H="",O="",q="";const re=d(p,"EEEE"),V=re==="Sunday",F=["admin","super_admin","hr","finance"].includes(y.role?.toLowerCase()||"")?"office":"field",W=w.some(h=>{if(h.day.toLowerCase()!==re.toLowerCase())return!1;const P=p.getDate(),T=Math.ceil(P/7),C=h.type||"office";return h.n===T&&C===F}),Q=pt.some(h=>{const[P,T]=h.date.split("-").map(Number);return p.getMonth()===P-1&&p.getDate()===T}),v=ye.some(h=>{const P=h.userId||h.user_id,T=h.holidayDate||h.holiday_date;if(!P||!T)return!1;const C=String(P).trim().toLowerCase(),je=String(y.id).trim().toLowerCase();if(C!==je)return!1;const ie=d(p,"yyyy-MM-dd"),ve=d(p,"-MM-dd"),de=String(T);return de.includes(ie)||de.endsWith(ve)||de.startsWith("-")&&ie.endsWith(de)}),he=(F==="field"?u:l).some(h=>{const P=String(h.date),T=d(p,"yyyy-MM-dd"),C=d(p,"-MM-dd");return P.includes(T)||P.endsWith(C)||P.startsWith("-")&&T.endsWith(P)});if(Q||v||he?a="H":W?a="F/H":V&&(a="W/O"),J.length>0){const h=[...J].sort((C,je)=>new Date(C.timestamp).getTime()-new Date(je.timestamp).getTime()),P=h.find(C=>C.type==="check-in"),T=[...h].reverse().find(C=>C.type==="check-out");if(W?a="H/P":V?a="W/P":a="P",P&&(H=d(new Date(P.timestamp),"HH:mm")),T&&(O=d(new Date(T.timestamp),"HH:mm")),P&&T){const C=new Date(P.timestamp),je=new Date(T.timestamp),ie=ht(je,C),ve=Math.floor(ie/60),de=ie%60;q=`${ve}h ${de}m`}}else ne&&(a="E/L");t.push({userName:y.name,date:L,status:a,checkIn:H,checkOut:O,duration:q})})});let M=G==="all"?t:t.filter(y=>y.status===G);return Ce!=="all"&&(M=M.filter(y=>{const p=y.checkIn&&y.checkIn!=="-"&&y.checkIn!=="",L=y.checkOut&&y.checkOut!=="-"&&y.checkOut!=="";switch(Ce){case"complete":return p&&L;case"missing_checkout":return p&&!L;case"missing_checkin":return!p&&L;case"incomplete":return!p||!L;default:return!0}})),M},[k,ae,m,A,U,G,Ce,w,X,ye,l,u]),Ye=n.useMemo(()=>{if(!m.startDate||!m.endDate)return[];let t=k.filter(r=>r.role!=="management");A!=="all"&&(t=t.filter(r=>r.id===A)),U!=="all"&&(t=t.filter(r=>r.role===U));const s=t,f=new Set(s.map(r=>r.id));return ae.filter(r=>f.has(r.userId)).map(r=>{const M=k.find(p=>p.id===r.userId),y=r.locationName||(r.latitude&&r.longitude?`${r.latitude.toFixed(4)}, ${r.longitude.toFixed(4)}`:"N/A");return{userName:M?.name||"Unknown",date:d(new Date(r.timestamp),"yyyy-MM-dd"),time:d(new Date(r.timestamp),"HH:mm:ss"),type:r.type,locationName:y,latitude:r.latitude,longitude:r.longitude}}).sort((r,M)=>r.date!==M.date?r.date.localeCompare(M.date):r.time.localeCompare(M.time))},[k,ae,m,A,U,X,w,ye,l,u]),Xe=n.useMemo(()=>{if(!m.startDate||!m.endDate)return[];const t=ot({start:m.startDate,end:m.endDate});let s=k.filter(r=>r.role!=="management");return A!=="all"&&(s=s.filter(r=>r.id===A)),U!=="all"&&(s=s.filter(r=>r.role===U)),s.map(r=>{const M=[];let y=0,p=0,L=0,J=0,ne=0,a=0,H=0,O=0,q=0,re=0,V=0,j=0,F=0,W=0;t.forEach(v=>{const he=d(v,"yyyy-MM-dd"),pe=(i,_)=>{if(!i)return!1;try{const Y=d(_,"yyyy-MM-dd"),De=d(_,"-MM-dd"),ce=String(i).split(" ")[0].split("T")[0];if(ce===Y||ce.includes(De)||ce.endsWith(De))return!0;if(ce.startsWith("-"))return Y.endsWith(ce);const kt=Y.replace(/-/g,"");return!!ce.replace(/[-\/]/g,"").includes(kt)}catch{return!1}},h=ae.filter(i=>String(i.userId)===String(r.id)&&d(new Date(i.timestamp),"yyyy-MM-dd")===he),P=h.length>0,T=d(v,"EEEE"),C=T==="Sunday",ie=["admin","super_admin","hr","finance"].includes(r.role?.toLowerCase()||"")?"office":"field",ve=w.some(i=>{if(i.day.toLowerCase()!==T.toLowerCase())return!1;const _=v.getDate(),Y=Math.ceil(_/7),De=i.type||"office";return i.n===Y&&De===ie}),de=pt.some(i=>{const[_,Y]=i.date.split("-").map(Number);return v.getMonth()===_-1&&v.getDate()===Y}),Te=ye.some(i=>{const _=i.userId||i.user_id,Y=i.holidayDate||i.holiday_date;if(!_||!Y)return!1;const De=String(_).trim().toLowerCase(),ce=String(r.id).trim().toLowerCase();return De===ce&&pe(Y,v)}),R=(ie==="field"?u:l).some(i=>pe(i.date,v)),we=de||Te||R,b=X.find(i=>String(i.userId)===String(r.id)&&i.status==="approved"&&ft(v,{start:lt(new Date(i.startDate)),end:yt(new Date(i.endDate))}));let N="";if(we)P?(N="HP",H++):(N="H",ne++);else if(ve)P?(N="HP",H++):(N="F/H",V++);else if(b){const i=b.leaveType?.toLowerCase();i==="sick"?(N="S/L",q++):i==="comp off"||i==="comp-off"||i==="compoff"||i==="c/o"?(N="C/O",j++):i==="floating"||i==="floating holiday"?(N="F/H",V++):i==="loss of pay"||i==="loss-of-pay"||i==="lop"?(N="A",p++,F++):(N="E/L",re++)}else if(P){const i=h.sort((_e,St)=>new Date(_e.timestamp).getTime()-new Date(St.timestamp).getTime()),_=i.find(_e=>_e.type==="check-in"),Y=[...i].reverse().find(_e=>_e.type==="check-out");let De=0;if(_&&Y){const _e=new Date(_.timestamp),St=new Date(Y.timestamp);De=ht(St,_e)}const ce=De/60,kt=6,Mt=3,Ot=ce>=kt,Bt=!Ot&&ce>=Mt,zt=_?.locationName?.toLowerCase().includes("work from home")||Y?.locationName?.toLowerCase().includes("work from home");C?(N="WOP",a++):zt?(N="W/H",W++):Ot?(N="P",y++):Bt?(N="0.5P",L++):(N="P",y++),ce>=Mt&&O++}else C?(v.getDate()<=7||O>=4?(N="W/O",J++):(N="A",p++),O=0):(N="A",p++);M.push(N)});const Q=y+J+ne+a+H+L*.5+q+re+V+j+W;return{userName:r.name,statuses:M,presentDays:y,absentDays:p,halfDays:L,weekOffs:J,holidays:ne,weekendPresents:a,holidayPresents:H,totalPayableDays:Q,sickLeaves:q,earnedLeaves:re,floatingHolidays:V,compOffs:j,lossOfPays:F,workFromHomeDays:W}}).filter(r=>G==="all"?!0:r.statuses.includes(G))},[k,ae,m,A,U,w,X,ye,l,u]),Oe=n.useCallback((t=!1)=>{const s=o?.name||"Unknown User";return E==="basic"?e.jsx(Cs,{data:Ve,dateRange:m,generatedBy:s,isPreview:t}):E==="log"?e.jsx(Ps,{data:Ye,dateRange:m,generatedBy:s}):E==="monthly"?e.jsx(As,{data:Xe,dateRange:m,generatedBy:s}):E==="audit"?e.jsx(ks,{logs:Pe,generatedBy:s}):null},[E,Ve,Ye,Xe,m,Pe,o?.name]),$=n.useMemo(()=>Oe(!1),[Oe]),ut=n.useMemo(()=>Oe(!0),[Oe]),Ne=async()=>{ze(!0);try{const t=Zt.getState().currentLogo;let s="";if(t&&t.startsWith("data:image"))s=t;else{const f=t&&(t.startsWith("http")||t.startsWith("/"))?t:Je;if(f)try{const r=await fetch(f);if(!r.ok)throw new Error("Fetch failed");const M=await r.blob();s=await new Promise((y,p)=>{const L=new FileReader;L.onloadend=()=>y(L.result),L.onerror=p,L.readAsDataURL(M)})}catch(r){console.error("Failed to fetch logo for Excel export:",r)}}if(E==="monthly")await ws(Xe,{startDate:m.startDate,endDate:m.endDate},s,o?.name||"Unknown User");else{let f=[],r=[],M="",y="";E==="basic"?(M="Basic Attendance Report",y="Attendance_Report",f=[{header:"Employee Name",key:"userName",width:25},{header:"Date",key:"date",width:15},{header:"Status",key:"status",width:15},{header:"Punch In",key:"checkIn",width:15},{header:"Punch Out",key:"checkOut",width:15},{header:"Hours",key:"duration",width:15}],r=Ve):E==="log"?(M="Attendance Log",y="Attendance_Log",f=[{header:"User",key:"userName",width:25},{header:"Date",key:"date",width:15},{header:"Time",key:"time",width:15},{header:"Event",key:"type",width:15},{header:"Location",key:"locationName",width:30},{header:"Latitude",key:"latitude",width:15},{header:"Longitude",key:"longitude",width:15}],r=Ye.map(p=>({...p,locationName:p.locationName||""}))):E==="audit"&&(M="Audit Log Report",y="Audit_Log",f=[{header:"Date & Time",key:"dateTime",width:20},{header:"Action",key:"action",width:20},{header:"Performed By",key:"performer_name",width:25},{header:"Target Employee",key:"target_name",width:25},{header:"Details",key:"detailsStr",width:50}],r=Pe.map(p=>({dateTime:d(new Date(p.created_at),"yyyy-MM-dd HH:mm"),action:p.action,performer_name:p.performer_name,target_name:p.target_name,detailsStr:JSON.stringify(p.details)}))),await Ns(r,f,M,{startDate:m.startDate,endDate:m.endDate},y,s,o?.name||"Unknown User")}Le({message:"Excel report downloaded successfully.",type:"success"})}catch(t){console.error("Download failed:",t),Le({message:"Failed to generate report.",type:"error"})}finally{ze(!1)}};if(Me&&!K&&!xe)return e.jsx(vs,{message:"Fetching attendance data..."});if(xe)return e.jsxs("div",{className:"p-4 space-y-6 pb-24 md:bg-transparent bg-[#041b0f]",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-primary-text",children:"My Attendance"}),e.jsxs("div",{className:"bg-card p-3 rounded-xl shadow-sm border border-border flex flex-wrap items-center gap-2",children:[["Today","This Month","Last 30 Days"].map(t=>e.jsx(Ue,{type:"button",variant:Z===t?"primary":"outline",onClick:()=>nt(t),className:Z===t?"text-white shadow-md border":"bg-card text-primary-text border border-border hover:bg-accent-light",style:Z===t?{backgroundColor:"#006B3F",borderColor:"#005632"}:{},children:t},t)),e.jsxs("div",{className:"relative",ref:z,children:[e.jsxs(Ue,{type:"button",variant:Z==="Custom"?"primary":"outline",onClick:()=>S(!c),className:Z==="Custom"?"text-white shadow-md border":"bg-card text-primary-text border border-border hover:bg-accent-light",style:Z==="Custom"?{backgroundColor:"#006B3F",borderColor:"#005632"}:{},children:[e.jsx(gt,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:Z==="Custom"?`${d(m.startDate,"dd MMM")} - ${d(m.endDate,"dd MMM")}`:"Custom"})]}),c&&e.jsx("div",{className:"absolute top-full right-0 mt-2 z-50 bg-white dark:bg-gray-950 border border-border rounded-lg shadow-xl w-[300px] sm:w-auto overflow-hidden",children:e.jsx("div",{className:"text-gray-900",children:e.jsx(Rt.DateRangePicker,{onChange:xt,months:1,ranges:Ie,direction:"horizontal",maxDate:new Date})})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-card p-6 rounded-xl shadow-sm border border-border flex flex-col items-center justify-center text-center hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"p-4 bg-emerald-600 text-white rounded-full mb-3 shadow-lg shadow-emerald-200 dark:shadow-none",children:e.jsx(Ht,{className:"h-8 w-8"})}),e.jsx("p",{className:"text-sm text-muted font-medium mb-1",children:"Present"}),e.jsx("p",{className:"text-2xl font-bold text-primary-text",children:ge.present})]}),e.jsxs("div",{className:"bg-card p-6 rounded-xl shadow-sm border border-border flex flex-col items-center justify-center text-center hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"p-4 bg-rose-600 text-white rounded-full mb-3 shadow-lg shadow-rose-200 dark:shadow-none",children:e.jsx(Et,{className:"h-8 w-8"})}),e.jsx("p",{className:"text-sm text-muted font-medium mb-1",children:"Absent"}),e.jsx("p",{className:"text-2xl font-bold text-primary-text",children:ge.absent})]}),e.jsxs("div",{className:"bg-card p-6 rounded-xl shadow-sm border border-border flex flex-col items-center justify-center text-center hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"p-4 bg-blue-600 text-white rounded-full mb-3 shadow-lg shadow-blue-200 dark:shadow-none",children:e.jsx(jt,{className:"h-8 w-8"})}),e.jsx("p",{className:"text-sm text-muted font-medium mb-1",children:"Overtime"}),e.jsxs("p",{className:"text-2xl font-bold text-primary-text",children:[ge.ot,"h"]})]}),e.jsxs("div",{className:"bg-card p-6 rounded-xl shadow-sm border border-border flex flex-col items-center justify-center text-center hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"p-4 bg-purple-600 text-white rounded-full mb-3 shadow-lg shadow-purple-200 dark:shadow-none",children:e.jsx(It,{className:"h-8 w-8"})}),e.jsx("p",{className:"text-sm text-muted font-medium mb-1",children:"Comp Offs"}),e.jsx("p",{className:"text-2xl font-bold text-primary-text",children:ge.compOff})]})]}),e.jsxs("div",{className:"bg-card rounded-xl shadow-sm border border-border overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-border font-semibold text-primary-text",children:"Attendance Logs"}),e.jsx("div",{className:"divide-y divide-border",children:Me?e.jsx("div",{className:"p-8 text-center text-muted",children:e.jsx(Ze,{className:"h-6 w-6 animate-spin mx-auto"})}):ct.length===0?e.jsx("div",{className:"p-8 text-center text-muted",children:"No records found for this period."}):ct.map((t,s)=>e.jsxs("div",{className:"p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-900/50 transition-colors",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-primary-text",children:t.date}),e.jsx("p",{className:"text-xs text-muted",children:t.day})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1.5",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider shadow-sm
                                            ${t.status==="Present"?"bg-emerald-500 text-white dark:bg-emerald-600":t.status==="Absent"?"bg-rose-500 text-white dark:bg-rose-600":t.status==="Holiday"?"bg-amber-500 text-white dark:bg-amber-600":t.status==="Weekend"?"bg-indigo-500 text-white dark:bg-indigo-600":"bg-gray-500 text-white dark:bg-gray-600"}`,children:t.status}),(t.checkIn!=="-"||t.checkOut!=="-")&&e.jsxs("div",{className:"text-xs text-muted font-medium",children:[t.checkIn," - ",t.checkOut]}),t.ot>0&&e.jsxs("span",{className:"text-[10px] text-blue-600 dark:text-blue-400 font-bold",children:["+",t.ot,"h OT"]})]})]},s))})]})]});const Dt=()=>{let t=[];return E==="basic"?t=Ve||[]:E==="log"?t=Ye||[]:E==="monthly"?t=Xe||[]:E==="audit"&&(t=Pe||[]),!t||t.length===0?e.jsx("div",{className:"text-center py-10 text-gray-400",children:"No report data available"}):e.jsxs("div",{className:"space-y-4 pt-4",children:[t.slice(0,5).map((s,f)=>e.jsxs("div",{className:"bg-[#041b0f] p-4 rounded-xl border border-[#1a3d2c]",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("div",{className:"font-bold text-white",children:s.userName||"Unknown"}),e.jsx("div",{className:`px-2 py-0.5 rounded text-[10px] font-bold ${s.status==="P"||s.type==="check-in"?"bg-green-500/20 text-green-400":s.status==="A"||s.type==="check-out"?"bg-red-500/20 text-red-400":"bg-blue-500/20 text-blue-400"}`,children:s.status||(s.type==="check-in"?"In":s.type==="check-out"?"Out":"Log")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block mb-0.5",children:"Date:"}),e.jsx("div",{className:"text-gray-300 font-medium",children:s.date?d(new Date(String(s.date).replace(/-/g,"/")),"dd MMM yyyy"):"-"})]}),E==="monthly"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block mb-0.5",children:"Present:"}),e.jsxs("div",{className:"text-gray-300 font-medium",children:[s.presentDays||0,"d"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block mb-0.5",children:"Absent:"}),e.jsxs("div",{className:"text-gray-300 font-medium",children:[s.absentDays||0,"d"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block mb-0.5",children:"Payable:"}),e.jsxs("div",{className:"text-gray-300 font-medium",children:[s.totalPayableDays||0,"d"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block mb-0.5",children:"Time/Hours:"}),e.jsx("div",{className:"text-gray-300 font-medium",children:s.duration||s.time||s.checkIn||"-"})]}),s.checkOut&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block mb-0.5",children:"Punch Out:"}),e.jsx("div",{className:"text-gray-300 font-medium",children:s.checkOut})]}),s.locationName&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-gray-500 block mb-0.5",children:"Location:"}),e.jsx("div",{className:"text-gray-300 font-medium truncate",children:s.locationName})]})]})]})]},f)),t.length>5&&e.jsx("div",{className:"text-center text-xs text-gray-500 italic py-2",children:"Showing first 5 rows in summary. Download CSV for full data."})]})};return e.jsxs("div",{className:"min-h-screen p-4 space-y-6 md:bg-transparent bg-[#041b0f]",children:[e.jsx("div",{className:"flex md:hidden flex-col items-center gap-4 mb-2",children:e.jsxs("div",{className:"flex justify-center w-full relative",children:[e.jsx("img",{src:Je,alt:"Logo",className:"h-12 border border-yellow-500 p-1"}),e.jsx("div",{className:"absolute right-0 top-0",children:e.jsxs("div",{className:"relative",children:[e.jsx("svg",{className:"w-8 h-8 text-emerald-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),e.jsx("span",{className:"absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full",children:"7"})]})})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-primary-text md:text-gray-900",children:"Attendance Dashboard"}),["admin","hr","super_admin"].includes(D||"")&&e.jsxs(Ue,{onClick:()=>He(!0),className:"w-full md:w-auto bg-[#22c55e] hover:bg-[#16a34a] text-white shadow-lg flex items-center justify-center gap-2 py-3 rounded-xl font-semibold",children:[e.jsx(Ht,{className:"w-5 h-5"}),"Add Manual Entry"]})]}),e.jsx(Ds,{isOpen:Be,onClose:()=>He(!1),onSuccess:()=>{Le({message:"Manual entry added successfully",type:"success"}),m.startDate&&m.endDate&&tt(m.startDate,m.endDate),E==="audit"&&Ge()},users:k,currentUserRole:D||"",currentUserId:o?.id||""}),e.jsxs("div",{className:"bg-transparent md:bg-white p-0 md:p-4 rounded-xl shadow-none md:shadow-sm border-none md:border md:border-gray-100 flex flex-col gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto pb-2 scrollbar-none no-scrollbar",children:[["Today","Last 7 Days","This Month"].map(t=>e.jsx(Ue,{type:"button",onClick:()=>nt(t),className:`whitespace-nowrap rounded-xl px-4 py-2 text-sm font-medium transition-all ${Z===t?"bg-[#22c55e] text-white shadow-md border-none":"bg-[#0b291a] md:bg-white text-gray-300 md:text-gray-700 border border-[#1a3d2c] md:border-gray-300 hover:opacity-80"}`,children:t},t)),e.jsxs("div",{className:"relative flex-shrink-0",ref:z,children:[e.jsxs(Ue,{type:"button",onClick:()=>S(!c),className:`whitespace-nowrap flex items-center gap-2 rounded-xl px-4 py-2 text-sm font-medium transition-all ${Z==="Custom"?"bg-[#22c55e] text-white shadow-md border-none":"bg-[#0b291a] md:bg-white text-gray-300 md:text-gray-700 border border-[#1a3d2c] md:border-gray-300 hover:opacity-80"}`,children:[e.jsx(gt,{className:"h-4 w-4"}),Z==="Custom"?`${d(m.startDate,"dd MMM")} - ${d(m.endDate,"dd MMM")}`:"Custom Range"]}),c&&e.jsx("div",{className:"absolute top-full left-0 mt-2 z-50 bg-[#0b291a] md:bg-card border border-[#1a3d2c] md:border-border rounded-xl shadow-xl p-2 min-w-[300px]",children:e.jsx(Rt.DateRangePicker,{onChange:xt,months:1,ranges:Ie,direction:"horizontal",maxDate:new Date})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:flex md:flex-wrap items-end gap-x-3 gap-y-4",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{htmlFor:ue,className:"block text-xs font-medium text-gray-400 md:text-gray-500 mb-1",children:"Report Type"}),e.jsxs("select",{id:ue,name:"reportType",className:"w-full md:w-auto border border-[#1a3d2c] md:border-gray-200 rounded-lg px-3 py-2 text-sm bg-[#041b0f] md:bg-white text-white md:text-gray-900 focus:ring-2 focus:ring-[#22c55e] outline-none appearance-none",value:E,onChange:t=>Ke(t.target.value),children:[e.jsx("option",{value:"basic",children:"Basic Report"}),e.jsx("option",{value:"log",children:"Attendance Log"}),e.jsx("option",{value:"monthly",children:"Monthly Report"}),e.jsx("option",{value:"workHours",children:"Work Hours Report"}),e.jsx("option",{value:"audit",children:"Audit Log Report"})]})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{htmlFor:st,className:"block text-xs font-medium text-gray-400 md:text-gray-500 mb-1",children:"Role"}),e.jsxs("select",{id:st,name:"role",className:"w-full md:w-auto border border-[#1a3d2c] md:border-gray-200 rounded-lg px-3 py-2 text-sm bg-[#041b0f] md:bg-white text-white md:text-gray-900 focus:ring-2 focus:ring-[#22c55e] outline-none appearance-none",value:U,onChange:t=>{te(t.target.value),ee("all")},children:[e.jsx("option",{value:"all",children:"All Roles"}),at.map(t=>e.jsx("option",{value:t,children:t?t.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase()):""},t))]})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{htmlFor:se,className:"block text-xs font-medium text-gray-400 md:text-gray-500 mb-1",children:"Employee"}),e.jsxs("select",{id:se,name:"employee",className:"w-full md:w-auto border border-[#1a3d2c] md:border-gray-200 rounded-lg px-3 py-2 text-sm bg-[#041b0f] md:bg-white text-white md:text-gray-900 focus:ring-2 focus:ring-[#22c55e] outline-none appearance-none",value:A,onChange:t=>ee(t.target.value),children:[e.jsx("option",{value:"all",children:"All Employees"}),k.filter(t=>U==="all"||t.role===U).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{htmlFor:mt,className:"block text-xs font-medium text-gray-400 md:text-gray-500 mb-1",children:"Status"}),e.jsxs("select",{id:mt,name:"status",className:"w-full md:w-auto border border-[#1a3d2c] md:border-gray-200 rounded-lg px-3 py-2 text-sm bg-[#041b0f] md:bg-white text-white md:text-gray-900 focus:ring-2 focus:ring-[#22c55e] outline-none appearance-none",value:G,onChange:t=>be(t.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"P",children:"Present (P)"}),e.jsx("option",{value:"0.5P",children:"Half Day (0.5P)"}),e.jsx("option",{value:"A",children:"Absent (A)"}),e.jsx("option",{value:"S/L",children:"Sick Leave (S/L)"}),e.jsx("option",{value:"E/L",children:"Earned Leave (E/L)"}),e.jsx("option",{value:"F/H",children:"Floating Holiday (F/H)"}),e.jsx("option",{value:"C/O",children:"Comp Off (C/O)"}),e.jsx("option",{value:"LOP",children:"Loss of Pay (LOP)"}),e.jsx("option",{value:"W/H",children:"Work From Home (W/H)"}),e.jsx("option",{value:"W/O",children:"Week Off (W/O)"}),e.jsx("option",{value:"W/P",children:"Week Off Present (W/P)"}),e.jsx("option",{value:"H",children:"Holiday (H)"}),e.jsx("option",{value:"H/P",children:"Holiday Present (H/P)"})]})]}),e.jsxs("div",{className:"col-span-2 md:col-span-1",children:[e.jsx("label",{htmlFor:rt,className:"block text-xs font-medium text-gray-400 md:text-gray-500 mb-1",children:"Record Type"}),e.jsxs("select",{id:rt,name:"recordType",className:"w-full md:w-auto border border-[#1a3d2c] md:border-gray-200 rounded-lg px-3 py-2 text-sm bg-[#041b0f] md:bg-white text-white md:text-gray-900 focus:ring-2 focus:ring-[#22c55e] outline-none appearance-none",value:Ce,onChange:t=>Nt(t.target.value),children:[e.jsx("option",{value:"all",children:"All Records"}),e.jsx("option",{value:"complete",children:"Complete (Punch-in & Punch-out)"}),e.jsx("option",{value:"missing_checkout",children:"Missing Punch-out"}),e.jsx("option",{value:"missing_checkin",children:"Missing Punch-in"}),e.jsx("option",{value:"incomplete",children:"Incomplete (Any Missing)"})]})]})]})]}),e.jsx("div",{className:"flex flex-col gap-8 md:grid md:grid-cols-2 lg:grid-cols-4 md:gap-6 bg-transparent md:bg-white p-0 md:p-4 rounded-xl",children:[{title:"Total Employees",value:K?.totalEmployees||0,icon:ss,color:"bg-emerald-500"},{title:`Present ${dt}`,value:K?.presentToday||0,icon:Ht,color:"bg-[#0eb161]"},{title:`Absent ${dt}`,value:K?.absentToday||0,icon:Et,color:"bg-[#df0637]"},{title:`On Leave ${dt}`,value:K?.onLeaveToday||0,icon:jt,color:"bg-[#1d63ff]"}].map((t,s)=>e.jsxs("div",{className:"flex items-center gap-6 md:bg-card md:p-6 md:rounded-2xl md:border md:border-[#1a3d2c] md:md:border-gray-100 md:shadow-sm",children:[e.jsx("div",{className:`p-4 md:p-3 rounded-full ${t.color} text-white shadow-xl md:shadow-none`,children:e.jsx(t.icon,{className:"h-8 w-8 md:h-6 md:w-6"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-sm md:text-xs font-medium text-gray-400 md:text-gray-500 mb-1",children:t.title}),e.jsx("p",{className:"text-4xl md:text-2xl font-bold text-white md:text-gray-900 leading-none",children:t.value})]})]},s))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-[#0b291a] md:bg-card p-4 md:p-6 rounded-2xl border border-[#1a3d2c] md:border-border shadow-sm",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(rs,{className:"h-5 w-5 mr-3 text-[#22c55e] md:text-muted"}),e.jsx("h3",{className:"font-semibold text-white md:text-primary-text",children:"Attendance Trend"})]}),e.jsx("div",{className:"h-64 md:h-80 relative",children:K?e.jsx(Ss,{data:K.attendanceTrend}):e.jsx(Ze,{className:"h-6 w-6 animate-spin text-muted mx-auto mt-20"})})]}),e.jsxs("div",{className:"bg-[#0b291a] md:bg-card p-4 md:p-6 rounded-2xl border border-[#1a3d2c] md:border-border shadow-sm",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(It,{className:"h-5 w-5 mr-3 text-[#22c55e] md:text-muted"}),e.jsx("h3",{className:"font-semibold text-white md:text-primary-text",children:"Productivity Trend"})]}),e.jsx("div",{className:"h-64 md:h-80 relative",children:K?e.jsx(Hs,{data:K.productivityTrend}):e.jsx(Ze,{className:"h-6 w-6 animate-spin text-muted mx-auto mt-20"})})]})]}),e.jsx("div",{style:{position:"fixed",top:"0",left:"0",width:"1123px",zIndex:-1e3,opacity:0,pointerEvents:"none"},children:e.jsx("div",{ref:et,className:"w-full bg-white",children:$})}),E==="workHours"&&e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100",children:e.jsx(Ms,{month:(m.startDate?.getMonth()??new Date().getMonth())+1,year:m.startDate?.getFullYear()||new Date().getFullYear(),userId:A==="all"?void 0:A})}),E!=="workHours"&&e.jsxs("div",{className:"hidden md:block bg-[#0b291a] md:bg-white p-4 md:p-6 rounded-2xl border border-[#1a3d2c] md:border-gray-100 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h2",{className:"text-lg font-bold text-white md:text-gray-900",children:"Report Preview"}),e.jsxs("div",{className:"md:hidden flex bg-[#041b0f] p-1 rounded-lg border border-[#1a3d2c]",children:[e.jsx("button",{onClick:()=>We("summary"),className:`px-3 py-1.5 text-xs font-semibold rounded-md transition-all ${me==="summary"?"bg-[#22c55e] text-white":"text-gray-400"}`,children:"Summary"}),e.jsx("button",{onClick:()=>We("full"),className:`px-3 py-1.5 text-xs font-semibold rounded-md transition-all ${me==="full"?"bg-[#22c55e] text-white":"text-gray-400"}`,children:"Full Layout"})]})]}),qe&&e.jsxs(Ue,{type:"button",onClick:Ne,disabled:Ae,className:"w-full sm:w-auto bg-[#22c55e] hover:bg-[#16a34a] text-white shadow-lg rounded-xl flex items-center justify-center gap-2 py-2.5 px-6 font-medium",children:[Ae?e.jsx(Ze,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(as,{className:"mr-2 h-4 w-4"}),Ae?"Generating...":"Download CSV"]})]}),me==="summary"?e.jsx("div",{className:"md:hidden",children:e.jsx(Dt,{})}):null,e.jsxs("div",{className:`border border-[#1a3d2c] md:border-gray-200 rounded-xl bg-[#041b0f] md:bg-gray-50 flex justify-center min-h-[300px] md:min-h-[400px] relative overflow-hidden ${me==="summary"?"hidden md:flex":"flex"}`,children:[Me&&e.jsxs("div",{className:"absolute inset-0 z-10 bg-[#041b0f]/50 md:bg-white/50 backdrop-blur-sm flex flex-col items-center justify-center",children:[e.jsx(Ze,{className:"h-8 w-8 animate-spin text-[#22c55e] mb-2"}),e.jsx("p",{className:"text-sm font-medium text-gray-300 md:text-gray-600",children:"Updating report data..."})]}),e.jsx("div",{className:"w-full max-w-full overflow-x-auto p-4 custom-scrollbar",children:e.jsx("div",{className:`origin-top-left sm:origin-top ${E==="basic"?"w-full":"min-w-[800px] md:min-w-[1123px] transform scale-[0.6] xs:scale-[0.7] sm:scale-[0.85] md:scale-[0.9] lg:scale-100"}`,children:ut})})]})]}),Re&&e.jsx(Xt,{message:Re.message,type:Re.type,onDismiss:()=>Le(null)})]})};export{Bs as default};
