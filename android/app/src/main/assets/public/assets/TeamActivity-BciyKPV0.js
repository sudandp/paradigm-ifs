import{u as J,k as K,m as W,i as Y,j as e,B as i,P as O}from"./index-D5q3SS3D.js";import{b as o}from"./react-vendor-BUaIliXj.js";import{P as Z}from"./Pagination-DXf7cs0z.js";import{a2 as ee,aF as h,U as T,aw as H,e as U,aH as se,L as te,b as A,M as ae,aD as $,aI as z}from"./ui-vendor-B8EvWqdc.js";import{f as E,m as B}from"./utils-vendor-DmorxLnX.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./supabase-7WG3J4rU.js";const me=()=>{const{user:l}=J(),[c,q]=o.useState([]),[R,k]=o.useState(!0),[d,y]=o.useState(null),[g,Q]=o.useState(1),[p,V]=o.useState(12),u=K("(max-width: 767px)");o.useEffect(()=>{f();const s=setInterval(f,3e4);return()=>clearInterval(s)},[l]);const f=async()=>{if(l)try{k(!0);const s=await W.getUsers();let t=[];Y(l.role)||l.role==="developer"?t=s.filter(r=>r.role==="operation_manager"||r.role==="field_staff"):l.role==="operation_manager"&&(t=s.filter(r=>r.role==="field_staff"&&r.reportingManagerId===l.id));const x=new Date;x.setHours(0,0,0,0);const I=new Date;I.setHours(23,59,59,999);const G=await Promise.all(t.map(async r=>{try{const M=(await W.getAttendanceEvents(r.id,x.toISOString(),I.toISOString())).sort((a,m)=>new Date(m.timestamp).getTime()-new Date(a.timestamp).getTime()),j=M.filter(a=>a.type.toLowerCase().replace(/[-_\s]/g,"")==="checkin"),N=M.filter(a=>a.type.toLowerCase().replace(/[-_\s]/g,"")==="checkout"),n=j[0],w=N[0];let v=0;for(let a=0;a<N.length;a++){const m=N[a],_=j.find(b=>new Date(b.timestamp)<new Date(m.timestamp));if(_){const b=new Date(m.timestamp).getTime()-new Date(_.timestamp).getTime();v+=b/(1e3*60*60)}}const S=n&&(!w||new Date(n.timestamp)>new Date(w.timestamp));if(S&&n){const a=Date.now()-new Date(n.timestamp).getTime();v+=a/(1e3*60*60)}return{...r,lastCheckIn:n?.timestamp,lastCheckOut:w?.timestamp,currentLocation:n?{latitude:n.latitude||0,longitude:n.longitude||0,address:n.address||void 0}:void 0,todayWorkingHours:v,todayTravelDistance:0,isCurrentlyWorking:S,isPresent:j.length>0}}catch(L){return console.error(`Error fetching data for ${r.name}:`,L),{...r,isPresent:!1,isCurrentlyWorking:!1}}}));q(G)}catch(s){console.error("Error fetching team members:",s)}finally{k(!1)}},C=s=>{if(!s)return;const t=s.replace(/\D/g,"").slice(-10);window.location.href=`tel:+91${t}`},F=s=>{if(!s)return;const t=s.replace(/\D/g,"").slice(-10);window.location.href=`sms:+91${t}`},P=s=>{if(!s)return"0h 0m";const t=Math.floor(s),x=Math.floor((s-t)*60);return`${t}h ${x}m`};if(R)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(ee,{className:"h-8 w-8 animate-spin text-accent"})});const X=({member:s})=>e.jsx("div",{className:"bg-card border border-border rounded-xl p-4 hover:border-accent transition-all cursor-pointer",onClick:()=>y(s),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(O,{photoUrl:s.photoUrl,seed:s.id,className:"w-12 h-12 rounded-full"}),e.jsx("span",{className:`absolute -bottom-0.5 -right-0.5 block h-4 w-4 rounded-full ring-2 ring-white ${s.isCurrentlyWorking?"bg-green-500 shadow-[0_0_10px_rgba(34,197,94,0.8)]":s.isPresent?"bg-yellow-500 shadow-[0_0_10px_rgba(234,179,8,0.8)]":"bg-red-500 shadow-[0_0_10px_rgba(239,44,44,0.8)]"}`})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-primary-text truncate",children:s.name}),e.jsx("p",{className:"text-xs text-muted",children:s.role.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("div",{className:"flex items-center gap-2 text-xs",children:s.isCurrentlyWorking?e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"h-3 w-3 text-green-500"}),e.jsx("span",{className:"text-green-500 font-medium",children:"Working"})]}):s.isPresent?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-3 w-3 text-yellow-500"}),e.jsx("span",{className:"text-yellow-500",children:"Punched Out"})]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-3 w-3 text-red-500"}),e.jsx("span",{className:"text-red-500",children:"Absent"})]})}),s.todayWorkingHours>0&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted",children:[e.jsx(A,{className:"h-3 w-3"}),e.jsx("span",{children:P(s.todayWorkingHours)})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(i,{variant:"icon",size:"sm",onClick:t=>{t.stopPropagation(),C(s.phone)},className:"hover:bg-accent/10",style:{backgroundColor:"#006B3F",color:"#FFFFFF"},children:e.jsx($,{className:"h-4 w-4"})}),e.jsx(i,{variant:"icon",size:"sm",onClick:t=>{t.stopPropagation(),F(s.phone)},className:"hover:bg-accent/10",style:{backgroundColor:"#006B3F",color:"#FFFFFF"},children:e.jsx(z,{className:"h-4 w-4"})})]})]})}),D=({member:s})=>e.jsxs("div",{className:"bg-card border border-border rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O,{photoUrl:s.photoUrl,seed:s.id,className:"w-16 h-16 rounded-full"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-primary-text",children:s.name}),e.jsx("p",{className:"text-sm text-muted",children:s.role.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())})]})]}),u&&e.jsx(i,{variant:"secondary",size:"sm",onClick:()=>y(null),children:"Close"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-accent/5 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(se,{className:"h-4 w-4 text-accent"}),e.jsx("span",{className:"text-xs font-medium text-muted",children:"Last Punch In"})]}),e.jsx("p",{className:"text-sm font-bold text-primary-text",children:s.lastCheckIn?E(new Date(s.lastCheckIn),"hh:mm a"):"Not checked in"}),s.lastCheckIn&&e.jsx("p",{className:"text-xs text-muted mt-1",children:B(new Date(s.lastCheckIn),{addSuffix:!0})})]}),e.jsxs("div",{className:"bg-accent/5 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(te,{className:"h-4 w-4 text-accent"}),e.jsx("span",{className:"text-xs font-medium text-muted",children:"Last Punch Out"})]}),e.jsx("p",{className:"text-sm font-bold text-primary-text",children:s.lastCheckOut?E(new Date(s.lastCheckOut),"hh:mm a"):"Not checked out"}),s.lastCheckOut&&e.jsx("p",{className:"text-xs text-muted mt-1",children:B(new Date(s.lastCheckOut),{addSuffix:!0})})]}),e.jsxs("div",{className:"bg-accent/5 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(A,{className:"h-4 w-4 text-accent"}),e.jsx("span",{className:"text-xs font-medium text-muted",children:"Working Hours Today"})]}),e.jsx("p",{className:"text-lg font-bold text-primary-text",children:P(s.todayWorkingHours)})]}),e.jsxs("div",{className:"bg-accent/5 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(h,{className:"h-4 w-4 text-accent"}),e.jsx("span",{className:"text-xs font-medium text-muted",children:"Status"})]}),e.jsx("p",{className:`text-lg font-bold ${s.isCurrentlyWorking?"text-green-500":s.isPresent?"text-yellow-500":"text-red-500"}`,children:s.isCurrentlyWorking?"Working":s.isPresent?"Punched Out":"Absent"})]})]}),s.currentLocation&&e.jsxs("div",{className:"bg-accent/5 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ae,{className:"h-4 w-4 text-accent"}),e.jsx("span",{className:"text-xs font-medium text-muted",children:"Current Location"})]}),e.jsx("p",{className:"text-sm text-primary-text",children:s.currentLocation.address||"Location not available"}),s.currentLocation.latitude!==0&&e.jsx("a",{href:`https://www.google.com/maps?q=${s.currentLocation.latitude},${s.currentLocation.longitude}`,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-accent hover:underline mt-2 inline-block",children:"View on map â†’"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(i,{onClick:()=>C(s.phone),className:"flex-1",style:{backgroundColor:"#006B3F",color:"#FFFFFF"},children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Call"]}),e.jsxs(i,{onClick:()=>F(s.phone),className:"flex-1",style:{backgroundColor:"#006B3F",color:"#FFFFFF"},children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Message"]})]})]});return e.jsxs("div",{className:"p-4 lg:p-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl lg:text-3xl font-bold text-primary-text",children:"Team Activity"}),e.jsx("p",{className:"text-sm text-muted mt-1",children:l?.role==="operation_manager"?"Monitor your field team in real-time":"Monitor all operation managers and field staff"})]}),e.jsxs(i,{onClick:f,variant:"secondary",size:"sm",children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-card border border-border rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(T,{className:"h-4 w-4 text-accent"}),e.jsx("span",{className:"text-xs font-medium text-muted",children:"Total Team"})]}),e.jsx("p",{className:"text-2xl font-bold text-primary-text",children:c.length})]}),e.jsxs("div",{className:"bg-card border border-border rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(h,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-xs font-medium text-muted",children:"Working Now"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-500",children:c.filter(s=>s.isCurrentlyWorking).length})]}),e.jsxs("div",{className:"bg-card border border-border rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(H,{className:"h-4 w-4 text-yellow-500"}),e.jsx("span",{className:"text-xs font-medium text-muted",children:"Present"})]}),e.jsx("p",{className:"text-2xl font-bold text-yellow-500",children:c.filter(s=>s.isPresent&&!s.isCurrentlyWorking).length})]}),e.jsxs("div",{className:"bg-card border border-border rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(U,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"text-xs font-medium text-muted",children:"Absent"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-500",children:c.filter(s=>!s.isPresent).length})]})]}),u&&d?e.jsx(D,{member:d}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-3",children:c.length===0?e.jsxs("div",{className:"bg-card border border-border rounded-xl p-12 text-center",children:[e.jsx(T,{className:"h-12 w-12 mx-auto text-muted mb-4 opacity-50"}),e.jsx("p",{className:"text-muted",children:"No team members found"})]}):e.jsxs(e.Fragment,{children:[c.slice((g-1)*p,g*p).map(s=>e.jsx(X,{member:s},s.id)),e.jsx(Z,{currentPage:g,totalItems:c.length,pageSize:p,onPageChange:Q,onPageSizeChange:V,className:"mt-6 col-span-full"})]})}),!u&&d&&e.jsx("div",{className:"lg:col-span-1 sticky top-6 self-start",children:e.jsx(D,{member:d})})]})]})};export{me as default};
