import{j as t}from"./index-D5q3SS3D.js";import{b as p}from"./react-vendor-BUaIliXj.js";import{aj as pe,bf as ge,bg as be,bd as ve,a5 as we,aD as Ne,z as ye}from"./ui-vendor-B8EvWqdc.js";const Ie=({users:j,externalSearchQuery:B,externalZoom:E,showControls:z=!0})=>{const H=p.useRef(null),U=p.useRef(null),[m,Z]=p.useState(null),[F,$]=p.useState(null),[k,te]=p.useState({x:0,y:0}),[se,ae]=p.useState(""),[ne,oe]=p.useState(1),[I,q]=p.useState({x:0,y:0}),T=B!==void 0?B:se,l=E!==void 0?E:ne,Q=ae,O=oe,A=p.useRef(null),_=p.useRef(!1),X=p.useRef({x:0,y:0}),D=p.useRef(!1),P=p.useRef({x:0,y:0}),V=p.useRef(0),W=p.useRef(new Map),J=p.useRef(window.devicePixelRatio||1);p.useEffect(()=>{j.forEach(e=>{if(e.photoUrl&&!W.current.has(e.id)){const a=new Image;a.crossOrigin="anonymous",a.src=e.photoUrl,a.onload=()=>{W.current.set(e.id,a)}}})},[j]);const K=()=>{const e=new Map;j.forEach(n=>{e.set(n.id,{...n,children:[]})});const a=[],o=new Set;return j.forEach(n=>{const f=e.get(n.id);if(n.reportingManagerId){const s=e.get(n.reportingManagerId);s&&(s.children.push(f),o.add(n.id))}if(n.reportingManager2Id){const s=e.get(n.reportingManager2Id);s&&(s.children.push({...f,id:n.id+"-m2",children:[]}),o.add(n.id))}if(n.reportingManager3Id){const s=e.get(n.reportingManager3Id);s&&(s.children.push({...f,id:n.id+"-m3",children:[]}),o.add(n.id))}}),j.forEach(n=>{o.has(n.id)||a.push(e.get(n.id))}),a},G=(e,a=50,o=50,n=0)=>{let c=a;const h=[];let w=1/0,g=-1/0,i=1/0,u=-1/0;e.forEach(x=>{if(x.level=n,x.children&&x.children.length>0){const y=G(x.children,c,o+120+120,n+1),v=y.width,M=c+v/2-180/2;x.x=M,x.y=o,h.push(x),h.push(...y.nodes),w=Math.min(w,M,y.bounds.minX),g=Math.max(g,M+180,y.bounds.maxX),i=Math.min(i,o,y.bounds.minY),u=Math.max(u,o+120,y.bounds.maxY),c+=v+20}else x.x=c,x.y=o,h.push(x),w=Math.min(w,c),g=Math.max(g,c+180),i=Math.min(i,o),u=Math.max(u,o+120),c+=200});const b=Math.max(0,c-a-20);return{width:Math.max(b,180),nodes:h,bounds:{minX:isFinite(w)?w:0,maxX:isFinite(g)?g:180,minY:isFinite(i)?i:0,maxY:isFinite(u)?u:300}}},re=(e,a,o,n)=>{if(a.x===void 0||a.y===void 0||o.x===void 0||o.y===void 0)return;const f=(a.x+90)*l+I.x,s=(a.y+120)*l+I.y,r=(o.x+90)*l+I.x,d=o.y*l+I.y,c=e.createLinearGradient(f,s,r,d),h=n*5e-4%1;c.addColorStop(0,"#E0E7FF"),c.addColorStop(h,"#818CF8"),c.addColorStop(1,"#E0E7FF"),e.save(),e.strokeStyle=c,e.lineWidth=2*l,e.lineCap="round",e.shadowColor="rgba(99, 102, 241, 0.2)",e.shadowBlur=4,e.beginPath(),e.moveTo(f,s);const w=(s+d)/2;e.bezierCurveTo(f,w,r,w,r,d),e.stroke(),e.restore();const i=(n*5e-4+a.id.charCodeAt(0)*.1)%1,u={x:f,y:s},b={x:f,y:(s+d)/2},x={x:r,y:(s+d)/2},y={x:r,y:d},v=3*(b.x-u.x),M=3*(x.x-b.x)-v,Y=y.x-u.x-v-M,N=3*(b.y-u.y),C=3*(x.y-b.y)-N,R=y.y-u.y-N-C,S=Y*i*i*i+M*i*i+v*i+u.x,xe=R*i*i*i+C*i*i+N*i+u.y;e.save(),e.fillStyle="#6366F1",e.shadowColor="#6366F1",e.shadowBlur=8,e.beginPath(),e.arc(S,xe,3*l,0,Math.PI*2),e.fill(),e.restore()},ie=(e,a,o,n,f)=>{if(a.x===void 0||a.y===void 0)return null;const s=a.x*l+I.x,r=a.y*l+I.y,d=180*l,c=120*l,h=48*l,w=!!T&&a.name.toLowerCase().includes(T.toLowerCase());e.save(),e.shadowColor=n?"rgba(99, 102, 241, 0.4)":"rgba(0, 0, 0, 0.08)",e.shadowBlur=(n?24:12)*l,e.shadowOffsetY=(n?8:4)*l;const g=e.createLinearGradient(s,r,s,r+c);g.addColorStop(0,"#FFFFFF"),g.addColorStop(1,"#FAFAFA"),e.fillStyle=g;const i=16*l;e.beginPath(),e.roundRect?e.roundRect(s,r,d,c,i):(e.moveTo(s+i,r),e.lineTo(s+d-i,r),e.quadraticCurveTo(s+d,r,s+d,r+i),e.lineTo(s+d,r+c-i),e.quadraticCurveTo(s+d,r+c,s+d-i,r+c),e.lineTo(s+i,r+c),e.quadraticCurveTo(s,r+c,s,r+c-i),e.lineTo(s,r+i),e.quadraticCurveTo(s,r,s+i,r)),e.fill(),e.lineWidth=(n?2:1)*l,e.strokeStyle=n?"#6366F1":o?"#A5B4FC":w?"#22C55E":"#E5E7EB",e.stroke(),e.restore(),(n||w)&&(e.save(),e.globalAlpha=.05,e.fillStyle=n?"#6366F1":"#22C55E",e.beginPath(),e.roundRect&&e.roundRect(s,r,d,c,i),e.fill(),e.restore());const u=s+(d-h)/2,b=r+16*l;e.save(),e.beginPath(),e.arc(u+h/2,b+h/2,h/2,0,Math.PI*2),e.clip();const x=W.current.get(a.id);if(x&&x.complete)e.drawImage(x,u,b,h,h);else{const C=e.createLinearGradient(u,b,u+h,b+h);C.addColorStop(0,"#818CF8"),C.addColorStop(1,"#4F46E5"),e.fillStyle=C,e.fillRect(u,b,h,h),e.fillStyle="#FFF",e.font=`600 ${Math.max(12,16*l)}px "Inter", sans-serif`,e.textAlign="center",e.textBaseline="middle";const R=a.name.split(" ").map(S=>S[0]).join("").substring(0,2).toUpperCase();e.fillText(R,u+h/2,b+h/2+1*l)}if(e.restore(),e.save(),e.strokeStyle=n?"#6366F1":"#FFF",e.lineWidth=2*l,e.beginPath(),e.arc(u+h/2,b+h/2,h/2,0,Math.PI*2),e.stroke(),e.restore(),a.level!==void 0&&a.level>0){const C=18*l,R=u+h-C/2,S=b+h-C/2;e.save(),e.fillStyle="#10B981",e.shadowColor="rgba(16, 185, 129, 0.4)",e.shadowBlur=4*l,e.beginPath(),e.arc(R,S,C/2,0,Math.PI*2),e.fill(),e.fillStyle="#FFF",e.font=`700 ${Math.max(8,9*l)}px "Inter", sans-serif`,e.textAlign="center",e.textBaseline="middle",e.fillText(`L${a.level}`,R,S+1*l),e.restore()}e.save(),e.fillStyle="#111827",e.font=`600 ${Math.max(11,13*l)}px "Inter", sans-serif`,e.textAlign="center",e.textBaseline="top";const y=b+h+12*l;let v=a.name;const M=d-24*l;if(e.measureText(v).width>M){for(;e.measureText(v+"...").width>M&&v.length>0;)v=v.substring(0,v.length-1);v+="..."}e.fillText(v,s+d/2,y),e.fillStyle="#6B7280",e.font=`500 ${Math.max(9,11*l)}px "Inter", sans-serif`;const Y=y+18*l;let N=(a.role||"").replace(/_/g," ");if(N=N?N.charAt(0).toUpperCase()+N.slice(1).toLowerCase():"",e.measureText(N).width>M){for(;e.measureText(N+"...").width>M&&N.length>0;)N=N.substring(0,N.length-1);N+="..."}return e.fillText(N,s+d/2,Y),e.restore(),{x:s,y:r,width:d,height:c}},le=(e,a)=>{const o=K(),n=G(o),f=new Map;return n.nodes.forEach(s=>{s.children&&s.children.forEach(r=>{re(e,s,r,a)})}),n.nodes.forEach(s=>{const r=m?.id===s.id,d=F?.id===s.id,c=ie(e,s,r,d);c&&f.set(s.id,c)}),{nodePositions:f,layout:n}},L=e=>{const a=e??H.current;if(!a)return;const o=a.getBoundingClientRect(),n=K(),s=G(n).bounds,r=180,d=120,c=Math.max(1,s.maxX-s.minX+r),h=Math.max(1,s.maxY-s.minY+d),w=s.minX+c/2,g=s.minY+h/2,i=.98,u=o.width*i/c,b=o.height*i/h;let x=Math.min(u,b);x=Math.max(.3,Math.min(x,1.5));const y=E!==void 0?E:x,v=o.width/2-w*y,M=o.height/2-g*y;E===void 0&&O(x),q({x:v,y:M})};p.useEffect(()=>{if(j.length>0){const e=setTimeout(()=>L(),100);return()=>clearTimeout(e)}},[j.length]),p.useEffect(()=>{E!==void 0&&j.length>0&&L()},[E]),p.useEffect(()=>{const e=()=>{const a=H.current,o=U.current;if(!a||!o)return;const n=window.devicePixelRatio||1;J.current=n;const f=o.getBoundingClientRect(),s=Math.max(1,f.width),r=Math.max(1,f.height);a.width=Math.round(s*n),a.height=Math.round(r*n),a.style.width=`${s}px`,a.style.height=`${r}px`;const d=a.getContext("2d");d&&(d.setTransform(n,0,0,n,0,0),L(a))};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[j]),p.useEffect(()=>{const e=H.current,a=e?.getContext("2d");if(!e||!a)return;const o=J.current;let n=0;const f=()=>{V.current+=16,a.clearRect(0,0,e.width/o,e.height/o);const s=e.width/o,r=e.height/o,d=a.createLinearGradient(0,0,s,r);d.addColorStop(0,"#FAFAFA"),d.addColorStop(1,"#F3F4F6"),a.fillStyle=d,a.fillRect(0,0,s,r);const{nodePositions:c}=le(a,V.current);let h=!1;for(const[w,g]of c.entries())if(k.x>=g.x&&k.x<=g.x+g.width&&k.y>=g.y&&k.y<=g.y+g.height){const i=j.find(u=>u.id===w);if(i){Z(i),h=!0;break}}!h&&m&&Z(null),n=requestAnimationFrame(f),A.current=n};return A.current=requestAnimationFrame(f),()=>{A.current&&cancelAnimationFrame(A.current)}},[j,m,F,k,l,I,T]);const de=e=>{_.current=!0,D.current=!1;const a=e.nativeEvent.offsetX,o=e.nativeEvent.offsetY;P.current={x:a,y:o},X.current={x:a,y:o}},ce=e=>{const a=e.nativeEvent.offsetX,o=e.nativeEvent.offsetY;if(te({x:a,y:o}),_.current){const n=(a-P.current.x)*1.3,f=(o-P.current.y)*1.3;Math.sqrt(Math.pow(a-X.current.x,2)+Math.pow(o-X.current.y,2))>5&&(D.current=!0),q(r=>({x:r.x+n,y:r.y+f})),P.current={x:a,y:o}}},ee=()=>{_.current=!1},he=()=>{m&&!D.current&&$(F?.id===m.id?null:m),D.current=!1},me=()=>O(e=>Math.min(e+.2,2.5)),ue=()=>O(e=>Math.max(e-.2,.4)),fe=()=>{L(),$(null),Q("")};return t.jsxs("div",{className:"relative w-full h-full bg-gradient-to-br from-slate-50 to-slate-100",ref:U,children:[z&&t.jsxs("div",{className:"absolute top-4 left-4 z-20 flex flex-col gap-3",children:[t.jsxs("div",{className:"bg-white/90 backdrop-blur-md border border-slate-200 rounded-xl shadow-xl p-3 min-w-[280px]",children:[t.jsxs("div",{className:"relative",children:[t.jsx(pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),t.jsx("input",{type:"text",placeholder:"Search employees...",value:T,onChange:e=>Q(e.target.value),className:"w-full pl-10 pr-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),T&&t.jsxs("p",{className:"mt-2 text-xs text-slate-500",children:[j.filter(e=>e.name.toLowerCase().includes(T.toLowerCase())).length," results"]})]}),t.jsxs("div",{className:"bg-white/80 backdrop-blur-md border border-white/20 rounded-2xl shadow-lg p-3 flex flex-col gap-3 min-w-[240px]",children:[t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsx("button",{onClick:ue,className:"p-2 hover:bg-slate-100/80 rounded-xl transition-all duration-200 text-slate-600 hover:text-slate-900 active:scale-95",title:"Zoom Out",children:t.jsx(ge,{className:"w-5 h-5"})}),t.jsx("div",{className:"flex-1 px-2",children:t.jsx("input",{type:"range",min:"40",max:"250",value:Math.round(l*100),onChange:e=>O(parseInt(e.target.value)/100),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-indigo-500 [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:shadow-md [&::-webkit-slider-thumb]:transition-transform [&::-webkit-slider-thumb]:hover:scale-110 [&::-moz-range-thumb]:w-4 [&::-moz-range-thumb]:h-4 [&::-moz-range-thumb]:rounded-full [&::-moz-range-thumb]:bg-indigo-500 [&::-moz-range-thumb]:cursor-pointer [&::-moz-range-thumb]:border-0 [&::-moz-range-thumb]:shadow-md",title:"Zoom Slider"})}),t.jsx("button",{onClick:me,className:"p-2 hover:bg-slate-100/80 rounded-xl transition-all duration-200 text-slate-600 hover:text-slate-900 active:scale-95",title:"Zoom In",children:t.jsx(be,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"px-2 min-w-[60px] text-center font-semibold text-slate-700 text-sm tabular-nums bg-slate-100 rounded-lg py-1",children:[Math.round(l*100),"%"]}),t.jsx("div",{className:"w-px h-6 bg-slate-200"}),t.jsx("button",{onClick:fe,className:"p-2 hover:bg-slate-100/80 rounded-xl transition-all duration-200 text-slate-600 hover:text-slate-900 active:scale-95",title:"Reset View",children:t.jsx(ve,{className:"w-5 h-5"})})]})]})]}),t.jsx("canvas",{ref:H,className:"w-full h-full cursor-grab active:cursor-grabbing",onMouseDown:de,onMouseMove:ce,onMouseUp:ee,onMouseLeave:ee,onClick:he}),m&&m.x!==void 0&&m.y!==void 0&&t.jsx("div",{className:"absolute pointer-events-none z-10 transform -translate-x-1/2 transition-all duration-200",style:{left:`${m.x*l+I.x+90*l}px`,top:`${Math.max(10,m.y*l+I.y-10)}px`},children:t.jsx("div",{className:"bg-white/95 backdrop-blur-xl border border-indigo-200 rounded-2xl shadow-2xl p-5 min-w-[320px] animate-fade-in-scale",children:t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsxs("div",{className:"flex-shrink-0 relative",children:[m.photoUrl?t.jsx("img",{src:m.photoUrl,alt:m.name,className:"w-20 h-20 rounded-2xl object-cover border-3 border-indigo-500 shadow-lg"}):t.jsx("div",{className:"w-20 h-20 rounded-2xl bg-gradient-to-br from-indigo-500 via-purple-500 to-indigo-600 flex items-center justify-center text-white font-bold text-2xl border-3 border-white shadow-lg",children:m.name.split(" ").map(e=>e[0]).join("").substring(0,2).toUpperCase()}),m.level!==void 0&&m.level>0&&t.jsxs("div",{className:"absolute -bottom-2 -right-2 bg-emerald-500 text-white text-xs font-bold px-2 py-1 rounded-full shadow-lg",children:["L",m.level]})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"font-bold text-slate-900 text-xl mb-1 truncate",children:m.name}),t.jsx("p",{className:"text-sm text-indigo-600 font-medium capitalize mb-3 truncate",children:m.role.replace(/_/g," ")}),t.jsxs("div",{className:"space-y-2",children:[m.email&&t.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[t.jsx(we,{className:"w-4 h-4 flex-shrink-0 text-indigo-500"}),t.jsx("span",{className:"truncate",children:m.email})]}),m.phone&&t.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[t.jsx(Ne,{className:"w-4 h-4 flex-shrink-0 text-indigo-500"}),t.jsx("span",{children:m.phone})]}),m.managerName&&t.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[t.jsx(ye,{className:"w-4 h-4 flex-shrink-0 text-indigo-500"}),t.jsxs("span",{className:"truncate",children:["Reports to: ",t.jsx("strong",{children:m.managerName})]})]})]}),t.jsx("div",{className:"mt-3 pt-3 border-t border-slate-200",children:t.jsxs("p",{className:"text-xs text-slate-500 italic",children:["Click to ",F?.id===m.id?"deselect":"select and focus"]})})]})]})})}),z&&t.jsx("div",{className:"absolute bottom-6 left-1/2 transform -translate-x-1/2 bg-white/90 backdrop-blur-md px-6 py-3 rounded-full border border-slate-200 shadow-xl",children:t.jsxs("p",{className:"text-sm text-slate-700 font-medium flex items-center gap-3",children:[t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"w-2 h-2 bg-indigo-500 rounded-full animate-pulse"}),"Drag to pan"]}),t.jsx("span",{className:"text-slate-300",children:"•"}),t.jsx("span",{children:"Hover for details"}),t.jsx("span",{className:"text-slate-300",children:"•"}),t.jsx("span",{children:"Click to select"})]})}),z&&t.jsxs("div",{className:"absolute top-4 right-4 bg-white/90 backdrop-blur-md border border-slate-200 rounded-2xl shadow-xl p-4 max-w-[200px]",children:[t.jsxs("h4",{className:"text-sm font-bold text-slate-900 mb-3 flex items-center gap-2",children:[t.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full"}),"Org Hierarchy"]}),t.jsxs("div",{className:"space-y-2.5",children:[t.jsxs("div",{className:"flex items-center gap-3 text-xs text-slate-600",children:[t.jsx("div",{className:"w-5 h-5 rounded bg-gradient-to-br from-purple-500 to-indigo-600 border-2 border-white shadow-md flex-shrink-0"}),t.jsx("span",{children:"Team Member"})]}),t.jsxs("div",{className:"flex items-center gap-3 text-xs text-slate-600",children:[t.jsx("div",{className:"w-5 h-5 rounded bg-gradient-to-br from-emerald-400 to-emerald-600 border-2 border-white shadow-md flex-shrink-0"}),t.jsx("span",{children:"Search Match"})]}),t.jsxs("div",{className:"flex items-center gap-3 text-xs text-slate-600",children:[t.jsx("div",{className:"w-8 h-0.5 bg-gradient-to-r from-indigo-400 to-purple-500 flex-shrink-0 shadow-sm"}),t.jsx("span",{children:"Reports To"})]}),t.jsxs("div",{className:"flex items-center gap-3 text-xs text-slate-600",children:[t.jsx("div",{className:"w-5 h-5 rounded-full bg-emerald-500 text-white text-[8px] font-bold flex items-center justify-center flex-shrink-0",children:"L2"}),t.jsx("span",{children:"Level Badge"})]})]}),F&&t.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-200",children:[t.jsx("p",{className:"text-xs font-semibold text-indigo-600 mb-1",children:"Selected:"}),t.jsx("p",{className:"text-xs text-slate-700 font-medium truncate",children:F.name})]})]}),t.jsxs("div",{className:"absolute bottom-6 right-6 bg-slate-900/80 backdrop-blur-sm text-white text-xs px-3 py-2 rounded-full font-mono",children:[j.length," employees"]})]})};export{Ie as W};
