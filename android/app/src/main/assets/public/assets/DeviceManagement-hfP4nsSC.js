import{u as b,E as d,j as e,T as y,B as j,G as N}from"./index-D5q3SS3D.js";import{b as i}from"./react-vendor-BUaIliXj.js";import{U as w}from"./UserDeviceList-Dt97HOJW.js";import{T as D,ao as E}from"./ui-vendor-B8EvWqdc.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./utils-vendor-DmorxLnX.js";import"./supabase-7WG3J4rU.js";import"./Modal-CR2aBU6L.js";import"./date-D8dFQo9a.js";const U=()=>{const{user:s}=b(),[I,m]=i.useState(""),[u,n]=i.useState(!1),[c,t]=i.useState(null),[g,l]=i.useState(0);i.useEffect(()=>{p()},[s]);const p=async()=>{try{const{deviceIdentifier:r}=await d();m(r)}catch(r){console.error("Error identifying device:",r)}},x=async()=>{if(s)try{n(!0);const{deviceIdentifier:r,deviceType:f,deviceName:v,deviceInfo:h}=await d(),a=await N(s.id,s.role,r,f,v,h);a.success?(t({message:a.message,type:"success"}),l(o=>o+1)):a.requiresApproval?(t({message:"Device registration request submitted for approval",type:"info"}),l(o=>o+1)):t({message:a.message,type:"error"})}catch(r){console.error("Error registering device:",r),t({message:"Failed to register device",type:"error"})}finally{n(!1)}};return e.jsxs("div",{className:"p-4 md:p-6 pb-24",children:[c&&e.jsx(y,{message:c.message,type:c.type,onDismiss:()=>t(null)}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Device Management"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Manage your registered devices and security settings"})]}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 mb-8 flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-2 bg-amber-100 rounded-full text-amber-600 mt-1",children:e.jsx(D,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-amber-900",children:"Ensure your current device is registered"}),e.jsx("p",{className:"text-sm text-amber-700 mt-1",children:"If your current device is not in the list below, please register it to avoid access issues."})]})]}),e.jsxs(j,{onClick:x,isLoading:u,className:"whitespace-nowrap bg-amber-600 hover:bg-amber-700 text-white border-none",children:[e.jsx(E,{className:"w-4 h-4 mr-2"})," Register This Device"]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-card p-6",children:s&&e.jsx(w,{userId:s.id,userRole:s.role,canManage:!0},g)})]})};export{U as default};
