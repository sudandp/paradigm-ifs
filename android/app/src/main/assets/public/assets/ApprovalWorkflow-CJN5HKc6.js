import{j as e,m,T as F,B as T}from"./index-D5q3SS3D.js";import{b as s,u as W}from"./react-vendor-BUaIliXj.js";import{S as c}from"./Select-Dz12MdxG.js";import{A}from"./AdminPageHeader-wINx_pXe.js";import{W as Z}from"./WorkflowChart2D-CpA107X_.js";import{aj as D,bf as U,bg as E,bd as R,bn as O,m as I,aJ as _,bo as B,bp as Q,a2 as q}from"./ui-vendor-B8EvWqdc.js";import{P as V}from"./Pagination-DXf7cs0z.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./utils-vendor-DmorxLnX.js";import"./supabase-7WG3J4rU.js";const H=({users:r})=>{const[n,u]=s.useState(!1),[x,f]=s.useState(""),[i,p]=s.useState(null),[h,w]=s.useState(!0),y=()=>{f(""),p(null),setTimeout(()=>{},100)},j=()=>p(l=>Math.min((l??80)+10,250)),g=()=>p(l=>Math.max((l??80)-10,40)),d=e.jsxs("div",{className:`flex flex-col ${n?"h-screen":"h-[75vh] min-h-[500px]"}`,children:[e.jsx("div",{className:"flex-shrink-0 bg-white border-b border-slate-200 px-4 py-3",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-stretch md:items-center gap-3",children:[e.jsxs("div",{className:"relative flex-shrink-0 w-full md:w-64",children:[e.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search employees...",value:x,onChange:l=>f(l.target.value),className:"w-full pl-10 pr-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex items-center gap-2 bg-slate-50 rounded-lg px-3 py-2 border border-slate-200",children:[e.jsx("button",{onClick:g,className:"p-1.5 hover:bg-slate-200/60 rounded-md transition-colors text-slate-600 hover:text-slate-900",title:"Zoom Out",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx("input",{type:"range",min:"40",max:"250",value:i??80,disabled:i===null,onChange:l=>p(parseInt(l.target.value)),className:"w-24 h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-primary [&::-webkit-slider-thumb]:cursor-pointer [&::-moz-range-thumb]:w-3 [&::-moz-range-thumb]:h-3 [&::-moz-range-thumb]:rounded-full [&::-moz-range-thumb]:bg-primary [&::-moz-range-thumb]:cursor-pointer [&::-moz-range-thumb]:border-0"}),e.jsx("span",{className:"text-xs font-semibold text-slate-700 min-w-[45px] text-center",children:i?`${i}%`:"Auto"}),e.jsx("button",{onClick:j,className:"p-1.5 hover:bg-slate-200/60 rounded-md transition-colors text-slate-600 hover:text-slate-900",title:"Zoom In",children:e.jsx(E,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:y,className:"px-3 py-2 text-sm font-medium text-slate-700 hover:text-slate-900 bg-slate-50 hover:bg-slate-100 border border-slate-200 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Reset"})]}),e.jsxs("button",{onClick:()=>u(!n),className:"px-3 py-2 text-sm font-medium text-white bg-primary hover:bg-primary/90 rounded-lg transition-colors flex items-center gap-2",children:[n?e.jsx(O,{className:"w-4 h-4"}):e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:n?"Exit":"Full Screen"})]})]})]})}),e.jsxs("div",{className:"flex-1 bg-slate-50 relative overflow-hidden",children:[e.jsx(Z,{users:r,externalSearchQuery:x,externalZoom:i!==null?i/100:void 0,showControls:!1}),e.jsx("div",{className:`absolute bottom-4 right-4 z-20 ${h?"block":"hidden"} md:block`,children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm border border-slate-200 rounded-xl shadow-lg px-4 py-3 min-w-[200px]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"text-xs font-bold text-slate-900 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full"}),"Legend"]}),e.jsx("button",{onClick:()=>w(!h),className:"md:hidden text-slate-400 hover:text-slate-600",children:e.jsx(I,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-gradient-to-br from-purple-500 to-indigo-600 border border-white shadow-sm flex-shrink-0"}),e.jsx("span",{children:"Team Member"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-gradient-to-br from-emerald-400 to-emerald-600 border border-white shadow-sm flex-shrink-0"}),e.jsx("span",{children:"Search Match"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[e.jsx("div",{className:"w-6 h-0.5 bg-gradient-to-r from-indigo-400 to-purple-500 flex-shrink-0 shadow-sm"}),e.jsx("span",{children:"Reports To"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-emerald-500 text-white text-[8px] font-bold flex items-center justify-center flex-shrink-0",children:"L2"}),e.jsx("span",{children:"Level Badge"})]})]})]})}),e.jsx("button",{onClick:()=>w(!h),className:"md:hidden absolute bottom-4 right-4 z-30 bg-white border border-slate-200 rounded-full p-2 shadow-lg",children:e.jsx(I,{className:"w-5 h-5 text-slate-600"})})]}),x&&e.jsx("div",{className:"flex-shrink-0 bg-white border-t border-slate-200 px-4 py-2",children:e.jsxs("p",{className:"text-xs text-slate-600",children:[r.filter(l=>l.name.toLowerCase().includes(x.toLowerCase())).length," results found"]})})]});return n?e.jsx("div",{className:"fixed inset-0 z-50 bg-white",children:d}):e.jsx("div",{className:"bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden",children:d})},ie=()=>{W();const[r,n]=s.useState([]),[u,x]=s.useState([]),[f,i]=s.useState("hr"),[p,h]=s.useState(!0),[w,y]=s.useState(!1),[j,g]=s.useState(null),[d,l]=s.useState("table"),[v,z]=s.useState(1),[N,$]=s.useState(10),C=s.useCallback(async()=>{h(!0);try{const[a,t,k]=await Promise.all([m.getUsersWithManagers(),m.getApprovalWorkflowSettings(),m.getRoles()]),S=[...a].sort((M,P)=>(M.name||"").localeCompare(P.name||"",void 0,{sensitivity:"base"}));n(S),i(t.finalConfirmationRole);const o=k.filter(M=>["admin","hr","operation_manager"].includes(M.id));o.push({id:"reporting_manager",displayName:"Reporting Manager",permissions:[]}),x(o)}catch{g({message:"Failed to load workflow data.",type:"error"})}finally{h(!1)}},[]);s.useEffect(()=>{C()},[C]);const b=(a,t,k=1)=>{n(S=>S.map(o=>o.id!==a?o:k===1?{...o,reportingManagerId:t||void 0}:k===2?{...o,reportingManager2Id:t||void 0}:{...o,reportingManager3Id:t||void 0}))},L=async()=>{y(!0);try{await Promise.all(r.flatMap(a=>[m.updateUserReportingManager(a.id,a.reportingManagerId||null,1),m.updateUserReportingManager(a.id,a.reportingManager2Id||null,2),m.updateUserReportingManager(a.id,a.reportingManager3Id||null,3)])),await m.updateApprovalWorkflowSettings(f),g({message:"Workflow saved successfully!",type:"success"}),C()}catch{g({message:"Failed to save workflow.",type:"error"})}finally{y(!1)}};return e.jsxs("div",{className:"p-4 border-0 shadow-none md:bg-card md:p-8 md:rounded-xl md:shadow-card",children:[j&&e.jsx(F,{message:j.message,type:j.type,onDismiss:()=>g(null)}),e.jsx(A,{title:"Leave Approval Settings",children:e.jsxs(T,{onClick:L,isLoading:w,children:[e.jsx(_,{className:"mr-2 h-4 w-4"})," Save Workflow"]})}),e.jsxs("section",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-bold text-primary-text mb-2",children:"Final Confirmation Step"}),e.jsx("p",{className:"text-sm text-muted mb-4",children:"Select the role responsible for the final confirmation of a leave request after it has been approved by the reporting manager chain."}),e.jsx("div",{className:"max-w-xs",children:e.jsx(c,{label:"Final Confirmation Role",id:"final-approver",value:f,onChange:a=>i(a.target.value),children:u.map(a=>e.jsx("option",{value:a.id,children:a.displayName},a.id))})})]}),e.jsxs("section",{children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-primary-text mb-1",children:"Reporting Structure"}),e.jsx("p",{className:"text-sm text-muted",children:"View and manage organizational hierarchy"})]})}),e.jsx("div",{className:"border-b border-border mb-6",children:e.jsxs("div",{className:"flex gap-1 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>l("table"),className:`flex items-center gap-2 px-4 py-3 text-sm font-medium transition-colors whitespace-nowrap border-b-2 ${d==="table"?"border-primary text-primary":"border-transparent text-muted hover:text-primary-text hover:border-border"}`,children:[e.jsx(B,{className:"w-4 h-4"}),"Table View"]}),e.jsxs("button",{onClick:()=>l("2d"),className:`flex items-center gap-2 px-4 py-3 text-sm font-medium transition-colors whitespace-nowrap border-b-2 ${d==="2d"?"border-primary text-primary":"border-transparent text-muted hover:text-primary-text hover:border-border"}`,children:[e.jsx(Q,{className:"w-4 h-4"}),"2D Workflow Chart"]})]})}),p?e.jsx("div",{className:"flex justify-center items-center py-10",children:e.jsx(q,{className:"h-6 w-6 animate-spin text-muted"})}):e.jsxs(e.Fragment,{children:[d==="table"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-muted mb-4",children:"For each employee, assign a reporting manager. Leave requests will be sent to this manager for first-level approval."}),e.jsx("div",{className:"overflow-x-auto hidden md:block border border-border rounded-lg",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-page",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Employee"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Reporting Manager"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Reporting Manager 2"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Reporting Manager 3"})]})}),e.jsx("tbody",{className:"bg-card divide-y divide-border",children:r.slice((v-1)*N,v*N).map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-4 font-medium text-primary-text whitespace-nowrap",children:a.name}),e.jsx("td",{className:"px-4 py-4 text-sm text-muted capitalize whitespace-nowrap",children:u.find(t=>t.id===a.role)?.displayName||a.role.replace(/_/g," ")}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs(c,{label:"","aria-label":`Reporting Manager for ${a.name}`,id:`manager-1-desktop-${a.id}`,value:a.reportingManagerId||"",onChange:t=>b(a.id,t.target.value,1),className:"w-full min-w-[160px]",children:[e.jsx("option",{value:"",children:"None"}),r.filter(t=>t.id!==a.id).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs(c,{label:"","aria-label":`Reporting Manager 2 for ${a.name}`,id:`manager-2-desktop-${a.id}`,value:a.reportingManager2Id||"",onChange:t=>b(a.id,t.target.value,2),className:"w-full min-w-[160px]",children:[e.jsx("option",{value:"",children:"None"}),r.filter(t=>t.id!==a.id).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs(c,{label:"","aria-label":`Reporting Manager 3 for ${a.name}`,id:`manager-3-desktop-${a.id}`,value:a.reportingManager3Id||"",onChange:t=>b(a.id,t.target.value,3),className:"w-full min-w-[160px]",children:[e.jsx("option",{value:"",children:"None"}),r.filter(t=>t.id!==a.id).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})})]},a.id))})]})}),e.jsx("div",{className:"space-y-3 md:hidden",children:r.slice((v-1)*N,v*N).map(a=>e.jsxs("div",{className:"bg-card rounded-lg border border-border overflow-hidden",children:[e.jsxs("div",{className:"p-3",children:[e.jsx("p",{className:"font-semibold text-primary-text",children:a.name}),e.jsx("p",{className:"text-sm text-muted capitalize",children:u.find(t=>t.id===a.role)?.displayName||a.role.replace(/_/g," ")})]}),e.jsxs("div",{className:"p-3 border-t border-border space-y-3",children:[e.jsxs(c,{label:"Manager 1",id:`manager-1-mobile-${a.id}`,value:a.reportingManagerId||"",onChange:t=>b(a.id,t.target.value,1),children:[e.jsx("option",{value:"",children:"None"}),r.filter(t=>t.id!==a.id).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs(c,{label:"Manager 2",id:`manager-2-mobile-${a.id}`,value:a.reportingManager2Id||"",onChange:t=>b(a.id,t.target.value,2),children:[e.jsx("option",{value:"",children:"None"}),r.filter(t=>t.id!==a.id).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs(c,{label:"Manager 3",id:`manager-3-mobile-${a.id}`,value:a.reportingManager3Id||"",onChange:t=>b(a.id,t.target.value,3),children:[e.jsx("option",{value:"",children:"None"}),r.filter(t=>t.id!==a.id).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]},a.id))}),e.jsx("div",{className:"mt-4",children:e.jsx(V,{currentPage:v,totalItems:r.length,pageSize:N,onPageChange:z,onPageSizeChange:$,pageSizeOptions:[10,20,50,100]})})]}),d==="2d"&&e.jsx(H,{users:r})]})]})]})};export{ie as default};
