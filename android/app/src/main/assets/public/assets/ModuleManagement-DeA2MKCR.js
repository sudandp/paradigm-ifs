import{c as S,o as A,d as $,j as e,I as w,C as q,p as F,B as g,q as P,e as v,T as D,m as N}from"./index-D5q3SS3D.js";import{b as n,u as E}from"./react-vendor-BUaIliXj.js";import{A as I}from"./AdminPageHeader-wINx_pXe.js";import{M as O}from"./Modal-CR2aBU6L.js";import{allPermissions as T}from"./RoleManagement-BD-VJiFD.js";import{S as h}from"./Skeleton-D0WWmlnq.js";import{ao as B,ax as L,as as _,at as z}from"./ui-vendor-B8EvWqdc.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./utils-vendor-DmorxLnX.js";import"./supabase-7WG3J4rU.js";import"./TableSkeleton-Bf5l1KHK.js";const G=$({id:v().required(),name:v().required("Module name is required"),description:v().required("Description is required"),permissions:P().of(v().required()).min(1,"At least one permission must be selected")}).defined(),H=({isOpen:i,onClose:d,onSave:c,initialData:u})=>{const{register:x,handleSubmit:f,control:l,reset:p,formState:{errors:r}}=S({resolver:A(G)});return n.useEffect(()=>{i&&p(u||{id:`mod_${Date.now()}`,name:"",description:"",permissions:[]})},[i,u,p]),i?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 p-4",onClick:d,children:e.jsx("div",{className:"bg-card rounded-xl shadow-card w-full max-w-2xl my-8 animate-fade-in-scale flex flex-col",onClick:o=>o.stopPropagation(),children:e.jsxs("form",{onSubmit:f(c),children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("h3",{className:"text-xl font-bold",children:[u?"Edit":"Add"," Module"]})}),e.jsxs("div",{className:"p-6 space-y-4 max-h-[60vh] overflow-y-auto",children:[e.jsx(w,{label:"Module Name",...x("name"),error:r.name?.message}),e.jsx(w,{label:"Description",...x("description"),error:r.description?.message}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted mb-2",children:"Permissions"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-2 p-4 border rounded-lg h-64 overflow-y-auto bg-page",children:e.jsx(q,{name:"permissions",control:l,render:({field:o})=>e.jsx(e.Fragment,{children:T.map(t=>e.jsx(F,{id:`perm-${t.key}`,label:t.name,checked:o.value?.includes(t.key)||!1,onChange:m=>{const j=m?[...o.value||[],t.key]:(o.value||[]).filter(y=>y!==t.key);o.onChange(j)}},t.key))})})}),r.permissions&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:Array.isArray(r.permissions)?r.permissions[0]?.message:r.permissions.message})]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-3",children:[e.jsx(g,{type:"button",variant:"secondary",onClick:d,children:"Cancel"}),e.jsx(g,{type:"submit",children:"Save Module"})]})]})})}):null},R=({count:i=6})=>e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.from({length:i}).map((d,c)=>e.jsxs("div",{className:"bg-page p-4 rounded-lg border border-border flex flex-col space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{className:"h-5 w-5 rounded-full"}),e.jsx(h,{className:"h-5 w-1/2"})]}),e.jsx(h,{className:"h-4 w-full"}),e.jsx(h,{className:"h-4 w-3/4"}),e.jsx(h,{className:"h-3 w-1/4"})]},c))}),re=()=>{const i=E(),[d,c]=n.useState([]),[u,x]=n.useState(!0),[f,l]=n.useState(null),[p,r]=n.useState(!1),[o,t]=n.useState(!1),[m,j]=n.useState(null);n.useEffect(()=>{(async()=>{x(!0);try{const a=await N.getModules();c(a)}catch{l({message:"Failed to load modules.",type:"error"})}finally{x(!1)}})()},[]);const y=async s=>{const a=[...d],M=a.findIndex(b=>b.id===s.id);M>-1?a[M]=s:a.push(s);try{await N.saveModules(a),c(a.sort((b,C)=>b.name.localeCompare(C.name))),l({message:`Module '${s.name}' saved.`,type:"success"}),r(!1)}catch{l({message:"Failed to save module.",type:"error"})}},k=async()=>{if(!m)return;const s=d.filter(a=>a.id!==m.id);try{await N.saveModules(s),c(s),l({message:`Module '${m.name}' deleted.`,type:"success"}),t(!1)}catch{l({message:"Failed to delete module.",type:"error"})}};return e.jsxs("div",{className:"p-4 border-0 shadow-none lg:bg-card lg:p-6 lg:rounded-xl lg:shadow-card",children:[f&&e.jsx(D,{...f,onDismiss:()=>l(null)}),e.jsx(H,{isOpen:p,onClose:()=>r(!1),onSave:y,initialData:m}),e.jsxs(O,{isOpen:o,onClose:()=>t(!1),onConfirm:k,title:"Confirm Deletion",children:['Are you sure you want to delete the module "',m?.name,'"?']}),e.jsx(I,{title:"Module Management",children:e.jsxs(g,{onClick:()=>i("/admin/modules/add"),children:[e.jsx(B,{className:"mr-2 h-4"})," Add Module"]})}),u?e.jsx(R,{count:6}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:d.map(s=>e.jsxs("div",{className:"bg-page p-4 rounded-lg border border-border flex flex-col",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(L,{className:"h-5 w-5 text-accent"}),e.jsx("h4",{className:"font-bold text-primary-text",children:s.name})]}),e.jsx("p",{className:"text-sm text-muted mb-3",children:s.description}),e.jsxs("p",{className:"text-xs font-semibold text-muted",children:[s.permissions.length," permissions"]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-border flex justify-end gap-2",children:[e.jsx(g,{variant:"icon",onClick:()=>{j(s),r(!0)},title:`Edit ${s.name}`,className:"p-2 hover:bg-blue-500/10 rounded-full transition-colors",children:e.jsx(_,{className:"h-5 w-5"})}),e.jsx(g,{variant:"icon",onClick:()=>{j(s),t(!0)},title:`Delete ${s.name}`,className:"p-2 hover:bg-red-500/10 rounded-full transition-colors",children:e.jsx(z,{className:"h-5 w-5 text-red-500"})})]})]},s.id))})]})};export{re as default};
