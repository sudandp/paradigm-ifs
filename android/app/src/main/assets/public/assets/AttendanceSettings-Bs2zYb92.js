import{n as Ne,F as A,j as e,T as ke,B as h,I as n,p as u,M as w,m as O}from"./index-D5q3SS3D.js";import{b as m}from"./react-vendor-BUaIliXj.js";import{D as j}from"./DatePicker-D2ulOwJx.js";import{S as z}from"./Select-Dz12MdxG.js";import{A as Ce}from"./AdminPageHeader-wINx_pXe.js";import{aJ as we,b,a1 as Se,s as U,p as D,B as He,f as X,ao as I,at as T,as as Le}from"./ui-vendor-B8EvWqdc.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./utils-vendor-DmorxLnX.js";import"./supabase-7WG3J4rU.js";const Ge=()=>{const{attendance:p,officeHolidays:K,fieldHolidays:Q,siteHolidays:Z,recurringHolidays:G,addHoliday:ee,removeHoliday:ae,addRecurringHoliday:se,removeRecurringHoliday:te,updateAttendanceSettings:ie}=Ne(),[o,f]=m.useState(p),[re,le]=m.useState(!1),[ne,V]=m.useState(!1),[i,y]=m.useState("office"),[E,B]=m.useState(""),[S,W]=m.useState(""),[_,de]=m.useState(3),[$,oe]=m.useState("Saturday"),[ce,q]=m.useState(!1),[Y,me]=m.useState([]),[xe,J]=m.useState(!1),[P,c]=m.useState(null),[H,N]=m.useState(""),[L,k]=m.useState(""),[v,R]=m.useState(null);m.useEffect(()=>{(async()=>{J(!0);try{const t=await O.getAppRoles();me(t)}catch(t){console.error("Failed to fetch roles:",t)}finally{J(!1)}})()},[]),m.useEffect(()=>{f(a=>{const t={...p};return t.admin||(t.admin={...p.office,deviceLimits:{web:5,android:5,ios:5}}),t.management||(t.management={...p.office,deviceLimits:{web:5,android:5,ios:5}}),t})},[p]),m.useEffect(()=>{le(JSON.stringify(o)!==JSON.stringify(p))},[o,p]);const s=i==="selections"?o.office:o[i],ue=i==="office"||i==="admin"||i==="management"?K:i==="field"?Q:Z,F=new Date().getFullYear(),x=[...A.map(a=>({id:`fixed-${a.date}`,name:a.name,date:`${F}-${a.date}`,type:i})),...ue.filter(a=>!A.some(t=>t.name===a.name))].sort((a,t)=>new Date(a.date.replace(/-/g,"/")).getTime()-new Date(t.date.replace(/-/g,"/")).getTime()),he=async a=>{if(a.preventDefault(),E&&S&&i!=="selections"){if(i==="admin"||i==="management"){c({message:"Holiday configuration for Admin/Management is inherited from Office rules.",type:"error"});return}if(x.filter(l=>!A.some(d=>d.name===l.name)).length>=0&&x.length>=(s.maxHolidaysPerCategory||10)){c({message:"Maximum total limit of 10 holidays reached.",type:"error"});return}if(x.some(l=>l.date===S)){c({message:"A holiday for this date already exists.",type:"error"});return}try{await ee(i,{name:E,date:S}),B(""),W(""),c({message:"Holiday added successfully.",type:"success"})}catch{c({message:"Failed to add holiday.",type:"error"})}}else c({message:"Please provide both a name and a date.",type:"error"})},pe=async a=>{if(!a.startsWith("fixed-")&&i!=="selections"){if(i==="admin"||i==="management")return;try{await ae(i,a),c({message:"Holiday removed successfully.",type:"success"})}catch{c({message:"Failed to remove holiday.",type:"error"})}}},fe=()=>{if(!H||!L){c({message:"Please provide both a name and a date.",type:"error"});return}const a=L.substring(4),t=[...s.holidayPool||w];t.push({name:H,date:a}),r("holidayPool",t),N(""),k("")},ge=a=>{const t=[...s.holidayPool||w];t.splice(a,1),r("holidayPool",t)},be=a=>{const l=[...s.holidayPool||w][a];N(l.name),k(`${F}${l.date}`),R(a)},ye=()=>{if(v===null)return;const a=L.substring(4),t=[...s.holidayPool||w];t[v]={name:H,date:a},r("holidayPool",t),N(""),k(""),R(null)},r=(a,t)=>{i!=="selections"&&f(l=>({...l,[i]:{...l[i],[a]:t}}))},ve=async()=>{if(window.confirm("This will record a manual check-out at 7:00 PM for all configured staff who haven't checked out today. Continue?")){q(!0);try{const a=await O.triggerMissedCheckouts(o);c({message:`Successfully triggered missed check-outs for ${a.count} staff.`,type:"success"})}catch(a){console.error("Failed to trigger missed check-outs:",a),c({message:"Failed to trigger missed check-outs. Please try again.",type:"error"})}finally{q(!1)}}},je=async()=>{V(!0);try{await O.saveAttendanceSettings(o),ie(o),c({message:"Settings saved successfully!",type:"success"})}catch{c({message:"Failed to save settings.",type:"error"})}finally{V(!1)}};return e.jsxs("div",{className:"p-4 border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card w-full pb-40",children:[P&&e.jsx(ke,{message:P.message,type:P.type,onDismiss:()=>c(null)}),e.jsx(Ce,{title:"Attendance & Leave Rules",children:e.jsxs(h,{onClick:je,isLoading:ne,disabled:!re,size:"md",className:"py-2 px-6",children:[e.jsx(we,{className:"mr-2 h-4 w-4"})," Save Rules"]})}),e.jsx("p",{className:"text-muted -mt-4 mb-6",children:"Set company-wide rules for attendance and leave calculation."}),e.jsx("div",{className:"mb-6 border-b border-border",children:e.jsxs("nav",{className:"-mb-px flex space-x-6 overflow-x-auto","aria-label":"Tabs",children:[e.jsx("button",{onClick:()=>y("office"),className:`whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm ${i==="office"?"border-accent text-accent-dark":"border-transparent text-muted hover:text-accent-dark hover:border-accent"}`,children:"Office Staff"}),e.jsx("button",{onClick:()=>y("field"),className:`whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm ${i==="field"?"border-accent text-accent-dark":"border-transparent text-muted hover:text-accent-dark hover:border-accent"}`,children:"Field Staff"}),e.jsx("button",{onClick:()=>y("site"),className:`whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm ${i==="site"?"border-accent text-accent-dark":"border-transparent text-muted hover:text-accent-dark hover:border-accent"}`,children:"Site Staff"}),e.jsx("button",{onClick:()=>y("admin"),className:`whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm ${i==="admin"?"border-accent text-accent-dark":"border-transparent text-muted hover:text-accent-dark hover:border-accent"}`,children:"Admin"}),e.jsx("button",{onClick:()=>y("management"),className:`whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm ${i==="management"?"border-accent text-accent-dark":"border-transparent text-muted hover:text-accent-dark hover:border-accent"}`,children:"Management"}),e.jsx("button",{onClick:()=>y("selections"),className:`whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm ${i==="selections"?"border-accent text-accent-dark":"border-transparent text-muted hover:text-accent-dark hover:border-accent"}`,children:"Staff Selections"})]})}),i==="office"&&e.jsx("p",{className:"text-sm text-muted -mt-4 mb-4",children:"These rules apply to Receptionist, Accountant, and general Office Staff."}),i==="field"&&e.jsx("p",{className:"text-sm text-muted -mt-4 mb-4",children:"These rules apply to Field Staff and Field Managers."}),i==="site"&&e.jsx("p",{className:"text-sm text-muted -mt-4 mb-4",children:"These rules apply to Site Staff (e.g. Site Managers, Security Guards)."}),i==="admin"&&e.jsx("p",{className:"text-sm text-muted -mt-4 mb-4",children:"These rules apply to System Administrators and HR Admins."}),i==="management"&&e.jsx("p",{className:"text-sm text-muted -mt-4 mb-4",children:"These rules apply to Top Management, CEO, GM, etc."}),i==="selections"&&e.jsx("p",{className:"text-sm text-muted -mt-4 mb-4",children:"Select staff groups to include in automated actions like missed check-out triggers."}),e.jsxs("div",{className:"space-y-6",children:[i!=="selections"&&e.jsxs(e.Fragment,{children:[e.jsxs("section",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-primary-text mb-4 flex items-center",children:[e.jsx(b,{className:"mr-2 h-5 w-5 text-muted"}),"Work Hours"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsx(n,{label:"Minimum Hours for Full Day",id:"minHoursFull",type:"number",value:s.minimumHoursFullDay,onChange:a=>r("minimumHoursFullDay",parseFloat(a.target.value)||0)}),e.jsx(n,{label:"Minimum Hours for Half Day",id:"minHoursHalf",type:"number",value:s.minimumHoursHalfDay,onChange:a=>r("minimumHoursHalfDay",parseFloat(a.target.value)||0)})]})]}),e.jsxs("section",{className:"pt-6 border-t border-border",children:[e.jsxs("h3",{className:"text-lg font-semibold text-primary-text mb-4 flex items-center",children:[e.jsx(Se,{className:"mr-2 h-5 w-5 text-muted"}),"Device Limits"]}),e.jsx("p",{className:"text-sm text-muted mb-4",children:"Set the maximum number of devices an employee can use to access the application. Exceeding these limits will require admin/HR approval."}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6",children:[e.jsx(n,{label:"Web Sessions",id:"limitWeb",type:"number",min:"0",value:s.deviceLimits?.web??1,onChange:a=>r("deviceLimits",{...s.deviceLimits,web:parseInt(a.target.value)||0}),description:"Max allowed browsers"}),e.jsx(n,{label:"Android Devices",id:"limitAndroid",type:"number",min:"0",value:s.deviceLimits?.android??1,onChange:a=>r("deviceLimits",{...s.deviceLimits,android:parseInt(a.target.value)||0})}),e.jsx(n,{label:"iOS Devices",id:"limitIos",type:"number",min:"0",value:s.deviceLimits?.ios??1,onChange:a=>r("deviceLimits",{...s.deviceLimits,ios:parseInt(a.target.value)||0})})]})]}),(i==="office"||i==="field"||i==="admin"||i==="management")&&e.jsxs("section",{className:"pt-6 border-t border-border",children:[e.jsxs("h3",{className:"text-lg font-semibold text-primary-text mb-4 flex items-center",children:[e.jsx(b,{className:"mr-2 h-5 w-5 text-muted"}),"Fixed Office Hours"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-6",children:[e.jsx(n,{label:"Check-in Start Time",id:"checkInTime",type:"time",value:s.fixedOfficeHours?.checkInTime||"09:00",onChange:a=>r("fixedOfficeHours",{...s.fixedOfficeHours,checkInTime:a.target.value})}),e.jsx(n,{label:"Check-out End Time",id:"checkOutTime",type:"time",value:s.fixedOfficeHours?.checkOutTime||"18:00",onChange:a=>r("fixedOfficeHours",{...s.fixedOfficeHours,checkOutTime:a.target.value})}),e.jsx(n,{label:"Min Daily Hours",id:"minDailyHours",type:"number",value:s.dailyWorkingHours?.min||7,onChange:a=>r("dailyWorkingHours",{...s.dailyWorkingHours,min:parseFloat(a.target.value)||7})}),e.jsx(n,{label:"Max Daily Hours",id:"maxDailyHours",type:"number",value:s.dailyWorkingHours?.max||9,onChange:a=>r("dailyWorkingHours",{...s.dailyWorkingHours,max:parseFloat(a.target.value)||9})})]})]}),i==="field"&&e.jsxs("section",{className:"pt-6 border-t border-border",children:[e.jsxs("h3",{className:"text-lg font-semibold text-primary-text mb-4 flex items-center",children:[e.jsx(b,{className:"mr-2 h-5 w-5 text-muted"}),"Site & Travel Time Tracking"]}),e.jsx("div",{className:"mb-4",children:e.jsx(u,{id:"enableSiteTimeTracking",label:"Enable Site/Travel Time Validation",description:"Track and validate the percentage of time field staff spend on-site vs traveling",checked:s.enableSiteTimeTracking||!1,onChange:a=>r("enableSiteTimeTracking",a.target.checked)})}),s.enableSiteTimeTracking&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 mb-4",children:[e.jsx(n,{label:"Minimum Site Time (%)",id:"minimumSitePercentage",type:"number",min:"0",max:"100",value:s.minimumSitePercentage||75,onChange:a=>r("minimumSitePercentage",parseFloat(a.target.value)||75)}),e.jsx(n,{label:"Maximum Travel Time (%)",id:"maximumTravelPercentage",type:"number",min:"0",max:"100",value:s.maximumTravelPercentage||25,onChange:a=>r("maximumTravelPercentage",parseFloat(a.target.value)||25)})]}),e.jsxs("div",{className:"p-4 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:[e.jsx("p",{className:"text-sm text-blue-400 mb-2",children:e.jsx("strong",{children:"How it works:"})}),e.jsxs("ul",{className:"text-sm text-blue-400 space-y-1 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Site Time:"})," Sum of all (check-out - check-in) durations at each site location"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Travel Time:"})," Time between sites (site checkout → next site check-in)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Example:"})," 8 hrs total → 6 hrs on-site (75%) + 2 hrs travel (25%) = Present"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Violation:"})," If site time falls below ",s.minimumSitePercentage||75,"%, a violation is created and the reporting manager is notified"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Grant Attendance:"})," Manager acknowledgment of violation grants (P) Present status for the day"]})]})]})]})]}),e.jsxs("section",{className:"pt-6 border-t border-border",children:[e.jsxs("h3",{className:"text-lg font-semibold text-primary-text mb-4 flex items-center",children:[e.jsx(b,{className:"mr-2 h-5 w-5 text-muted"}),"Break Tracking"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(u,{id:"enableBreakTracking",label:"Enable Break Tracking",description:"Allow employees to record lunch breaks. Working hours will exclude break time.",checked:s.enableBreakTracking||!1,onChange:a=>r("enableBreakTracking",a.target.checked)}),s.enableBreakTracking&&e.jsx(n,{label:"Standard Lunch Break Duration (minutes)",id:"lunchBreakDuration",type:"number",value:s.lunchBreakDuration||60,onChange:a=>r("lunchBreakDuration",parseInt(a.target.value,10)||60)})]})]}),e.jsxs("section",{className:"pt-6 border-t border-border",children:[e.jsxs("h3",{className:"text-lg font-semibold text-primary-text mb-4 flex items-center",children:[e.jsx(U,{className:"mr-2 h-5 w-5 text-muted"}),"Leave Allocation"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(n,{label:"Annual Earned Leaves",id:"annualEarnedLeaves",type:"number",value:s.annualEarnedLeaves,onChange:a=>r("annualEarnedLeaves",parseInt(a.target.value,10)||0),description:"Base annual quota if dynamic accrual is disabled."}),e.jsxs("div",{className:"mt-4",children:[e.jsx(j,{label:"Valid Till",id:"earnedLeavesExpiryDate",value:s.earnedLeavesExpiryDate||"",onChange:a=>r("earnedLeavesExpiryDate",a)}),s.earnedLeavesExpiryDate?new Date(s.earnedLeavesExpiryDate)<new Date(new Date().toISOString().split("T")[0])?e.jsx("p",{className:"text-xs text-amber-500 mt-1",children:"⚠ Expired - Not Applicable"}):e.jsx("p",{className:"text-xs text-emerald-500 mt-1",children:"✓ Valid"}):e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"No Validity"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(n,{label:"Annual Sick Leaves",id:"annualSickLeaves",type:"number",value:s.annualSickLeaves,onChange:a=>r("annualSickLeaves",parseInt(a.target.value,10)||0)}),e.jsxs("div",{className:"mt-4",children:[e.jsx(j,{label:"Valid Till",id:"sickLeavesExpiryDate",value:s.sickLeavesExpiryDate||"",onChange:a=>r("sickLeavesExpiryDate",a)}),s.sickLeavesExpiryDate?new Date(s.sickLeavesExpiryDate)<new Date(new Date().toISOString().split("T")[0])?e.jsx("p",{className:"text-xs text-amber-500 mt-1",children:"⚠ Expired - Not Applicable"}):e.jsx("p",{className:"text-xs text-emerald-500 mt-1",children:"✓ Valid"}):e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"No Validity"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(n,{label:"Monthly Floating Holidays",id:"monthlyFloatingLeaves",type:"number",value:s.monthlyFloatingLeaves,onChange:a=>r("monthlyFloatingLeaves",parseInt(a.target.value,10)||0)}),e.jsxs("div",{className:"mt-4",children:[e.jsx(j,{label:"Valid Till",id:"floatingLeavesExpiryDate",value:s.floatingLeavesExpiryDate||"",onChange:a=>r("floatingLeavesExpiryDate",a)}),s.floatingLeavesExpiryDate?new Date(s.floatingLeavesExpiryDate)<new Date(new Date().toISOString().split("T")[0])?e.jsx("p",{className:"text-xs text-amber-500 mt-1",children:"⚠ Expired - Not Applicable"}):e.jsx("p",{className:"text-xs text-emerald-500 mt-1",children:"✓ Valid"}):e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"No Validity"})]})]})]}),e.jsxs("div",{className:"mt-8 p-4 bg-emerald-500/5 border border-emerald-500/20 rounded-xl",children:[e.jsxs("h4",{className:"text-sm font-semibold text-emerald-600 mb-4 flex items-center",children:[e.jsx(D,{className:"mr-2 h-4 w-4"})," Earned Leave Accrual Rule"]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(u,{id:"enableAccrual",label:"Enable Dynamic Accrual",description:"Automatically calculate earned leave based on attendance history.",checked:!!s.earnedLeaveAccrual,onChange:a=>{a.target.checked?r("earnedLeaveAccrual",{daysRequired:10,amountEarned:.5}):r("earnedLeaveAccrual",void 0)}}),s.earnedLeaveAccrual&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 pl-8",children:[e.jsx(n,{label:"Days Required",type:"number",value:s.earnedLeaveAccrual.daysRequired,onChange:a=>r("earnedLeaveAccrual",{...s.earnedLeaveAccrual,daysRequired:parseFloat(a.target.value)||10}),description:"Countable days (Worked + Holiday + Weekoff)"}),e.jsx(n,{label:"Leave Earned (Days)",type:"number",step:"0.1",value:s.earnedLeaveAccrual.amountEarned,onChange:a=>r("earnedLeaveAccrual",{...s.earnedLeaveAccrual,amountEarned:parseFloat(a.target.value)||.5}),description:"Amount of leave granted per period"})]})]})]}),e.jsxs("div",{className:"mt-8 p-4 bg-emerald-500/5 border border-emerald-500/20 rounded-xl",children:[e.jsxs("h4",{className:"text-sm font-semibold text-emerald-600 mb-4 flex items-center",children:[e.jsx(U,{className:"mr-2 h-4 w-4"})," Sick Leave Accrual Rule"]}),e.jsx("div",{className:"flex flex-col gap-4",children:e.jsx(u,{id:"enableSickAccrual",label:"Enable Monthly Sick Leave Accrual",description:"Automatically grant 1 day of sick leave for every month with attendance.",checked:!!s.enableSickLeaveAccrual,onChange:a=>r("enableSickLeaveAccrual",a.target.checked)})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mt-8",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(n,{label:"Annual Compensatory Off",id:"annualCompOffLeaves",type:"number",value:s.annualCompOffLeaves,onChange:a=>r("annualCompOffLeaves",parseInt(a.target.value,10)||0)}),e.jsxs("div",{className:"mt-4",children:[e.jsx(j,{label:"Valid Till",id:"compOffLeavesExpiryDate",value:s.compOffLeavesExpiryDate||"",onChange:a=>r("compOffLeavesExpiryDate",a)}),s.compOffLeavesExpiryDate?new Date(s.compOffLeavesExpiryDate)<new Date(new Date().toISOString().split("T")[0])?e.jsx("p",{className:"text-xs text-amber-500 mt-1",children:"⚠ Expired - Not Applicable"}):e.jsx("p",{className:"text-xs text-emerald-500 mt-1",children:"✓ Valid"}):e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"No Validity"})]})]}),e.jsx(n,{label:"Sick Leave Cert. After (Days)",id:"sickLeaveCertThreshold",type:"number",value:s.sickLeaveCertificateThreshold,onChange:a=>r("sickLeaveCertificateThreshold",parseInt(a.target.value,10)||0),title:"Require a doctor's certificate if total sick leave taken exceeds this number of days."})]})]}),e.jsxs("section",{className:"pt-6 border-t border-border",children:[e.jsxs("h3",{className:"text-lg font-semibold text-primary-text mb-4 flex items-center",children:[e.jsx(He,{className:"mr-2 h-5 w-5 text-muted"}),"Notifications"]}),e.jsx(u,{id:"attendance-notifications",label:"Enable Check-in/Check-out Notifications",description:"Send a notification to Site Managers, Ops Managers, and HR when a Field Staff checks in or out.",checked:s.enableAttendanceNotifications,onChange:a=>r("enableAttendanceNotifications",a.target.checked)})]}),e.jsxs("section",{className:"pt-6 border-t border-border",children:[e.jsxs("h3",{className:"text-lg font-semibold text-primary-text mb-4 flex items-center",children:[e.jsx(D,{className:"mr-2 h-5 w-5 text-muted"}),"Geofencing Verification"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(u,{id:"geofencing-verification",label:"Enable Geofencing Verification",description:i==="office"?"Verify office staff are at PIFS Bangalore office (100m radius) during check-in/out. Violations are tracked and salary may be withheld.":i==="field"?"Verify field staff are at their assigned location during check-in/out. Violations are tracked and salary may be withheld after exceeding the limit.":"Verify site staff are at their assigned site during check-in/out. Geofencing is strictly enforced.",checked:s.geofencingEnabled,onChange:a=>r("geofencingEnabled",a.target.checked)}),e.jsx(n,{label:"Maximum Violations Per Month",id:"maxViolations",type:"number",value:s.maxViolationsPerMonth,onChange:a=>r("maxViolationsPerMonth",parseInt(a.target.value)||3),title:"After this many violations in a month, salary will be put on hold"})]})]}),e.jsxs("section",{className:"pt-6 border-t border-border",children:[e.jsxs("h3",{className:"text-lg font-semibold text-primary-text mb-4 flex items-center",children:[e.jsx(X,{className:"mr-2 h-5 w-5 text-muted"}),"Recurring Holidays"]}),e.jsxs("div",{className:"p-4 bg-page rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Add Recurring Holiday"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 items-end",children:[e.jsxs(z,{label:"Occurrence",value:_,onChange:a=>de(parseInt(a.target.value)),children:[e.jsx("option",{value:1,children:"1st"}),e.jsx("option",{value:2,children:"2nd"}),e.jsx("option",{value:3,children:"3rd"}),e.jsx("option",{value:4,children:"4th"}),e.jsx("option",{value:5,children:"5th"})]}),e.jsxs(z,{label:"Day",value:$,onChange:a=>oe(a.target.value),children:[e.jsx("option",{value:"Monday",children:"Monday"}),e.jsx("option",{value:"Tuesday",children:"Tuesday"}),e.jsx("option",{value:"Wednesday",children:"Wednesday"}),e.jsx("option",{value:"Thursday",children:"Thursday"}),e.jsx("option",{value:"Friday",children:"Friday"}),e.jsx("option",{value:"Saturday",children:"Saturday"}),e.jsx("option",{value:"Sunday",children:"Sunday"})]}),e.jsxs(h,{type:"button",onClick:async()=>{try{await se({day:$,n:_,type:i}),c({message:"Recurring holiday added successfully.",type:"success"})}catch{c({message:"Failed to add recurring holiday.",type:"error"})}},className:"w-full sm:w-auto h-[46px] px-6 text-sm",children:[e.jsx(I,{className:"mr-2 h-4 w-4"})," Add Rule"]})]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[G.filter(a=>(a.type||"office")===i).map((a,t)=>e.jsxs("div",{className:"flex justify-between items-start p-4 pr-6 border border-white/10 rounded-lg bg-white/5 mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"font-medium text-primary-text truncate",children:[a.n===1?"1st":a.n===2?"2nd":a.n===3?"3rd":a.n+"th"," ",a.day]}),e.jsx("p",{className:"text-sm text-muted",children:"Repeats every month"})]}),e.jsx("div",{className:"ml-4 shrink-0",children:e.jsx(h,{variant:"icon",onClick:async()=>{if(a.id)try{await te(a.id),c({message:"Recurring holiday removed successfully.",type:"success"})}catch{c({message:"Failed to remove recurring holiday.",type:"error"})}},className:"p-2 hover:bg-red-500/10 rounded-full transition-colors",children:e.jsx(T,{className:"h-5 w-5 text-red-500"})})})]},a.id||t)),G.filter(a=>(a.type||"office")===i).length===0&&e.jsx("p",{className:"text-center text-muted py-4",children:"No recurring holidays configured."})]})]}),e.jsxs("section",{className:"pt-6 border-t border-border",children:[e.jsxs("h3",{className:"text-lg font-semibold text-primary-text mb-4 flex items-center",children:[e.jsx(X,{className:"mr-2 h-5 w-5 text-muted"}),"Holiday List"]}),e.jsx("div",{className:"mb-6 space-y-4",children:e.jsx(u,{id:"enableCustomHolidays",label:"Enable Custom Holiday Selection",description:"Allow employees to select 5 holidays from the company selection list. Admin or HR will feed the remaining 5.",checked:s.enableCustomHolidays||!1,onChange:a=>r("enableCustomHolidays",a.target.checked)})}),e.jsxs("div",{className:"p-4 bg-page rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Add Admin Allocated Holiday"}),s.enableCustomHolidays?e.jsxs("div",{className:"mb-3 text-sm text-muted",children:[e.jsxs("span",{className:"font-medium",children:["Admin Holidays: ",x.length," / ",s.adminAllocatedHolidays||5]}),x.length>=(s.adminAllocatedHolidays||5)&&e.jsx("span",{className:"ml-2 text-red-500",children:"Maximum admin limit reached"})]}):e.jsxs("div",{className:"mb-3 text-sm text-muted",children:[e.jsxs("span",{className:"font-medium",children:["Holidays: ",x.length," / ",s.maxHolidaysPerCategory||10]}),x.length>=(s.maxHolidaysPerCategory||10)&&e.jsx("span",{className:"ml-2 text-red-500",children:"Maximum limit reached"})]}),e.jsxs("form",{onSubmit:he,className:"grid grid-cols-1 sm:grid-cols-3 gap-4 items-end",children:[e.jsx(n,{label:"Holiday Name",id:"holidayName",value:E,onChange:a=>B(a.target.value)}),e.jsx(j,{label:"Date",id:"holidayDate",value:S,onChange:W}),e.jsxs(h,{type:"submit",className:"w-full sm:w-auto h-[46px] px-8 text-sm",disabled:x.length>=(s.enableCustomHolidays?s.adminAllocatedHolidays||5:s.maxHolidaysPerCategory||10),children:[e.jsx(I,{className:"mr-2 h-4 w-4"})," Add"]})]})]}),s.enableCustomHolidays&&e.jsxs("div",{className:"mt-8 pt-6 border-t border-border/50",children:[e.jsxs("h4",{className:"font-semibold mb-2 flex items-center text-primary-text",children:[e.jsx(D,{className:"mr-2 h-4 w-4 text-muted"}),"Holiday Selection Pool"]}),e.jsxs("div",{className:"mb-6 p-4 bg-emerald-500/5 border border-emerald-500/20 rounded-xl",children:[e.jsxs("h4",{className:"text-sm font-semibold text-emerald-600 mb-4 flex items-center",children:[e.jsx(I,{className:"mr-2 h-4 w-4"})," ",v!==null?"Edit Pool Holiday":"Add to Selection Pool"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 items-end",children:[e.jsx(n,{label:"Holiday Name",value:H,onChange:a=>N(a.target.value),placeholder:"e.g. Christmas"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-semibold text-muted ml-1",children:"Date (Year Ignored)"}),e.jsx(j,{id:"pool-holiday-date",label:"",value:L,onChange:k})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{onClick:v!==null?ye:fe,className:"flex-1 h-[46px] text-sm",children:v!==null?"Update":"Add to Pool"}),v!==null&&e.jsx(h,{variant:"secondary",onClick:()=>{R(null),N(""),k("")},className:"h-[46px] px-4",children:"Cancel"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-3 max-h-[400px] overflow-y-auto p-1",children:(s.holidayPool||w).map((a,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 border border-white/10 rounded-lg group",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:a.name}),e.jsx("p",{className:"text-xs text-muted",children:new Date(`${F}${a.date}`).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>be(t),className:"p-1.5 hover:bg-white/10 rounded-md text-muted hover:text-primary transition-colors",title:"Edit",children:e.jsx(Le,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>ge(t),className:"p-1.5 hover:bg-red-500/10 rounded-md text-red-400 hover:text-red-500 transition-colors",title:"Remove",children:e.jsx(T,{className:"h-4 w-4"})})]})]},t))})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h4",{className:"font-semibold mb-4 text-primary-text",children:"Allocated Holidays"}),e.jsx("div",{className:"space-y-2",children:x.length>0?x.map(a=>e.jsxs("div",{className:"flex justify-between items-start p-4 pr-6 border border-white/10 rounded-lg bg-white/5 mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-primary-text truncate",children:a.name}),e.jsx("p",{className:"text-sm text-muted",children:new Date(a.date.replace(/-/g,"/")).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"})})]}),e.jsx("div",{className:"ml-4 shrink-0",children:A.some(t=>t.name===a.name)?e.jsx("span",{className:"text-[10px] bg-primary/10 text-primary px-2 py-1 rounded uppercase font-semibold",children:"Common"}):e.jsx(h,{variant:"outline",size:"sm",onClick:()=>pe(a.id),className:"p-2 border-red-500/20 hover:bg-red-500/10 rounded-full transition-colors",children:e.jsx(T,{className:"h-4 w-4 text-red-500"})})})]},a.id)):e.jsxs("p",{className:"text-center text-muted py-4",children:["No allocated holidays yet for ",i," staff."]})})]})]})]}),i==="selections"&&e.jsxs("section",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-primary-text mb-4 flex items-center",children:[e.jsx(D,{className:"mr-2 h-5 w-5 text-muted"}),"Missed Check-out Configuration"]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h4",{className:"text-sm font-medium text-muted mb-3 uppercase tracking-wider",children:"1. Select Active Categories"}),e.jsx("p",{className:"text-sm text-muted mb-4",children:'Choose which staff categories should be included in the "Trigger Missed Check-outs" action.'}),e.jsxs("div",{className:"flex flex-wrap gap-6 p-4 bg-page rounded-lg border border-border/50",children:[e.jsx(u,{id:"cat-office",label:"Office Staff",checked:o.missedCheckoutConfig?.enabledGroups?.includes("office")??!0,onChange:a=>{const t=o.missedCheckoutConfig?.enabledGroups||["office"],l=a.target.checked?[...new Set([...t,"office"])]:t.filter(d=>d!=="office");f(d=>({...d,missedCheckoutConfig:{...d.missedCheckoutConfig||{enabledGroups:["office"]},enabledGroups:l}}))}}),e.jsx(u,{id:"cat-field",label:"Field Staff",checked:o.missedCheckoutConfig?.enabledGroups?.includes("field")??!1,onChange:a=>{const t=o.missedCheckoutConfig?.enabledGroups||["office"],l=a.target.checked?[...new Set([...t,"field"])]:t.filter(d=>d!=="field");f(d=>({...d,missedCheckoutConfig:{...d.missedCheckoutConfig||{enabledGroups:["office"]},enabledGroups:l}}))}}),e.jsx(u,{id:"cat-site",label:"Site Staff",checked:o.missedCheckoutConfig?.enabledGroups?.includes("site")??!1,onChange:a=>{const t=o.missedCheckoutConfig?.enabledGroups||["office"],l=a.target.checked?[...new Set([...t,"site"])]:t.filter(d=>d!=="site");f(d=>({...d,missedCheckoutConfig:{...d.missedCheckoutConfig||{enabledGroups:["office"]},enabledGroups:l}}))}})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted mb-3 uppercase tracking-wider",children:"2. Manage Category Roles"}),e.jsx("p",{className:"text-sm text-muted mb-4",children:"Assign individual roles to each category. Based on these selections, employees will be processed as Office, Field, or Site staff."}),xe?e.jsxs("div",{className:"p-8 text-center text-muted bg-page rounded-lg border border-border/50",children:[e.jsx(b,{className:"animate-spin h-5 w-5 mx-auto mb-2 opacity-50"}),"Loading available roles..."]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:["office","field","site"].map(a=>{const t=o.missedCheckoutConfig?.roleMapping?.[a]||(a==="office"?["admin","hr","finance","developer"]:a==="field"?["field_staff","field_officer"]:["site_manager","security_guard","supervisor"]);return e.jsxs("div",{className:"bg-page rounded-lg border border-border/50 flex flex-col h-full",children:[e.jsxs("div",{className:"p-3 border-b border-border/30 bg-white/5 flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm font-semibold uppercase tracking-tight",children:[a," Staff Roles"]}),e.jsx("span",{className:"text-[10px] bg-primary/20 text-primary px-2 py-0.5 rounded-full",children:t.length})]}),e.jsxs("div",{className:"p-3 flex-1 space-y-2 max-h-[300px] overflow-y-auto",children:[t.map(l=>{const d=Y.find(C=>C.id===l);return e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white/5 rounded border border-border/10 group",children:[e.jsx("span",{className:"text-xs truncate",title:l,children:d?.displayName||l}),e.jsx("button",{onClick:()=>{const C=o.missedCheckoutConfig?.roleMapping||{office:["admin","hr","finance","developer"],field:["field_staff","field_officer"],site:["site_manager","security_guard","supervisor"]},M=t.filter(g=>g!==l);f(g=>({...g,missedCheckoutConfig:{...g.missedCheckoutConfig||{enabledGroups:["office"]},roleMapping:{...C,[a]:M}}}))},className:"text-muted hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(T,{className:"h-3 w-3"})})]},l)}),t.length===0&&e.jsx("p",{className:"text-[11px] text-muted text-center py-4 italic",children:"No roles assigned"})]}),e.jsx("div",{className:"p-3 border-t border-border/30 bg-white/5",children:e.jsxs("select",{className:"w-full bg-transparent border border-border/50 rounded p-1 text-xs text-primary-text outline-none focus:border-primary/50",value:"",onChange:l=>{if(!l.target.value)return;const d=l.target.value,C=o.missedCheckoutConfig?.roleMapping||{office:["admin","hr","finance","developer"],field:["field_staff","field_officer"],site:["site_manager","security_guard","supervisor"]},M=[...new Set([...t,d])];f(g=>({...g,missedCheckoutConfig:{...g.missedCheckoutConfig||{enabledGroups:["office"]},roleMapping:{...C,[a]:M}}}))},children:[e.jsx("option",{value:"",disabled:!0,className:"bg-page",children:"Assign Role..."}),Y.filter(l=>!t.includes(l.id)).map(l=>e.jsx("option",{value:l.id,className:"bg-page",children:l.displayName||l.id},l.id))]})})]},a)})})]})]}),e.jsxs("div",{className:"pt-6 border-t border-border/50",children:[e.jsx("h4",{className:"text-sm font-semibold text-primary-text mb-2",children:"Automated Actions"}),e.jsxs("div",{className:"bg-emerald-500/10 border border-emerald-500/20 rounded-lg p-3 mb-4",children:[e.jsxs("p",{className:"text-xs text-emerald-500 font-medium flex items-center",children:[e.jsx(b,{className:"h-3 w-3 mr-1.5"}),"Auto-Checkout Active"]}),e.jsxs("p",{className:"text-xs text-muted mt-1",children:["The system automatically checks out eligible staff at your configured ",e.jsx("strong",{children:"Check-out End Time"})," (currently ",o.office.fixedOfficeHours?.checkOutTime||"19:00","). This check runs every 15 minutes. You can also use the button below to manually run the trigger immediately for testing or overrides."]})]}),e.jsxs(h,{variant:"outline",onClick:ve,isLoading:ce,className:"border-red-500/30 hover:bg-red-500/10 text-red-400",disabled:!o.missedCheckoutConfig?.enabledGroups?.length,children:[e.jsx(b,{className:"mr-2 h-4 w-4"})," Run Manual Trigger Now"]})]})]})]})]})};export{Ge as default};
