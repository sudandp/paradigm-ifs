import{u as P,r as k,j as e,T,B as f,t as U,v as z}from"./index-D5q3SS3D.js";import{b as t}from"./react-vendor-BUaIliXj.js";import{P as E}from"./Pagination-DXf7cs0z.js";import{A as I}from"./AdminPageHeader-wINx_pXe.js";import{f as F}from"./date-D8dFQo9a.js";import{g as y,a1 as L,Q as B,av as H,X as M}from"./ui-vendor-B8EvWqdc.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./utils-vendor-DmorxLnX.js";import"./supabase-7WG3J4rU.js";const Z=()=>{const{user:l}=P(),[c,d]=t.useState([]),[b,v]=t.useState(!0),[n,o]=t.useState(null),[a,m]=t.useState(null),[x,j]=t.useState(""),[p,r]=t.useState(null),[g,N]=t.useState(1),[u,w]=t.useState(12);t.useEffect(()=>{R()},[]);const R=async()=>{try{v(!0);const s=await k();d(s)}catch(s){console.error("Error loading requests:",s),r({message:"Failed to load pending requests",type:"error"})}finally{v(!1)}},C=async(s,i)=>{if(window.confirm(`Are you sure you want to approve the device "${i}"?`)&&l)try{o(s),await U(s,l.id),r({message:"Device approved successfully",type:"success"}),d(h=>h.filter(A=>A.id!==s))}catch(h){console.error("Error approving device:",h),r({message:"Failed to approve device",type:"error"})}finally{o(null)}},D=(s,i)=>{m({id:s,name:i}),j("")},S=async()=>{if(a&&l){if(!x.trim()){alert("Please provide a reason for rejection");return}try{o(a.id),await z(a.id,l.id,x),r({message:"Device rejected successfully",type:"success"}),d(s=>s.filter(i=>i.id!==a.id)),m(null)}catch(s){console.error("Error rejecting device:",s),r({message:"Failed to reject device",type:"error"})}finally{o(null)}}};return e.jsxs("div",{className:"p-4 md:p-8 pb-20",children:[p&&e.jsx(T,{message:p.message,type:p.type,onDismiss:()=>r(null)}),e.jsx(I,{title:"Device Approvals"}),e.jsx("p",{className:"text-muted -mt-4 mb-8",children:"Review and manage requests for additional device access."}),b?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):c.length===0?e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-24 text-center mt-4",children:[e.jsx("div",{className:"bg-green-50 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(y,{className:"w-10 h-10 text-[#22c55e]",strokeWidth:3})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"All Caught Up!"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"There are no pending device requests requiring approval."})]}):e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx("div",{className:"grid grid-cols-1 gap-4",children:c.slice((g-1)*u,g*u).map(s=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 flex flex-col md:flex-row items-start md:items-center justify-between gap-6 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-4 min-w-[200px]",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold",children:s.userName?.charAt(0)||"U"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.userName||"Unknown User"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Requested ",F(s.requestedAt)]})]})]}),e.jsxs("div",{className:"flex-1 flex items-start gap-4 p-3 bg-gray-50 rounded-lg w-full md:w-auto",children:[e.jsx("div",{className:"mt-1",children:s.deviceType==="web"?e.jsx(L,{className:"w-5 h-5 text-blue-500"}):e.jsx(B,{className:"w-5 h-5 text-green-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-800",children:s.deviceName}),e.jsxs("p",{className:"text-xs text-gray-500 break-all",children:[s.deviceType.toUpperCase()," â€¢ ",s.deviceInfo?.browser||s.deviceInfo?.platform]}),s.currentDeviceCount!==void 0&&e.jsxs("p",{className:"text-xs text-amber-600 mt-1 flex items-center",children:[e.jsx(H,{className:"w-3 h-3 mr-1"}),"User has ",s.currentDeviceCount," active ",s.deviceType," device(s)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto",children:[e.jsxs(f,{onClick:()=>D(s.id,s.deviceName),className:"bg-white border border-gray-200 text-gray-700 hover:bg-gray-50 flex-1 md:flex-none",disabled:!!n,children:[e.jsx(M,{className:"w-4 h-4 mr-2"})," Reject"]}),e.jsxs(f,{onClick:()=>C(s.id,s.deviceName),className:"bg-primary hover:bg-primary-dark text-white flex-1 md:flex-none",isLoading:n===s.id,disabled:!!n,children:[e.jsx(y,{className:"w-4 h-4 mr-2"})," Approve"]})]})]},s.id))}),e.jsx(E,{currentPage:g,totalItems:c.length,pageSize:u,onPageChange:N,onPageSizeChange:w,pageSizeOptions:[12,24,48,96]})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full p-6 animate-in fade-in zoom-in duration-200",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"Reject Device Request"}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Please provide a reason for rejecting access to ",e.jsx("strong",{children:a.name}),"."]}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded-lg p-3 min-h-[100px] focus:ring-2 focus:ring-primary focus:border-primary outline-none text-sm",placeholder:"e.g., Use company provided laptop instead...",value:x,onChange:s=>j(s.target.value),autoFocus:!0}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:()=>m(null),className:"px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800",children:"Cancel"}),e.jsx(f,{onClick:S,className:"bg-red-600 hover:bg-red-700 text-white border-none",isLoading:n===a.id,children:"Reject Request"})]})]})})]})};export{Z as default};
