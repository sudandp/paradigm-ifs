import{l as $,m as L,c as A,j as e,T as M,B as P,C as n,p as r,I as y}from"./index-D5q3SS3D.js";import{b as o}from"./react-vendor-BUaIliXj.js";import{A as T}from"./AdminPageHeader-wINx_pXe.js";import{S as m}from"./Select-Dz12MdxG.js";import{aJ as B,F,I as N,z as G,as as I,ar as V}from"./ui-vendor-B8EvWqdc.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./utils-vendor-DmorxLnX.js";import"./supabase-7WG3J4rU.js";const h={documents:{aadhaar:!1,pan:!1,bankProof:!1,educationCertificate:!1,salarySlip:!1,uanProof:!1,familyAadhaar:!1},verifications:{requireBengaluruAddress:!1,requireDobVerification:!1}},Q=()=>{const d=$(),[u,b]=o.useState(null),[w,S]=o.useState([]),[l,E]=o.useState("Administrator");o.useEffect(()=>{L.getSiteStaffDesignations().then(s=>{const a=[...new Set(s.map(t=>t.designation))];a.includes("Administrator")||a.unshift("Administrator"),S(a.map((t,R)=>({id:`${R}`,designation:t,department:"",permanentId:"",temporaryId:""})))})},[]);const{register:x,handleSubmit:C,control:i,formState:{isDirty:D},watch:p,reset:f,setValue:j}=A({defaultValues:d});o.useEffect(()=>{f(d)},[d,f]),o.useEffect(()=>{d.rulesByDesignation?.[l]||(Object.keys(h.documents).forEach(a=>{j(`rulesByDesignation.${l}.documents.${a}`,!0,{shouldDirty:!0})}),Object.keys(h.verifications).forEach(a=>{j(`rulesByDesignation.${l}.verifications.${a}`,!0,{shouldDirty:!0})}))},[l,d.rulesByDesignation,j]);const g=p("enforceManpowerLimit"),v=p("enableEsiRule"),c=p("enableGmcRule"),k=s=>{d.updateRules(s),b({message:"Enrollment rules saved successfully!",type:"success"}),f(s)};return e.jsxs("form",{onSubmit:C(k),className:"p-4 space-y-8 w-full",children:[u&&e.jsx(M,{message:u.message,type:u.type,onDismiss:()=>b(null)}),e.jsx(T,{title:"Enrollment Rules",children:e.jsxs(P,{type:"submit",disabled:!D,children:[e.jsx(B,{className:"mr-2 h-4 w-4"})," Save Rules"]})}),e.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-8 md:rounded-xl md:shadow-card",children:[e.jsxs("div",{className:"flex items-start mb-6",children:[e.jsx("div",{className:"p-3 rounded-full bg-accent-light mr-4",children:e.jsx(F,{className:"h-6 w-6 text-accent-dark"})}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Designation-Specific Rules"}),e.jsx("p",{className:"text-muted",children:"Set mandatory documents and verifications for specific roles."})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx(m,{label:"Configure rules for designation",value:l,onChange:s=>E(s.target.value),children:w.map(s=>e.jsx("option",{value:s.designation,children:s.designation},s.id))})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("section",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Mandatory Documents"}),e.jsx("div",{className:"space-y-3",children:Object.keys(h.documents).map(s=>e.jsx(n,{name:`rulesByDesignation.${l}.documents.${s}`,control:i,defaultValue:!0,render:({field:a})=>e.jsx(r,{id:`${l}-${s}`,label:s.replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase()),checked:a.value,onChange:a.onChange})},s))})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Data Verifications"}),e.jsx("div",{className:"space-y-3",children:Object.keys(h.verifications).map(s=>e.jsx(n,{name:`rulesByDesignation.${l}.verifications.${s}`,control:i,defaultValue:!0,render:({field:a})=>e.jsx(r,{id:`${l}-${s}`,label:s.replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase()),checked:a.value,onChange:a.onChange})},s))})]})]})]}),e.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-8 md:rounded-xl md:shadow-card",children:[e.jsxs("div",{className:"flex items-start mb-6",children:[e.jsx("div",{className:"p-3 rounded-full bg-accent-light mr-4",children:e.jsx(N,{className:"h-6 w-6 text-accent-dark"})}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("h2",{className:"text-xl font-bold",children:"ESI Eligibility"}),e.jsx("p",{className:"text-muted",children:"Define salary threshold for statutory insurance."})]}),e.jsx(n,{name:"enableEsiRule",control:i,render:({field:s})=>e.jsx(r,{id:"enableEsiRule",label:"Enable Rule",checked:s.value,onChange:s.onChange})})]}),e.jsx("div",{className:`transition-opacity ${v?"opacity-100":"opacity-50 pointer-events-none"}`,children:e.jsxs("div",{className:"max-w-sm",children:[e.jsx(y,{label:"ESI Eligibility Gross Salary Threshold",id:"esiCtcThreshold",type:"number",registration:x("esiCtcThreshold",{valueAsNumber:!0}),disabled:!v}),e.jsx("p",{className:"text-xs text-muted mt-2",children:"Employees at or below this amount are eligible for ESI. Those above are eligible for GMC."})]})})]}),e.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-8 md:rounded-xl md:shadow-card",children:[e.jsxs("div",{className:"flex items-start mb-6",children:[e.jsx("div",{className:"p-3 rounded-full bg-accent-light mr-4",children:e.jsx(N,{className:"h-6 w-6 text-accent-dark"})}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("h2",{className:"text-xl font-bold",children:"GMC/Insurance Policy Rules"}),e.jsx("p",{className:"text-muted",children:"Set default GMC policies."})]}),e.jsx(n,{name:"enableGmcRule",control:i,render:({field:s})=>e.jsx(r,{id:"enableGmcRule",label:"Enable Rule",checked:s.value,onChange:s.onChange})})]}),e.jsxs("div",{className:`transition-opacity ${c?"opacity-100":"opacity-50 pointer-events-none"}`,children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6",children:[e.jsx(y,{label:"GMC Salary Threshold",id:"salaryThreshold",type:"number",registration:x("salaryThreshold",{valueAsNumber:!0}),disabled:!c}),e.jsx(n,{name:"defaultPolicySingle",control:i,render:({field:s})=>e.jsxs(m,{label:"Policy (Single)",...s,disabled:!c,children:[e.jsx("option",{value:"1L",children:"1 Lakh"}),e.jsx("option",{value:"2L",children:"2 Lakh"})]})}),e.jsx(n,{name:"defaultPolicyMarried",control:i,render:({field:s})=>e.jsxs(m,{label:"Policy (Married)",...s,disabled:!c,children:[e.jsx("option",{value:"1L",children:"1 Lakh"}),e.jsx("option",{value:"2L",children:"2 Lakh"})]})})]}),e.jsx("p",{className:"text-xs text-muted mt-2",children:"Employees with a salary *above* this threshold will be eligible for GMC."})]})]}),e.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-8 md:rounded-xl md:shadow-card",children:[e.jsxs("div",{className:"flex items-start mb-6",children:[e.jsx("div",{className:"p-3 rounded-full bg-accent-light mr-4",children:e.jsx(G,{className:"h-6 w-6 text-accent-dark"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Manpower Allocation"}),e.jsx("p",{className:"text-muted",children:"Set rules for enrolling based on approved manpower."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(n,{name:"enforceManpowerLimit",control:i,render:({field:s})=>e.jsx(r,{id:"enforceManpowerLimit",label:"Enforce Manpower Allocation Limits",description:"Check new enrollments against the approved manpower count for the site.",checked:s.value,onChange:s.onChange})}),e.jsx("div",{className:`max-w-sm transition-opacity ${g?"opacity-100":"opacity-50 pointer-events-none"}`,children:e.jsxs(m,{label:"Action When Limit is Reached",id:"manpowerLimitRule",registration:x("manpowerLimitRule"),disabled:!g,children:[e.jsx("option",{value:"warn",children:"Warn field staff but allow enrollment"}),e.jsx("option",{value:"block",children:"Block enrollment and require approval"})]})})]})]}),e.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-8 md:rounded-xl md:shadow-card",children:[e.jsxs("div",{className:"flex items-start mb-6",children:[e.jsx("div",{className:"p-3 rounded-full bg-accent-light mr-4",children:e.jsx(I,{className:"h-6 w-6 text-accent-dark"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Field Staff Permissions"}),e.jsx("p",{className:"text-muted",children:"Control what field staff can do during enrollment."})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(n,{name:"allowSalaryEdit",control:i,render:({field:s})=>e.jsx(r,{id:"allowSalaryEdit",label:"Allow Salary Editing",description:"Permit field staff to edit default salary, triggering an approval workflow.",checked:s.value??!1,onChange:s.onChange})})})]}),e.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-8 md:rounded-xl md:shadow-card",children:[e.jsxs("div",{className:"flex items-start mb-6",children:[e.jsx("div",{className:"p-3 rounded-full bg-accent-light mr-4",children:e.jsx(V,{className:"h-6 w-6 text-accent-dark"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Family Details Validation"}),e.jsx("p",{className:"text-muted",children:"Set rules for validating family member details."})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(n,{name:"enforceFamilyValidation",control:i,render:({field:s})=>e.jsx(r,{id:"enforceFamilyValidation",label:"Enforce Strict Family Validation",description:"Enable checks for duplicates, age, and gender based on relationship.",checked:s.value??!1,onChange:s.onChange})})})]})]})};export{Q as default};
