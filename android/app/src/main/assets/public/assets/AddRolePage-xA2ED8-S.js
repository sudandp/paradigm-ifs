import{k as T,a as q,j as e,I as f,T as w,B as C,m as v}from"./index-D5q3SS3D.js";import{u as F,l as _,b as m}from"./react-vendor-BUaIliXj.js";import{allPermissions as P}from"./RoleManagement-BD-VJiFD.js";import{S as D}from"./ui-vendor-B8EvWqdc.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./utils-vendor-DmorxLnX.js";import"./supabase-7WG3J4rU.js";import"./AdminPageHeader-wINx_pXe.js";import"./Modal-CR2aBU6L.js";import"./TableSkeleton-Bf5l1KHK.js";import"./Skeleton-D0WWmlnq.js";const W=()=>{const b=F(),{id:x}=_(),a=!!x,I=T("(max-width: 767px)"),{permissions:R,setRolePermissions:E,addRolePermissionEntry:A}=q(),[r,g]=m.useState(""),[d,y]=m.useState(""),[u,k]=m.useState([]),[t,j]=m.useState(!1),[o,n]=m.useState(null);m.useEffect(()=>{(async()=>{try{if(a&&x){const i=(await v.getRoles()).find(c=>c.id===x);if(i){g(i.id),y(i.displayName);const c=R[i.id]||[];k(c)}}}catch{n({message:"Failed to load data.",type:"error"})}})()},[x,a,R]);const S=s=>{k(l=>l.includes(s)?l.filter(i=>i!==s):[...l,s])},N=async s=>{if(s.preventDefault(),!(!r.trim()||!d.trim())){j(!0);try{const l=a?r:r.toLowerCase().replace(/\s+/g,"_"),i={id:l,displayName:d.trim()},c=await v.getRoles();let h=[...c];if(a)h=h.map(p=>p.id===l?i:p);else{if(c.some(p=>p.id===l)){n({message:"Role ID already exists.",type:"error"}),j(!1);return}h.push(i)}await v.saveRoles(h),E(l,u),a||A(i),n({message:`Role ${a?"updated":"created"} successfully!`,type:"success"}),setTimeout(()=>b("/admin/roles"),1500)}catch{n({message:"Failed to save role. Please try again.",type:"error"})}finally{j(!1)}}};return I?e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("header",{className:"p-4 flex-shrink-0 fo-mobile-header",children:e.jsx("h1",{children:a?"Edit Role":"Add Role"})}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4",children:e.jsxs("div",{className:"bg-card rounded-2xl p-6 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block bg-accent-light p-3 rounded-full mb-2",children:e.jsx(D,{className:"h-8 w-8 text-accent-dark"})}),e.jsx("h2",{className:"text-xl font-bold text-primary-text",children:a?"Edit Role":"Add New Role"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Define role permissions and access control."})]}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsx(f,{label:"Role ID",id:"roleId",value:r,onChange:s=>g(s.target.value),placeholder:"e.g. admin, hr, field_staff",required:!0,disabled:t||a}),e.jsx(f,{label:"Display Name",id:"displayName",value:d,onChange:s=>y(s.target.value),placeholder:"e.g. Admin, HR, Field Staff",required:!0,disabled:t}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted mb-2",children:"Permissions"}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:P.map(s=>e.jsxs("label",{className:"flex items-center gap-2 p-2 rounded hover:bg-page cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:u.includes(s.key),onChange:()=>S(s.key),className:"form-checkbox",disabled:t}),e.jsx("span",{className:"text-sm",children:s.name})]},s.key))})]})]})]})}),e.jsxs("footer",{className:"p-4 flex-shrink-0 flex items-center gap-4",children:[e.jsx("button",{type:"button",onClick:()=>b("/admin/roles"),disabled:t,className:"fo-btn-secondary px-6",children:"Cancel"}),e.jsx("button",{type:"submit",onClick:N,disabled:t||!r.trim()||!d.trim(),className:"fo-btn-primary flex-1",children:t?"Saving...":a?"Save Changes":"Create Role"})]}),o&&e.jsx(w,{message:o.message,type:o.type,onDismiss:()=>n(null)})]}):e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"bg-card p-8 rounded-xl shadow-card w-full max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"bg-accent-light p-3 rounded-full mr-4",children:e.jsx(D,{className:"h-8 w-8 text-accent-dark"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-primary-text",children:a?"Edit Role":"Add New Role"}),e.jsx("p",{className:"text-muted",children:"Define role permissions and access control."})]})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsx(f,{label:"Role ID",id:"roleId",value:r,onChange:s=>g(s.target.value),placeholder:"e.g. admin, hr, field_staff",required:!0,disabled:t||a}),e.jsx(f,{label:"Display Name",id:"displayName",value:d,onChange:s=>y(s.target.value),placeholder:"e.g. Admin, HR, Field Staff",required:!0,disabled:t}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-muted mb-2",children:["Permissions (",u.length," selected)"]}),e.jsx("div",{className:"border border-border rounded-lg p-4 space-y-2 max-h-96 overflow-y-auto",children:P.map(s=>e.jsxs("label",{className:"flex items-center gap-3 p-2 rounded hover:bg-page cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:u.includes(s.key),onChange:()=>S(s.key),className:"form-checkbox",disabled:t}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:s.name}),s.description&&e.jsx("div",{className:"text-xs text-muted",children:s.description})]})]},s.key))})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t flex justify-end gap-3",children:[e.jsx(C,{type:"button",onClick:()=>b("/admin/roles"),variant:"secondary",disabled:t,children:"Cancel"}),e.jsx(C,{type:"submit",isLoading:t,disabled:!r.trim()||!d.trim(),children:a?"Save Changes":"Create Role"})]})]})]}),o&&e.jsx(w,{message:o.message,type:o.type,onDismiss:()=>n(null)})]})};export{W as default};
