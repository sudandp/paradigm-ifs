import{u as B,j as e,T as L,B as j,m as d}from"./index-D5q3SS3D.js";import{u as V,b as s}from"./react-vendor-BUaIliXj.js";import{d as H}from"./index-BKlf32TQ.js";import{S as w}from"./Select-Dz12MdxG.js";import{F as U}from"./FormHeader-CSy2Sh-o.js";import{D as $}from"./DatePicker-D2ulOwJx.js";import{S as v}from"./StatCard-Dc05kpHM.js";import{f as G,aF as I,F as Q,ar as X,aG as _,a4 as q}from"./ui-vendor-B8EvWqdc.js";import{f as y}from"./utils-vendor-DmorxLnX.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./supabase-7WG3J4rU.js";const le=()=>{const b=V(),[m,F]=s.useState([]),[k,A]=s.useState([]),[M,C]=s.useState([]),[J,S]=s.useState(!0),[u,n]=s.useState(null),{user:r}=B(),[a,T]=s.useState([{startDate:new Date(new Date().setMonth(new Date().getMonth()-1)),endDate:new Date,key:"selection"}]),[D,N]=s.useState(!1),[x,O]=s.useState(""),[f,z]=s.useState(""),[p,P]=s.useState(y(new Date,"yyyy-MM-dd"));s.useEffect(()=>{(async()=>{if(r){S(!0);try{const i=["admin","super_admin"].includes(r.role),[l,h,c]=await Promise.all([d.getVerificationSubmissions(void 0,void 0,i?void 0:r.id),d.getFieldStaff(i?void 0:r.id),d.getOrganizations()]);F(l),A(h),C(c)}catch{n({message:"Failed to load dashboard data.",type:"error"})}finally{S(!1)}}})()},[r]);const o=s.useMemo(()=>{const t=a[0].startDate,i=a[0].endDate;if(!t||!i)return m;const l=new Date(i);return l.setHours(23,59,59,999),m.filter(h=>{const c=new Date(h.enrollmentDate.replace(/-/g,"/"));return c>=t&&c<=l})},[m,a]),g=s.useMemo(()=>({total:o.length,verified:o.filter(t=>t.status==="verified").length,rejected:o.filter(t=>t.status==="rejected").length}),[o]),R=async t=>{if(t.preventDefault(),!x||!f||!p){n({message:"Please fill all fields for assignment.",type:"error"});return}try{await d.createAssignment(x,f,p),n({message:"Assignment created successfully (mocked).",type:"success"})}catch{n({message:"Failed to create assignment.",type:"error"})}},E=a[0].startDate&&a[0].endDate?`${y(a[0].startDate,"MMM d, yyyy")} - ${y(a[0].endDate,"MMM d, yyyy")}`:"Select Date";return e.jsxs("div",{className:"p-4 space-y-8",children:[u&&e.jsx(L,{message:u.message,type:u.type,onDismiss:()=>n(null)}),e.jsx("div",{className:"bg-card p-4 rounded-2xl",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-primary-text",children:"Operations Dashboard"}),e.jsxs("div",{className:"relative",children:[e.jsxs(j,{variant:"outline",onClick:()=>N(!D),children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:E})]}),D&&e.jsx("div",{className:"absolute top-full right-0 mt-2 z-10 bg-card border rounded-lg shadow-lg",children:e.jsx(H.DateRangePicker,{onChange:t=>{T([t.selection]),N(!1)},months:1,ranges:a,direction:"horizontal"})})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 border-2 border-accent/30 rounded-2xl p-6 cursor-pointer hover:border-accent hover:shadow-lg transition-all group",onClick:()=>b("/operations/team-activity"),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"bg-accent rounded-xl p-3 group-hover:scale-110 transition-transform",children:e.jsx(I,{className:"h-6 w-6 text-white"})}),e.jsx("h3",{className:"text-xl font-bold text-primary-text",children:"Team Activity Monitor"})]}),e.jsx("p",{className:"text-muted mb-4",children:"Track your field team in real-time. Monitor check-ins, working hours, locations, and communicate instantly with your team members."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"px-3 py-1 bg-green-500/10 text-green-600 rounded-full text-xs font-medium",children:"Real-time tracking"}),e.jsx("span",{className:"px-3 py-1 bg-blue-500/10 text-blue-600 rounded-full text-xs font-medium",children:"Location monitoring"}),e.jsx("span",{className:"px-3 py-1 bg-purple-500/10 text-purple-600 rounded-full text-xs font-medium",children:"Quick communication"})]})]}),e.jsx("div",{className:"flex-shrink-0 ml-4",children:e.jsx(j,{onClick:t=>{t.stopPropagation(),b("/operations/team-activity")},style:{backgroundColor:"#006B3F",color:"#FFFFFF"},children:"View Team Activity â†’"})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(v,{title:"Total Submissions",value:g.total,icon:Q}),e.jsx(v,{title:"Verified Employees",value:g.verified,icon:X}),e.jsx(v,{title:"Rejected Applications",value:g.rejected,icon:_})]}),e.jsxs("div",{className:"bg-card p-6 rounded-2xl",children:[e.jsx(U,{title:"Assign Field Staff",subtitle:"Assign a field staff to an organization for a specific date."}),e.jsxs("form",{onSubmit:R,className:"grid grid-cols-1 md:grid-cols-4 gap-6 items-end",children:[e.jsx("div",{className:"md:col-span-1",children:e.jsxs(w,{label:"Field Staff",id:"officer",value:x,onChange:t=>O(t.target.value),children:[e.jsx("option",{value:"",children:"Select Staff"}),k.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})}),e.jsx("div",{className:"md:col-span-1",children:e.jsxs(w,{label:"Organization/Site",id:"site",value:f,onChange:t=>z(t.target.value),children:[e.jsx("option",{value:"",children:"Select Site"}),M.map(t=>e.jsx("option",{value:t.id,children:t.shortName},t.id))]})}),e.jsx("div",{className:"md:col-span-1",children:e.jsx($,{label:"Assignment Date",id:"assignmentDate",value:p,onChange:P})}),e.jsx("div",{className:"md:col-span-1",children:e.jsxs(j,{type:"submit",className:"w-full",children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),"Assign"]})})]})]})]})};export{le as default};
