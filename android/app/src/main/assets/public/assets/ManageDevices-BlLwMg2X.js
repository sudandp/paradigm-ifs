import{j as e,T as A,B as v,I as b,m as d}from"./index-D5q3SS3D.js";import{b as r}from"./react-vendor-BUaIliXj.js";import{M as j}from"./Modal-CR2aBU6L.js";import{S as B}from"./Select-Dz12MdxG.js";import{ao as M,K as O,ay as E,az as L,p as F,at as T,M as P,aA as N}from"./ui-vendor-B8EvWqdc.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./utils-vendor-DmorxLnX.js";import"./supabase-7WG3J4rU.js";const W=()=>{const[m,y]=r.useState([]),[w,S]=r.useState([]),[D,f]=r.useState(!0),[C,c]=r.useState(!1),[h,i]=r.useState(null),[a,o]=r.useState({sn:"",name:"",organizationId:"",locationName:""}),[t,n]=r.useState(null),[g,p]=r.useState(null),x=async()=>{f(!0);try{const[s,l]=await Promise.all([d.getBiometricDevices(),d.getOrganizations()]);y(s),S(l)}catch(s){console.error("Failed to fetch devices:",s),i({message:"Failed to load devices.",type:"error"})}finally{f(!1)}};r.useEffect(()=>{x()},[]);const k=async()=>{const s=t||a;if(!s.sn||!s.name){i({message:"Serial Number and Name are required.",type:"error"});return}const l={sn:s.sn,name:s.name,organizationId:s.organizationId===""?null:s.organizationId,locationName:s.locationName===""?null:s.locationName};try{if(t)await d.updateBiometricDevice(t.id,l),i({message:"Device updated successfully.",type:"success"}),c(!1),n(null);else{const u=await d.addBiometricDevice(l);i({message:"Device added successfully.",type:"success"}),c(!1),p(u)}o({sn:"",name:"",organizationId:"",locationName:""}),x()}catch(u){console.error("Save error:",u),i({message:u.message||"Failed to save device.",type:"error"})}},z=s=>{n(s),c(!0)},I=async s=>{if(window.confirm("Are you sure you want to delete this device?"))try{await d.deleteBiometricDevice(s),i({message:"Device deleted successfully.",type:"success"}),x()}catch{i({message:"Failed to delete device.",type:"error"})}};return e.jsxs("div",{className:"p-4 md:p-8",children:[h&&e.jsx(A,{message:h.message,type:h.type,onDismiss:()=>i(null)}),e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8 pb-6 border-b border-border",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-extrabold text-primary-text tracking-tight",children:"Biometric Devices"}),e.jsx("p",{className:"text-muted mt-1",children:"Manage eSSL AiFace-Mars hardware across site locations."})]}),e.jsxs(v,{onClick:()=>{n(null),c(!0)},className:"flex items-center justify-center gap-2 h-11 px-6 shadow-lg shadow-accent/20",children:[e.jsx(M,{className:"h-5 w-5"})," Add New Device"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:D?Array(3).fill(0).map((s,l)=>e.jsx("div",{className:"animate-pulse bg-card rounded-2xl h-56 border border-border"},l)):m.length===0?e.jsxs("div",{className:"col-span-full py-20 flex flex-col items-center justify-center bg-card rounded-3xl border border-dashed border-border/60 shadow-sm",children:[e.jsx("div",{className:"h-20 w-20 bg-accent/5 rounded-full flex items-center justify-center mb-6",children:e.jsx(O,{className:"h-10 w-10 text-accent/40"})}),e.jsx("h3",{className:"text-xl font-bold text-primary-text mb-2",children:"No Devices Configured"}),e.jsx("p",{className:"text-muted text-center max-w-sm mb-8 px-6",children:"You haven't added any biometric devices yet. Connect your first eSSL device to start tracking attendance."}),e.jsx(v,{variant:"outline",onClick:()=>{n(null),c(!0)},className:"hover:bg-accent hover:text-white transition-all",children:"Register Your First Device"})]}):m.map(s=>e.jsxs("div",{className:"bg-card rounded-2xl shadow-sm border border-border hover:border-accent hover:shadow-md transition-all relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 w-1 pt-24 bg-accent/10 opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsx("div",{className:`p-4 rounded-2xl ${s.status==="online"?"bg-emerald-500/10":"bg-gray-500/10"}`,children:s.status==="online"?e.jsx(E,{className:"h-6 w-6 text-emerald-500"}):e.jsx(L,{className:"h-6 w-6 text-gray-400"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>z(s),className:"p-2 text-muted hover:text-accent hover:bg-accent/5 rounded-xl transition-all",title:"Edit Device",children:e.jsx(F,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>I(s.id),className:"p-2 text-muted hover:text-red-500 hover:bg-red-500/5 rounded-xl transition-all",title:"Delete Device",children:e.jsx(T,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"space-y-1 mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-primary-text tracking-tight",children:s.name}),e.jsx("div",{className:"flex items-center gap-2 text-xs font-mono text-muted bg-gray-50 px-2 py-1 rounded w-fit capitalize",children:e.jsxs("span",{children:["SN: ",s.sn]})})]}),e.jsxs("div",{className:"space-y-3 mb-6 pt-6 border-t border-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-primary-text/80",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-gray-50 flex items-center justify-center",children:e.jsx(P,{className:"h-4 w-4 text-muted"})}),e.jsx("span",{className:"font-medium",children:s.locationName||s.organization?.shortName||"Unassigned Site"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-primary-text/80",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-gray-50 flex items-center justify-center",children:e.jsx(N,{className:"h-4 w-4 text-muted"})}),e.jsxs("span",{className:"text-xs",children:["Last seen: ",e.jsx("span",{className:"text-muted",children:s.lastSeen?new Date(s.lastSeen).toLocaleString():"Never"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-full bg-gray-50 w-fit",children:[e.jsx("span",{className:`h-2 w-2 rounded-full animate-pulse ${s.status==="online"?"bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]":"bg-gray-400"}`}),e.jsx("span",{className:`text-[10px] font-bold uppercase tracking-widest ${s.status==="online"?"text-emerald-600":"text-gray-500"}`,children:s.status})]})]})]},s.id))})]}),e.jsx(j,{isOpen:C,onClose:()=>c(!1),onConfirm:k,title:t?"Edit Biometric Device":"Add New Biometric Device",confirmButtonText:t?"Save Changes":"Add Device",confirmButtonVariant:"primary",children:e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx(b,{label:"Serial Number (SN)",value:t?t.sn:a.sn,onChange:s=>t?n({...t,sn:s.target.value}):o({...a,sn:s.target.value}),placeholder:"e.g. CI987654321",required:!0,disabled:!!t}),e.jsx(b,{label:"Device Name",value:t?t.name:a.name,onChange:s=>t?n({...t,name:s.target.value}):o({...a,name:s.target.value}),placeholder:"e.g. Main Gate Arrival",required:!0}),e.jsx(b,{label:"Manual Site (Optional)",value:t?t.locationName||"":a.locationName,onChange:s=>t?n({...t,locationName:s.target.value}):o({...a,locationName:s.target.value}),placeholder:"e.g. South Entry Gate"}),e.jsx("div",{className:"text-xs text-muted -mt-2",children:"If manual site is entered, it will override organization name in attendance logs."}),e.jsxs(B,{label:"Assign Site (Organization)",value:t?t.organizationId||"":a.organizationId,onChange:s=>t?n({...t,organizationId:s.target.value}):o({...a,organizationId:s.target.value}),children:[e.jsx("option",{value:"",children:"Select a Site"}),w.map(s=>e.jsx("option",{value:s.id,children:s.shortName},s.id))]})]})}),e.jsx(j,{isOpen:!!g,onClose:()=>p(null),title:" Configure Your Device",confirmButtonText:"I Have Configured It",onConfirm:()=>p(null),confirmButtonVariant:"primary",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 text-sm text-amber-800",children:[e.jsx("strong",{children:"Action Required:"})," Please enter these exact details into your eSSL Device under ",e.jsx("em",{children:"Menu → Comm → Cloud Server (ADMS)"}),"."]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-muted uppercase tracking-wider block mb-1",children:"Server Address (URL)"}),e.jsx("div",{className:"bg-gray-100 p-3 rounded-lg font-mono text-sm break-all select-all flex justify-between items-center group",children:e.jsx("span",{children:"https://fmyafuhxlorbafbacywa.supabase.co/functions/v1/biometric-push"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-muted uppercase tracking-wider block mb-1",children:"Server Port"}),e.jsx("div",{className:"bg-gray-100 p-3 rounded-lg font-mono text-sm font-bold",children:"443"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-muted uppercase tracking-wider block mb-1",children:"Enable HTTPS"}),e.jsx("div",{className:"bg-gray-100 p-3 rounded-lg font-mono text-sm font-bold text-emerald-600",children:"ON"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-muted uppercase tracking-wider block mb-1",children:"Enable Domain Name"}),e.jsx("div",{className:"bg-gray-100 p-3 rounded-lg font-mono text-sm font-bold text-emerald-600",children:"ON"})]})]}),e.jsxs("div",{className:"border-t border-border pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-muted",children:"Current Status: "}),e.jsx("span",{className:`font-bold ${m.find(s=>s.id===g?.id)?.status==="online"?"text-emerald-600":"text-red-500"}`,children:m.find(s=>s.id===g?.id)?.status?.toUpperCase()||"OFFLINE"})]}),e.jsxs(v,{size:"sm",variant:"outline",onClick:x,className:"gap-2",children:[e.jsx(N,{className:"h-3 w-3"})," Check Status"]})]}),e.jsx("p",{className:"text-xs text-muted mt-2 text-center",children:'After saving on the device, wait 30 seconds and click "Check Status".'})]})]})})]})};export{W as default};
