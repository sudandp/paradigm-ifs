import{u as P,i as $,m as p,j as e,P as o,B as E,T as B}from"./index-D5q3SS3D.js";import{u as D,b as t}from"./react-vendor-BUaIliXj.js";import{M as y}from"./Modal-CR2aBU6L.js";import{a2 as Q,R as _,S as z,j as F,n as q,at as G,z as w,aj as H,ar as J,av as K}from"./ui-vendor-B8EvWqdc.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./utils-vendor-DmorxLnX.js";import"./supabase-7WG3J4rU.js";const te=()=>{const M=D(),{user:f}=P(),[a,C]=t.useState([]),[S,g]=t.useState(!0),[d,U]=t.useState(""),[r,A]=t.useState(null),[k,c]=t.useState(!1),[R,m]=t.useState(!1),[x,L]=t.useState(null),[b,n]=t.useState(!1),[u,l]=t.useState(null),j=$(f?.role)||f?.role==="developer",i=t.useCallback(async()=>{g(!0);try{const s=await p.getUsers();C(s)}catch{l({message:"Failed to fetch users",type:"error"})}finally{g(!1)}},[]);t.useEffect(()=>{i()},[i]);const T=t.useMemo(()=>a.filter(s=>["admin","operation_manager","hr"].includes(s.role)).sort((s,v)=>s.name.localeCompare(v.name)),[a]),h=t.useMemo(()=>r?a.filter(s=>s.reportingManagerId===r.id):[],[a,r]),N=t.useMemo(()=>r?a.filter(s=>s.id!==r.id&&s.reportingManagerId!==r.id).filter(s=>s.name.toLowerCase().includes(d.toLowerCase())||s.email.toLowerCase().includes(d.toLowerCase())):[],[a,r,d]),O=async s=>{if(r){n(!0);try{await p.updateUserReportingManager(s,r.id),l({message:"User assigned successfully",type:"success"}),await i(),c(!1)}catch{l({message:"Assignment failed",type:"error"})}finally{n(!1)}}},I=async()=>{if(x){n(!0);try{await p.updateUserReportingManager(x.id,null),l({message:"User removed from team",type:"success"}),await i(),m(!1)}catch{l({message:"Removal failed",type:"error"})}finally{n(!1)}}};return S&&a.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px]",children:[e.jsx(Q,{className:"w-10 h-10 text-emerald-500 animate-spin mb-4"}),e.jsx("p",{className:"text-muted font-medium",children:"Loading user directory..."})]}):e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>M("/my-team"),className:"p-2.5 rounded-xl hover:bg-card border border-transparent hover:border-border transition-all text-muted hover:text-primary-text",children:e.jsx(_,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-primary-text",children:"Reporting Structure"}),e.jsx("p",{className:"text-sm text-muted",children:"Manage team assignments and manager hierarchy"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[e.jsx("div",{className:"lg:col-span-4 space-y-4",children:e.jsxs("div",{className:"bg-card border border-border rounded-2xl overflow-hidden shadow-sm",children:[e.jsx("div",{className:"p-4 border-b border-border bg-muted/30",children:e.jsxs("h2",{className:"font-bold text-primary-text flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-emerald-500"}),"Managers"]})}),e.jsx("div",{className:"overflow-y-auto max-h-[600px] divide-y divide-border",children:T.map(s=>e.jsxs("button",{onClick:()=>A(s),className:`w-full flex items-center gap-3 p-4 text-left transition-colors duration-200 ${r?.id===s.id?"bg-emerald-50 dark:bg-emerald-500/10":"hover:bg-muted/50"}`,children:[e.jsx(o,{seed:s.id,className:"w-10 h-10 rounded-full border border-border"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`font-bold truncate ${r?.id===s.id?"text-emerald-600":"text-primary-text"}`,children:s.name}),e.jsx("p",{className:"text-[10px] text-muted uppercase tracking-wider font-semibold",children:s.role.replace("_"," ")})]}),e.jsx(F,{className:`w-4 h-4 transition-transform ${r?.id===s.id?"translate-x-1 text-emerald-500":"text-muted"}`})]},s.id))})]})}),e.jsx("div",{className:"lg:col-span-8 space-y-6",children:r?e.jsxs("div",{className:"bg-card border border-border rounded-2xl shadow-sm overflow-hidden min-h-[500px] flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-border flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(o,{seed:r.id,className:"w-12 h-12 rounded-full ring-2 ring-emerald-500/20"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-primary-text",children:[r.name,"'s Team"]}),e.jsxs("p",{className:"text-sm text-muted",children:[h.length," direct reports"]})]})]}),j&&e.jsxs(E,{onClick:()=>c(!0),children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Assign Member"]})]}),e.jsx("div",{className:"flex-1 p-6",children:h.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:h.map(s=>e.jsx("div",{className:"group p-4 rounded-xl border border-border hover:border-emerald-500/30 hover:shadow-md transition-all duration-300",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{seed:s.id,className:"w-10 h-10 rounded-full border border-border"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-primary-text truncate",children:s.name}),e.jsx("p",{className:"text-xs text-muted truncate",children:s.email})]}),j&&e.jsx("button",{onClick:()=>{L(s),m(!0)},className:"opacity-0 group-hover:opacity-100 p-2 text-red-500 hover:bg-red-50 rounded-lg transition-all",title:"Remove from team",children:e.jsx(G,{className:"w-4 h-4"})})]})},s.id))}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center p-10 opacity-60",children:[e.jsx("div",{className:"bg-muted p-4 rounded-full mb-4",children:e.jsx(w,{className:"w-8 h-8 text-muted"})}),e.jsx("p",{className:"text-lg font-bold",children:"No reports found"}),e.jsx("p",{className:"text-sm",children:"Assigned members will appear here"})]})})]}):e.jsxs("div",{className:"bg-card border-2 border-dashed border-border rounded-2xl p-12 flex flex-col items-center justify-center text-center h-full",children:[e.jsx(w,{className:"w-12 h-12 text-muted mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-primary-text mb-2",children:"Select a Manager"}),e.jsx("p",{className:"text-muted max-w-sm",children:"Choose a manager from the list to view and manage their direct reporting structure."})]})})]}),e.jsx(y,{isOpen:k,onClose:()=>c(!1),title:"Assign Team Member",onConfirm:()=>{},children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted"}),e.jsx("input",{type:"text",placeholder:"Search by name or email...",className:"w-full !pl-10 pr-4 py-2 bg-muted/30 border border-border rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none",value:d,onChange:s=>U(s.target.value)})]}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto divide-y divide-border border border-border rounded-xl",children:N.length>0?N.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{seed:s.id,className:"w-8 h-8 rounded-full"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-primary-text leading-none",children:s.name}),e.jsx("p",{className:"text-[10px] text-muted mt-1 uppercase tracking-wider",children:s.role})]})]}),e.jsx("button",{onClick:()=>O(s.id),disabled:b,className:"p-1.5 text-emerald-600 hover:bg-emerald-50 rounded-lg transition-colors",children:e.jsx(J,{className:"w-5 h-5"})})]},s.id)):e.jsx("p",{className:"p-4 text-center text-muted text-sm",children:"No users found"})})]})}),e.jsx(y,{isOpen:R,onClose:()=>m(!1),title:"Remove Member",onConfirm:I,isConfirming:b,children:e.jsxs("div",{className:"flex gap-4 p-2 text-red-600 bg-red-50 dark:bg-red-500/10 rounded-xl mb-4",children:[e.jsx(K,{className:"w-5 h-5 flex-shrink-0"}),e.jsxs("p",{className:"text-sm font-medium",children:["Are you sure you want to remove ",e.jsx("strong",{children:x?.name})," from ",r?.name,"'s team?"]})]})}),u&&e.jsx(B,{message:u.message,type:u.type,onDismiss:()=>l(null)})]})};export{te as default};
