import{u as Ee,m,j as e,T as ze}from"./index-D5q3SS3D.js";import{u as $e,b as l}from"./react-vendor-BUaIliXj.js";import{E as K,F as oe}from"./FileSaver.min-C7cHFFkD.js";import{$ as Le,au as He,ap as _e,ao as xe,D as Oe,b as me,aw as he,a5 as We,T as pe,aj as Ue,a2 as Y,w as qe,m as Qe,bD as Xe,at as Z,bm as ge,bE as ye,X as Je}from"./ui-vendor-B8EvWqdc.js";import{v as Ve,s as Ge,E as Ke,k as Ye,p as v,f as w,a as Ze}from"./utils-vendor-DmorxLnX.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./supabase-7WG3J4rU.js";const dt=()=>{const H=$e(),[u,ue]=l.useState([]),[I,ee]=l.useState(!0),[_,n]=l.useState(null),[te,T]=l.useState(!1),[F,A]=l.useState([]),[ae,se]=l.useState(!1),[fe,be]=l.useState([]),re=l.useRef(null),[N,ve]=l.useState(""),[p,O]=l.useState({siteName:"",status:""}),[f,k]=l.useState(1),[j,je]=l.useState(15),[i,g]=l.useState(new Set),[W,M]=l.useState(!1),[we,S]=l.useState(!1),[U,le]=l.useState([]),[c,ne]=l.useState("active"),[D,q]=l.useState(null),[Q,X]=l.useState(""),[ie,B]=l.useState(!1),[P,E]=l.useState(null),{user:o}=Ee(),h=l.useCallback(async()=>{if(o){ee(!0);try{const t=(o.role||"").toLowerCase(),r=["admin","super_admin","finance_manager","management","hr","hr_ops"].includes(t)?void 0:o.id,[d,x,s]=await Promise.all([m.getSiteInvoiceRecords(r),m.getSiteInvoiceDefaults(r),m.getDeletedSiteInvoiceRecords(r)]);ue(d),be(x),le(s);const G=Ve(new Date,7),ce=s.filter(L=>L.deletedAt&&new Date(L.deletedAt)<G);if(ce.length>0){await Promise.all(ce.map(Pe=>m.permanentlyDeleteSiteInvoiceRecord(Pe.id)));const L=await m.getDeletedSiteInvoiceRecords();le(L)}}catch(t){console.error("Error fetching tracker data:",t),n({message:"Failed to load data",type:"error"})}finally{ee(!1)}}},[]);l.useEffect(()=>{h()},[h]);const Ne=async t=>{if(W){await ke(t);return}if(!(!D||!o)){B(!0);try{await m.softDeleteSiteInvoiceRecord(D.id,t,o.id,o.name||"Unknown"),n({message:"Record moved to deletion log",type:"success"}),q(null),X(""),S(!1),h()}catch{n({message:"Failed to delete record",type:"error"})}finally{B(!1)}}},ke=async t=>{if(!(i.size===0||!o)){B(!0);try{const a=Array.from(i);await m.bulkSoftDeleteSiteInvoiceRecords(a,t,o.id,o.name||"Unknown"),n({message:`${i.size} records moved to deletion log`,type:"success"}),g(new Set),X(""),M(!1),S(!1),h()}catch(a){console.error("Bulk delete error:",a),n({message:"Failed to delete selected records",type:"error"})}finally{B(!1)}}},Se=async t=>{E(t);try{await m.restoreSiteInvoiceRecord(t),n({message:"Record restored successfully",type:"success"}),h()}catch{n({message:"Failed to restore record",type:"error"})}finally{E(null)}},De=async t=>{if(window.confirm("This will permanently delete the record. Continue?"))try{await m.permanentlyDeleteSiteInvoiceRecord(t),n({message:"Record permanently deleted",type:"success"}),h()}catch{n({message:"Failed to delete record",type:"error"})}},Re=async()=>{if(!(i.size===0||!C)){E("bulk");try{const t=Array.from(i);await m.bulkRestoreSiteInvoiceRecords(t),n({message:`${i.size} records restored successfully`,type:"success"}),g(new Set),h()}catch{n({message:"Failed to restore records",type:"error"})}finally{E(null)}}},Ce=async()=>{if(!(i.size===0||!C)&&window.confirm(`Are you sure you want to permanently delete these ${i.size} records? This action cannot be undone.`))try{const t=Array.from(i);await m.bulkPermanentlyDeleteSiteInvoiceRecords(t),n({message:`${i.size} records permanently deleted`,type:"success"}),g(new Set),h()}catch{n({message:"Failed to delete records",type:"error"})}},J=t=>t===null?"text-gray-400":t>5?"text-rose-600 bg-rose-50 px-2 py-0.5 rounded font-bold":t>0?"text-amber-600 bg-amber-50 px-2 py-0.5 rounded font-semibold":"text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded font-medium",b=t=>{if(!t)return null;if(t instanceof Date)return w(t,"yyyy-MM-dd");const a=t.toString().trim();if(!a)return null;try{const r=new Date(a);if(!isNaN(r.getTime()))return w(r,"yyyy-MM-dd")}catch{console.warn("Failed to parse date:",a)}return null},V=(t,a)=>{if(!t||!a)return null;try{return Ze(v(t),v(a))}catch{return null}},Ie=async()=>{T(!0);try{const t=new K.Workbook,a=t.addWorksheet("Invoice Tracker");a.columns=[{header:"Site Name",key:"siteName",width:25},{header:"Company Name",key:"companyName",width:18},{header:"Billing Cycle",key:"billingCycle",width:18},{header:"Ops Incharge",key:"opsIncharge",width:15},{header:"HR Incharge",key:"hrIncharge",width:15},{header:"Invoice Incharge",key:"invoiceIncharge",width:18},{header:"Ops Remarks",key:"opsRemarks",width:20},{header:"HR Remarks",key:"hrRemarks",width:20},{header:"Finance Remarks",key:"financeRemarks",width:20},{header:"Manager Tentative Date",key:"managerTentativeDate",width:15},{header:"Manager Received Date",key:"managerReceivedDate",width:15},{header:"HR Tentative Date",key:"hrTentativeDate",width:15},{header:"HR Received Date",key:"hrReceivedDate",width:15},{header:"Attendance Received Time",key:"attendanceReceivedTime",width:12},{header:"Invoice Sharing Tentative Date",key:"invoiceSharingTentativeDate",width:15},{header:"Invoice Prepared Date",key:"invoicePreparedDate",width:15},{header:"Invoice Sent Date",key:"invoiceSentDate",width:15},{header:"Invoice Sent Time",key:"invoiceSentTime",width:12},{header:"Invoice Sent Method Remarks",key:"invoiceSentMethodRemarks",width:25},{header:"Received Balance",key:"receivedBalance",width:15},{header:"Balance Receipt No / Remarks",key:"receivedBalanceReceipt",width:25}],a.getRow(1).font={bold:!0,color:{argb:"FFFFFFFF"}},a.getRow(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF006B3F"}},u.forEach(d=>a.addRow(d));const r=await t.xlsx.writeBuffer();oe.saveAs(new Blob([r]),`Attendance_Tracker_${w(new Date,"yyyyMMdd")}.xlsx`),n({message:"Exported successfully!",type:"success"})}catch{n({message:"Failed to export",type:"error"})}finally{T(!1)}},Te=async()=>{T(!0);try{const t=new K.Workbook,a=t.addWorksheet("Template");a.columns=[{header:"Site Name",key:"siteName",width:25},{header:"Company Name",key:"companyName",width:20},{header:"Billing Cycle",key:"billingCycle",width:20},{header:"Ops Incharge",key:"opsIncharge",width:20},{header:"HR Incharge",key:"hrIncharge",width:20},{header:"Invoice Incharge",key:"invoiceIncharge",width:20},{header:"Ops Remarks",key:"opsRemarks",width:20},{header:"HR Remarks",key:"hrRemarks",width:20},{header:"Finance Remarks",key:"financeRemarks",width:20},{header:"Manager Tentative Date",key:"managerTentativeDate",width:15},{header:"Manager Received Date",key:"managerReceivedDate",width:15},{header:"HR Tentative Date",key:"hrTentativeDate",width:15},{header:"HR Received Date",key:"hrReceivedDate",width:15},{header:"Attendance Received Time",key:"attendanceReceivedTime",width:12},{header:"Invoice Sharing Tentative Date",key:"invoiceSharingTentativeDate",width:15},{header:"Invoice Prepared Date",key:"invoicePreparedDate",width:15},{header:"Invoice Sent Date",key:"invoiceSentDate",width:15},{header:"Invoice Sent Time",key:"invoiceSentTime",width:12},{header:"Invoice Sent Method Remarks",key:"invoiceSentMethodRemarks",width:25},{header:"Received Balance",key:"receivedBalance",width:15},{header:"Balance Receipt No / Remarks",key:"receivedBalanceReceipt",width:25}],a.getRow(1).font={bold:!0,color:{argb:"FFFFFFFF"}},a.getRow(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF0D9488"}},fe.forEach(d=>a.addRow(d));const r=await t.xlsx.writeBuffer();oe.saveAs(new Blob([r]),"Attendance_Template.xlsx"),n({message:"Template downloaded!",type:"success"})}catch{n({message:"Failed to download template",type:"error"})}finally{T(!1)}},Fe=async t=>{const a=t.target.files?.[0];if(a)try{const r=new K.Workbook;await r.xlsx.load(await a.arrayBuffer());const d=r.getWorksheet(1),x=[];d?.eachRow((s,G)=>{G!==1&&x.push({siteName:s.getCell(1).value?.toString()||"",companyName:s.getCell(2).value?.toString()||"",billingCycle:s.getCell(3).value?.toString()||"",opsIncharge:s.getCell(4).value?.toString()||"",hrIncharge:s.getCell(5).value?.toString()||"",invoiceIncharge:s.getCell(6).value?.toString()||"",opsRemarks:s.getCell(7).value?.toString()||"",hrRemarks:s.getCell(8).value?.toString()||"",financeRemarks:s.getCell(9).value?.toString()||"",managerTentativeDate:b(s.getCell(10).value),managerReceivedDate:b(s.getCell(11).value),hrTentativeDate:b(s.getCell(12).value),hrReceivedDate:b(s.getCell(13).value),attendanceReceivedTime:s.getCell(14).value?.toString()||"",invoiceSharingTentativeDate:b(s.getCell(15).value),invoicePreparedDate:b(s.getCell(16).value),invoiceSentDate:b(s.getCell(17).value),invoiceSentTime:s.getCell(18).value?.toString()||"",invoiceSentMethodRemarks:s.getCell(19).value?.toString()||""})}),A(x.filter(s=>!!s.siteName)),n({message:"File parsed. Please review.",type:"success"})}catch{n({message:"Failed to parse file",type:"error"})}},Ae=async()=>{if(o){se(!0);try{const t=F.map(a=>({...a,createdBy:o.id,createdByName:o.name,createdByRole:o.role}));await m.bulkSaveSiteInvoiceRecords(t),n({message:"Records imported!",type:"success"}),A([]),h()}catch(t){console.error("Import failed:",t);const a=t.message||t.details||"Check console for details";n({message:`Import failed: ${a}`,type:"error"})}finally{se(!1)}}},de=c==="active"?u:U,R=l.useMemo(()=>de.filter(t=>{const a=t.siteName.toLowerCase().includes(N.toLowerCase())||(t.companyName||"").toLowerCase().includes(N.toLowerCase()),r=!p.siteName||t.siteName.toLowerCase().includes(p.siteName.toLowerCase()),d=!p.status||(()=>{const x=!!t.invoiceSentDate;return p.status==="sent"?x:!x})();return a&&r&&d}),[de,N,p]),y=l.useMemo(()=>{const t=u.length,a=u.filter(s=>!!s.invoiceSentDate).length,r=t-a,d=Ge(new Date),x=u.filter(s=>s.invoiceSentDate||!s.invoiceSharingTentativeDate?!1:Ke(v(s.invoiceSharingTentativeDate),d)||Ye(v(s.invoiceSharingTentativeDate)));return{total:t,sent:a,pending:r,due:x}},[u]),z=Math.ceil(R.length/j),$=R.slice((f-1)*j,f*j),Me=t=>{if(t.target.checked){const a=$.map(r=>r.id);g(new Set(a))}else g(new Set)},Be=t=>{g(a=>{const r=new Set(a);return r.has(t)?r.delete(t):r.add(t),r})};l.useEffect(()=>{k(1)},[N,p,c]),l.useEffect(()=>{O({siteName:"",status:""}),g(new Set)},[c]);const C=["admin","super_admin","management","hr"].includes(o?.role||"");return e.jsxs("div",{className:"space-y-6 w-full px-4",children:[e.jsx("div",{className:"bg-white rounded-xl border border-gray-200/80 shadow-sm p-5",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("button",{onClick:Te,disabled:te,className:"inline-flex items-center gap-1.5 px-4 py-2 text-xs font-semibold text-gray-600 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 hover:border-gray-300 transition-all duration-150 hover:scale-[1.02] active:scale-[0.98] disabled:opacity-50",children:[e.jsx(Le,{className:"h-3.5 w-3.5 text-emerald-600"}),"Template"]}),e.jsxs("button",{onClick:()=>re.current?.click(),className:"inline-flex items-center gap-1.5 px-4 py-2 text-xs font-semibold text-gray-600 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 hover:border-gray-300 transition-all duration-150 hover:scale-[1.02] active:scale-[0.98]",children:[e.jsx(He,{className:"h-3.5 w-3.5 text-emerald-600"}),"Import"]}),e.jsxs("button",{onClick:Ie,disabled:te,className:"inline-flex items-center gap-1.5 px-4 py-2 text-xs font-semibold text-gray-600 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 hover:border-gray-300 transition-all duration-150 hover:scale-[1.02] active:scale-[0.98] disabled:opacity-50",children:[e.jsx(_e,{className:"h-3.5 w-3.5 text-emerald-600"}),"Export"]}),e.jsx("input",{type:"file",ref:re,onChange:Fe,accept:".xlsx, .xls",className:"hidden"})]}),e.jsxs("button",{onClick:()=>H("/finance/attendance/add"),className:"inline-flex items-center gap-1.5 px-5 py-2 text-xs font-bold text-white bg-[#006B3F] rounded-lg hover:bg-[#005632] transition-all duration-150 shadow-sm shadow-emerald-900/10 hover:shadow-md hover:shadow-emerald-900/15 hover:scale-[1.02] active:scale-[0.98]",children:[e.jsx(xe,{className:"h-3.5 w-3.5"}),"New Entry"]})]})}),!I&&e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl border border-gray-200/80 p-5 transition-all duration-150 hover:shadow-md hover:-translate-y-0.5",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-semibold text-gray-500 uppercase tracking-wider text-emerald-600",children:"Total Sites"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mt-1.5",children:y.total}),e.jsx("p",{className:"text-[10px] font-medium text-gray-400 mt-1",children:"Active site connections"})]}),e.jsx("div",{className:"w-10 h-10 rounded-lg bg-emerald-50 flex items-center justify-center",children:e.jsx(Oe,{className:"h-5 w-5 text-emerald-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200/80 p-5 transition-all duration-150 hover:shadow-md hover:-translate-y-0.5",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-semibold text-gray-500 uppercase tracking-wider text-rose-600",children:"Pending Invoices"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mt-1.5",children:y.pending}),e.jsxs("p",{className:"text-[10px] font-medium text-rose-500 mt-1",children:[y.due.length," Action required"]})]}),e.jsx("div",{className:"w-10 h-10 rounded-lg bg-rose-50 flex items-center justify-center",children:e.jsx(me,{className:"h-5 w-5 text-rose-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200/80 p-5 transition-all duration-150 hover:shadow-md hover:-translate-y-0.5",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-semibold text-gray-500 uppercase tracking-wider text-emerald-600",children:"Successfully Sent"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mt-1.5",children:y.sent}),e.jsxs("p",{className:"text-[10px] font-medium text-emerald-500 mt-1",children:[Math.round(y.sent/(y.total||1)*100),"% Completion"]})]}),e.jsx("div",{className:"w-10 h-10 rounded-lg bg-emerald-50 flex items-center justify-center",children:e.jsx(he,{className:"h-5 w-5 text-emerald-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200/80 p-5 transition-all duration-150 hover:shadow-md hover:-translate-y-0.5",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-semibold text-gray-500 uppercase tracking-wider text-emerald-600",children:"Mail Dispatched"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mt-1.5",children:u.filter(t=>t.invoiceSentMethodRemarks?.toLowerCase().includes("mail")).length}),e.jsx("p",{className:"text-[10px] font-medium text-gray-400 mt-1",children:"Via organizational email"})]}),e.jsx("div",{className:"w-10 h-10 rounded-lg bg-emerald-50 flex items-center justify-center",children:e.jsx(We,{className:"h-5 w-5 text-emerald-600"})})]})})]}),!I&&y.due.length>0&&e.jsxs("div",{className:"bg-rose-50/50 border border-rose-100 rounded-xl p-4 flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-rose-100 flex items-center justify-center shrink-0",children:e.jsx(pe,{className:"h-4 w-4 text-rose-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-rose-900",children:"Immediate Action Required"}),e.jsx("p",{className:"text-xs text-rose-700 mt-0.5",children:"The following sites have reached their tentative invoice sharing date:"}),e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2.5",children:y.due.map(t=>e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-md bg-white border border-rose-200 text-rose-800 text-[10px] font-bold shadow-sm whitespace-nowrap",children:[t.siteName," (Due: ",t.invoiceSharingTentativeDate?w(v(t.invoiceSharingTentativeDate),"dd MMM"):"N/A",")"]},t.id))})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200/80 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"px-5 py-3 border-b border-gray-100 flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsx("div",{className:"flex items-center gap-6",children:e.jsxs("div",{className:"flex bg-gray-100/80 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>ne("active"),className:`px-4 py-1.5 rounded-md text-xs font-bold transition-all ${c==="active"?"bg-white text-emerald-700 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Active Records"}),e.jsxs("button",{onClick:()=>ne("log"),className:`px-4 py-1.5 rounded-md text-xs font-bold transition-all ${c==="log"?"bg-white text-rose-700 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:["Deletion Log",U.length>0&&e.jsx("span",{className:"ml-1.5 px-1.5 py-0.5 rounded-full bg-rose-100 text-rose-600 text-[10px]",children:U.length})]})]})}),!I&&e.jsx("div",{className:"flex flex-1 items-center justify-end gap-3 w-full sm:w-auto",children:e.jsxs("div",{className:"relative flex-1 max-w-xs",children:[e.jsx("input",{type:"text",placeholder:`Search ${c==="active"?"records":"deleted ones"}...`,value:N,onChange:t=>ve(t.target.value),className:"w-full h-8 pl-8 pr-3 text-sm bg-gray-50 border border-gray-200 rounded-lg focus:bg-white focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500/20 outline-none transition-all placeholder:text-gray-400"}),e.jsx(Ue,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-gray-400"})]})})]}),I?e.jsxs("div",{className:"flex flex-col items-center justify-center py-24 gap-3",children:[e.jsx(Y,{className:"h-7 w-7 animate-spin text-emerald-500"}),e.jsx("span",{className:"text-sm text-gray-400 font-medium",children:"Loading records..."})]}):R.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 px-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center mb-5",children:e.jsx(qe,{className:"h-7 w-7 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:c==="active"?"No attendance records":"Deletion log is empty"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1.5 max-w-xs",children:c==="active"?"No records found for the current filter. Add a new entry to get started.":"Records deleted in the last 7 days will appear here."}),c==="active"&&e.jsxs("button",{onClick:()=>H("/finance/attendance/add"),className:"mt-5 inline-flex items-center gap-1.5 px-5 py-2.5 text-sm font-bold text-white bg-[#006B3F] rounded-lg hover:bg-[#005632] transition-all",children:[e.jsx(xe,{className:"h-4 w-4"}),"Add First Entry"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsxs("thead",{children:[e.jsxs("tr",{className:"bg-gray-50/80 border-b border-gray-200",children:[e.jsx("th",{className:"px-5 py-3 text-left w-10",children:e.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500 cursor-pointer",checked:$.length>0&&$.every(t=>i.has(t.id)),onChange:Me})}),e.jsx("th",{className:"px-5 py-3 text-left text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:"Site Information"}),e.jsx("th",{className:"px-4 py-3 text-left text-[11px] font-semibold text-gray-500 uppercase tracking-wider hidden md:table-cell",children:"Incharges (Ops / HR)"}),c==="active"?e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-4 py-3 text-center text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:"Mgr Delay"}),e.jsx("th",{className:"px-4 py-3 text-center text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:"HR Delay"}),e.jsx("th",{className:"px-4 py-3 text-center text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:"Sharing Delay"}),e.jsx("th",{className:"px-4 py-3 text-center text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:"Date"})]}):e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-4 py-3 text-left text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:"Deleted By"}),e.jsx("th",{className:"px-4 py-3 text-left text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:"Reason"}),e.jsx("th",{className:"px-4 py-3 text-left text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:"Deleted At"})]}),e.jsx("th",{className:"px-4 py-3 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-wider w-24",children:"Actions"})]}),e.jsxs("tr",{className:"bg-white border-b border-gray-100",children:[e.jsx("td",{className:"px-5 py-2"}),e.jsx("td",{className:"px-5 py-2",children:e.jsx("input",{type:"text",placeholder:"Filter Site...",value:p.siteName,onChange:t=>O(a=>({...a,siteName:t.target.value})),className:"w-full text-[10px] px-2 py-1 bg-gray-50 border border-gray-200 rounded focus:border-emerald-500 outline-none transition-all"})}),e.jsx("td",{className:"px-4 py-2 hidden md:table-cell"}),c==="active"?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-4 py-2"}),e.jsx("td",{className:"px-4 py-2"}),e.jsx("td",{className:"px-4 py-2"}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs("select",{value:p.status,onChange:t=>O(a=>({...a,status:t.target.value})),className:"w-full text-[10px] px-1 py-1 bg-gray-50 border border-gray-200 rounded focus:border-emerald-500 outline-none transition-all font-bold text-gray-600",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"sent",children:"Sent"}),e.jsx("option",{value:"pending",children:"Pending"})]})}),e.jsx("td",{className:"px-4 py-2"})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-4 py-2"}),e.jsx("td",{className:"px-4 py-2"}),e.jsx("td",{className:"px-4 py-2"})]}),e.jsx("td",{className:"px-4 py-2"})]})]}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:$.map((t,a)=>{const r=V(t.managerReceivedDate,t.managerTentativeDate),d=V(t.hrReceivedDate,t.hrTentativeDate),x=V(t.invoiceSentDate,t.invoiceSharingTentativeDate),s=i.has(t.id);return e.jsxs("tr",{className:`hover:bg-gray-50/60 transition-all duration-100 group ${s?"bg-emerald-50/30":""}`,children:[e.jsx("td",{className:"px-5 py-3.5",children:e.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500 cursor-pointer",checked:s,onChange:()=>Be(t.id)})}),e.jsxs("td",{className:"px-5 py-3.5",children:[e.jsx("div",{className:"font-semibold text-gray-900 text-sm",children:t.siteName}),e.jsx("div",{className:"text-[11px] text-gray-400 mt-0.5",children:t.companyName||"—"}),t.billingCycle&&e.jsx("div",{className:"inline-block mt-1.5 px-1.5 py-0.5 rounded bg-emerald-50 text-emerald-700 text-[10px] font-bold uppercase tracking-tighter",children:t.billingCycle})]}),e.jsxs("td",{className:"px-4 py-3.5 hidden md:table-cell",children:[e.jsxs("div",{className:"text-xs text-gray-600 font-medium",children:["Ops: ",t.opsIncharge||"—"]}),e.jsxs("div",{className:"text-[11px] text-gray-400 mt-0.5",children:["HR: ",t.hrIncharge||"—"]})]}),c==="active"?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-4 py-3.5 text-center text-xs",children:e.jsx("span",{className:J(r),children:r!==null?`${r}d`:"—"})}),e.jsx("td",{className:"px-4 py-3.5 text-center text-xs",children:e.jsx("span",{className:J(d),children:d!==null?`${d}d`:"—"})}),e.jsx("td",{className:"px-4 py-3.5 text-center text-xs",children:e.jsx("span",{className:J(x),children:x!==null?`${x}d`:"—"})}),e.jsx("td",{className:"px-4 py-3.5 text-center",children:t.invoiceSentDate?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-emerald-50 text-emerald-700 text-[10px] font-bold",children:[e.jsx(he,{className:"h-3 w-3"}),"Sent"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-amber-50 text-amber-700 text-[10px] font-bold whitespace-nowrap",children:[e.jsx(me,{className:"h-3 w-3"}),"Pending"]})}),e.jsxs("td",{className:"px-4 py-3.5",children:[e.jsx("div",{className:"text-[11px] font-medium text-gray-900",children:w(v(t.createdAt),"dd MMM yyyy")}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx("span",{className:"text-[10px] text-gray-400",children:t.createdByName||"System"}),t.createdByRole&&e.jsx("span",{className:"px-1 py-0.5 rounded bg-gray-100 text-[10px] font-bold text-gray-500 uppercase border border-gray-200",children:t.createdByRole.replace("_"," ")})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("td",{className:"px-4 py-3.5",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-900",children:t.deletedByName||"Unknown"}),e.jsxs("div",{className:"text-[10px] text-gray-400 mt-0.5",children:["ID: ",t.deletedBy?.slice(0,8),"..."]})]}),e.jsx("td",{className:"px-4 py-3.5",children:e.jsxs("div",{className:"flex items-start gap-1.5",children:[e.jsx(Qe,{className:"h-3 w-3 text-rose-400 mt-0.5 shrink-0"}),e.jsxs("p",{className:"text-xs text-rose-600 font-medium leading-relaxed italic",children:['"',t.deletedReason||"No reason provided",'"']})]})}),e.jsxs("td",{className:"px-4 py-3.5",children:[e.jsx("div",{className:"text-xs font-medium text-gray-900",children:t.deletedAt?w(v(t.deletedAt),"dd MMM, HH:mm"):"—"}),e.jsx("div",{className:"text-[10px] text-gray-400 mt-0.5",children:"Auto-purge in 7 days"})]})]}),e.jsx("td",{className:"px-4 py-3.5 text-right",children:e.jsx("div",{className:"flex items-center justify-end gap-1",children:c==="active"?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>H(`/finance/attendance/edit/${t.id}`),className:"p-1.5 text-gray-400 hover:text-emerald-600 hover:bg-emerald-50 rounded-md transition-all h-8 w-8 flex items-center justify-center border border-transparent hover:border-emerald-100",title:"Edit",children:e.jsx(Xe,{className:"h-3.5 w-3.5"})}),e.jsx("button",{onClick:()=>{q(t),M(!1),S(!0)},className:"p-1.5 text-gray-400 hover:text-rose-600 hover:bg-rose-50 rounded-md transition-all h-8 w-8 flex items-center justify-center border border-transparent hover:border-rose-100",title:"Delete",children:e.jsx(Z,{className:"h-3.5 w-3.5"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Se(t.id),disabled:P===t.id||!C,className:"p-1.5 text-gray-400 hover:text-emerald-600 hover:bg-emerald-50 rounded-md transition-all h-8 w-8 flex items-center justify-center border border-transparent hover:border-emerald-100 disabled:opacity-50",title:"Restore",children:P===t.id?e.jsx(Y,{className:"h-3.5 w-3.5 animate-spin"}):e.jsx(ge,{className:"h-3.5 w-3.5"})}),e.jsx("button",{onClick:()=>De(t.id),disabled:!C,className:"p-1.5 text-gray-400 hover:text-rose-700 hover:bg-rose-50 rounded-md transition-all h-8 w-8 flex items-center justify-center border border-transparent hover:border-rose-100 disabled:opacity-50",title:"Permanent Delete",children:e.jsx(ye,{className:"h-3.5 w-3.5"})})]})})})]},t.id)})})]})}),z>1&&e.jsxs("div",{className:"px-5 py-3 border-t border-gray-100 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-400",children:"Rows per page:"}),e.jsxs("select",{value:j,onChange:t=>{je(Number(t.target.value)),k(1)},className:"h-7 px-2 text-[11px] font-bold text-gray-600 bg-gray-50 border border-gray-200 rounded outline-none focus:border-emerald-500 transition-all cursor-pointer",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:15,children:"15"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:50,children:"50"})]})]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Showing ",(f-1)*j+1,"–",Math.min(f*j,R.length)," of ",R.length]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>k(t=>Math.max(1,t-1)),disabled:f===1,className:"px-2.5 py-1 text-xs font-medium text-gray-500 bg-white border border-gray-200 rounded-md hover:bg-gray-50 disabled:opacity-40",children:"Prev"}),Array.from({length:Math.min(5,z)},(t,a)=>a+1).map(t=>e.jsx("button",{onClick:()=>k(t),className:`w-7 h-7 text-xs font-medium rounded-md transition-all ${t===f?"bg-[#006B3F] text-white":"text-gray-500 hover:bg-gray-50"}`,children:t},t)),e.jsx("button",{onClick:()=>k(t=>Math.min(z,t+1)),disabled:f===z,className:"px-2.5 py-1 text-xs font-medium text-gray-500 bg-white border border-gray-200 rounded-md hover:bg-gray-50 disabled:opacity-40",children:"Next"})]})]})]})]}),F.length>0&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-5xl max-h-[85vh] flex flex-col shadow-2xl overflow-hidden border border-gray-200",children:[e.jsxs("div",{className:"px-6 py-5 border-b border-gray-100 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Attendance Import Preview"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-0.5",children:[F.length," records ready to import"]})]}),e.jsx("button",{onClick:()=>A([]),className:"p-1.5 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Je,{className:"h-5 w-5 text-gray-400"})})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-5 py-3 text-left text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:"Site Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:"Company"}),e.jsx("th",{className:"px-4 py-3 text-left text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:"Billing"}),e.jsx("th",{className:"px-4 py-3 text-left text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:"Ops Incharge"}),e.jsx("th",{className:"px-4 py-3 text-left text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:"HR Incharge"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:F.map((t,a)=>e.jsxs("tr",{className:"hover:bg-gray-50/50",children:[e.jsx("td",{className:"px-5 py-3 font-semibold text-gray-900",children:t.siteName}),e.jsx("td",{className:"px-4 py-3 text-xs text-gray-600",children:t.companyName}),e.jsx("td",{className:"px-4 py-3 text-xs text-gray-600",children:t.billingCycle}),e.jsx("td",{className:"px-4 py-3 text-xs text-gray-600",children:t.opsIncharge}),e.jsx("td",{className:"px-4 py-3 text-xs text-gray-600",children:t.hrIncharge})]},a))})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-100 bg-gray-50/50 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>A([]),className:"px-5 py-2 text-sm font-semibold text-gray-600 bg-white border border-gray-200 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsxs("button",{onClick:Ae,disabled:ae,className:"inline-flex items-center gap-1.5 px-6 py-2 text-sm font-bold text-white bg-emerald-600 rounded-lg hover:bg-emerald-700 transition-all shadow-sm disabled:opacity-50",children:[ae&&e.jsx(Y,{className:"h-3.5 w-3.5 animate-spin"}),"Confirm Import"]})]})]})}),i.size>0&&e.jsx("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 animate-in fade-in slide-in-from-bottom-4 duration-300",children:e.jsxs("div",{className:"bg-gray-900 text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-6",children:[e.jsxs("span",{className:"text-sm font-medium border-r border-gray-700 pr-6",children:[i.size," records selected"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[c==="active"?e.jsxs("button",{onClick:()=>{M(!0),S(!0)},className:"flex items-center gap-2 px-4 py-1.5 bg-red-500 hover:bg-red-600 rounded-full text-xs font-bold transition-all",children:[e.jsx(Z,{size:14}),"Delete Selected"]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:Re,disabled:P==="bulk",className:"flex items-center gap-2 px-4 py-1.5 bg-emerald-600 hover:bg-emerald-700 rounded-full text-xs font-bold transition-all disabled:opacity-50",children:[e.jsx(ge,{size:14,className:P==="bulk"?"animate-spin":""}),"Restore Selected"]}),e.jsxs("button",{onClick:Ce,disabled:!C,className:"flex items-center gap-2 px-4 py-1.5 bg-rose-600 hover:bg-rose-700 rounded-full text-xs font-bold transition-all disabled:opacity-50",children:[e.jsx(ye,{size:14}),"Permanently Delete"]})]}),e.jsx("button",{onClick:()=>g(new Set),className:"px-4 py-1.5 hover:bg-white/10 rounded-full text-xs font-medium transition-all",children:"Cancel"})]})]})}),we&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden animate-in zoom-in-95 duration-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center text-red-600",children:e.jsx(Z,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:W?`Delete ${i.size} Records`:"Delete Record"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Records will be moved to the Deletion Log."})]})]}),!W&&D&&e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6 border border-gray-100",children:[e.jsx("p",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-2",children:"Selected Site"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:D.siteName}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:D.companyName})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Reason for Deletion"}),e.jsx("textarea",{value:Q,onChange:t=>X(t.target.value),placeholder:"Enter reason...",className:"w-full h-24 px-4 py-3 bg-gray-50 border-2 border-transparent focus:border-red-500 rounded-xl outline-none transition-all resize-none text-sm"})]}),e.jsxs("div",{className:"bg-amber-50 rounded-xl p-4 border border-amber-100 mb-6 flex items-start gap-3",children:[e.jsx(pe,{className:"text-amber-600 flex-shrink-0 mt-0.5",size:16}),e.jsx("p",{className:"text-xs text-amber-800 leading-relaxed font-medium",children:"Records can be restored from the Deletion Log within 7 days. After 7 days, they will be permanently deleted."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{S(!1),q(null),M(!1)},className:"flex-1 py-3 px-4 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl text-sm font-bold transition-all",children:"Cancel"}),e.jsx("button",{onClick:()=>Ne(Q),disabled:!Q.trim()||ie,className:"flex-2 py-3 px-6 bg-red-600 hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-xl text-sm font-bold shadow-lg shadow-red-200 transition-all flex items-center justify-center gap-2",children:ie?"Deleting...":"Confirm Deletion"})]})]})})}),_&&e.jsx(ze,{message:_.message,type:_.type,onDismiss:()=>n(null)})]})};export{dt as default};
