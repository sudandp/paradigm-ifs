import{c as ue,o as rs,d as is,m as V,j as e,I as w,C as x,B as y,q as Le,e as H,O as fe,T as pe,n as ls,Z as Me,k as os}from"./index-D5q3SS3D.js";import{b as p,R as cs,u as ds}from"./react-vendor-BUaIliXj.js";import{S as _}from"./Select-Dz12MdxG.js";import{D as De}from"./DatePicker-D2ulOwJx.js";import{a2 as ie,F as me,T as Ve,aM as ms,as as ke,ao as se,bq as us,d as Je,$ as ge,au as je,aJ as le,at as te,R as Ke,Q as ps,br as hs,bs as xs,K as gs,bt as js,be as fs,bu as bs,ax as Qe,aj as Fe,ak as $e,C as Ye,a$ as Ze,bv as _e,w as ys,p as Ns,bw as vs,z as Cs,bx as Ss,af as ws,by as Is,bz as As,bA as ks,a5 as Ds,aG as $s,I as Be,D as ze,av as Ts,j as Ge}from"./ui-vendor-B8EvWqdc.js";import{S as Es}from"./SiteConfigurationForm-2Dtz1cgY.js";import{M as Os}from"./Modal-CR2aBU6L.js";import{U as X}from"./UploadDocument-BAL6UInC.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./utils-vendor-DmorxLnX.js";import"./supabase-7WG3J4rU.js";import"./CameraCaptureModal-DQDGRnEP.js";const Rs=is({id:H().required(),name:H().required("Client name is required"),organizationId:H().optional(),location:H().optional(),registeredAddress:H().optional(),registrationType:H().oneOf(["CIN","ROC","ROF","Society","Trust",""]).optional(),registrationNumber:H().optional(),gstNumber:H().optional().nullable().matches(/^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/,"Invalid GST Number format").optional(),panNumber:H().transform(a=>a?.toUpperCase()||"").matches(/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/,"Invalid PAN format").optional(),email:H().email("Invalid email format").optional(),eShramNumber:H().optional(),shopAndEstablishmentCode:H().optional(),epfoCode:H().optional(),esicCode:H().optional(),psaraLicenseNumber:H().optional(),psaraValidTill:H().optional().nullable(),insuranceIds:Le().of(H().required()).optional(),policyIds:Le().of(H().required()).optional()}).defined(),Ps=({isOpen:a,onClose:t,onSave:s,initialData:r,companyName:c})=>{const[n,i]=p.useState("General"),[g,N]=p.useState([]),[j,f]=p.useState([]),[d,O]=p.useState(!0),{register:b,handleSubmit:z,formState:{errors:R},reset:P,control:v}=ue({resolver:rs(Rs)}),F=!!r;p.useEffect(()=>{a&&(O(!0),Promise.all([V.getPolicies(),V.getInsurances()]).then(([u,l])=>{N(u),f(l),O(!1)}),P(r||{id:`new_${Date.now()}`,name:"",location:"",registeredAddress:"",registrationType:"",registrationNumber:"",gstNumber:"",panNumber:"",email:"",eShramNumber:"",shopAndEstablishmentCode:"",epfoCode:"",esicCode:"",psaraLicenseNumber:"",psaraValidTill:"",insuranceIds:[],policyIds:[]}))},[r,P,a]);const S=u=>{s(u)};if(!a)return null;const h=({tabName:u})=>e.jsx("button",{type:"button",onClick:()=>i(u),className:`px-4 py-2 text-sm font-medium rounded-t-lg border-b-2 ${n===u?"border-accent text-accent":"border-transparent text-muted hover:text-primary-text"}`,children:u});return e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto bg-black bg-opacity-50 p-4",onClick:t,children:e.jsx("div",{className:"bg-card rounded-xl shadow-card p-6 w-full max-w-3xl my-8 mx-auto animate-fade-in-scale",onClick:u=>u.stopPropagation(),children:e.jsxs("form",{onSubmit:z(S),children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-primary-text",children:F?"Edit Client":"Add New Client"}),e.jsxs("p",{className:"text-sm text-muted",children:["for ",c]})]}),e.jsx("div",{className:"border-b border-border mb-6",children:e.jsxs("nav",{className:"-mb-px flex space-x-4",children:[e.jsx(h,{tabName:"General"}),e.jsx(h,{tabName:"Registration"}),e.jsx(h,{tabName:"Compliance"}),e.jsx(h,{tabName:"Policies & Insurance"})]})}),e.jsxs("div",{className:"space-y-6 min-h-[300px]",children:[n==="General"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(w,{label:"Client Name (as per document)",id:"name",registration:b("name"),error:R.name?.message}),e.jsx(w,{label:"Location / City",id:"location",registration:b("location"),error:R.location?.message}),e.jsx(w,{label:"Registered Address",id:"registeredAddress",registration:b("registeredAddress"),error:R.registeredAddress?.message})]}),n==="Registration"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4",children:[e.jsxs(_,{label:"Registration Type",id:"registrationType",registration:b("registrationType"),error:R.registrationType?.message,children:[e.jsx("option",{value:"",children:"Select Type"}),e.jsx("option",{value:"CIN",children:"CIN"}),e.jsx("option",{value:"ROC",children:"ROC"}),e.jsx("option",{value:"ROF",children:"ROF"}),e.jsx("option",{value:"Society",children:"Society"}),e.jsx("option",{value:"Trust",children:"Trust"})]}),e.jsx(w,{label:"Registration Number",id:"registrationNumber",registration:b("registrationNumber"),error:R.registrationNumber?.message}),e.jsx(w,{label:"GST Number",id:"gstNumber",registration:b("gstNumber"),error:R.gstNumber?.message}),e.jsx(w,{label:"PAN Number",id:"panNumber",registration:b("panNumber"),error:R.panNumber?.message}),e.jsx(w,{label:"Email Address",id:"email",type:"email",registration:b("email"),error:R.email?.message})]}),n==="Compliance"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4",children:[e.jsx(w,{label:"E-Shram Number",id:"eShramNumber",registration:b("eShramNumber"),error:R.eShramNumber?.message}),e.jsx(w,{label:"Shop & Establishment Code",id:"shopAndEstablishmentCode",registration:b("shopAndEstablishmentCode"),error:R.shopAndEstablishmentCode?.message}),e.jsx(w,{label:"EPFO Code",id:"epfoCode",registration:b("epfoCode"),error:R.epfoCode?.message}),e.jsx(w,{label:"ESIC Code",id:"esicCode",registration:b("esicCode"),error:R.esicCode?.message}),e.jsx(w,{label:"PSARA License Number",id:"psaraLicenseNumber",registration:b("psaraLicenseNumber"),error:R.psaraLicenseNumber?.message}),e.jsx(x,{name:"psaraValidTill",control:v,render:({field:u})=>e.jsx(De,{label:"PSARA Valid Till",id:"psaraValidTill",value:u.value,onChange:u.onChange,error:R.psaraValidTill?.message})})]}),n==="Policies & Insurance"&&(d?e.jsx(ie,{className:"mx-auto h-6 w-6 animate-spin text-muted"}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsx(x,{name:"policyIds",control:v,render:({field:u})=>e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Policies"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto p-3 border rounded-lg bg-page",children:g.map(l=>e.jsxs("label",{className:"flex items-center p-2 rounded-md hover:bg-card transition-colors",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 text-accent border-gray-300 rounded focus:ring-accent",checked:u.value?.includes(l.id),onChange:U=>{const q=U.target.checked?[...u.value||[],l.id]:(u.value||[]).filter(Q=>Q!==l.id);u.onChange(q)}}),e.jsx("span",{className:"ml-3 text-sm",children:l.name})]},l.id))})]})}),e.jsx(x,{name:"insuranceIds",control:v,render:({field:u})=>e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Insurance"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto p-3 border rounded-lg bg-page",children:j.map(l=>e.jsxs("label",{className:"flex items-center p-2 rounded-md hover:bg-card transition-colors",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 text-accent border-gray-300 rounded focus:ring-accent",checked:u.value?.includes(l.id),onChange:U=>{const q=U.target.checked?[...u.value||[],l.id]:(u.value||[]).filter(Q=>Q!==l.id);u.onChange(q)}}),e.jsxs("span",{className:"ml-3 text-sm",children:[l.type," - ",l.provider]})]},l.id))})]})})]}))]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-border flex justify-end space-x-3",children:[e.jsx(y,{type:"button",onClick:t,variant:"secondary",children:"Cancel"}),e.jsx(y,{type:"submit",children:F?"Save Changes":"Add Client"})]})]})})})},Ie=({number:a,title:t,children:s})=>e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-lg text-primary-text mb-2",children:["Step ",a,": ",t]}),e.jsx("div",{className:"text-sm text-muted space-y-2",children:s})]}),Fs=({isOpen:a,onClose:t})=>a?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 p-4",onClick:t,children:e.jsxs("div",{className:"bg-card rounded-xl shadow-card w-full max-w-3xl my-8 animate-fade-in-scale flex flex-col",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b flex items-center gap-3",children:[e.jsx(me,{className:"h-6 w-6 text-accent"}),e.jsx("h3",{className:"text-xl font-bold text-primary-text",children:"How to Use Import Templates"})]}),e.jsxs("div",{className:"flex-grow overflow-y-auto p-6 space-y-6 max-h-[70vh]",children:[e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(Ve,{className:"h-5 w-5 text-red-500 mr-3 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-red-800",children:"The Golden Rule: Do Not Modify the Template Structure"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:"You must **NEVER** add, delete, rename, or reorder columns. Any changes to the header row will cause the import to fail. This rule ensures data integrity."})]})]})}),e.jsxs(Ie,{number:1,title:"Get the Template",children:[e.jsx("p",{children:"You have two options for getting a file to work with:"}),e.jsxs("ul",{className:"list-disc list-inside pl-4 space-y-2",children:[e.jsxs("li",{children:[e.jsxs("strong",{className:"text-primary-text flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"})," Download Template:"]}),e.jsx("span",{children:"Provides a blank CSV file with only the correct header row. Use this for adding **new** records in bulk."})]}),e.jsxs("li",{children:[e.jsxs("strong",{className:"text-primary-text flex items-center gap-2",children:[e.jsx(ms,{className:"h-4 w-4"})," Export Data:"]}),e.jsx("span",{children:"Provides a CSV file filled with all the current data from the system. Use this for **updating existing** records in bulk."})]})]})]}),e.jsx(Ie,{number:2,title:"Edit Your Data",children:e.jsxs("ul",{className:"list-disc list-inside pl-4 space-y-2",children:[e.jsxs("li",{children:[e.jsxs("strong",{className:"text-primary-text flex items-center gap-2",children:[e.jsx(ke,{className:"h-4 w-4"})," To Update Existing Data:"]}),e.jsx("span",{children:"Use the file from **Export Data**. Find the row you want to change and edit its values. Do **NOT** edit the ID columns (e.g., `GroupId`, `EntityId`). These are used by the system to identify records."})]}),e.jsxs("li",{children:[e.jsxs("strong",{className:"text-primary-text flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4"})," To Add New Data:"]}),e.jsx("span",{children:"Add a new row at the bottom of the file. Leave the ID columns blank; the system will generate them automatically. Fill in all other required information."})]}),e.jsxs("li",{children:[e.jsx("strong",{className:"text-primary-text",children:"Complex Data (JSON):"}),e.jsx("span",{children:"For Site Configuration, some columns like `agreementDetails` contain complex data. This is exported as a JSON text string. Only edit this text if you are familiar with JSON, as incorrect formatting will cause the import to fail."})]})]})}),e.jsx(Ie,{number:3,title:"Save and Import",children:e.jsxs("ul",{className:"list-disc list-inside pl-4 space-y-2",children:[e.jsxs("li",{children:[e.jsx("strong",{className:"text-primary-text",children:"Save as CSV:"}),e.jsx("span",{children:"After making your changes, save your file. If you are using Excel or Google Sheets, make sure to **Save As** or **Download As** a **CSV (Comma-Separated Values)** file."})]}),e.jsxs("li",{children:[e.jsxs("strong",{className:"text-primary-text flex items-center gap-2",children:[e.jsx(us,{className:"h-4 w-4"})," Import:"]}),e.jsx("span",{children:"Go back to the application, click **Import**, and select the CSV file you just saved."})]})]})}),e.jsx(Ie,{number:4,title:"Review Feedback",children:e.jsxs("ul",{className:"list-disc list-inside pl-4 space-y-2",children:[e.jsxs("li",{children:[e.jsxs("strong",{className:"text-green-600 flex items-center gap-2",children:[e.jsx(Je,{className:"h-4 w-4"})," Success:"]}),e.jsx("span",{children:"You will see a success message indicating how many records were imported."})]}),e.jsxs("li",{children:[e.jsxs("strong",{className:"text-red-600 flex items-center gap-2",children:[e.jsx(Ve,{className:"h-4 w-4"})," Error:"]}),e.jsx("span",{children:'If the import fails, a specific error message will appear. The most common error is a "Header mismatch," which means you have violated the Golden Rule. If this happens, download a fresh template and carefully copy your data into it.'})]})]})})]}),e.jsx("div",{className:"p-4 border-t flex justify-end",children:e.jsx(y,{onClick:t,children:"Close"})})]})}):null,oe=({title:a})=>e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-8 bg-page rounded-lg min-h-[400px]",children:[e.jsx("h3",{className:"text-xl font-semibold text-primary-text mb-2",children:a}),e.jsx("p",{className:"text-muted max-w-sm",children:"Configuration for this section will be available here. The form details will be provided in a future update."})]}),Ue=["Site Name","Designation","Quantity","Billing Rate","Billing Model","Holiday Billing Policy","Holiday Payment Policy","Uniform Deduction"],Ls=a=>{if(a.length===0)return"";const t=Object.keys(a[0]);return[t.join(","),...a.map(r=>t.map(c=>{const n=String(r[c]??"");return n.includes(",")||n.includes('"')||n.includes(`
`)?`"${n.replace(/"/g,'""')}"`:n}).join(","))].join(`
`)},Ms=a=>{const t=a.trim().replace(/\r/g,"").split(`
`);if(t.length<2)return[];const s=t[0].split(",").map(c=>c.trim()),r=[];for(let c=1;c<t.length;c++){const n={},i=t[c].match(new RegExp('(?<=,|^)(?:"(?:[^"]|"")*"|[^,]*)',"g"))||[];s.forEach((g,N)=>{let j=(i[N]||"").trim();j.startsWith('"')&&j.endsWith('"')&&(j=j.substring(1,j.length-1).replace(/""/g,'""')),n[g]=j}),r.push(n)}return r},Vs=()=>{const[a,t]=p.useState([]),[s,r]=p.useState(!0),[c,n]=p.useState(!1),[i,g]=p.useState({}),[N,j]=p.useState(null),f=p.useRef(null),{register:d,control:O,handleSubmit:b,watch:z,setValue:R}=ue({defaultValues:{resources:[],serviceChargePercentage:10}}),{fields:P,append:v,remove:F,replace:S}=fe({control:O,name:"resources"});p.useEffect(()=>{V.getOrganizations().then(t).finally(()=>r(!1))},[]);const h=async L=>{if(!L){S([]);return}n(!0);try{const T=await V.getManpowerDetails(L),K=T.filter(M=>M.count>0).map(M=>({id:`res_${M.designation.replace(/\s/g,"_")}_${Date.now()}`,siteId:L,designation:M.designation,quantity:M.count,billingRate:null,billingModel:"Per Month",holidayBillingPolicy:"",holidayPaymentPolicy:"",uniformDeduction:"Yes"}));if(!i[L]){const M=T.map(B=>B.designation);g(B=>({...B,[L]:M}))}S(K)}catch(T){console.error("Failed to load manpower",T),j({message:"Failed to load manpower details.",type:"error"})}finally{n(!1)}},u=async(L,T)=>{if(R(`resources.${T}.designation`,""),L&&!i[L])try{const M=(await V.getManpowerDetails(L)).map(B=>B.designation);g(B=>({...B,[L]:M}))}catch(K){console.error(`Failed to load designations for site ${L}`,K)}},l=z("resources"),U=z("serviceChargePercentage"),q=()=>{v({id:`res_${Date.now()}`,siteId:"",designation:"",quantity:1,billingRate:0,billingModel:"Per Month",holidayBillingPolicy:"",holidayPaymentPolicy:"",uniformDeduction:"Yes"})},{subTotal:Q,serviceCharge:Y,grandTotal:J}=cs.useMemo(()=>{const T=(Array.isArray(l)?l:[]).reduce((ae,he)=>{const ve=Number(he.quantity)||0,ne=Number(he.billingRate)||0;return ae+ve*ne},0),K=Number(U)||0,M=T*(K/100),B=T+M;return{subTotal:T,serviceCharge:M,grandTotal:B}},[l,U]),be=()=>{const L=[Object.fromEntries(Ue.map(B=>[B,""]))],T=Ls(L),K=new Blob([T],{type:"text/csv;charset=utf-8;"}),M=document.createElement("a");M.href=URL.createObjectURL(K),M.setAttribute("download","costing_resource_template.csv"),document.body.appendChild(M),M.click(),document.body.removeChild(M)},ce=L=>{const T=L.target.files?.[0];if(!T)return;const K=new FileReader;K.onload=async M=>{try{const B=M.target?.result;if(!B)throw new Error("File is empty.");const ae=Ms(B);if(ae.length===0)throw new Error("No data rows found in CSV.");const he=Object.keys(ae[0]);if(!Ue.every(G=>he.includes(G)))throw new Error("CSV file is missing required headers.");const ne=new Map(a.map(G=>[G.shortName.toLowerCase(),G.id])),Ce=new Set;for(const G of ae){const ee=G["Site Name"]?.trim().toLowerCase();if(ee){const Z=ne.get(ee);typeof Z=="string"&&Ce.add(Z)}}const Se=[...Ce].filter(G=>!i[G]);if(Se.length>0){const G=Se.map(Z=>V.getManpowerDetails(Z).then(o=>({siteId:Z,designations:o.map(m=>m.designation)}))),ee=await Promise.all(G);g(Z=>{const o={...Z};return ee.forEach(m=>{o[m.siteId]=m.designations}),o})}const Ne=ae.map(G=>{const ee=G["Site Name"]?.trim().toLowerCase(),Z=ee?ne.get(ee):void 0;return Z?{id:`res_imported_${Date.now()}_${Math.random()}`,siteId:Z,designation:G.Designation||"",quantity:parseFloat(G.Quantity)||0,billingRate:parseFloat(G["Billing Rate"])||0,billingModel:G["Billing Model"]||"Per Month",holidayBillingPolicy:G["Holiday Billing Policy"]||"",holidayPaymentPolicy:G["Holiday Payment Policy"]||"",uniformDeduction:G["Uniform Deduction"]||"Yes"}:null}).filter(G=>G!==null);S(Ne),j({message:`Successfully imported ${Ne.length} resources.`,type:"success"})}catch(B){j({message:B.message||"Failed to import CSV.",type:"error"})}finally{L.target&&(L.target.value="")}},K.readAsText(T)},ye=L=>{console.log("Saving Costing & Resource Data:",L),j({message:"Configuration saved successfully (mocked).",type:"success"})};return e.jsxs("form",{onSubmit:b(ye),className:"space-y-6",children:[N&&e.jsx(pe,{message:N.message,type:N.type,onDismiss:()=>j(null)}),e.jsx("input",{type:"file",ref:f,className:"hidden",accept:".csv",onChange:ce}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between md:items-center gap-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-primary-text",children:"Costing & Resource Configuration"}),e.jsxs("div",{className:"relative flex-1 md:max-w-xs",children:[e.jsxs(_,{label:"Load Manpower from Site",id:"site-selector",onChange:L=>h(L.target.value),disabled:s||c,children:[e.jsx("option",{value:"",children:"-- Select a Site --"}),a.map(L=>e.jsx("option",{value:L.id,children:L.shortName},L.id))]}),c&&e.jsx(ie,{className:"absolute right-3 top-9 h-5 w-5 animate-spin text-muted"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 md:flex md:flex-wrap md:justify-end md:gap-2",children:[e.jsxs(y,{type:"button",variant:"outline",onClick:be,className:"!p-2 justify-center md:!px-4 md:!py-2",title:"Download Template",children:[e.jsx(ge,{className:"h-5 w-5 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Template"})]}),e.jsxs(y,{type:"button",variant:"outline",onClick:()=>f.current?.click(),className:"!p-2 justify-center md:!px-4 md:!py-2",title:"Import",children:[e.jsx(je,{className:"h-5 w-5 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Import"})]}),e.jsxs(y,{type:"button",variant:"outline",onClick:q,className:"!p-2 justify-center md:!px-4 md:!py-2",title:"Add Resource",children:[e.jsx(se,{className:"h-5 w-5 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Add Resource"})]}),e.jsxs(y,{type:"submit",className:"!p-2 justify-center md:!px-4 md:!py-2",title:"Save",children:[e.jsx(le,{className:"h-5 w-5 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Save"})]})]}),e.jsx("div",{className:"space-y-4",children:P.map((L,T)=>{const K=z(`resources.${T}.siteId`);return e.jsxs("div",{className:"p-4 border border-border rounded-xl relative bg-page/50",children:[e.jsx(y,{type:"button",variant:"icon",size:"sm",onClick:()=>F(T),className:"absolute top-2 right-2","aria-label":"Remove Resource",children:e.jsx(te,{className:"h-4 w-4 text-red-500"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(x,{control:O,name:`resources.${T}.siteId`,render:({field:M})=>e.jsxs(_,{label:"Site",id:`res-site-${T}`,...M,onChange:B=>{M.onChange(B),u(B.target.value,T)},children:[e.jsx("option",{value:"",children:"Select Site"}),a.map(B=>e.jsx("option",{value:B.id,children:B.shortName},B.id))]})}),e.jsxs(_,{label:"Designation",id:`res-desig-${T}`,...d(`resources.${T}.designation`),disabled:!K,children:[e.jsx("option",{value:"",children:"Select Designation"}),(i[K]||[]).map(M=>e.jsx("option",{value:M,children:M},M))]}),e.jsx(w,{label:"Quantity",id:`res-qty-${T}`,type:"number",step:"0.01",...d(`resources.${T}.quantity`)}),e.jsx(w,{label:"Billing Rate",id:`res-rate-${T}`,type:"number",step:"0.01",...d(`resources.${T}.billingRate`)}),e.jsxs(_,{label:"Billing Model",id:`res-billing-${T}`,...d(`resources.${T}.billingModel`),children:[e.jsx("option",{children:"Per Month"}),e.jsx("option",{children:"Per Day"}),e.jsx("option",{children:"Per Hour"}),e.jsx("option",{children:"Lumpsum"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:`res-hol-bill-${T}`,className:"block text-sm font-medium text-muted",children:"Holiday Billing Policy"}),e.jsx("textarea",{id:`res-hol-bill-${T}`,...d(`resources.${T}.holidayBillingPolicy`),rows:3,className:"mt-1 form-input"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`res-hol-pay-${T}`,className:"block text-sm font-medium text-muted",children:"Holiday Payment Policy"}),e.jsx("textarea",{id:`res-hol-pay-${T}`,...d(`resources.${T}.holidayPaymentPolicy`),rows:3,className:"mt-1 form-input"})]}),e.jsxs(_,{label:"Uniform Deduction",id:`res-uniform-${T}`,...d(`resources.${T}.uniformDeduction`),children:[e.jsx("option",{children:"Yes"}),e.jsx("option",{children:"No"})]})]})]},L.id)})}),P.length>0&&e.jsx("div",{className:"flex justify-end pt-4 border-t border-border",children:e.jsxs("div",{className:"w-full max-w-sm space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted font-medium",children:"Sub Total"}),e.jsx("span",{className:"font-semibold text-primary-text",children:Q.toLocaleString("en-IN",{style:"currency",currency:"INR"})})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted font-medium",children:"Service Charges"}),e.jsx("div",{className:"w-20",children:e.jsx(w,{"aria-label":"Service charge percentage",id:"service-charge-perc",type:"number",...d("serviceChargePercentage")})}),e.jsx("span",{className:"text-muted font-medium",children:"%"})]}),e.jsx("span",{className:"font-semibold text-primary-text",children:Y.toLocaleString("en-IN",{style:"currency",currency:"INR"})})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 mt-2 border-t-2 border-primary-text",children:[e.jsx("span",{className:"font-bold text-lg",children:"Grand Total"}),e.jsx("span",{className:"font-bold text-lg",children:J.toLocaleString("en-IN",{style:"currency",currency:"INR"})})]})]})}),P.length===0&&e.jsx("div",{className:"text-center p-8 text-muted bg-page rounded-lg",children:s?e.jsx(ie,{className:"h-5 w-5 animate-spin mx-auto"}):'Select a site to load manpower or click "Add Resource" to begin.'})]})},Xe=["Department","Designation","Permanent ID","Temporary ID"],_s=a=>{const t=Xe.join(","),s=a.map(r=>[r.department,r.designation,r.permanentId,r.temporaryId].map(c=>{const n=String(c??"");return n.includes(",")?`"${n}"`:n}).join(","));return[t,...s].join(`
`)},Bs=a=>{const t=a.trim().replace(/\r/g,"").split(`
`);if(t.length<2)return[];const s=t[0].split(",").map(c=>c.trim()),r={};return s.forEach((c,n)=>{const i=c.toLowerCase().replace(/\s/g,"");r[i]=n}),t.slice(1).map(c=>{const n=c.split(","),i=g=>{for(const N of g){const j=r[N.toLowerCase().replace(/\s/g,"")];if(j!==void 0){let f=(n[j]||"").trim();return f.startsWith('"')&&f.endsWith('"')&&(f=f.substring(1,f.length-1).replace(/""/g,'"')),f}}return""};return{department:i(["Department"]),designation:i(["Designation"]),permanentId:i(["Permanent ID","PermanentId"]),temporaryId:i(["Temporary ID","TemporaryId"])}})},zs=()=>{const[a,t]=p.useState(!0),[s,r]=p.useState(null),c=p.useRef(null),{register:n,control:i,handleSubmit:g,reset:N,watch:j}=ue({defaultValues:{series:[]}}),{append:f,remove:d,replace:O}=fe({control:i,name:"series"});p.useEffect(()=>{t(!0),V.getBackOfficeIdSeries().then(h=>N({series:h})).catch(()=>r({message:"Failed to load data.",type:"error"})).finally(()=>t(!1))},[N]);const b=j("series"),z=p.useMemo(()=>Array.isArray(b)?b.reduce((h,u,l)=>{const U=u.department||"Uncategorized";return h[U]||(h[U]=[]),h[U].push({...u,originalIndex:l}),h},{}):{},[b]),R=()=>{f({id:`new_${Date.now()}`,department:"",designation:"",permanentId:"",temporaryId:""})},P=async h=>{try{await V.updateBackOfficeIdSeries(h.series),r({message:"Configuration saved successfully.",type:"success"})}catch{r({message:"Failed to save configuration.",type:"error"})}},v=()=>{if(!Array.isArray(b)||b.length===0){r({message:"No data to export.",type:"error"});return}const h=_s(b),u=new Blob([h],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a");l.href=URL.createObjectURL(u),l.setAttribute("download","back_office_id_series.csv"),document.body.appendChild(l),l.click(),document.body.removeChild(l)},F=()=>{const h=Xe.join(","),u=new Blob([h],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a");l.href=URL.createObjectURL(u),l.setAttribute("download","id_series_template.csv"),document.body.appendChild(l),l.click(),document.body.removeChild(l)},S=h=>{const u=h.target.files?.[0];if(!u)return;const l=new FileReader;l.onload=U=>{try{const q=U.target?.result,Y=Bs(q).map(J=>({id:`imported_${Date.now()}_${Math.random()}`,department:J.department||"",designation:J.designation||"",permanentId:J.permanentId||"",temporaryId:J.temporaryId||""}));O(Y),r({message:`Imported ${Y.length} records.`,type:"success"})}catch(q){r({message:q.message||"Failed to import CSV.",type:"error"})}finally{h.target&&(h.target.value="")}},l.readAsText(u)};return e.jsxs("form",{onSubmit:g(P),className:"bg-card p-6 rounded-xl shadow-card",children:[s&&e.jsx(pe,{message:s.message,type:s.type,onDismiss:()=>r(null)}),e.jsx("input",{type:"file",ref:c,className:"hidden",accept:".csv",onChange:S}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-primary-text",children:"Back Office Department & Emp ID Series"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(y,{type:"button",variant:"outline",onClick:F,children:[e.jsx(me,{className:"mr-2 h-4 w-4"})," Template"]}),e.jsxs(y,{type:"button",variant:"outline",onClick:()=>c.current?.click(),children:[e.jsx(je,{className:"mr-2 h-4 w-4"})," Import"]}),e.jsxs(y,{type:"button",variant:"outline",onClick:v,children:[e.jsx(ge,{className:"mr-2 h-4 w-4"})," Export"]}),e.jsxs(y,{type:"submit",children:[e.jsx(le,{className:"mr-2 h-4 w-4"})," Save"]})]})]}),e.jsx("div",{className:"space-y-6",children:a?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(ie,{className:"h-8 w-8 animate-spin text-accent"})}):Object.keys(z).length===0?e.jsx("div",{className:"text-center p-8 text-muted bg-page rounded-lg",children:'No ID series defined. Click "Add Designation" to begin.'}):Object.entries(z).map(([h,u])=>e.jsxs("div",{className:"border border-border rounded-xl",children:[e.jsx("div",{className:"p-4 bg-page rounded-t-xl",children:e.jsx(w,{"aria-label":`Department for ${h}`,id:`series.${u[0].originalIndex}.department`,...n(`series.${u[0].originalIndex}.department`),className:"font-semibold text-lg !border-0 !p-0 !bg-transparent focus:!ring-0"})}),e.jsx("div",{className:"space-y-3 p-4",children:Array.isArray(u)&&u.map(l=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-10 gap-2 items-center",children:[e.jsx("div",{className:"md:col-span-3",children:e.jsx(w,{placeholder:"Designation","aria-label":`Designation for ${h}`,id:`series.${l.originalIndex}.designation`,...n(`series.${l.originalIndex}.designation`)})}),e.jsx("div",{className:"md:col-span-3",children:e.jsx(w,{placeholder:"Permanent ID","aria-label":`Permanent ID for ${l.designation}`,id:`series.${l.originalIndex}.permanentId`,...n(`series.${l.originalIndex}.permanentId`)})}),e.jsx("div",{className:"md:col-span-3",children:e.jsx(w,{placeholder:"Temporary ID","aria-label":`Temporary ID for ${l.designation}`,id:`series.${l.originalIndex}.temporaryId`,...n(`series.${l.originalIndex}.temporaryId`)})}),e.jsx("div",{className:"md:col-span-1 text-right",children:e.jsx(y,{type:"button",variant:"icon",size:"sm",onClick:()=>d(l.originalIndex),"aria-label":`Remove ${l.designation}`,title:`Remove ${l.designation}`,children:e.jsx(te,{className:"h-4 w-4 text-red-500"})})})]},l.id))})]},h))}),e.jsxs(y,{type:"button",onClick:R,variant:"outline",className:"mt-6",children:[e.jsx(se,{className:"mr-2 h-4 w-4"})," Add Designation"]})]})},es=["Department","Designation","Permanent ID","Temporary ID","Monthly Salary"],Gs=a=>{const t=es.join(","),s=a.map(r=>[r.department,r.designation,r.permanentId,r.temporaryId,r.monthlySalary].map(c=>{const n=String(c??"");return n.includes(",")||n.includes('"')||n.includes(`
`)?`"${n.replace(/"/g,'""')}"`:n}).join(","));return[t,...s].join(`
`)},Us=a=>{const t=a.trim().replace(/\r/g,"").split(`
`);if(t.length<2)return[];const s=t[0].split(",").map(n=>n.trim().replace(/"/g,"")),r={};s.forEach((n,i)=>{const g=n.toLowerCase().replace(/\s/g,"");r[g]=i});const c=[];for(let n=1;n<t.length;n++){const i=t[n].match(new RegExp('(?<=,|^)(?:"(?:[^"]|"")*"|[^,]*)',"g"))||[],g=f=>{for(const d of f){const O=r[d.toLowerCase().replace(/\s/g,"")];if(O!==void 0){let b=(i[O]||"").trim();return b.startsWith('"')&&b.endsWith('"')&&(b=b.substring(1,b.length-1).replace(/""/g,'"')),b}}return""},N=g(["Monthly Salary","MonthlySalary"]),j=parseFloat(N);c.push({department:g(["Department"]),designation:g(["Designation"]),permanentId:g(["Permanent ID","PermanentId"]),temporaryId:g(["Temporary ID","TemporaryId"]),monthlySalary:isNaN(j)?null:j})}return c},Ws=()=>{const[a,t]=p.useState(!0),[s,r]=p.useState(null),c=p.useRef(null),{register:n,control:i,handleSubmit:g,reset:N,watch:j}=ue({defaultValues:{designations:[]}}),{append:f,remove:d,replace:O}=fe({control:i,name:"designations"});p.useEffect(()=>{t(!0),V.getSiteStaffDesignations().then(h=>N({designations:h})).catch(()=>r({message:"Failed to load data.",type:"error"})).finally(()=>t(!1))},[N]);const b=j("designations"),z=p.useMemo(()=>Array.isArray(b)?b.reduce((h,u,l)=>{const U=u.department||"Uncategorized";return h[U]||(h[U]=[]),h[U].push({...u,originalIndex:l}),h},{}):{},[b]),R=()=>{f({id:`new_${Date.now()}`,department:"",designation:"",permanentId:"",temporaryId:"",monthlySalary:null})},P=async h=>{try{await V.updateSiteStaffDesignations(h.designations),r({message:"Configuration saved successfully.",type:"success"})}catch{r({message:"Failed to save configuration.",type:"error"})}},v=()=>{if(!Array.isArray(b)||b.length===0){r({message:"No data to export.",type:"error"});return}const h=Gs(b),u=new Blob([h],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a");l.href=URL.createObjectURL(u),l.setAttribute("download","site_staff_designations.csv"),document.body.appendChild(l),l.click(),document.body.removeChild(l)},F=()=>{const h=es.join(","),u=new Blob([h],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a");l.href=URL.createObjectURL(u),l.setAttribute("download","site_staff_template.csv"),document.body.appendChild(l),l.click(),document.body.removeChild(l)},S=h=>{const u=h.target.files?.[0];if(!u)return;const l=new FileReader;l.onload=U=>{try{const q=U.target?.result,Y=Us(q).map(J=>({id:`imported_${Date.now()}_${Math.random()}`,department:J.department||"",designation:J.designation||"",permanentId:J.permanentId||"",temporaryId:J.temporaryId||"",monthlySalary:J.monthlySalary||null}));O(Y),r({message:`Imported ${Y.length} records.`,type:"success"})}catch(q){r({message:q.message||"Failed to import CSV.",type:"error"})}finally{h.target&&(h.target.value="")}},l.readAsText(u)};return e.jsxs("form",{onSubmit:g(P),className:"bg-card p-6 rounded-xl shadow-card",children:[s&&e.jsx(pe,{message:s.message,type:s.type,onDismiss:()=>r(null)}),e.jsx("input",{type:"file",ref:c,className:"hidden",accept:".csv",onChange:S}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-primary-text",children:"Staff Designation & ID Series"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(y,{type:"button",variant:"outline",onClick:F,children:[e.jsx(me,{className:"mr-2 h-4 w-4"})," Template"]}),e.jsxs(y,{type:"button",variant:"outline",onClick:()=>c.current?.click(),children:[e.jsx(je,{className:"mr-2 h-4 w-4"})," Import"]}),e.jsxs(y,{type:"button",variant:"outline",onClick:v,children:[e.jsx(ge,{className:"mr-2 h-4 w-4"})," Export"]}),e.jsxs(y,{type:"submit",children:[e.jsx(le,{className:"mr-2 h-4 w-4"})," Save"]})]})]}),e.jsx("div",{className:"space-y-6",children:a?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(ie,{className:"h-8 w-8 animate-spin text-accent"})}):Object.keys(z).length===0?e.jsx("div",{className:"text-center p-8 text-muted bg-page rounded-lg",children:'No designations defined. Click "Add Designation" to begin.'}):Object.entries(z).map(([h,u])=>e.jsxs("div",{className:"border border-border rounded-xl",children:[e.jsx("div",{className:"p-4 bg-page rounded-t-xl",children:e.jsx(w,{"aria-label":`Department for ${h}`,id:`designations.${u[0].originalIndex}.department`,...n(`designations.${u[0].originalIndex}.department`),className:"font-semibold text-lg !border-0 !p-0 !bg-transparent focus:!ring-0"})}),e.jsx("div",{className:"space-y-3 p-4",children:Array.isArray(u)&&u.map(l=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-2 items-center",children:[e.jsx("div",{className:"md:col-span-3",children:e.jsx(w,{placeholder:"Designation","aria-label":`Designation for ${h}`,id:`designations.${l.originalIndex}.designation`,...n(`designations.${l.originalIndex}.designation`)})}),e.jsx("div",{className:"md:col-span-3",children:e.jsx(w,{placeholder:"Permanent ID","aria-label":`Permanent ID for ${l.designation}`,id:`designations.${l.originalIndex}.permanentId`,...n(`designations.${l.originalIndex}.permanentId`)})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(w,{placeholder:"Temporary ID","aria-label":`Temporary ID for ${l.designation}`,id:`designations.${l.originalIndex}.temporaryId`,...n(`designations.${l.originalIndex}.temporaryId`)})}),e.jsx("div",{className:"md:col-span-3",children:e.jsx(w,{placeholder:"Monthly Salary (Gross)","aria-label":`Salary for ${l.designation}`,id:`designations.${l.originalIndex}.monthlySalary`,type:"number",...n(`designations.${l.originalIndex}.monthlySalary`,{valueAsNumber:!0})})}),e.jsx("div",{className:"md:col-span-1 text-right",children:e.jsx(y,{type:"button",variant:"icon",size:"sm",onClick:()=>d(l.originalIndex),"aria-label":`Remove ${l.designation}`,title:`Remove ${l.designation}`,children:e.jsx(te,{className:"h-4 w-4 text-red-500"})})})]},l.id))})]},h))}),e.jsxs(y,{type:"button",onClick:R,variant:"outline",className:"mt-4",children:[e.jsx(se,{className:"mr-2 h-4 w-4"})," Add Designation"]})]})},qs=({id:a,label:t,checked:s,onChange:r,description:c,disabled:n})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex-grow flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-primary-text",children:t}),c&&e.jsx("span",{className:"text-sm text-muted",children:c})]}),e.jsxs("div",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",id:a,className:"sr-only peer",checked:s,onChange:i=>r(i.target.checked),disabled:n}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-2 peer-focus:ring-accent-dark peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent"})]})]}),Pe=["Applicability","OptInDisclaimer","CoverageDetails","OptOutDisclaimer","RequireAlternateInsurance","CollectProvider","CollectStartDate","CollectEndDate","CollectExtentOfCover"],Hs={applicability:"Optional - Opt-in Default",optInDisclaimer:"",coverageDetails:"",optOutDisclaimer:"",requireAlternateInsurance:!1,collectProvider:!1,collectStartDate:!1,collectEndDate:!1,collectExtentOfCover:!1},Js=a=>{const t=Pe.join(","),s=Pe.map(r=>{const c=r.charAt(0).toLowerCase()+r.slice(1);let n=a[c];return typeof n=="string"&&(n.includes(",")||n.includes(`
`)||n.includes('"'))?`"${n.replace(/"/g,'""')}"`:n});return[t,s.join(",")].join(`
`)},Ks=a=>{const t=a.trim().replace(/\r/g,"").split(`
`);if(t.length<2)throw new Error("CSV file must have a header and at least one data row.");const s=t[0].split(",").map(n=>n.trim()),r=t[1].match(new RegExp('(?<=,|^)(?:"(?:[^"]|"")*"|[^,]*)',"g"))||[],c={};return s.forEach((n,i)=>{const g=n.charAt(0).toLowerCase()+n.slice(1);let N=(r[i]||"").trim();N.startsWith('"')&&N.endsWith('"')&&(N=N.substring(1,N.length-1).replace(/""/g,'""')),g==="applicability"?c[g]=N:typeof Hs[g]=="boolean"?c[g]=N.toLowerCase()==="true":c[g]=N}),c},Ae=({label:a,...t})=>e.jsxs("label",{className:"flex items-center gap-2 text-sm text-muted",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 text-accent border-gray-300 rounded focus:ring-accent",...t}),a]}),Qs=()=>{const{gmcPolicy:a,updateGmcPolicySettings:t}=ls(),[s,r]=p.useState(null),c=p.useRef(null),{register:n,handleSubmit:i,control:g,watch:N,reset:j,formState:{isDirty:f}}=ue({defaultValues:a});p.useEffect(()=>{j(a)},[a,j]);const d=N("requireAlternateInsurance"),O=N("applicability")==="Mandatory",b=v=>{t(v),r({message:"GMC policy settings saved.",type:"success"})},z=()=>{const v=Js(a),F=new Blob([v],{type:"text/csv;charset=utf-8;"}),S=document.createElement("a");S.href=URL.createObjectURL(F),S.setAttribute("download","gmc_policy_settings.csv"),document.body.appendChild(S),S.click(),document.body.removeChild(S)},R=()=>{const v=Pe.join(","),F=new Blob([v],{type:"text/csv;charset=utf-8;"}),S=document.createElement("a");S.href=URL.createObjectURL(F),S.setAttribute("download","gmc_policy_template.csv"),document.body.appendChild(S),S.click(),document.body.removeChild(S)},P=v=>{const F=v.target.files?.[0];if(!F)return;const S=new FileReader;S.onload=h=>{try{const u=h.target?.result,l=Ks(u);j(l),r({message:"Settings imported from CSV. Review and save.",type:"success"})}catch(u){r({message:u.message||"Failed to import CSV.",type:"error"})}finally{v.target&&(v.target.value="")}},S.readAsText(F)};return e.jsxs("form",{onSubmit:i(b),className:"bg-card p-6 rounded-xl shadow-card",children:[s&&e.jsx(pe,{message:s.message,type:s.type,onDismiss:()=>r(null)}),e.jsx("input",{type:"file",ref:c,className:"hidden",accept:".csv",onChange:P}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-primary-text",children:"GMC Policy Configuration"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(y,{type:"button",variant:"outline",onClick:R,children:[e.jsx(me,{className:"mr-2 h-4 w-4"})," Template"]}),e.jsxs(y,{type:"button",variant:"outline",onClick:()=>c.current?.click(),children:[e.jsx(je,{className:"mr-2 h-4 w-4"})," Import"]}),e.jsxs(y,{type:"button",variant:"outline",onClick:z,children:[e.jsx(ge,{className:"mr-2 h-4 w-4"})," Export"]}),e.jsxs(y,{type:"submit",disabled:!f,children:[e.jsx(le,{className:"mr-2 h-4 w-4"})," Save"]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsx(x,{name:"applicability",control:g,render:({field:v})=>e.jsxs(_,{label:"Applicability",...v,children:[e.jsx("option",{children:"Mandatory"}),e.jsx("option",{children:"Optional - Opt-in Default"}),e.jsx("option",{children:"Optional - Opt-out Default"})]})})}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("h4",{className:"font-semibold text-primary-text",children:"Opt-In Details"}),e.jsxs("div",{children:[e.jsx("h5",{className:"block text-sm font-medium text-muted",children:"Opt-In Disclaimer"}),e.jsx("textarea",{...n("optInDisclaimer"),rows:3,className:"form-input mt-1"})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"block text-sm font-medium text-muted",children:"Coverage Details"}),e.jsx("textarea",{...n("coverageDetails"),rows:2,className:"form-input mt-1"})]})]}),!O&&e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("h4",{className:"font-semibold text-primary-text",children:"Opt-Out Details"}),e.jsxs("div",{children:[e.jsx("h5",{className:"block text-sm font-medium text-muted",children:"Opt-Out Disclaimer"}),e.jsx("textarea",{...n("optOutDisclaimer"),rows:3,className:"form-input mt-1"})]}),e.jsx(x,{name:"requireAlternateInsurance",control:g,render:({field:v})=>e.jsx(qs,{id:"require-alt-ins",label:"Require proof of alternate insurance on opt-out",checked:v.value,onChange:v.onChange})}),d&&e.jsxs("div",{className:"p-4 bg-page rounded-lg space-y-3",children:[e.jsx("p",{className:"text-sm text-muted",children:"Collect the following from employees who opt out:"}),e.jsx(x,{name:"collectProvider",control:g,render:({field:v})=>e.jsx(Ae,{label:"Provider Name",checked:v.value,onChange:v.onChange})}),e.jsx(x,{name:"collectStartDate",control:g,render:({field:v})=>e.jsx(Ae,{label:"Policy Start Date",checked:v.value,onChange:v.onChange})}),e.jsx(x,{name:"collectEndDate",control:g,render:({field:v})=>e.jsx(Ae,{label:"Policy End Date",checked:v.value,onChange:v.onChange})}),e.jsx(x,{name:"collectExtentOfCover",control:g,render:({field:v})=>e.jsx(Ae,{label:"Extent of Cover (Sum Assured)",checked:v.value,onChange:v.onChange})})]})]})]})]})},ss=[{key:"Phone",label:"Phone",icon:ps},{key:"Computer",label:"Computer / Laptop",icon:hs},{key:"Vehicle",label:"Vehicle",icon:xs},{key:"Sim",label:"SIM Card",icon:gs},{key:"IdCard",label:"Identity Card",icon:js},{key:"Petrocard",label:"Petrocard",icon:fs},{key:"Tools",label:"Tools",icon:bs},{key:"Other",label:"Other Asset",icon:Qe}],Ys=({assetType:a,...t})=>{switch(a){case"Phone":return e.jsx(Zs,{...t});case"Computer":return e.jsx(et,{...t});case"Vehicle":return e.jsx(at,{...t});case"Sim":return e.jsx(Xs,{...t});case"IdCard":return e.jsx(st,{...t});case"Petrocard":return e.jsx(tt,{...t});case"Tools":return e.jsx(nt,{...t});case"Other":return e.jsx(rt,{...t});default:return null}},Zs=({index:a,control:t})=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 pt-4",children:[e.jsx(x,{name:`assets.${a}.brand`,control:t,render:({field:s})=>e.jsx(w,{label:"Brand",...s})}),e.jsx(x,{name:`assets.${a}.imei`,control:t,render:({field:s})=>e.jsx(w,{label:"IMEI Number",...s})}),e.jsx(x,{name:`assets.${a}.color`,control:t,render:({field:s})=>e.jsx(w,{label:"Colour",...s})}),e.jsx(x,{name:`assets.${a}.condition`,control:t,render:({field:s})=>e.jsxs(_,{label:"New / Used",...s,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"New"}),e.jsx("option",{children:"Used"})]})}),e.jsx(x,{name:`assets.${a}.chargerStatus`,control:t,render:({field:s})=>e.jsxs(_,{label:"Charger",...s,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"With Charger"}),e.jsx("option",{children:"Without Charger"})]})}),e.jsx(x,{name:`assets.${a}.displayStatus`,control:t,render:({field:s})=>e.jsxs(_,{label:"Display Condition",...s,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"With Damages"}),e.jsx("option",{children:"Without Damages"})]})}),e.jsx(x,{name:`assets.${a}.bodyStatus`,control:t,render:({field:s})=>e.jsxs(_,{label:"Body Condition",...s,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"With Damages"}),e.jsx("option",{children:"Without Damages"})]})}),e.jsx(x,{name:`assets.${a}.picture`,control:t,render:({field:s})=>e.jsx(X,{label:"Picture",file:s.value,onFileChange:s.onChange})})]}),Xs=({index:a,control:t})=>e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4",children:e.jsx(x,{name:`assets.${a}.number`,control:t,render:({field:s})=>e.jsx(w,{label:"SIM Number",...s})})}),et=({index:a,control:t})=>e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(x,{name:`assets.${a}.computerType`,control:t,render:({field:s})=>e.jsxs(_,{label:"Type",...s,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"Laptop"}),e.jsx("option",{children:"Desktop"}),e.jsx("option",{children:"Tab"})]})}),e.jsx(x,{name:`assets.${a}.brand`,control:t,render:({field:s})=>e.jsx(w,{label:"Brand",...s})}),e.jsx(x,{name:`assets.${a}.serialNumber`,control:t,render:({field:s})=>e.jsx(w,{label:"Serial Number",...s})}),e.jsx(x,{name:`assets.${a}.windowsKey`,control:t,render:({field:s})=>e.jsx(w,{label:"Windows Key",...s})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(x,{name:`assets.${a}.condition`,control:t,render:({field:s})=>e.jsxs(_,{label:"New / Used",...s,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"New"}),e.jsx("option",{children:"Used"})]})}),e.jsx(x,{name:`assets.${a}.chargerStatus`,control:t,render:({field:s})=>e.jsxs(_,{label:"Charger",...s,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"With Charger"}),e.jsx("option",{children:"Without Charger"})]})}),e.jsx(x,{name:`assets.${a}.bagStatus`,control:t,render:({field:s})=>e.jsxs(_,{label:"Bag",...s,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"With Bag"}),e.jsx("option",{children:"Without Bag"})]})}),e.jsx(x,{name:`assets.${a}.mouseStatus`,control:t,render:({field:s})=>e.jsxs(_,{label:"Mouse",...s,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"With Mouse"}),e.jsx("option",{children:"Without Mouse"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(x,{name:`assets.${a}.displayStatus`,control:t,render:({field:s})=>e.jsxs(_,{label:"Display Condition",...s,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"With Damages"}),e.jsx("option",{children:"Without Damages"})]})}),e.jsx(x,{name:`assets.${a}.bodyStatus`,control:t,render:({field:s})=>e.jsxs(_,{label:"Body Condition",...s,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"With Damages"}),e.jsx("option",{children:"Without Damages"})]})}),e.jsx(x,{name:`assets.${a}.officeStatus`,control:t,render:({field:s})=>e.jsxs(_,{label:"MS Office",...s,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"With Office"}),e.jsx("option",{children:"Without Office"})]})}),e.jsx(x,{name:`assets.${a}.antivirusStatus`,control:t,render:({field:s})=>e.jsxs(_,{label:"Antivirus",...s,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"With Antivirus"}),e.jsx("option",{children:"Without Antivirus"})]})})]}),e.jsx(x,{name:`assets.${a}.picture`,control:t,render:({field:s})=>e.jsx(X,{label:"Picture",file:s.value,onFileChange:s.onChange})})]}),st=({index:a,control:t})=>e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4",children:e.jsx(x,{name:`assets.${a}.issueDate`,control:t,render:({field:s})=>e.jsx(De,{label:"Date Issued",id:s.name,value:s.value,onChange:s.onChange})})}),tt=({index:a,control:t})=>e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4",children:e.jsx(x,{name:`assets.${a}.number`,control:t,render:({field:s})=>e.jsx(w,{label:"Petrocard Number",...s})})}),at=({index:a,control:t})=>e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(x,{name:`assets.${a}.vehicleType`,control:t,render:({field:s})=>e.jsxs(_,{label:"Vehicle Type",...s,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"Bicycle"}),e.jsx("option",{children:"Two Wheeler"}),e.jsx("option",{children:"Three Wheeler"}),e.jsx("option",{children:"Four Wheeler"})]})}),e.jsx(x,{name:`assets.${a}.brand`,control:t,render:({field:s})=>e.jsx(w,{label:"Brand",...s})}),e.jsx(x,{name:`assets.${a}.vehicleNumber`,control:t,render:({field:s})=>e.jsx(w,{label:"Vehicle Number",...s})}),e.jsx(x,{name:`assets.${a}.chassisNumber`,control:t,render:({field:s})=>e.jsx(w,{label:"Chassis Number",...s})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(x,{name:`assets.${a}.dlNumber`,control:t,render:({field:s})=>e.jsx(w,{label:"DL Number of User",...s})}),e.jsx(x,{name:`assets.${a}.kmsAtIssue`,control:t,render:({field:s})=>e.jsx(w,{label:"Kms at issue",type:"number",...s})}),e.jsx(x,{name:`assets.${a}.condition`,control:t,render:({field:s})=>e.jsxs(_,{label:"New / Used",...s,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"New"}),e.jsx("option",{children:"Used"})]})}),e.jsx(x,{name:`assets.${a}.finesStatus`,control:t,render:({field:s})=>e.jsxs(_,{label:"Violations / Fines",...s,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"Existing"}),e.jsx("option",{children:"Nil"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(x,{name:`assets.${a}.insuranceValidity`,control:t,render:({field:s})=>e.jsx(De,{label:"Insurance Validity",id:s.name,value:s.value,onChange:s.onChange})}),e.jsx(x,{name:`assets.${a}.pollutionCertValidity`,control:t,render:({field:s})=>e.jsx(De,{label:"Pollution Cert. Validity",id:s.name,value:s.value,onChange:s.onChange})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(x,{name:`assets.${a}.dlFrontPic`,control:t,render:({field:s})=>e.jsx(X,{label:"Picture of DL (Front)",file:s.value,onFileChange:s.onChange})}),e.jsx(x,{name:`assets.${a}.dlBackPic`,control:t,render:({field:s})=>e.jsx(X,{label:"Picture of DL (Back)",file:s.value,onFileChange:s.onChange})}),e.jsx(x,{name:`assets.${a}.picture`,control:t,render:({field:s})=>e.jsx(X,{label:"Picture of Vehicle",file:s.value,onFileChange:s.onChange})})]})]}),nt=({index:a,control:t})=>{const{fields:s,append:r,remove:c}=fe({control:t,name:`assets.${a}.toolList`});return e.jsxs("div",{className:"space-y-4 pt-4",children:[s.map((n,i)=>e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(x,{name:`assets.${a}.toolList.${i}.name`,control:t,render:({field:g})=>e.jsx(w,{label:"Tool Name",...g})})}),e.jsx("div",{className:"flex-1",children:e.jsx(x,{name:`assets.${a}.toolList.${i}.description`,control:t,render:({field:g})=>e.jsx(w,{label:"Description",...g})})}),e.jsx("div",{children:e.jsx(x,{name:`assets.${a}.toolList.${i}.quantity`,control:t,render:({field:g})=>e.jsx(w,{label:"Quantity",type:"number",...g})})}),e.jsx(y,{type:"button",variant:"icon",size:"sm",onClick:()=>c(i),children:e.jsx(te,{className:"h-4 w-4 text-red-500"})})]},n.id)),e.jsxs(y,{type:"button",variant:"outline",size:"sm",onClick:()=>r({id:`tool_${Date.now()}`,name:"",description:"",quantity:1}),children:[e.jsx(se,{className:"mr-1 h-4 w-4"})," Add Tool"]}),e.jsx(x,{name:`assets.${a}.picture`,control:t,render:({field:n})=>e.jsx(X,{label:"Picture of Tools",file:n.value,onFileChange:n.onChange})})]})},rt=({index:a,control:t})=>e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(x,{name:`assets.${a}.name`,control:t,render:({field:s})=>e.jsx(w,{label:"Asset Name",placeholder:"e.g. Printer",...s})}),e.jsx(x,{name:`assets.${a}.brand`,control:t,render:({field:s})=>e.jsx(w,{label:"Brand",...s})}),e.jsx(x,{name:`assets.${a}.model`,control:t,render:({field:s})=>e.jsx(w,{label:"Model No.",...s})}),e.jsx(x,{name:`assets.${a}.serialNumber`,control:t,render:({field:s})=>e.jsx(w,{label:"Serial Number",...s})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(x,{name:`assets.${a}.condition`,control:t,render:({field:s})=>e.jsxs(_,{label:"New / Used",...s,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"New"}),e.jsx("option",{children:"Used"})]})}),e.jsx(x,{name:`assets.${a}.issueCondition`,control:t,render:({field:s})=>e.jsx(w,{label:"Condition at time of issue",...s})})]}),e.jsx("div",{children:e.jsx(x,{name:`assets.${a}.accessories`,control:t,render:({field:s})=>e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"block text-sm font-medium text-muted",children:"Accessories List"}),e.jsx("textarea",{...s,rows:3,className:"form-input mt-1"})]})})}),e.jsx(x,{name:`assets.${a}.picture`,control:t,render:({field:s})=>e.jsx(X,{label:"Picture of Asset",file:s.value,onFileChange:s.onChange})})]}),it=({item:a,index:t,control:s,errors:r,remove:c})=>{const[n,i]=p.useState(()=>a.id.startsWith("new_")),g=ss.find(d=>d.key===a.type),N=g?.icon||Qe,f=(d=>"brand"in d&&d.brand?`${d.brand} ${d.type}`:"number"in d&&d.number?`${d.type} - ${d.number}`:"name"in d&&d.name?d.name:"vehicleNumber"in d&&d.vehicleNumber?d.vehicleNumber:g?.label||"Asset")(a);return e.jsxs("div",{className:"border border-border rounded-xl bg-card",children:[e.jsxs("div",{className:"flex items-center p-3",children:[e.jsxs("button",{type:"button",onClick:()=>i(!n),className:"flex items-center gap-3 flex-grow text-left",children:[e.jsx(N,{className:"h-5 w-5 text-muted flex-shrink-0"}),e.jsx("span",{className:"font-semibold text-primary-text",children:f})]}),e.jsx(y,{type:"button",variant:"icon",size:"sm",onClick:()=>c(t),children:e.jsx(te,{className:"h-4 w-4 text-red-500"})}),e.jsx(y,{type:"button",variant:"icon",size:"sm",onClick:()=>i(!n),children:e.jsx(Ye,{className:`h-5 w-5 transform transition-transform ${n?"rotate-180":""}`})})]}),n&&e.jsx("div",{className:"p-4 border-t border-border",children:e.jsx(Ys,{assetType:a.type,index:t,control:s,errors:r})})]})},lt=({site:a,initialAssets:t,onSave:s,onBack:r,setToast:c})=>{const[n,i]=p.useState(!1),[g,N]=p.useState(!1),j=p.useRef(null),{control:f,handleSubmit:d,reset:O,formState:{errors:b}}=ue(),{fields:z,append:R,remove:P}=fe({control:f,name:"assets"});p.useEffect(()=>{O({assets:t})},[t,O]),p.useEffect(()=>{const S=h=>{j.current&&!j.current.contains(h.target)&&N(!1)};return document.addEventListener("mousedown",S),()=>document.removeEventListener("mousedown",S)},[]);const v=S=>{const h={id:`new_${S}_${Date.now()}`,type:S};let u;switch(S){case"Phone":u={...h,type:"Phone",brand:"",condition:"",chargerStatus:"",displayStatus:"",bodyStatus:"",imei:"",color:""};break;case"Sim":u={...h,type:"Sim",number:""};break;case"Computer":u={...h,type:"Computer",computerType:"",brand:"",condition:"",bagStatus:"",mouseStatus:"",chargerStatus:"",displayStatus:"",bodyStatus:"",serialNumber:"",windowsKey:"",officeStatus:"",antivirusStatus:""};break;case"IdCard":u={...h,type:"IdCard",issueDate:""};break;case"Petrocard":u={...h,type:"Petrocard",number:""};break;case"Vehicle":u={...h,type:"Vehicle",vehicleType:"",brand:"",dlNumber:"",condition:"",kmsAtIssue:null,vehicleNumber:"",chassisNumber:"",insuranceValidity:"",pollutionCertValidity:"",finesStatus:""};break;case"Tools":u={...h,type:"Tools",toolList:[]};break;case"Other":u={...h,type:"Other",name:"",brand:"",model:"",serialNumber:"",condition:"",issueCondition:"",accessories:""};break;default:return}R(u),N(!1)},F=async S=>{i(!0);try{await s(a.id,S.assets)}catch{}finally{i(!1)}};return e.jsxs("form",{onSubmit:d(F),children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs(y,{type:"button",onClick:r,variant:"outline",size:"sm",className:"mb-2",children:[e.jsx(Ke,{className:"mr-2 h-4 w-4"})," Back to List"]}),e.jsxs("h3",{className:"text-xl font-semibold text-primary-text",children:["Managing Assets for: ",a.shortName]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",ref:j,children:[e.jsxs(y,{type:"button",onClick:()=>N(!g),children:[e.jsx(se,{className:"mr-2 h-4 w-4"})," Add Asset"]}),g&&e.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-card border rounded-lg shadow-lg z-10",children:ss.map(S=>e.jsxs("button",{type:"button",className:"w-full text-left px-4 py-2 text-sm hover:bg-page flex items-center gap-3",onClick:()=>v(S.key),children:[e.jsx(S.icon,{className:"h-4 w-4 text-muted"}),e.jsx("span",{children:S.label})]},S.key))})]}),e.jsxs(y,{type:"submit",isLoading:n,children:[e.jsx(le,{className:"mr-2 h-4 w-4"})," Save Changes"]})]})]}),e.jsx("div",{className:"space-y-4",children:z.length>0?z.map((S,h)=>e.jsx(it,{item:S,index:h,control:f,errors:b,remove:P},S.id)):e.jsx("div",{className:"text-center p-8 text-muted bg-page rounded-lg",children:'No assets found for this site. Click "Add Asset" to begin.'})})]})},ot=({sites:a,allAssets:t,searchTerm:s,setSearchTerm:r,onViewDetails:c})=>{const n=(i=[])=>{if(!i||i.length===0)return"No assets assigned.";const g=i.reduce((N,j)=>(N[j.type]=(N[j.type]||0)+1,N),{});return Object.entries(g).map(([N,j])=>`${j} ${N}(s)`).join(", ")};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-primary-text",children:"Asset Overview"}),e.jsxs("div",{className:"relative flex-1 md:max-w-xs",children:[e.jsx(Fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted"}),e.jsx(w,{id:"site-search",placeholder:"Search sites...",className:"pl-10",value:s,onChange:i=>r(i.target.value)})]})]}),e.jsxs("div",{className:"overflow-x-auto border border-border rounded-lg",children:[e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-page",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Site Name"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Asset Summary"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:a.map(i=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:i.shortName}),e.jsx("td",{className:"px-4 py-3 text-muted",children:n(t[i.id])}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(y,{variant:"icon",size:"sm",onClick:()=>c(i.id),title:"View Details",children:e.jsx($e,{className:"h-4 w-4"})})})]},i.id))})]}),a.length===0&&e.jsx("p",{className:"text-center p-8 text-muted",children:"No sites match your search."})]})]})},ct=()=>{const[a,t]=p.useState("list"),[s,r]=p.useState(null),[c,n]=p.useState([]),[i,g]=p.useState({}),[N,j]=p.useState(!0),[f,d]=p.useState(""),[O,b]=p.useState(null);p.useEffect(()=>{j(!0),Promise.all([V.getOrganizations(),V.getAllSiteAssets()]).then(([v,F])=>{n(v.sort((S,h)=>S.shortName.localeCompare(h.shortName))),g(F)}).catch(()=>b({message:"Failed to load asset configuration.",type:"error"})).finally(()=>j(!1))},[]);const z=async(v,F)=>{try{await V.updateSiteAssets(v,F),g(S=>({...S,[v]:F})),b({message:"Assets saved successfully.",type:"success"})}catch(S){throw b({message:"Failed to save assets.",type:"error"}),S}},R=v=>{r(v),t("detail")},P=p.useMemo(()=>f?c.filter(v=>v.shortName.toLowerCase().includes(f.toLowerCase())):c,[c,f]);return N?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(ie,{className:"h-8 w-8 animate-spin text-accent"})}):e.jsxs("div",{children:[O&&e.jsx(pe,{message:O.message,type:O.type,onDismiss:()=>b(null)}),a==="detail"&&s?e.jsx(lt,{site:c.find(v=>v.id===s),initialAssets:i[s]||[],onSave:z,onBack:()=>t("list"),setToast:b}):e.jsx(ot,{sites:P,allAssets:i,searchTerm:f,setSearchTerm:d,onViewDetails:R})]})},dt=({control:a,index:t,remove:s,masterTools:r})=>{const[c,n]=p.useState(!0),i=Me({control:a,name:`tools.${t}.department`}),g=Me({control:a,name:`tools.${t}.name`}),N=i?r[i]||[]:[],j=g||"New Tool",f=i||"Select a department";return e.jsxs("div",{className:"border border-border rounded-xl bg-card",children:[e.jsxs("div",{className:"flex items-center p-3",children:[e.jsxs("button",{type:"button",onClick:()=>n(!c),className:"flex items-center gap-3 flex-grow text-left",children:[e.jsx(Ze,{className:"h-5 w-5 text-muted flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-primary-text",children:j}),e.jsx("p",{className:"text-sm text-muted",children:f})]})]}),e.jsx(y,{type:"button",variant:"icon",size:"sm",onClick:()=>s(t),children:e.jsx(te,{className:"h-4 w-4 text-red-500"})}),e.jsx(y,{type:"button",variant:"icon",size:"sm",onClick:()=>n(!c),children:e.jsx(Ye,{className:`h-5 w-5 transform transition-transform ${c?"rotate-180":""}`})})]}),c&&e.jsxs("div",{className:"p-4 border-t border-border space-y-4 animate-fade-in-down",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(x,{name:`tools.${t}.department`,control:a,render:({field:d})=>e.jsxs(_,{label:"Department",...d,children:[e.jsx("option",{value:"",children:"Select Department"}),Object.keys(r).map(O=>e.jsx("option",{value:O,children:O},O))]})}),e.jsx(x,{name:`tools.${t}.name`,control:a,render:({field:d})=>e.jsxs(_,{label:"Tool Name",...d,disabled:!i,children:[e.jsx("option",{value:"",children:"Select Tool"}),N.map(O=>e.jsx("option",{value:O.name,children:O.name},O.id))]})}),e.jsx(x,{name:`tools.${t}.quantity`,control:a,render:({field:d})=>e.jsx(w,{label:"Quantity",type:"number",...d})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(x,{name:`tools.${t}.picture`,control:a,render:({field:d})=>e.jsx(X,{label:"Picture of Tool",file:d.value,onFileChange:d.onChange})}),e.jsx(x,{name:`tools.${t}.inwardDcCopy`,control:a,render:({field:d})=>e.jsx(X,{label:"Inward DC Copy",file:d.value,onFileChange:d.onChange})}),e.jsx(x,{name:`tools.${t}.deliveryCopy`,control:a,render:({field:d})=>e.jsx(X,{label:"Delivery Copy",file:d.value,onFileChange:d.onChange})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 items-end",children:[e.jsx(x,{name:`tools.${t}.invoiceCopy`,control:a,render:({field:d})=>e.jsx(X,{label:"Invoice",file:d.value,onFileChange:d.onChange})}),e.jsx(x,{name:`tools.${t}.signedReceipt`,control:a,render:({field:d})=>e.jsx(X,{label:"Signed Receipt",file:d.value,onFileChange:d.onChange})}),e.jsx(x,{name:`tools.${t}.receiverName`,control:a,render:({field:d})=>e.jsx(w,{label:"Receiver's Name",...d})})]})]})]})},mt=({site:a,initialTools:t,masterTools:s,onSave:r,onBack:c})=>{const[n,i]=p.useState(!1),{control:g,handleSubmit:N,reset:j}=ue(),{fields:f,append:d,remove:O}=fe({control:g,name:"tools"});p.useEffect(()=>{j({tools:t})},[t,j]);const b=()=>{d({id:`new_tool_${Date.now()}`,department:"",name:"",quantity:1})},z=async R=>{i(!0);try{await r(a.id,R.tools)}finally{i(!1)}};return e.jsxs("form",{onSubmit:N(z),children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs(y,{type:"button",onClick:c,variant:"outline",size:"sm",className:"mb-2",children:[e.jsx(Ke,{className:"mr-2 h-4 w-4"})," Back to List"]}),e.jsxs("h3",{className:"text-xl font-semibold text-primary-text",children:["Managing Tools for: ",a.shortName]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(y,{type:"button",onClick:b,children:[e.jsx(se,{className:"mr-2 h-4 w-4"})," Add Tool"]}),e.jsxs(y,{type:"submit",isLoading:n,children:[e.jsx(le,{className:"mr-2 h-4 w-4"})," Save Changes"]})]})]}),e.jsx("div",{className:"space-y-4",children:f.length>0?f.map((R,P)=>e.jsx(dt,{control:g,index:P,remove:O,masterTools:s},R.id)):e.jsx("div",{className:"text-center p-8 text-muted bg-page rounded-lg",children:'No tools found for this site. Click "Add Tool" to begin.'})})]})},ut=({sites:a,allIssuedTools:t,searchTerm:s,setSearchTerm:r,onViewDetails:c})=>{const n=(i=[])=>{if(!i||i.length===0)return"No tools issued.";const g=i.reduce((j,f)=>j+(f.quantity||0),0),N=new Set(i.map(j=>j.department)).size;return`${g} tools issued across ${N} department${N>1?"s":""}.`};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-primary-text",children:"Site Tools Overview"}),e.jsxs("div",{className:"relative flex-1 md:max-w-xs",children:[e.jsx(Fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted"}),e.jsx(w,{id:"site-search",placeholder:"Search sites...",className:"pl-10",value:s,onChange:i=>r(i.target.value)})]})]}),e.jsxs("div",{className:"overflow-x-auto border border-border rounded-lg",children:[e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-page",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Site Name"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Tools Summary"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:a.map(i=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:i.shortName}),e.jsx("td",{className:"px-4 py-3 text-muted",children:n(t[i.id])}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(y,{variant:"icon",size:"sm",onClick:()=>c(i.id),title:"View Details",children:e.jsx($e,{className:"h-4 w-4"})})})]},i.id))})]}),a.length===0&&e.jsx("p",{className:"text-center p-8 text-muted",children:"No sites match your search."})]})]})},pt=()=>{const[a,t]=p.useState(null),[s,r]=p.useState([]),[c,n]=p.useState({}),[i,g]=p.useState({}),[N,j]=p.useState(!0),[f,d]=p.useState(""),[O,b]=p.useState(null);p.useEffect(()=>{j(!0),Promise.all([V.getOrganizations(),V.getAllSiteIssuedTools(),V.getToolsList()]).then(([P,v,F])=>{r(P.sort((S,h)=>S.shortName.localeCompare(h.shortName))),n(v),g(F)}).catch(()=>b({message:"Failed to load initial configuration.",type:"error"})).finally(()=>j(!1))},[]);const z=async(P,v)=>{try{await V.updateSiteIssuedTools(P,v),n(F=>({...F,[P]:v})),b({message:"Tools list saved successfully.",type:"success"})}catch(F){throw b({message:"Failed to save tools list.",type:"error"}),F}},R=p.useMemo(()=>f?s.filter(P=>P.shortName.toLowerCase().includes(f.toLowerCase())):s,[s,f]);return N?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(ie,{className:"h-8 w-8 animate-spin text-accent"})}):e.jsxs("div",{children:[O&&e.jsx(pe,{message:O.message,type:O.type,onDismiss:()=>b(null)}),a?e.jsx(mt,{site:s.find(P=>P.id===a),initialTools:c[a]||[],masterTools:i,onSave:z,onBack:()=>t(null)}):e.jsx(ut,{sites:R,allIssuedTools:c,searchTerm:f,setSearchTerm:d,onViewDetails:t})]})},ht=()=>e.jsx(oe,{title:"Attendance Format"}),xt=()=>e.jsx(oe,{title:"Attendance Overview"}),gt=()=>e.jsx(oe,{title:"Daily Attendance Summary"}),jt=()=>e.jsx(oe,{title:"Notification & Mail Configuration"}),ft=()=>e.jsx(oe,{title:"Onboarding Rejection Reasons"}),bt=()=>e.jsx(oe,{title:"Salary Breakup"}),yt=()=>e.jsx(oe,{title:"Salary Line Item"}),We=(a,t)=>{const s=t.join(","),r=a.map(c=>t.map(n=>{const i=c[n]===null||c[n]===void 0?"":String(c[n]);return i.includes(",")||i.includes('"')||i.includes(`
`)?`"${i.replace(/"/g,'""')}"`:i}).join(","));return[s,...r].join(`
`)},qe=a=>{const t=a.trim().replace(/\r/g,"").split(`
`);if(t.length<2)return[];const s=t[0].split(",").map(c=>c.trim().replace(/"/g,"")),r=[];for(let c=1;c<t.length;c++){const n={},i=t[c].match(new RegExp('(?<=,|^)(?:"(?:[^"]|"")*"|[^,]*)',"g"))||[];s.forEach((g,N)=>{let j=(i[N]||"").trim();j.startsWith('"')&&j.endsWith('"')&&(j=j.substring(1,j.length-1).replace(/""/g,'"')),n[g]=j}),r.push(n)}return r},Ee=["Group Id","Group Name","Company Id","Company Name","Entity Id","Entity Name","Organization Id","Location","Registered Address","Registration Type","Registration Number","GST Number","PAN Number","Email","E Shram Number","Shop and Establishment Code","EPFO Code","ESIC Code","PSARA License Number","PSARA Valid Till"],Oe=["Organization Id","Organization Name","Location","Entity Id","Billing Name","Registered Address","GST Number","PAN Number","Email 1","Email 2","Email 3","E Shram Number","Shop and Establishment Code","Key Account Manager","Site Area (Sq Ft)","Project Type","Apartment Count","Agreement Details","Site Operations"],He=(a,t)=>{const s=new Blob([a],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.href=URL.createObjectURL(s),r.setAttribute("download",t),document.body.appendChild(r),r.click(),document.body.removeChild(r)},Nt=({isOpen:a,onClose:t,onSave:s,title:r,label:c,initialName:n=""})=>{const[i,g]=p.useState(n),[N,j]=p.useState("");p.useEffect(()=>{a&&g(n)},[a,n]);const f=()=>{if(!i.trim()){j("Name cannot be empty.");return}s(i),t()};return a?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:t,children:e.jsxs("div",{className:"bg-card rounded-xl shadow-card p-6 w-full max-w-md m-4",onClick:d=>d.stopPropagation(),children:[e.jsx("h3",{className:"text-lg font-bold",children:r}),e.jsx("div",{className:"mt-4",children:e.jsx(w,{label:c,id:"name-input",value:i,onChange:d=>{g(d.target.value),j("")},error:N})}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx(y,{onClick:t,variant:"secondary",children:"Cancel"}),e.jsx(y,{onClick:f,children:"Save"})]})]})}):null},Re=[{key:"client_structure",label:"Client Structure",icon:ys},{key:"site_configuration",label:"Site Configuration",icon:Ns},{key:"costing_resource",label:"Costing & Resource",icon:vs},{key:"backoffice_heads",label:"Back Office & ID Series",icon:Cs},{key:"staff_designation",label:"Staff Designation",icon:Ss},{key:"gmc_policy",label:"GMC Policy",icon:ws},{key:"asset",label:"Asset Management",icon:Is},{key:"tools_list",label:"Tools List",icon:Ze},{key:"attendance_format",label:"Attendance Format",icon:As},{key:"attendance_overview",label:"Attendance Overview",icon:ks},{key:"notification_template",label:"Notification & Mail",icon:Ds},{key:"onboard_reject_reason",label:"Onboarding Rejection Reasons",icon:$s},{key:"salary_template",label:"Salary Breakup",icon:Be},{key:"salary_line_item",label:"Salary Line Item",icon:Be}],Pt=()=>{const a=ds(),[t,s]=p.useState([]),[r,c]=p.useState([]),[n,i]=p.useState([]),[g,N]=p.useState(!0),[j,f]=p.useState(null),[d,O]=p.useState({}),[b,z]=p.useState("client_structure"),R=p.useRef(null),[P,v]=p.useState(""),[F,S]=p.useState(null),[h,u]=p.useState(!1),l=os("(max-width: 767px)"),[U,q]=p.useState({isOpen:!1,initialData:null,companyName:""}),[Q,Y]=p.useState({isOpen:!1,mode:"add",type:"group",title:"",label:""}),[J,be]=p.useState({isOpen:!1,type:"group",id:"",name:""}),[ce,ye]=p.useState({isOpen:!1,org:null}),L=p.useMemo(()=>t.flatMap(o=>o.companies.flatMap(m=>m.entities.map(C=>({...C,companyName:m.name})))),[t]);p.useEffect(()=>{(async()=>{N(!0);try{const[m,C,k]=await Promise.all([V.getOrganizationStructure(),V.getOrganizations(),V.getSiteConfigurations()]);s(m),c(C),i(k)}catch{f({message:"Failed to load data.",type:"error"})}finally{N(!1)}})()},[]);const T=p.useMemo(()=>{if(!P.trim())return t;const o=P.toLowerCase();return t.map(m=>{if(m.name.toLowerCase().includes(o))return m;const C=m.companies.map(k=>{if(k.name.toLowerCase().includes(o))return k;const D=k.entities.filter(A=>A.name.toLowerCase().includes(o));return D.length>0?{...k,entities:D}:null}).filter(Boolean);return C.length>0?{...m,companies:C}:null}).filter(Boolean)},[t,P]),K=p.useMemo(()=>{if(!P.trim())return r;const o=P.toLowerCase();return r.filter(m=>m.shortName.toLowerCase().includes(o))},[r,P]),M=o=>O(m=>({...m,[o]:!m[o]})),B=async()=>{N(!0);try{await V.bulkSaveOrganizationStructure(t),f({message:"All changes saved to database successfully.",type:"success"})}catch(o){console.error("Failed to save changes:",o),f({message:"Failed to save changes to database.",type:"error"})}finally{N(!1)}},ae=o=>q({isOpen:!0,initialData:null,companyName:o}),he=(o,m)=>q({isOpen:!0,initialData:o,companyName:m}),ve=async o=>{try{const m=t.flatMap(k=>k.companies).find(k=>k.name===U.companyName);if(!m)throw new Error("Company not found");const C=await V.saveEntity({...o,companyId:m.id});s(k=>k.map(D=>({...D,companies:D.companies.map(A=>{if(A.id===m.id){const E=A.entities.some(W=>W.id===C.id);return{...A,entities:E?A.entities.map(W=>W.id===C.id?C:W):[...A.entities,C]}}return A})}))),f({message:o.id.startsWith("new_")?"Client added.":"Client updated.",type:"success"}),q({isOpen:!1,initialData:null,companyName:""})}catch{f({message:"Failed to save client.",type:"error"})}},ne=(o,m,C)=>be({isOpen:!0,type:o,id:m,name:C}),Ce=async()=>{const{type:o,id:m,name:C}=J;try{o==="group"?(await V.deleteOrganizationGroup(m),s(k=>k.filter(D=>D.id!==m))):o==="company"?(await V.deleteCompany(m),s(k=>k.map(D=>({...D,companies:D.companies.filter(A=>A.id!==m)})))):o==="client"&&(await V.deleteEntity(m),s(k=>k.map(D=>({...D,companies:D.companies.map(A=>({...A,entities:A.entities.filter(E=>E.id!==m)}))})))),f({message:`${o.charAt(0).toUpperCase()+o.slice(1)} '${C}' deleted.`,type:"success"})}catch{f({message:`Failed to delete ${o}.`,type:"error"})}be({isOpen:!1,type:"group",id:"",name:""})},Se=async o=>{const{mode:m,type:C,id:k,groupId:D}=Q;try{if(m==="add"){if(C==="group"){const A=await V.createOrganizationGroup({id:`group_${Date.now()}`,name:o});s(E=>[...E,{...A,companies:[],locations:[]}]),f({message:`Group '${o}' added.`,type:"success"})}else if(C==="company"&&D){const A=await V.createCompany({id:`comp_${Date.now()}`,name:o,groupId:D});s(E=>E.map(W=>W.id===D?{...W,companies:[...W.companies,{...A,entities:[]}]}:W)),f({message:`Company '${o}' added.`,type:"success"})}}else C==="group"&&k?(await V.updateOrganizationGroup(k,{name:o}),s(A=>A.map(E=>E.id===k?{...E,name:o}:E)),f({message:"Group updated.",type:"success"})):C==="company"&&k&&D&&(await V.updateCompany(k,{name:o}),s(A=>A.map(E=>E.id===D?{...E,companies:E.companies.map(W=>W.id===k?{...W,name:o}:W)}:E)),f({message:"Company updated.",type:"success"}))}catch{f({message:`Failed to ${m} ${C}.`,type:"error"})}Y({isOpen:!1,mode:"add",type:"group",title:"",label:""})},Ne=()=>{let o,m,C;if(b==="client_structure"){C=Ee;const k=t.flatMap(D=>D.companies.flatMap(A=>A.entities.map(E=>({"Group Id":D.id,"Group Name":D.name,"Company Id":A.id,"Company Name":A.name,"Entity Id":E.id,"Entity Name":E.name,"Organization Id":E.organizationId||"",Location:E.location||"","Registered Address":E.registeredAddress||"","Registration Type":E.registrationType||"","Registration Number":E.registrationNumber||"","GST Number":E.gstNumber||"","PAN Number":E.panNumber||"",Email:E.email||"","E Shram Number":E.eShramNumber||"","Shop and Establishment Code":E.shopAndEstablishmentCode||"","EPFO Code":E.epfoCode||"","ESIC Code":E.esicCode||"","PSARA License Number":E.psaraLicenseNumber||"","PSARA Valid Till":E.psaraValidTill||""}))));o=We(k,C),m="client_structure_export.csv"}else if(b==="site_configuration"){C=Oe;const k=r.map(D=>{const A=n.find(E=>E.organizationId===D.id);return{"Organization Id":D.id,"Organization Name":D.shortName,Location:A?.location||"","Entity Id":A?.entityId||"","Billing Name":A?.billingName||"","Registered Address":A?.registeredAddress||"","GST Number":A?.gstNumber||"","PAN Number":A?.panNumber||"","Email 1":A?.email1||"","Email 2":A?.email2||"","Email 3":A?.email3||"","E Shram Number":A?.eShramNumber||"","Shop and Establishment Code":A?.shopAndEstablishmentCode||"","Key Account Manager":A?.keyAccountManager||"","Site Area (Sq Ft)":A?.siteAreaSqFt||"","Project Type":A?.projectType||"","Apartment Count":A?.apartmentCount||"","Agreement Details":JSON.stringify(A?.agreementDetails||{}),"Site Operations":JSON.stringify(A?.siteOperations||{})}});o=We(k,C),m="site_configuration_export.csv"}else{f({message:"Export not implemented for this view.",type:"error"});return}He(o,m),f({message:"Data exported successfully.",type:"success"})},G=()=>{let o,m;if(b==="client_structure")o=Ee,m="client_structure_template.csv";else if(b==="site_configuration")o=Oe,m="site_configuration_template.csv";else{f({message:"Template not available for this view.",type:"error"});return}He(o.join(","),m)},ee=o=>{const m=o.target.files?.[0];if(!m)return;const C=new FileReader;C.onload=k=>{try{const D=k.target?.result;if(!D)throw new Error("File is empty.");const A=D.trim().replace(/\r/g,"").split(`
`);if(A.length<1)throw new Error("CSV file is empty.");const E=A[0].split(",").map(W=>W.trim().replace(/"/g,""));if(b==="client_structure"){if(E.join(",")!==Ee.join(","))throw new Error("Header mismatch. Please use the downloaded template.");const W=qe(D);if(W.length===0)throw new Error("No data rows found.");const de=new Map;for(const I of W){const re=I["Group Id"]||I.GroupId,we=I["Group Name"]||I.GroupName,xe=I["Company Id"]||I.CompanyId,ts=I["Company Name"]||I.CompanyName;de.has(re)||de.set(re,{group:{id:re,name:we,locations:[],companies:[]},companiesMap:new Map});const Te=de.get(re);Te.companiesMap.has(xe)||Te.companiesMap.set(xe,{id:xe,name:ts,entities:[]});const as=Te.companiesMap.get(xe),ns={id:I["Entity Id"]||I.EntityId,name:I["Entity Name"]||I.EntityName,organizationId:I["Organization Id"]||I.organizationId,location:I.Location||I.Location,registeredAddress:I["Registered Address"]||I.RegisteredAddress,registrationType:I["Registration Type"]||I.RegistrationType||"",registrationNumber:I["Registration Number"]||I.RegistrationNumber,gstNumber:I["GST Number"]||I.GSTNumber,panNumber:I["PAN Number"]||I.PANNumber,email:I.Email||I.Email,eShramNumber:I["E Shram Number"]||I.EShramNumber,shopAndEstablishmentCode:I["Shop and Establishment Code"]||I.ShopAndEstablishmentCode,epfoCode:I["EPFO Code"]||I.EPFOCode,esicCode:I["ESIC Code"]||I.ESICCode,psaraLicenseNumber:I["PSARA License Number"]||I.PSARALicenseNumber,psaraValidTill:I["PSARA Valid Till"]||I.PSARAValidTill};as.entities.push(ns)}const $=Array.from(de.values()).map(I=>(I.group.companies=Array.from(I.companiesMap.values()),I.group));s($),f({message:`Successfully imported ${W.length} client records.`,type:"success"})}else if(b==="site_configuration"){if(E.join(",")!==Oe.join(","))throw new Error("Header mismatch. Please use the downloaded template.");const W=qe(D);if(W.length===0)throw new Error("No data rows found.");const de=W.map($=>({organizationId:$["Organization Id"]||$.organizationId,location:$.Location||$.location,entityId:$["Entity Id"]||$.entityId,billingName:$["Billing Name"]||$.billingName,registeredAddress:$["Registered Address"]||$.registeredAddress,gstNumber:$["GST Number"]||$.gstNumber,panNumber:$["PAN Number"]||$.panNumber,email1:$["Email 1"]||$.email1,email2:$["Email 2"]||$.email2,email3:$["Email 3"]||$.email3,eShramNumber:$["E Shram Number"]||$.eShramNumber,shopAndEstablishmentCode:$["Shop and Establishment Code"]||$.shopAndEstablishmentCode,keyAccountManager:$["Key Account Manager"]||$.keyAccountManager,siteAreaSqFt:Number($["Site Area (Sq Ft)"]||$.siteAreaSqFt)||null,projectType:$["Project Type"]||$.projectType,apartmentCount:Number($["Apartment Count"]||$.apartmentCount)||null,agreementDetails:JSON.parse($["Agreement Details"]||$.agreementDetails||"{}"),siteOperations:JSON.parse($["Site Operations"]||$.siteOperations||"{}")}));i($=>{const I=[...$];return de.forEach(re=>{const we=I.findIndex(xe=>xe.organizationId===re.organizationId);we>-1?I[we]=re:I.push(re)}),I}),f({message:`Successfully imported ${de.length} site configurations.`,type:"success"})}else f({message:"Import not implemented for this view.",type:"error"})}catch(D){f({message:D.message||"Failed to import CSV.",type:"error"})}finally{o.target&&(o.target.value="")}},C.readAsText(m)},Z=()=>{switch(b){case"client_structure":return e.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-4",children:[e.jsxs(y,{onClick:()=>a("/hr/entity-management/add-group"),style:{backgroundColor:"#006B3F",color:"#FFFFFF",borderColor:"#005632"},className:"border hover:opacity-90 text-white shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(se,{className:"mr-2 h-4"}),"Add Group"]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(y,{type:"button",variant:"outline",onClick:G,className:"hover:bg-gray-100",children:[e.jsx(me,{className:"mr-2 h-4 w-4"})," Template"]}),e.jsxs(y,{type:"button",variant:"outline",onClick:()=>R.current?.click(),className:"hover:bg-gray-100",children:[e.jsx(je,{className:"mr-2 h-4 w-4"})," Import"]}),e.jsxs(y,{type:"button",variant:"outline",onClick:Ne,className:"hover:bg-gray-100",children:[e.jsx(ge,{className:"mr-2 h-4 w-4"})," Export"]})]})]}),e.jsx("div",{className:"space-y-2",children:T.map(m=>e.jsxs("div",{className:"border-b border-border",children:[e.jsxs("div",{className:"p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>M(m.id),children:e.jsx(Ge,{className:`h-5 w-5 transition-transform ${d[m.id]?"rotate-90":""}`})}),e.jsx(ze,{className:"h-5 w-5 text-muted"}),e.jsx("span",{className:"font-semibold",children:m.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{size:"sm",className:"!p-1.5",onClick:()=>Y({isOpen:!0,mode:"add",type:"company",groupId:m.id,title:`Add Company to ${m.name}`,label:"Company Name"}),title:"Add Company",children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx(y,{variant:"icon",onClick:()=>Y({isOpen:!0,mode:"edit",type:"group",id:m.id,initialName:m.name,title:"Edit Group Name",label:"Group Name"}),title:"Edit group name",className:"p-2 hover:bg-blue-500/10 rounded-full transition-colors",children:e.jsx(ke,{className:"h-5 w-5"})}),e.jsx(y,{variant:"icon",onClick:()=>ne("group",m.id,m.name),title:"Delete group",className:"p-2 hover:bg-red-500/10 rounded-full transition-colors",children:e.jsx(te,{className:"h-5 w-5 text-red-500"})})]})]}),d[m.id]&&e.jsx("div",{className:"pl-6 pr-3 pb-3 space-y-2",children:m.companies.map(C=>e.jsxs("div",{className:"border border-border rounded-lg",children:[e.jsxs("div",{className:"p-2 flex items-center justify-between bg-card",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>M(C.id),children:e.jsx(Ge,{className:`h-5 w-5 transition-transform ${d[C.id]?"rotate-90":""}`})}),e.jsxs("span",{children:[C.name," (",C.entities.length," clients)"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{variant:"icon",size:"sm",title:`View ${C.entities.length} clients`,onClick:()=>S({companyName:C.name,clients:C.entities}),children:e.jsx($e,{className:"h-4 w-4"})}),e.jsx(y,{variant:"icon",size:"sm",onClick:()=>ae(C.name),title:"Add client",children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx(y,{variant:"icon",onClick:()=>Y({isOpen:!0,mode:"edit",type:"company",id:C.id,groupId:m.id,initialName:C.name,title:"Edit Company Name",label:"Company Name"}),title:"Edit company name",className:"p-2 hover:bg-blue-500/10 rounded-full transition-colors",children:e.jsx(ke,{className:"h-5 w-5"})}),e.jsx(y,{variant:"icon",onClick:()=>ne("company",C.id,C.name),title:"Delete company",className:"p-2 hover:bg-red-500/10 rounded-full transition-colors",children:e.jsx(te,{className:"h-5 w-5 text-red-500"})})]})]}),d[C.id]&&e.jsx("div",{className:"p-2",children:C.entities.map(k=>e.jsxs("div",{className:"p-2 flex items-center justify-between hover:bg-page rounded",children:[e.jsx("span",{children:k.name}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{variant:"icon",onClick:()=>he(k,C.name),className:"p-2 hover:bg-blue-500/10 rounded-full transition-colors",children:e.jsx(ke,{className:"h-5 w-5"})}),e.jsx(y,{variant:"icon",onClick:()=>ne("client",k.id,k.name),className:"p-2 hover:bg-red-500/10 rounded-full transition-colors",children:e.jsx(te,{className:"h-5 w-5 text-red-500"})})]})]},k.id))})]},C.id))})]},m.id))})]});case"site_configuration":return e.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-primary-text",children:"Sites Configuration"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(y,{type:"button",variant:"outline",onClick:G,children:[e.jsx(me,{className:"mr-2 h-4 w-4"})," Template"]}),e.jsxs(y,{type:"button",variant:"outline",onClick:()=>R.current?.click(),children:[e.jsx(je,{className:"mr-2 h-4 w-4"})," Import"]}),e.jsxs(y,{type:"button",variant:"outline",onClick:Ne,children:[e.jsx(ge,{className:"mr-2 h-4 w-4"})," Export"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-border responsive-table",children:[e.jsx("thead",{className:"bg-page",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Site Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Configuration Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-border md:bg-card md:divide-y-0",children:K.map(m=>{const C=n.find(D=>D.organizationId===m.id),k=!!C&&(!!C.billingName||!!C.keyAccountManager);return e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Site Name",className:"px-4 py-3 font-medium",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ze,{className:"h-5 w-5 text-muted"}),e.jsx("span",{children:m.shortName})]})}),e.jsx("td",{"data-label":"Status",className:"px-4 py-3",children:k?e.jsxs("span",{className:"flex items-center text-green-600",children:[e.jsx(Je,{className:"h-4 w-4 mr-1"})," Complete"]}):e.jsxs("span",{className:"flex items-center text-yellow-600",children:[e.jsx(Ts,{className:"h-4 w-4 mr-1"})," Incomplete"]})}),e.jsx("td",{"data-label":"Actions",className:"px-4 py-3",children:e.jsxs(y,{size:"sm",variant:"outline",onClick:()=>ye({isOpen:!0,org:m}),children:[e.jsx($e,{className:"mr-2 h-4 w-4"})," View / Edit"]})})]},m.id)})})]})})]});case"costing_resource":return e.jsx(Vs,{});case"backoffice_heads":return e.jsx(zs,{});case"staff_designation":return e.jsx(Ws,{});case"gmc_policy":return e.jsx(Qs,{});case"asset":return e.jsx(ct,{});case"tools_list":return e.jsx(pt,{});case"attendance_format":return e.jsx(ht,{});case"attendance_overview":return e.jsx(xt,{});case"daily_attendance":return e.jsx(gt,{});case"notification_template":return e.jsx(jt,{});case"onboard_reject_reason":return e.jsx(ft,{});case"salary_template":return e.jsx(bt,{});case"salary_line_item":return e.jsx(yt,{});default:const o=Re.find(m=>m.key===b);return e.jsx(oe,{title:o?.label||"Configuration"})}};return e.jsxs("div",{className:"p-4 space-y-6",children:[j&&e.jsx(pe,{message:j.message,type:j.type,onDismiss:()=>f(null)}),e.jsx(Fs,{isOpen:h,onClose:()=>u(!1)}),U.isOpen&&e.jsx(Ps,{...U,onClose:()=>q(o=>({...o,isOpen:!1})),onSave:ve}),e.jsx(Nt,{isOpen:Q.isOpen,onClose:()=>Y({isOpen:!1,mode:"add",type:"group",title:"",label:""}),onSave:Se,title:Q.title,label:Q.label,initialName:Q.initialName}),e.jsxs(Os,{isOpen:J.isOpen,onClose:()=>be(o=>({...o,isOpen:!1})),onConfirm:Ce,title:"Confirm Deletion",children:["Are you sure you want to delete the ",J.type,' "',J.name,'"? This action cannot be undone.']}),ce.isOpen&&ce.org&&e.jsx(Es,{isOpen:ce.isOpen,onClose:()=>ye({isOpen:!1,org:null}),onSave:async(o,m)=>{try{await V.saveSiteConfiguration(o,m),i(C=>{const k=C.findIndex(D=>D.organizationId===o);if(k>-1){const D=[...C];return D[k]=m,D}return[...C,m]}),f({message:"Site configuration saved.",type:"success"}),ye({isOpen:!1,org:null})}catch{f({message:"Failed to save site configuration.",type:"error"})}},organization:ce.org,allClients:L,initialData:n.find(o=>o.organizationId===ce.org?.id)}),F&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60",onClick:()=>S(null),children:e.jsxs("div",{className:"bg-card rounded-xl shadow-card p-6 w-full max-w-md m-4 animate-fade-in-scale",onClick:o=>o.stopPropagation(),children:[e.jsxs("h3",{className:"text-lg font-bold text-primary-text mb-4",children:["Clients in ",F.companyName]}),F.clients.length>0?e.jsx("ul",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:F.clients.map(o=>e.jsx("li",{className:"text-sm p-2 bg-page rounded-md",children:o.name},o.id))}):e.jsx("p",{className:"text-muted text-center py-4",children:"No clients found for this company."}),e.jsx("div",{className:"mt-6 text-right",children:e.jsx(y,{onClick:()=>S(null),variant:"secondary",children:"Close"})})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between md:items-center gap-4 mb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-primary-text",children:"Client Management"}),!l&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(y,{variant:"outline",onClick:()=>u(!0),className:"hover:bg-gray-100",children:[e.jsx(_e,{className:"mr-2 h-4 w-4"})," Help"]}),e.jsx("input",{type:"file",ref:R,className:"hidden",accept:".csv",onChange:ee}),e.jsxs(y,{onClick:B,style:{backgroundColor:"#006B3F",color:"#FFFFFF",borderColor:"#005632"},className:"border hover:opacity-90 text-white shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(le,{className:"mr-2 h-4 w-4"})," Save All Changes"]})]})]}),l&&e.jsxs("div",{className:"flex flex-col gap-3 mb-4",children:[e.jsxs(y,{onClick:B,style:{backgroundColor:"#006B3F",color:"#FFFFFF",borderColor:"#005632"},className:"w-full justify-center border hover:opacity-90 text-white shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(le,{className:"mr-2 h-4 w-4"})," Save All Changes"]}),e.jsxs(y,{variant:"outline",onClick:()=>u(!0),className:"w-full justify-center hover:bg-gray-100",children:[e.jsx(_e,{className:"mr-2 h-4 w-4"})," Help"]}),e.jsx("input",{type:"file",ref:R,className:"hidden",accept:".csv",onChange:ee})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted"}),e.jsx("input",{id:"client-search",name:"clientSearch",type:"text",placeholder:"Search across all clients and sites...",value:P,onChange:o=>v(o.target.value),className:"form-input !pl-10 w-full"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("nav",{className:"md:col-span-1",children:l?e.jsx(_,{label:"Configuration Section",id:"hr-config-select",value:b,onChange:o=>z(o.target.value),children:Re.map(o=>e.jsx("option",{value:o.key,children:o.label},o.key))}):e.jsx("div",{className:"space-y-1",children:Re.map(o=>e.jsxs("button",{onClick:()=>z(o.key),className:`w-full flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-lg text-left transition-colors ${b===o.key?"text-white":"text-muted hover:bg-accent-light hover:text-accent-dark"}`,style:b===o.key?{backgroundColor:"#006B3F"}:{},children:[e.jsx(o.icon,{className:"h-5 w-5"}),e.jsx("span",{children:o.label})]},o.key))})}),e.jsx("main",{className:"md:col-span-3",children:g?e.jsx(ie,{className:"h-8 w-8 animate-spin text-accent mx-auto mt-16"}):Z()})]})]})};export{Pt as default};
