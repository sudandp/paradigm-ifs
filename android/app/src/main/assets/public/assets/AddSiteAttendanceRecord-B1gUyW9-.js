import{k as ae,j as e,I as d,B as C,T as L,m as R,u as M}from"./index-D5q3SS3D.js";import{u as te,l as se,b as m}from"./react-vendor-BUaIliXj.js";import{S as T}from"./SearchableSelect-B7rWk5GL.js";import{t as ne,z as re,w as ie,b as H,F as oe,aJ as ce,R as U}from"./ui-vendor-B8EvWqdc.js";import{p as le,H as de,I as me,J as he,K as ge,f as pe}from"./utils-vendor-DmorxLnX.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./supabase-7WG3J4rU.js";const je=()=>{const p=te(),{id:j}=se(),g=!!j,u=ae("(max-width: 767px)"),[$,E]=m.useState(!0),[A,B]=m.useState(!1),[w,z]=m.useState([]),[r,O]=m.useState({siteId:"",siteName:"",companyName:"",billingCycle:"",opsRemarks:"",hrRemarks:"",financeRemarks:"",opsIncharge:"",hrIncharge:"",invoiceIncharge:"",managerTentativeDate:"",managerReceivedDate:"",hrTentativeDate:"",hrReceivedDate:"",attendanceReceivedTime:"",invoiceSharingTentativeDate:"",invoicePreparedDate:"",invoiceSentTime:"",invoiceSentMethodRemarks:""}),[b,v]=m.useState(null),J=["1st Billing Cycle","2nd Billing Cycle","3rd Billing Cycle"],[K,Y]=m.useState([]),[G,Q]=m.useState([]),[V,_]=m.useState([]),[q,W]=m.useState([]),[k,X]=m.useState(null);m.useEffect(()=>{(async()=>{E(!0);try{const[n,h,s]=await Promise.all([R.getOrganizations(),R.getSiteInvoiceDefaults(),R.getSiteInvoiceRecords()]),x=Array.from(new Set(s.map(t=>t.siteName).filter(Boolean))),N=[...n||[]];x.forEach(t=>{N.find(S=>S.shortName===t)||N.push({id:t,shortName:t,name:t})}),z(N),W(h||[]);const c=new Set,l=new Set,y=new Set;s.forEach(t=>{t.opsIncharge&&c.add(t.opsIncharge),t.hrIncharge&&l.add(t.hrIncharge),t.invoiceIncharge&&y.add(t.invoiceIncharge)}),["Sandeep","Shilpa","Isaac","Venkat"].forEach(t=>c.add(t)),["Chandana","Pooja","Kavya"].forEach(t=>l.add(t)),["Arpitha","Sinchana"].forEach(t=>y.add(t)),Y(Array.from(c).sort()),Q(Array.from(l).sort()),_(Array.from(y).sort());const{user:f}=M.getState();if(f&&X({id:f.id,name:f.name||"Unknown"}),g&&j){const t=s.find(S=>S.id===j);t?(!t.siteId&&t.siteName&&(t.siteId=t.siteName),O(t)):(v({message:"Record not found",type:"error"}),setTimeout(()=>p("/finance?tab=attendance"),2e3))}}catch(n){console.error("Error loading form data:",n),v({message:"Failed to load data",type:"error"})}finally{E(!1)}})()},[j,g,p]);const i=(a,n)=>{O(h=>{const s={...h,[a]:n};if(a==="siteId"){const x=w.find(l=>l.id===n||l.shortName===n);x?(s.siteId=x.id,s.siteName=x.shortName):(s.siteId=n,s.siteName=n);const N=x?x.id:n,c=q.find(l=>l.siteId===N||l.siteName===n);if(c){s.companyName=c.companyName||s.companyName,s.billingCycle=c.billingCycle||s.billingCycle,s.opsIncharge=c.opsIncharge||s.opsIncharge,s.hrIncharge=c.hrIncharge||s.hrIncharge,s.invoiceIncharge=c.invoiceIncharge||s.invoiceIncharge;const l=y=>{if(!y)return"";try{const f=le(y),t=new Date,S=de(t,{date:ge(f),month:he(t),year:me(t)});return pe(S,"yyyy-MM-dd")}catch(f){return console.error("Date adjustment error:",f),""}};s.managerTentativeDate=l(c.managerTentativeDate)||s.managerTentativeDate,s.hrTentativeDate=l(c.hrTentativeDate)||s.hrTentativeDate,s.invoiceSharingTentativeDate=l(c.invoiceSharingTentativeDate)||s.invoiceSharingTentativeDate}}return s})},P=async a=>{if(a.preventDefault(),!r.siteId||!r.siteName){v({message:"Please select a site",type:"error"});return}B(!0);try{const n={...r},h=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;if(n.siteId&&!h.test(n.siteId)&&(n.siteId=null),!g&&k){const{user:s}=M.getState();n.createdBy=k.id,n.createdByName=k.name,n.createdByRole=s?.role}await R.saveSiteInvoiceRecord(n),v({message:`Record ${g?"updated":"created"} successfully!`,type:"success"}),setTimeout(()=>p("/finance?tab=attendance"),1500)}catch(n){console.error("Save error:",n),v({message:"Failed to save record",type:"error"})}finally{B(!1)}};if($)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"}),e.jsx("p",{className:"text-muted italic",children:"Loading form..."})]});const I=({icon:a,title:n,bgColor:h})=>e.jsxs("h4",{className:`text-sm font-bold uppercase tracking-wider border-b ${u?"border-[#1f3d2b]":"border-border/60"} pb-3 mb-6 flex items-center ${h}`,children:[e.jsx(a,{className:"w-5 h-5 mr-2"}),n]}),Z=u?"text-xs font-bold text-gray-400 uppercase tracking-tight ml-1":"text-xs font-bold text-muted uppercase tracking-tight ml-1",o=u?"rounded-xl bg-[#0c2e1f] border-[#1f3d2b] text-white placeholder:text-gray-500":"rounded-xl",ee=u?"w-full flex h-11 rounded-xl border border-[#1f3d2b] bg-[#0c2e1f] px-3 py-2 text-sm text-white focus:outline-none focus:ring-4 focus:ring-primary/10 focus:border-primary transition-all shadow-sm":"w-full flex h-11 rounded-xl border border-border bg-white px-3 py-2 text-sm text-primary-text focus:outline-none focus:ring-4 focus:ring-primary/10 focus:border-primary transition-all shadow-sm",D=u?"bg-card/50 p-4 rounded-xl border border-border space-y-4":"bg-white/40 p-6 rounded-3xl border border-border/50 shadow-sm transition-all hover:shadow-md",F=e.jsxs("form",{onSubmit:P,className:"space-y-12",children:[e.jsxs("div",{className:D,children:[e.jsx(I,{icon:ne,title:"Description",bgColor:"text-orange-600"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"space-y-1 group",children:e.jsx(T,{label:"Select Site",placeholder:"Select or type site name...",options:w.map(a=>({id:a.id,name:a.shortName})),value:r.siteName||"",onChange:a=>{const n=w.find(h=>h.shortName===a);n?i("siteId",n.id):i("siteId",a)},allowCustom:!0})}),e.jsx(d,{id:"companyName",name:"companyName",label:"Company Name",placeholder:"e.g. IFS, IBM",value:r.companyName||"",onChange:a=>i("companyName",a.target.value),className:o}),e.jsxs("div",{className:"space-y-1 group",children:[e.jsx("label",{htmlFor:"billingCycle",className:Z,children:"Billing Cycle"}),e.jsxs("select",{id:"billingCycle",name:"billingCycle",className:ee,value:r.billingCycle||"",onChange:a=>i("billingCycle",a.target.value),children:[e.jsx("option",{value:"",children:"Select cycle..."}),J.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsx("div",{className:"space-y-1 group",children:e.jsx(T,{label:"Ops Incharge",placeholder:"Select or type name...",options:K.map(a=>({id:a,name:a})),value:r.opsIncharge||"",onChange:a=>i("opsIncharge",a),allowCustom:!0})}),e.jsx("div",{className:"space-y-1 group",children:e.jsx(T,{label:"HR Incharge",placeholder:"Select or type name...",options:G.map(a=>({id:a,name:a})),value:r.hrIncharge||"",onChange:a=>i("hrIncharge",a),allowCustom:!0})}),e.jsx("div",{className:"space-y-1 group",children:e.jsx(T,{label:"Invoice Incharge",placeholder:"Select or type name...",options:V.map(a=>({id:a,name:a})),value:r.invoiceIncharge||"",onChange:a=>i("invoiceIncharge",a),allowCustom:!0})}),e.jsx(d,{id:"opsRemarks",name:"opsRemarks",label:"Ops Remarks",placeholder:"Operational notes",value:r.opsRemarks||"",onChange:a=>i("opsRemarks",a.target.value),className:o}),e.jsx(d,{id:"hrRemarks",name:"hrRemarks",label:"HR Remarks",placeholder:"HR notes",value:r.hrRemarks||"",onChange:a=>i("hrRemarks",a.target.value),className:o}),e.jsx(d,{id:"financeRemarks",name:"financeRemarks",label:"Finance Remarks",placeholder:"Finance notes",value:r.financeRemarks||"",onChange:a=>i("financeRemarks",a.target.value),className:o})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:`${D} border-l-4 border-l-yellow-400`,children:[e.jsx(I,{icon:re,title:"Attendance Status (Managers)",bgColor:"text-yellow-700"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsx(d,{id:"managerTentativeDate",name:"managerTentativeDate",label:"Tentative Submission Date",type:"date",value:r.managerTentativeDate||"",onChange:a=>i("managerTentativeDate",a.target.value),className:o}),e.jsx(d,{id:"managerReceivedDate",name:"managerReceivedDate",label:"Attendance Received Date",type:"date",value:r.managerReceivedDate||"",onChange:a=>i("managerReceivedDate",a.target.value),className:o})]})]}),e.jsxs("div",{className:`${D} border-l-4 border-l-blue-400`,children:[e.jsx(I,{icon:ie,title:"Attendance Status (HR)",bgColor:"text-blue-700"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsx(d,{id:"hrTentativeDate",name:"hrTentativeDate",label:"Tentative Submission Date",type:"date",value:r.hrTentativeDate||"",onChange:a=>i("hrTentativeDate",a.target.value),className:o}),e.jsx(d,{id:"hrReceivedDate",name:"hrReceivedDate",label:"Received from HR Date",type:"date",value:r.hrReceivedDate||"",onChange:a=>i("hrReceivedDate",a.target.value),className:o}),e.jsx(d,{id:"attendanceReceivedTime",name:"attendanceReceivedTime",label:"Attendance Received Time",placeholder:"e.g. 5:00 AM",value:r.attendanceReceivedTime||"",onChange:a=>i("attendanceReceivedTime",a.target.value),icon:e.jsx(H,{className:"h-4 w-4"}),className:o.replace("rounded-xl","")})]})]})]}),e.jsxs("div",{className:`${D} border-t-4 border-t-green-400`,children:[e.jsx(I,{icon:oe,title:"Invoice Status",bgColor:"text-green-700"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(d,{id:"invoiceSharingTentativeDate",name:"invoiceSharingTentativeDate",label:"Tentative Sharing Date",type:"date",value:r.invoiceSharingTentativeDate||"",onChange:a=>i("invoiceSharingTentativeDate",a.target.value),className:o}),e.jsx(d,{id:"invoicePreparedDate",name:"invoicePreparedDate",label:"Invoice Prepared Date",type:"date",value:r.invoicePreparedDate||"",onChange:a=>i("invoicePreparedDate",a.target.value),className:o}),e.jsx(d,{id:"invoiceSentDate",name:"invoiceSentDate",label:"Invoice Sent Date",type:"date",value:r.invoiceSentDate||"",onChange:a=>i("invoiceSentDate",a.target.value),className:o}),e.jsx(d,{id:"invoiceSentTime",name:"invoiceSentTime",label:"Sent Timing",placeholder:"e.g. 12:35 PM",value:r.invoiceSentTime||"",onChange:a=>i("invoiceSentTime",a.target.value),icon:e.jsx(H,{className:"h-4 w-4"}),className:o})]})]}),!u&&e.jsxs("div",{className:"flex justify-end space-x-4 pt-8 border-t border-border",children:[e.jsx(C,{type:"button",variant:"secondary",onClick:()=>p("/finance?tab=attendance"),className:"px-6 rounded-xl border-2",children:"Cancel"}),e.jsxs(C,{type:"submit",isLoading:A,className:"px-10 rounded-xl shadow-lg shadow-primary/20",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),g?"Update Entry":"Create Entry"]})]})]});return u?e.jsxs("div",{className:"min-h-screen bg-[#041b0f] pb-20",children:[e.jsxs("header",{className:"fixed top-0 left-0 right-0 z-50 bg-[#041b0f] border-b border-[#1f3d2b] p-4 flex items-center gap-4",style:{paddingTop:"calc(1rem + env(safe-area-inset-top))"},children:[e.jsx("button",{onClick:()=>p("/finance?tab=attendance"),className:"p-2 hover:bg-white/5 rounded-full text-white",children:e.jsx(U,{className:"h-6 w-6"})}),e.jsx("h1",{className:"text-xl font-bold text-white tracking-tight",children:g?"Edit Entry":"New Entry"})]}),e.jsx("main",{className:"p-4",style:{paddingTop:"calc(5rem + env(safe-area-inset-top))"},children:F}),e.jsxs("footer",{className:"fixed bottom-0 left-0 right-0 p-4 bg-[#041b0f] border-t border-[#1f3d2b] flex gap-4 z-[60]",children:[e.jsx(C,{type:"button",variant:"secondary",onClick:()=>p("/finance?tab=attendance"),className:"flex-1 rounded-xl border border-[#1f3d2b] text-white hover:bg-white/5",children:"Cancel"}),e.jsx(C,{type:"button",onClick:P,isLoading:A,className:"flex-1 rounded-xl font-bold bg-primary text-white shadow-lg shadow-primary/20",children:g?"Update":"Create"})]}),b&&e.jsx(L,{message:b.message,type:b.type,onDismiss:()=>v(null)})]}):e.jsxs("div",{className:"p-6 lg:p-10",children:[e.jsxs("button",{onClick:()=>p("/finance?tab=attendance"),className:"flex items-center text-sm font-bold text-muted hover:text-primary transition-all mb-8 group",children:[e.jsx(U,{className:"h-5 w-5 mr-2 group-hover:-translate-x-1 transition-transform"}),"Back to Finance"]}),e.jsx("div",{className:"flex items-start mb-8",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-black text-primary-text tracking-tight leading-tight",children:g?"Edit Tracker Record":"Create Tracker Record"}),e.jsx("p",{className:"text-muted text-lg",children:"Input attendance and invoicing status for site monitoring."})]})}),F,b&&e.jsx(L,{message:b.message,type:b.type,onDismiss:()=>v(null)})]})};export{je as default};
