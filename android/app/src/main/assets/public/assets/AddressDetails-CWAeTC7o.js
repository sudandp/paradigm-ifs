import{d as j,R as k,h as B,n as F,c as O,o as T,Z as V,j as e,I,e as p,m as N}from"./index-D5q3SS3D.js";import{m as R,b as f}from"./react-vendor-BUaIliXj.js";import{F as H}from"./FormHeader-CSy2Sh-o.js";import{V as i}from"./VerifiedInput-CBziK85I.js";import{a2 as W}from"./ui-vendor-B8EvWqdc.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./utils-vendor-DmorxLnX.js";import"./supabase-7WG3J4rU.js";const q=j({line1:p().required("Address line 1 is required"),line2:p().optional(),city:p().required("City is required"),state:p().required("State is required"),country:p().required("Country is required"),pincode:p().required("Pincode is required").matches(/^[1-9][0-9]{5}$/,"Must be a valid 6-digit Indian pincode"),verifiedStatus:j().optional()}).defined(),Y=j({present:q.required(),permanent:q.required(),sameAsPresent:k().required()}).defined(),te=()=>{const{onValidated:M}=R(),{data:t,updateAddress:g,setAddressVerifiedStatus:u}=B(),{address:v}=F(),[w,y]=f.useState(!1),[C,h]=f.useState(""),{register:s,handleSubmit:E,formState:{errors:a},control:x,setValue:c,trigger:S,getValues:Z,reset:P,watch:A}=O({resolver:T(Y),defaultValues:t.address}),b=V({control:x,name:"sameAsPresent"}),l=V({control:x,name:"present"}),m=V({control:x,name:"permanent"});f.useEffect(()=>{P(t.address)},[t.address,P]),f.useEffect(()=>{let n;const d=A(o=>{clearTimeout(n),n=window.setTimeout(()=>{g(o)},500)});return()=>{d.unsubscribe(),clearTimeout(n)}},[A,g]),f.useEffect(()=>{b&&l&&(c("permanent",l),t.address.present.verifiedStatus&&u("permanent",t.address.present.verifiedStatus),S("permanent"))},[b,l,c,S,t.address.present.verifiedStatus,u]);const r=(n,d)=>{u(n,{[d]:!1})},L=async n=>{const d=n.target.value;if(r("present","pincode"),v.enablePincodeVerification&&/^[1-9][0-9]{5}$/.test(d)){y(!0),h("");try{const o=await N.getPincodeDetails(d);c("present.city",o.city,{shouldValidate:!0}),c("present.state",o.state,{shouldValidate:!0}),u("present",{city:!0,state:!0,pincode:!0})}catch{h("Invalid Pincode. Please check and try again.")}finally{y(!1)}}},$=async n=>{const d=n.target.value;if(r("permanent","pincode"),v.enablePincodeVerification&&/^[1-9][0-9]{5}$/.test(d)){y(!0),h("");try{const o=await N.getPincodeDetails(d);c("permanent.city",o.city,{shouldValidate:!0}),c("permanent.state",o.state,{shouldValidate:!0}),u("permanent",{city:!0,state:!0,pincode:!0})}catch{h("Invalid Pincode. Please check and try again.")}finally{y(!1)}}},D=async n=>{g(n),await M()};return e.jsxs("form",{onSubmit:E(D),id:"address-form",children:[e.jsx(H,{title:"Address Details",subtitle:"Your communication and permanent address."}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-primary-text mb-4",children:"Present Address"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsx("div",{className:"sm:col-span-2",children:e.jsx(i,{label:"Address Line 1",id:"present.line1",isVerified:!!t.address.present.verifiedStatus?.line1,hasValue:!!l?.line1,onManualInput:()=>r("present","line1"),error:a.present?.line1?.message,registration:s("present.line1")})}),e.jsx("div",{className:"sm:col-span-2",children:e.jsx(I,{label:"Address Line 2 (Optional)",id:"present.line2",registration:s("present.line2")})}),e.jsx(i,{label:"Country",id:"present.country",isVerified:!!t.address.present.verifiedStatus?.country,hasValue:!!l?.country,onManualInput:()=>r("present","country"),error:a.present?.country?.message,registration:s("present.country")}),e.jsxs("div",{className:"relative",children:[e.jsx(i,{label:"Pincode",id:"present.pincode",type:"tel",isVerified:!!t.address.present.verifiedStatus?.pincode,hasValue:!!l?.pincode,error:a.present?.pincode?.message||C,registration:s("present.pincode"),onBlur:L}),w&&e.jsx(W,{className:"absolute right-3 top-9 h-5 w-5 animate-spin text-muted"})]}),e.jsx(i,{label:"City",id:"present.city",isVerified:!!t.address.present.verifiedStatus?.city,hasValue:!!l?.city,onManualInput:()=>r("present","city"),error:a.present?.city?.message,registration:s("present.city")}),e.jsx(i,{label:"State",id:"present.state",isVerified:!!t.address.present.verifiedStatus?.state,hasValue:!!l?.state,onManualInput:()=>r("present","state"),error:a.present?.state?.message,registration:s("present.state")})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-primary-text mb-4",children:"Permanent Address"}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("input",{id:"sameAsPresent",type:"checkbox",...s("sameAsPresent"),className:"h-4 w-4 text-accent border-gray-300 rounded focus:ring-accent"}),e.jsx("label",{htmlFor:"sameAsPresent",className:"ml-2 block text-sm text-muted",children:"Same as Present Address"})]}),!b&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 animate-fade-in-down",children:[e.jsx("div",{className:"sm:col-span-2",children:e.jsx(i,{label:"Address Line 1",id:"permanent.line1",isVerified:!!t.address.permanent.verifiedStatus?.line1,hasValue:!!m?.line1,onManualInput:()=>r("permanent","line1"),error:a.permanent?.line1?.message,registration:s("permanent.line1")})}),e.jsx("div",{className:"sm:col-span-2",children:e.jsx(I,{label:"Address Line 2 (Optional)",id:"permanent.line2",registration:s("permanent.line2")})}),e.jsx(i,{label:"Country",id:"permanent.country",isVerified:!!t.address.permanent.verifiedStatus?.country,hasValue:!!m?.country,onManualInput:()=>r("permanent","country"),error:a.permanent?.country?.message,registration:s("permanent.country")}),e.jsx(i,{label:"Pincode",id:"permanent.pincode",type:"tel",isVerified:!!t.address.permanent.verifiedStatus?.pincode,hasValue:!!m?.pincode,onManualInput:()=>r("permanent","pincode"),error:a.permanent?.pincode?.message,registration:s("permanent.pincode"),onBlur:$}),e.jsx(i,{label:"City",id:"permanent.city",isVerified:!!t.address.permanent.verifiedStatus?.city,hasValue:!!m?.city,onManualInput:()=>r("permanent","city"),error:a.permanent?.city?.message,registration:s("permanent.city")}),e.jsx(i,{label:"State",id:"permanent.state",isVerified:!!t.address.permanent.verifiedStatus?.state,hasValue:!!m?.state,onManualInput:()=>r("permanent","state"),error:a.permanent?.state?.message,registration:s("permanent.state")})]})]})]})]})};export{Y as addressDetailsSchema,te as default};
