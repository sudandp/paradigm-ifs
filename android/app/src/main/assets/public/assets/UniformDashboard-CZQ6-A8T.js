import{j as e,T as F,B as y,m as g,C as L,I as M}from"./index-D5q3SS3D.js";import{u as U,b as r,R as I}from"./react-vendor-BUaIliXj.js";import{A}from"./AdminPageHeader-wINx_pXe.js";import{M as B}from"./Modal-CR2aBU6L.js";import{a2 as P,ao as G,ak as T,as as $,at as O,X as Q}from"./ui-vendor-B8EvWqdc.js";import{f as W}from"./utils-vendor-DmorxLnX.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./supabase-7WG3J4rU.js";const H=({status:a})=>{const l={Pending:"bg-yellow-100 text-yellow-800",Approved:"bg-blue-100 text-blue-800",Issued:"bg-green-100 text-green-800",Rejected:"bg-red-100 text-red-800"};return e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full capitalize ${l[a]}`,children:a})},b=({title:a,sizes:l,headers:p,control:u,quantityType:f,quantities:h,readOnly:o=!1})=>{const c=Array.from(new Set(l.map(s=>s.fit))),d=Array.from(new Set(l.map(s=>s.size))).sort((s,m)=>{const x=parseInt(String(s)),i=parseInt(String(m));return!isNaN(x)&&!isNaN(i)?x-i:String(s).localeCompare(String(m))});return e.jsxs("div",{className:"border rounded-lg flex flex-col overflow-hidden",children:[e.jsx("h4",{className:"p-3 font-semibold bg-page border-b flex-shrink-0",children:a}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-page",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 text-left font-medium text-muted",children:"Size"}),p.map(s=>e.jsx("th",{className:"px-2 py-2 text-left font-medium text-muted",children:s.label},String(s.key))),e.jsx("th",{className:"px-2 py-2 text-left font-medium text-muted w-20",children:"Qty"})]})}),e.jsx("tbody",{className:"divide-y",children:d.map(s=>e.jsx(I.Fragment,{children:c.map((m,x)=>{const i=l.find(n=>n.size===s&&n.fit===m);return i?e.jsxs("tr",{children:[x===0&&e.jsx("td",{rowSpan:c.filter(n=>l.some(j=>j.size===s&&j.fit===n)).length,className:"px-2 py-2 align-middle font-semibold border-r",children:s}),p.map(n=>e.jsx("td",{className:"px-2 py-2",children:i[n.key]},String(n.key))),e.jsx("td",{className:"px-2 py-2",children:o?e.jsx("span",{className:"font-semibold block text-center pr-4",children:h?.[i.id]||0}):e.jsx(L,{name:`${f}.${i.id}`,control:u,render:({field:n})=>e.jsx(M,{"aria-label":`Quantity for ${a} size ${s} ${m}`,type:"number",...n,value:n.value||"",onChange:j=>n.onChange(parseInt(j.target.value)||null),className:"!py-1.5"})})})]},i.id):null})},s))})]})})]})},V=({request:a,onClose:l,masterUniforms:p})=>{if(!a)return null;const{pantsQuantities:u,shirtsQuantities:f}=r.useMemo(()=>{const o={},c={};return a.items.forEach(d=>{d.category==="Pants"?o[d.sizeId]=d.quantity:c[d.sizeId]=d.quantity}),{pantsQuantities:o,shirtsQuantities:c}},[a.items]),h=a.gender==="Gents"?p.gents:p.ladies;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 p-4",onClick:l,children:e.jsxs("div",{className:"bg-card rounded-xl shadow-card w-full max-w-6xl my-4 animate-fade-in-scale flex flex-col max-h-[90vh]",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-start flex-shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-primary-text",children:"Uniform Request Details"}),e.jsxs("p",{className:"text-sm text-muted",children:[a.siteName," - ",W(new Date(a.requestedDate),"dd MMM, yyyy")]})]}),e.jsx(y,{variant:"icon",onClick:l,children:e.jsx(Q,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"flex-grow overflow-y-auto p-6",children:e.jsx("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:a.gender==="Gents"?e.jsxs(e.Fragment,{children:[e.jsx(b,{readOnly:!0,title:"Gents' Pants",sizes:h.pants,headers:[{key:"length",label:"L"},{key:"waist",label:"W"},{key:"hip",label:"H"},{key:"tilesLoose",label:"TL"},{key:"bottomWaist",label:"BW"},{key:"fit",label:"Fit"}],quantities:u}),e.jsx(b,{readOnly:!0,title:"Gents' Shirts",sizes:h.shirts,headers:[{key:"length",label:"L"},{key:"sleeves",label:"S"},{key:"chest",label:"C"},{key:"shoulder",label:"Sh"},{key:"collar",label:"Co"},{key:"fit",label:"Fit"}],quantities:f})]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{readOnly:!0,title:"Ladies' Pants",sizes:h.pants,headers:[{key:"length",label:"L"},{key:"waist",label:"W"},{key:"hip",label:"H"},{key:"fit",label:"Fit"}],quantities:u}),e.jsx(b,{readOnly:!0,title:"Ladies' Shirts",sizes:h.shirts,headers:[{key:"length",label:"L"},{key:"sleeves",label:"S"},{key:"bust",label:"B"},{key:"shoulder",label:"Sh"},{key:"fit",label:"Fit"}],quantities:f})]})})}),e.jsx("div",{className:"p-4 border-t flex justify-end flex-shrink-0",children:e.jsx(y,{variant:"secondary",onClick:l,children:"Close"})})]})})},ae=()=>{const a=U(),[l,p]=r.useState("list"),[u,f]=r.useState([]),[h,o]=r.useState([]),[c,d]=r.useState(null),[s,m]=r.useState(!0),[x,i]=r.useState(null),[n,j]=r.useState(null),[N,k]=r.useState(null),[S,v]=r.useState(null),w=async()=>{m(!0);try{const[t,q,z,E]=await Promise.all([g.getUniformRequests(),g.getOrganizations(),g.getMasterGentsUniforms(),g.getMasterLadiesUniforms()]);f(t),o(q),d({gents:z,ladies:E})}catch{i({message:"Failed to load uniform data.",type:"error"})}finally{m(!1)}};r.useEffect(()=>{w()},[]);const R=()=>{a("/uniforms/request/new")},C=t=>{a(`/uniforms/request/edit/${t.id}`)},D=async()=>{if(N)try{await g.deleteUniformRequest(N.id),i({message:"Request deleted.",type:"success"}),k(null),w()}catch{i({message:"Failed to delete request.",type:"error"})}};return s?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(P,{className:"h-8 w-8 animate-spin text-accent"})}):e.jsxs("div",{className:"p-4 space-y-6",children:[x&&e.jsx(F,{message:x.message,type:x.type,onDismiss:()=>i(null)}),e.jsx(B,{isOpen:!!N,onClose:()=>k(null),onConfirm:D,title:"Confirm Deletion",children:"Are you sure you want to delete this uniform request? This cannot be undone."}),c&&e.jsx(V,{request:S,onClose:()=>v(null),masterUniforms:c}),e.jsx("div",{className:"bg-card p-4 rounded-2xl",children:e.jsx(A,{title:"Uniform Management",children:l==="list"&&e.jsxs(y,{onClick:R,children:[e.jsx(G,{className:"mr-2 h-4 w-4"})," New Uniform Request"]})})}),l==="list"&&e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full text-sm responsive-table",children:[e.jsx("thead",{className:"bg-page",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Site / Employee"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Gender"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Requested By"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Source"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Actions"})]})}),e.jsx("tbody",{children:u.map(t=>e.jsxs("tr",{children:[e.jsxs("td",{"data-label":"Site",className:"px-4 py-3 font-medium",children:[e.jsx("p",{children:t.siteName}),t.source==="Individual"&&t.employeeDetails?.[0]?.employeeName&&e.jsxs("p",{className:"text-xs text-muted",children:["For: ",t.employeeDetails[0].employeeName]}),t.source==="Enrollment"&&e.jsxs("p",{className:"text-xs text-muted",children:["(",t.employeeDetails?.length||0," employees)"]})]}),e.jsx("td",{"data-label":"Gender",className:"px-4 py-3 text-muted",children:t.gender}),e.jsx("td",{"data-label":"Requested By",className:"px-4 py-3 text-muted",children:t.requestedByName||"System"}),e.jsx("td",{"data-label":"Source",className:"px-4 py-3 text-muted",children:t.source||"Bulk"}),e.jsx("td",{"data-label":"Status",className:"px-4 py-3",children:e.jsx(H,{status:t.status})}),e.jsx("td",{"data-label":"Actions",className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2 md:justify-start justify-end",children:[e.jsx(y,{variant:"icon",size:"sm",onClick:()=>v(t),title:"View Request",children:e.jsx(T,{className:"h-4 w-4"})}),e.jsx(y,{variant:"icon",size:"sm",onClick:()=>C(t),title:"Edit Request",disabled:t.source==="Enrollment",children:e.jsx($,{className:"h-4 w-4"})}),e.jsx(y,{variant:"icon",size:"sm",onClick:()=>k(t),title:"Delete Request",disabled:t.source==="Enrollment",children:e.jsx(O,{className:"h-4 w-4 text-red-600"})})]})})]},t.id))})]}),u.length===0&&e.jsx("p",{className:"text-center p-8 text-muted",children:"No uniform requests found."})]})]})};export{ae as default};
