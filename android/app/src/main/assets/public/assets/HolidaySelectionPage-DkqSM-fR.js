import{u as P,n as E,z as F,M as O,j as e,F as T,T as U,B as b,m as j}from"./index-D5q3SS3D.js";import{u as Y,b as c}from"./react-vendor-BUaIliXj.js";import{H as A}from"./HolidayCalendar-ycAr_EbJ.js";import{a2 as _,i as z,f as B,g as M,m as R,aJ as J}from"./ui-vendor-B8EvWqdc.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./utils-vendor-DmorxLnX.js";import"./supabase-7WG3J4rU.js";const ae=()=>{const h=Y(),{user:r}=P(),{attendance:N}=E(),{isMobile:u}=F(),[v,y]=c.useState(!0),[w,p]=c.useState(!1),[W,S]=c.useState([]),[t,m]=c.useState([]),[x,d]=c.useState(null),o=new Date().getFullYear(),f=r?.role?.toLowerCase(),g=f?.includes("field")?"field":f?.includes("site")?"site":"office",H=N[g]?.holidayPool||O,l=6;c.useEffect(()=>{(async()=>{if(r?.id){y(!0);try{const a=await j.getUserHolidays(r.id);S(a),m(a.map(i=>({name:i.holidayName,date:i.holidayDate})))}catch(a){console.error("Failed to fetch user holidays:",a),d({message:"Failed to load your holiday selections.",type:"error"})}finally{y(!1)}}})()},[r?.id]);const $=(s,a)=>{if(t.some(n=>n.name===s))m(t.filter(n=>n.name!==s));else{if(t.length>=l){d({message:`You can only select up to ${l} holidays.`,type:"error"});return}m([...t,{name:s,date:a}])}},L=async()=>{if(t.length!==l){d({message:`Please select exactly ${l} holidays.`,type:"error"});return}if(r?.id){p(!0);try{const s=t.map(a=>({holidayName:a.name,holidayDate:a.date.startsWith("-")?`${o}${a.date}`:a.date,year:o}));await j.saveUserHolidays(r.id,s),d({message:"Holiday selection saved successfully!",type:"success"}),setTimeout(()=>h("/leaves/dashboard"),1500)}catch(s){console.error("Failed to save holidays:",s),d({message:"Failed to save holiday selection.",type:"error"})}finally{p(!1)}}};if(v)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh]",children:[e.jsx(_,{className:"h-8 w-8 animate-spin text-accent mb-4"}),e.jsx("p",{className:"text-muted",children:"Loading holiday pool..."})]});const C=[...T.map(s=>({id:`fixed-${s.date}`,name:s.name,date:`${o}-${s.date}`,type:g}))],D=t.map(s=>({id:`user-${s.name}`,holidayName:s.name,holidayDate:`${o}${s.date}`,userId:r?.id||"",year:o}));return e.jsxs("div",{className:"p-4 md:p-6 pb-32",children:[x&&e.jsx(U,{message:x.message,type:x.type,onDismiss:()=>d(null)}),e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsx(b,{variant:"secondary",size:"md",onClick:()=>h("/leaves/dashboard"),className:"p-2 rounded-full h-10 w-10 flex items-center justify-center",children:e.jsx(z,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-primary-text",children:"Holiday Selection"}),e.jsxs("p",{className:"text-muted",children:["Pick your optional holidays for ",o]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-card rounded-2xl p-6 shadow-card border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(B,{className:"h-5 w-5 text-accent"}),"Available Holidays"]}),e.jsxs("div",{className:`px-4 py-1 rounded-full text-sm font-medium ${t.length===l?"bg-emerald-500/10 text-emerald-500":"bg-accent/10 text-accent"}`,children:[t.length," / ",l," Selected"]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:H.map((s,a)=>{const i=t.some(k=>k.name===s.name),I=new Date(`${o}${s.date}`).toLocaleDateString("en-IN",{day:"numeric",month:"short",weekday:"short"});return e.jsxs("button",{onClick:()=>$(s.name,s.date),className:`flex items-center justify-between p-4 rounded-xl border transition-all duration-200 text-left ${i?"bg-accent/10 border-accent shadow-sm":"bg-transparent border-border hover:border-accent/50 hover:bg-white/5"}`,children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-xl font-semibold ${u?"text-white":"text-primary-text"}`,children:s.name}),e.jsx("p",{className:`text-base font-bold ${u?"text-white/70":"text-muted"} mt-1`,children:I})]}),e.jsx("div",{className:`h-6 w-6 rounded-full flex items-center justify-center border transition-colors ${i?"bg-accent border-accent text-white":"border-border bg-card"}`,children:i&&e.jsx(M,{className:"h-4 w-4"})})]},a)})}),e.jsxs("div",{className:"mt-8 flex flex-col md:flex-row items-center justify-between gap-4 pt-6 border-t border-border",children:[e.jsxs("p",{className:"text-sm text-muted flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),"Please select exactly ",l," holidays from the pool."]}),e.jsxs(b,{onClick:L,isLoading:w,disabled:t.length!==l,className:"w-full md:w-auto px-12 py-3 shadow-lg shadow-accent/20",children:[e.jsx(J,{className:"mr-2 h-5 w-5"}),"Save Selection"]})]})]})}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"sticky top-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 px-1",children:"Calendar Preview"}),e.jsx(A,{adminHolidays:C,userSelectedHolidays:D}),e.jsxs("div",{className:"mt-6 p-4 bg-accent/5 border border-accent/10 rounded-xl space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-accent-dark",children:"Legend"}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx("div",{className:"h-3 w-3 rounded-full bg-red-500"}),e.jsx("span",{className:"text-muted",children:"Company Holiday"})]}),e.jsxs("div",{className:`flex items-center gap-3 text-sm transition-opacity ${t.length>0?"opacity-100":"opacity-50"}`,children:[e.jsx("div",{className:"h-3 w-3 rounded-full bg-emerald-500"}),e.jsx("span",{className:"text-muted",children:"Your Selection"})]})]})]})})]})]})};export{ae as default};
