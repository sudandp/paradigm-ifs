import{j as e,u as I,k as L,i as T,m as b,T as A,B as m}from"./index-D5q3SS3D.js";import{b as t,u as D}from"./react-vendor-BUaIliXj.js";import{S as O}from"./StatusChip-B0urzFi1.js";import{S as w}from"./Select-Dz12MdxG.js";import{n as N,aj as P,ak as B,F as M}from"./ui-vendor-B8EvWqdc.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./utils-vendor-DmorxLnX.js";import"./supabase-7WG3J4rU.js";const _=({status:r})=>{if(!r)return e.jsx("span",{className:"text-sm font-medium text-muted",children:"-"});const x={pending_sync:"sync-chip--pending_sync",synced:"sync-chip--synced",failed:"sync-chip--failed"},p={pending_sync:"Pending Sync",synced:"Synced",failed:"Failed"},l=x[r];return e.jsx("span",{className:`sync-chip ${l}`,children:p[r]})},K=()=>{const[r,x]=t.useState([]),[p,l]=t.useState(!0),[o,S]=t.useState("all"),[n,v]=t.useState(""),[u,C]=t.useState(null),c=D(),{user:i}=I(),j=L("(max-width: 767px)"),[h,F]=t.useState([]),[a,f]=t.useState(i?.organizationId),d=i&&T(i.role);t.useEffect(()=>{d&&b.getOrganizations().then(s=>{F(s),s.length>0&&!a&&f(s[0].id)})},[d,a]);const g=t.useCallback(async()=>{if(!a){i?.organizationId&&l(!1);return}l(!0);try{const s=["admin","super_admin"].includes(i?.role||""),E=await b.getVerificationSubmissions(o==="all"?void 0:o,a,s?void 0:i?.id);x(E)}catch(s){console.error("Failed to fetch submissions",s)}finally{l(!1)}},[o,a,i?.organizationId]);t.useEffect(()=>{g()},[g]);const y=t.useMemo(()=>r.filter(s=>s.personal.firstName.toLowerCase().includes(n.toLowerCase())||s.personal.lastName.toLowerCase().includes(n.toLowerCase())||s.personal.employeeId.toLowerCase().includes(n.toLowerCase())),[r,n]),k=h.find(s=>s.id===a)?.shortName||i?.organizationName,z=["all","pending","verified","rejected"];return e.jsxs("div",{className:"p-4 border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card",children:[u&&e.jsx(A,{message:u.message,type:u.type,onDismiss:()=>C(null)}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-primary-text",children:"Site Dashboard"}),e.jsxs("p",{className:"text-muted",children:["Viewing submissions for site: ",e.jsx("span",{className:"font-semibold text-accent-dark",children:k||"N/A"})]})]}),!j&&e.jsxs("div",{className:"flex items-center gap-4",children:[d&&e.jsx("div",{className:"w-full sm:w-56",children:e.jsxs(w,{label:"",id:"org-selector",value:a,onChange:s=>f(s.target.value),children:[e.jsx("option",{value:"",children:"Select a Site"}),h.map(s=>e.jsx("option",{value:s.id,children:s.shortName},s.id))]})}),e.jsxs(m,{onClick:()=>c("/onboarding/select-organization"),style:{backgroundColor:"#006B3F",color:"#FFFFFF",borderColor:"#005632"},className:"border hover:opacity-90 text-white shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(N,{className:"mr-2 h-4 w-4"}),"New Enrollment"]})]})]}),j&&e.jsxs("div",{className:"flex flex-col gap-4 mt-6",children:[d&&e.jsxs(w,{label:"Select Site",id:"org-selector-mobile",value:a,onChange:s=>f(s.target.value),children:[e.jsx("option",{value:"",children:"Select a Site"}),h.map(s=>e.jsx("option",{value:s.id,children:s.shortName},s.id))]}),e.jsxs(m,{onClick:()=>c("/onboarding/select-organization"),style:{backgroundColor:"#006B3F",color:"#FFFFFF",borderColor:"#005632"},className:"w-full justify-center border hover:opacity-90 text-white shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(N,{className:"mr-2 h-4 w-4"}),"New Enrollment"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center my-6 gap-4",children:[e.jsx("div",{className:"w-full sm:w-auto border-b border-border",children:e.jsx("nav",{className:"-mb-px flex space-x-6","aria-label":"Tabs",children:z.map(s=>e.jsx("button",{onClick:()=>S(s),className:`${o===s?"border-emerald-500 text-emerald-700":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm capitalize transition-colors duration-200`,children:s},s))})}),e.jsxs("div",{className:"relative w-full sm:w-auto sm:max-w-xs",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(P,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{id:"site-search",name:"siteSearch",type:"text",placeholder:"Search by name or ID...",value:n,onChange:s=>v(s.target.value),className:"block w-full !pl-10 pr-3 py-2 border border-border rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-accent focus:border-accent sm:text-sm"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full responsive-table",children:[e.jsx("thead",{className:"bg-page",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider",children:"Employee"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider",children:"Portal Sync"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:p?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-10 text-muted",children:"Loading submissions..."})}):a?y.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-10 text-muted",children:"No submissions found for this site."})}):y.map(s=>e.jsxs("tr",{children:[e.jsxs("td",{"data-label":"Employee",className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm font-medium text-primary-text",children:[s.personal.firstName," ",s.personal.lastName]}),e.jsx("div",{className:"text-sm text-muted",children:s.personal.employeeId})]}),e.jsx("td",{"data-label":"Status",className:"px-6 py-4 whitespace-nowrap",children:e.jsx(O,{status:s.status})}),e.jsx("td",{"data-label":"Portal Sync",className:"px-6 py-4 whitespace-nowrap",children:e.jsx(_,{status:s.portalSyncStatus})}),e.jsx("td",{"data-label":"Actions",className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex items-center gap-2 md:justify-start justify-end",children:[e.jsx(m,{variant:"icon",size:"sm",onClick:()=>c(`/onboarding/add/personal?id=${s.id}`),title:"View/Edit Details",children:e.jsx(B,{className:"h-4 w-4"})}),e.jsx(m,{variant:"icon",size:"sm",onClick:()=>c(`/onboarding/pdf/${s.id}`),title:"Download Forms",children:e.jsx(M,{className:"h-4 w-4"})})]})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-10 text-muted",children:"Please select a site to view submissions."})})})]})})]})};export{K as default};
