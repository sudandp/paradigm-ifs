import{d as P,S as v,e as g,R as V,u as T,h as I,k as D,c as E,o as O,_ as j,j as e,C as y,I as k}from"./index-D5q3SS3D.js";import{m as $,b as U}from"./react-vendor-BUaIliXj.js";import{F as q}from"./FormHeader-CSy2Sh-o.js";import{U as l}from"./UploadDocument-BAL6UInC.js";import{V as M}from"./VerifiedInput-CBziK85I.js";import"./ui-vendor-B8EvWqdc.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./utils-vendor-DmorxLnX.js";import"./supabase-7WG3J4rU.js";import"./CameraCaptureModal-DQDGRnEP.js";const R=P({hasPreviousPf:V().required(),uanNumber:g().when("hasPreviousPf",{is:!0,then:s=>s.required("UAN Number is required").matches(/^[0-9]{12}$/,"UAN must be 12 digits"),otherwise:s=>s.optional().nullable()}),pfNumber:g().when("hasPreviousPf",{is:!0,then:s=>s.optional().nullable(),otherwise:s=>s.optional().nullable()}),document:v().optional().nullable(),salarySlip:v().optional().nullable(),verifiedStatus:P().optional()}).defined(),Z=()=>{const{onValidated:s,setToast:c}=$(),{user:L}=T(),{data:r,updateUan:n,setUanVerifiedStatus:m}=I(),S=D("(max-width: 767px)"),{register:t,control:d,handleSubmit:p,formState:{errors:b},setValue:h,watch:u,reset:f}=E({resolver:O(R),defaultValues:r.uan});U.useEffect(()=>{f(r.uan)},[r.uan,f]),U.useEffect(()=>{let a;const o=u(i=>{clearTimeout(a),a=window.setTimeout(()=>{n(i)},500)});return()=>{o.unsubscribe(),clearTimeout(a)}},[u,n]);const N=u("hasPreviousPf"),A=u(),x=async a=>{n(a),await s()},w=()=>{m({uanNumber:!1})},F=a=>{if(a.uanNumber){const o=a.uanNumber.replace(/\D/g,"");if(o.length===12){const i={uanNumber:o,hasPreviousPf:!0};h("uanNumber",o,{shouldValidate:!0}),h("hasPreviousPf",!0,{shouldValidate:!0}),n(i),m({uanNumber:!0}),c({message:"UAN extracted successfully.",type:"success"})}}},C={type:j.OBJECT,properties:{uanNumber:{type:j.STRING,description:"The 12-digit Universal Account Number (UAN)."}},required:["uanNumber"]};return S?e.jsxs("form",{onSubmit:p(x),id:"uan-form",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"Provide your Universal Account Number if you have one."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"flex items-center gap-3 p-4 bg-[#243524] rounded-lg border border-[#374151]",children:[e.jsx("input",{type:"checkbox",...t("hasPreviousPf"),className:"h-5 w-5 rounded text-accent focus:ring-accent bg-transparent border-[#9ca89c]"}),e.jsx("span",{children:"Do you have a previous PF account or UAN?"})]}),N&&e.jsxs("div",{className:"space-y-4 animate-fade-in-down",children:[e.jsx("input",{placeholder:"UAN Number",...t("uanNumber"),className:"form-input"}),e.jsx("input",{placeholder:"PF Number (Optional)",...t("pfNumber"),className:"form-input"}),e.jsx(y,{name:"document",control:d,render:({field:a})=>e.jsx(l,{label:"Upload Proof (Payslip, etc.)",file:a.value,onFileChange:a.onChange,allowCapture:!0,costingItemName:"EPF UAN Lookup"})})]})]})]}):e.jsxs("form",{onSubmit:p(x),id:"uan-form",children:[e.jsx(q,{title:"UAN / PF Details",subtitle:"Provide your Universal Account Number if you have one."}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"hasPreviousPf",type:"checkbox",...t("hasPreviousPf"),className:"h-4 w-4 text-accent border-gray-300 rounded focus:ring-accent"}),e.jsx("label",{htmlFor:"hasPreviousPf",className:"ml-2 block text-sm text-muted",children:"Do you have a previous PF account or UAN?"})]}),r.uan.salarySlip&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"text-md font-semibold text-primary-text mb-2",children:"Reference Salary Slip"}),e.jsx(l,{label:"",file:r.uan.salarySlip,onFileChange:()=>{}})]}),N&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 animate-fade-in-down",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(M,{label:"UAN Number",id:"uanNumber",hasValue:!!A.uanNumber,isVerified:r.uan.verifiedStatus?.uanNumber===!0,onManualInput:w,registration:t("uanNumber"),error:b.uanNumber?.message}),e.jsx(k,{label:"PF Number (Optional)",id:"pfNumber",registration:t("pfNumber"),error:b.pfNumber?.message})]}),e.jsx(y,{name:"document",control:d,render:({field:a})=>e.jsx(l,{label:"Upload Proof (Payslip, etc.)",file:a.value,onFileChange:a.onChange,onOcrComplete:F,ocrSchema:C,setToast:c,costingItemName:"EPF UAN Lookup"})})]})]})]})};export{Z as default,R as uanDetailsSchema};
