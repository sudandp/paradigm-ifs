import{j as e,h as G,m as V,B as _}from"./index-D5q3SS3D.js";import{u as X,b as o}from"./react-vendor-BUaIliXj.js";import{C as q}from"./CameraCaptureModal-DQDGRnEP.js";import{X as Y,d as Z,e as H,aA as J,a2 as $,bc as K,bd as Q,at as T,b2 as ee,U as te,be as ae,I as se,aa as re,ah as ne,ac as ie,F as le}from"./ui-vendor-B8EvWqdc.js";const ce=({isOpen:r,onClose:s,imageUrl:m})=>r?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-80 p-4",onClick:s,role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",onClick:d=>d.stopPropagation(),children:[e.jsx("img",{src:m,alt:"Document Preview",className:"max-w-full max-h-full object-contain rounded-lg"}),e.jsx("button",{onClick:s,className:"absolute top-0 right-0 m-2 p-2 bg-black/50 rounded-full text-white hover:bg-black/80 transition-colors","aria-label":"Close image preview",children:e.jsx(Y,{className:"h-6 w-6"})})]})}):null,pe=({label:r,file:s,onFileChange:m,allowedTypes:d=["image/jpeg","image/png","application/pdf"],error:A,allowCapture:P=!1,costingItemName:f,verificationStatus:C,onOcrComplete:b,ocrSchema:g,setToast:j,docType:L,onVerification:w})=>{const F=X(),[x,v]=o.useState(!1),[O,l]=o.useState(""),[z,R]=o.useState(!1),[S,D]=o.useState(!1),{logVerificationUsage:U}=G.getState(),B=()=>{if(s?.preview){const t=new URLSearchParams({url:s.preview,title:r});F(`/image-viewer?${t.toString()}`)}},E=o.useMemo(()=>{const t=r.toLowerCase();return t.includes("photo")?"profile":["proof","document","card","slip","passbook","cheque","certificate"].some(a=>t.includes(a))?"document":"none"},[r]),N=o.useCallback(async(t,a)=>{if(!d.includes(t.type)){l(`Invalid file type. Allowed: ${d.join(", ")}.`);return}if(t.size>5*1024*1024){l("File size must be less than 5MB.");return}l(""),v(!0);const c=a?`data:${t.type};base64,${a}`:URL.createObjectURL(t);let h={name:t.name,type:t.type,size:t.size,preview:c,file:t};m(h),f&&U(f);try{const u=a||await new Promise((n,k)=>{const i=new FileReader;i.onloadend=()=>n(i.result.split(",")[1]),i.onerror=k,i.readAsDataURL(t)});if(w){const n=await w(u,t.type);if(!n.success){l(n.reason),v(!1);return}}if(b&&g&&j)try{const n=await V.extractDataFromImage(u,t.type,g,L);b(n)}catch(n){console.error("OCR failed:",n),j({message:"AI extraction failed. Please check the document.",type:"error"})}}catch(u){l(u.message||"Processing failed.")}finally{v(!1)}},[d,m,f,U,b,g,j,L,w]),M=o.useCallback(async(t,a)=>{try{const c=atob(t),h=new ArrayBuffer(c.length),u=new Uint8Array(h);for(let i=0;i<c.length;i++)u[i]=c.charCodeAt(i);const n=new Blob([h],{type:a}),k=new File([n],`capture-${Date.now()}.jpg`,{type:a});N(k,t)}catch(c){console.error("Error processing captured image:",c),l("Failed to process captured photo.")}},[N]),W=()=>{s&&!s.preview.startsWith("data:")&&URL.revokeObjectURL(s.preview),m(null),l("")},p=`file-upload-${r.replace(/\s+/g,"-")}`,y=A||O,I=(t=>{const a=t.toLowerCase();return a.includes("profile photo")?te:a.includes("id proof")||a.includes("aadhaar")||a.includes("pan")||a.includes("voter")?ae:a.includes("bank proof")?se:a.includes("signature")?re:a.includes("fingerprint")?ne:a.includes("certificate")?ie:le})(r);return e.jsxs("div",{className:"w-full",children:[e.jsx(ce,{isOpen:S,onClose:()=>D(!1),imageUrl:s?.preview||""}),z&&e.jsx(q,{isOpen:z,onClose:()=>R(!1),onCapture:M,captureGuidance:E,autoConfirm:!0}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-muted",htmlFor:p,children:r}),C===!0&&e.jsx("span",{title:"Verified",children:e.jsx(Z,{className:"h-4 w-4 text-green-400"})}),C===!1&&e.jsx("span",{title:"Verification Failed",children:e.jsx(H,{className:"h-4 w-4 text-red-400"})})]}),e.jsx("div",{className:"w-full text-center transition-all duration-300",children:s?e.jsxs("div",{className:`
                        w-full flex flex-col p-4 border-2 border-dashed rounded-lg bg-page/50 relative overflow-hidden
                        border-accent/30 pro-dark-theme:bg-accent/5 pro-dark-theme:border-accent/40
                        min-h-[160px] justify-center
                     `,children:[e.jsx("div",{className:"absolute inset-0 z-0 flex items-center justify-center opacity-[0.03] select-none pointer-events-none",children:e.jsx(I,{className:"h-32 w-32"})}),e.jsxs("div",{className:"relative z-10 w-full flex flex-col items-center justify-center group",children:[s.type.startsWith("image/")&&e.jsxs("div",{className:`relative flex items-center justify-center ${r.toLowerCase().includes("photo")?"w-32 h-32 rounded-full ring-4 ring-white shadow-xl":"w-full"} bg-black/5 overflow-hidden`,children:[e.jsx("img",{src:s.preview,alt:"preview",className:`
                                            ${r.toLowerCase().includes("photo")?"w-full h-full object-cover":"max-w-full max-h-[180px] object-contain"}
                                            rounded transition-transform duration-500 group-hover:scale-105 shadow-sm
                                            ${x?"opacity-40 blur-[2px]":"opacity-100"}
                                        `}),!x&&e.jsx("label",{htmlFor:p,className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center cursor-pointer",children:e.jsx("div",{className:"bg-white/20 backdrop-blur-md p-3 rounded-full transform scale-90 group-hover:scale-100 transition-transform",children:e.jsx(J,{className:"h-6 w-6 text-white"})})}),x&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/10 backdrop-blur-[1px]",children:[e.jsx($,{className:"h-8 w-8 animate-spin text-accent"}),e.jsx("span",{className:"text-[10px] font-bold text-white mt-2 drop-shadow-md uppercase tracking-widest",children:"Analyzing..."})]})]}),!s.type.startsWith("image/")&&e.jsxs("div",{className:"text-muted p-8 bg-black/5 rounded-xl flex flex-col items-center justify-center border border-border/20 w-full relative",children:[x&&e.jsxs("div",{className:"absolute inset-0 z-20 flex flex-col items-center justify-center bg-white/80 backdrop-blur-sm rounded-xl",children:[e.jsx($,{className:"h-8 w-8 animate-spin text-accent"}),e.jsx("p",{className:"text-[10px] font-bold text-accent mt-2",children:"ANALYZING..."})]}),e.jsx("div",{className:"p-4 bg-accent/10 rounded-2xl mb-4",children:e.jsx(K,{className:"h-10 w-10 text-accent"})}),e.jsx("span",{className:"text-sm font-bold text-primary-text break-all max-w-[200px] text-center",children:s.name}),e.jsxs("p",{className:"text-xs text-muted mt-1",children:[(s.size/(1024*1024)).toFixed(2)," MB"]}),!x&&e.jsx("label",{htmlFor:p,className:"mt-4 text-xs font-bold bg-accent text-white px-5 py-2 rounded-full cursor-pointer hover:bg-accent-dark transition-all shadow-sm active:scale-95",children:"Change File"})]})]}),!x&&e.jsxs("div",{className:"mt-3 relative z-10 flex items-center justify-center gap-4 border-t border-border/30 pt-3",children:[s.type.startsWith("image/")&&e.jsxs("button",{type:"button",onClick:B,className:"text-xs font-semibold text-accent hover:text-accent-dark flex items-center gap-1.5 px-3 py-1 rounded-full bg-accent/10 transition-colors",children:[e.jsx(Q,{className:"h-3.5 w-3.5"})," View Full Size"]}),e.jsxs("button",{type:"button",onClick:W,className:"text-xs font-semibold text-red-500 hover:text-red-600 flex items-center gap-1.5 px-3 py-1 rounded-full bg-red-50 transition-colors",children:[e.jsx(T,{className:"h-3.5 w-3.5"})," Clear"]})]})]}):e.jsxs("label",{htmlFor:p,className:`
                        cursor-pointer flex flex-col items-center justify-center
                        p-6 border-2 border-dashed rounded-lg transition-all duration-300
                        bg-page/30 border-border hover:border-accent hover:bg-accent-light
                        pro-dark-theme:border-accent/30 pro-dark-theme:hover:border-accent pro-dark-theme:bg-accent/5
                        ${y?"!border-red-500 shadow-[0_0_10px_rgba(239,68,68,0.1)]":""}
                        min-h-[180px]
                    `,children:[e.jsx("div",{className:"p-4 bg-accent/5 rounded-full text-accent pro-dark-theme:bg-accent/10",children:e.jsx(I,{className:"h-10 w-10"})}),e.jsx("p",{className:"font-bold text-primary-text mt-3",children:"Click to upload"}),e.jsx("p",{className:"text-xs text-muted mt-1 uppercase tracking-wider",children:"or drag & drop"}),P&&e.jsxs("div",{className:"w-full flex flex-col items-center mt-4",children:[e.jsxs("div",{className:"flex items-center w-full max-w-[120px] mb-4",children:[e.jsx("div",{className:"h-px flex-1 bg-border/50"}),e.jsx("span",{className:"px-3 text-[10px] font-bold text-muted/60",children:"OR"}),e.jsx("div",{className:"h-px flex-1 bg-border/50"})]}),e.jsxs(_,{type:"button",onClick:t=>{t.preventDefault(),R(!0)},variant:"secondary",size:"sm",className:"!rounded-full font-bold shadow-sm",children:[e.jsx(ee,{className:"h-4 w-4 mr-2 text-accent"}),"Capture with Camera"]})]})]})}),e.jsx("input",{id:p,type:"file",className:"sr-only",onChange:t=>t.target.files?.[0]&&N(t.target.files[0]),accept:d.join(",")}),e.jsx("div",{className:"text-center mt-1 min-h-[16px]",children:y&&e.jsx("p",{className:"text-xs text-red-500",children:y})})]})};export{pe as U};
