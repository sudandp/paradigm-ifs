const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D5q3SS3D.js","assets/ui-vendor-B8EvWqdc.js","assets/react-vendor-BUaIliXj.js","assets/pdf-vendor-CB_F1AVu.js","assets/capacitor-vendor-CqiIOUn1.js","assets/utils-vendor-DmorxLnX.js","assets/supabase-7WG3J4rU.js","assets/index-T8TUKm63.css"])))=>i.map(i=>d[i]);
import{_ as Q}from"./pdf-vendor-CB_F1AVu.js";import{V as X,E as Z,j as e,T as q,B as z,W as J,X as Y}from"./index-D5q3SS3D.js";import{b as l}from"./react-vendor-BUaIliXj.js";import{M as ee}from"./Modal-CR2aBU6L.js";import{f as M}from"./date-D8dFQo9a.js";import{S as A,a1 as g,Q as u,bk as S,b as T,m as se,at as te,K as ae,bl as U,ay as re,T as ne,d as ie}from"./ui-vendor-B8EvWqdc.js";const pe=({userId:j,userRole:N="staff",canManage:b=!1,className:E="",showTitle:P=!0})=>{const[m,R]=l.useState([]),[V,w]=l.useState(!0),[_,B]=l.useState(""),[f,p]=l.useState(null),[t,h]=l.useState(null),[x,W]=l.useState({web:1,android:1,ios:1});l.useEffect(()=>{I(),O(),G()},[j,N]);const G=async()=>{try{const{getDeviceLimits:s}=await Q(async()=>{const{getDeviceLimits:a}=await import("./index-D5q3SS3D.js").then(n=>n.a8);return{getDeviceLimits:a}},__vite__mapDeps([0,1,2,3,4,5,6,7])),r=await s(N);W(r)}catch(s){console.error("Error loading limits:",s)}},I=async()=>{try{w(!0);const s=await X(j);R(s)}catch(s){console.error("Error loading devices:",s),p({message:"Failed to load devices",type:"error"})}finally{w(!1)}},O=async()=>{try{const{deviceIdentifier:s}=await Z();B(s)}catch(s){console.error("Error identifying device:",s)}},F=async s=>{if(!b)return;const r=s.status==="revoked",a=r?"Are you sure you want to permanently delete this device history? This cannot be undone.":"Are you sure you want to remove this device? The user will need to register it again to use it.";if(window.confirm(a))try{r?(await J(s.id),p({message:"Device deleted permanently",type:"success"})):(await Y(s.id),p({message:"Device removed successfully",type:"success"})),await I()}catch(n){console.error("Error removing/deleting device:",n),p({message:"Failed to remove device",type:"error"})}},C=s=>{const r=s.deviceType.toLowerCase(),a=s.deviceInfo?.os?.toLowerCase()||"";return s.deviceInfo?.deviceModel?.toLowerCase(),s.deviceName.toLowerCase(),a.includes("ios")||a.includes("iphone")?e.jsx(u,{className:"w-5 h-5 text-gray-800"}):a.includes("ipad")?e.jsx(u,{className:"w-5 h-5 text-gray-800"}):a.includes("mac")?e.jsx(g,{className:"w-5 h-5 text-gray-800"}):r==="android"?e.jsx(u,{className:"w-5 h-5 text-green-500"}):e.jsx(g,{className:"w-5 h-5"})},k=s=>{switch(s.toLowerCase()){case"active":return e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(ie,{className:"w-3 h-3 mr-1"})," Active"]});case"pending":return e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(T,{className:"w-3 h-3 mr-1"})," Pending Approval"]});case"revoked":return e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800",children:[e.jsx(ne,{className:"w-3 h-3 mr-1"})," Revoked"]});default:return e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800",children:s})}},v=(s,r)=>s>r?"bg-red-50 border-red-100 text-red-700":s===r?"bg-amber-50 border-amber-100 text-amber-700":"bg-blue-50 border-blue-100 text-blue-700",L=m.filter(s=>s.deviceType.toLowerCase()==="web"&&s.status.toLowerCase()==="active").length,D=m.filter(s=>s.deviceType.toLowerCase()==="android"&&s.status.toLowerCase()==="active").length,$=m.filter(s=>s.deviceType.toLowerCase()==="ios"&&s.status.toLowerCase()==="active").length;return e.jsxs("div",{className:`space-y-6 ${E}`,children:[f&&e.jsx(q,{message:f.message,type:f.type,onDismiss:()=>p(null)}),P&&e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-900 flex items-center",children:[e.jsx(A,{className:"w-5 h-5 mr-2 text-primary"})," Registered Devices"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:`px-3 py-1 border rounded-lg text-xs font-semibold flex items-center gap-1.5 ${v(L,x.web)}`,children:[e.jsx(g,{className:"w-3.5 h-3.5"})," Laptop / PC: ",L," / ",x.web]}),e.jsxs("div",{className:`px-3 py-1 border rounded-lg text-xs font-semibold flex items-center gap-1.5 ${v(D,x.android)}`,children:[e.jsx(u,{className:"w-3.5 h-3.5"})," Android: ",D," / ",x.android]}),e.jsxs("div",{className:`px-3 py-1 border rounded-lg text-xs font-semibold flex items-center gap-1.5 ${v($,x.ios)}`,children:[e.jsx(u,{className:"w-3.5 h-3.5"})," iOS: ",$," / ",x.ios]})]})]}),V?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"animate-pulse bg-gray-50 h-20 rounded-lg"},s))}):m.length>0?e.jsx("div",{className:"space-y-4",children:m.map(s=>{const r=s.deviceIdentifier===_;return e.jsx("div",{className:`border rounded-xl p-4 transition-all ${r?"border-primary ring-1 ring-primary bg-primary/5":"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${r?"bg-white text-primary":"bg-gray-100 text-gray-500"}`,children:C(s)}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:(()=>{const a=s.deviceInfo||{},n=(a.os||"").toLowerCase(),H=(a.manufacturer||"").toLowerCase(),y=(a.deviceModel||"").toLowerCase(),d=a.browser||"";if(H.includes("apple")||n.includes("mac")||n.includes("ios")||n.includes("iphone")||n.includes("ipad"))return n.includes("iphone")||y.includes("iphone")?`iPhone (${d})`:n.includes("ipad")||y.includes("ipad")?`iPad (${d})`:n.includes("mac")||y.includes("mac")?`MacBook / iMac (${d})`:`Apple Device (${d})`;if(s.deviceType.toLowerCase()==="android"||n.includes("android")){const i=a.hardwareModel||a.deviceModel,c=(a.manufacturer||"").replace(/Google Inc\.?/i,"Google");let o="Android Device";return i&&c?o=i.toLowerCase().includes(c.toLowerCase())?i:`${c} ${i}`:o=i||c||"Android Device",(o.toUpperCase()==="K"||o.toUpperCase()==="UNKNOWN")&&(o="Android Device"),`${o} (${d})`}if(a.deviceModel||a.manufacturer){const i=a.deviceModel||"",c=(a.manufacturer||"").replace(/Google Inc\.?/i,"Google");let o="";return i&&c?o=i.toLowerCase().includes(c.toLowerCase())?i:`${c} ${i}`:o=i||c,`${o} Laptop/PC (${d})`}return s.deviceName||`${n||"Unknown"} System (${d})`})()}),r&&e.jsx("span",{className:"text-xs bg-primary text-white px-2 py-0.5 rounded-full",children:"Current"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-500",children:[e.jsx("span",{children:s.deviceType.toLowerCase()==="web"?`${s.deviceInfo?.browser} on ${s.deviceInfo?.os||s.deviceInfo?.platform}`:`${s.deviceInfo?.manufacturer||""} ${s.deviceInfo?.deviceModel||s.deviceInfo?.platform||""}`}),s.deviceInfo?.ipAddress&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-300",children:"•"}),e.jsxs("span",{className:"flex items-center gap-1 bg-gray-50 px-1.5 py-0.5 rounded border border-gray-100 text-[11px] font-mono",children:[e.jsx(S,{className:"w-3 h-3 text-accent/70"})," ",s.deviceInfo.ipAddress]})]}),e.jsx("span",{className:"text-gray-300",children:"•"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-3 h-3"})," ",M(s.lastUsedAt)]})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[s.deviceInfo?.batteryLevel!==void 0&&e.jsxs("span",{className:"flex items-center gap-1 bg-gray-50 px-2 py-0.5 rounded border border-gray-100 text-[10px] font-medium text-gray-600",children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${s.deviceInfo.batteryLevel>.2?"bg-green-500":"bg-red-500"}`}),"Battery: ",Math.round(s.deviceInfo.batteryLevel*100),"% ",s.deviceInfo.isCharging?"(Charging)":""]}),s.deviceInfo?.connectionType&&e.jsxs("span",{className:"flex items-center gap-1 bg-gray-50 px-2 py-0.5 rounded border border-gray-100 text-[10px] font-medium text-gray-600 uppercase",children:["Network: ",s.deviceInfo.connectionType]}),s.deviceInfo?.appVersion&&e.jsxs("span",{className:"flex items-center gap-1 bg-gray-50 px-2 py-0.5 rounded border border-gray-100 text-[10px] font-medium text-gray-600",children:["App v",s.deviceInfo.appVersion]}),s.deviceInfo?.androidId&&e.jsxs("span",{className:"flex items-center gap-1 bg-gray-50 px-2 py-0.5 rounded border border-gray-100 text-[10px] font-medium text-gray-600 font-mono",children:["Android ID: ",s.deviceInfo.androidId]})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-400 font-mono",children:["System ID: ",s.id.slice(0,8),"..."]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-3",children:[k(s.status),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>h(s),className:"p-1.5 text-gray-400 hover:text-accent hover:bg-accent-soft rounded-lg transition-colors",title:"View device details",children:e.jsx(se,{className:"w-4 h-4"})}),b&&e.jsx("button",{onClick:()=>F(s),className:"text-red-500 hover:text-red-700 p-1 hover:bg-red-50 rounded transition-colors",title:"Remove Device",children:e.jsx(te,{className:"w-4 h-4"})})]})]})]})},s.id)})}):e.jsxs("div",{className:"text-center py-12 text-gray-500 bg-gray-50 rounded-xl border border-dashed border-gray-200",children:[e.jsx(g,{className:"w-12 h-12 mx-auto text-gray-300 mb-3"}),e.jsx("p",{children:"No devices registered yet."})]}),e.jsx(ee,{isOpen:!!t,onClose:()=>h(null),title:"Device Information",hideFooter:!0,maxWidth:"md:max-w-lg",children:t&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-xl border border-gray-100",children:[e.jsx("div",{className:"p-3 bg-white text-primary rounded-lg shadow-sm",children:C(t)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-gray-900",children:t.deviceName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Registered: ",M(t.registeredAt)]})]}),e.jsx("div",{className:"ml-auto",children:k(t.status)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 text-blue-600 rounded-lg",children:e.jsx(g,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"block text-[10px] uppercase font-bold text-gray-400 tracking-wider",children:"Manufacturer"}),e.jsx("p",{className:"text-sm font-medium text-gray-700",children:t.deviceInfo?.manufacturer||"Unknown"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-50 text-purple-600 rounded-lg",children:e.jsx(ae,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"block text-[10px] uppercase font-bold text-gray-400 tracking-wider",children:"Hardware Model"}),e.jsx("p",{className:"text-sm font-medium text-gray-700",children:t.deviceInfo?.deviceModel||"Unknown"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-50 text-orange-600 rounded-lg",children:e.jsx(A,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] uppercase font-bold text-gray-400 tracking-wider",children:"Operating System"}),e.jsx("p",{className:"text-sm font-medium text-gray-700",children:(()=>{const s=t.deviceInfo?.os||"",r=t.deviceInfo?.osVersion||"",a=s.charAt(0).toUpperCase()+s.slice(1);return r.toLowerCase().startsWith(s.toLowerCase())?r:`${a} ${r}`})()})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-green-50 text-green-600 rounded-lg",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] uppercase font-bold text-gray-400 tracking-wider",children:"Battery Status"}),e.jsx("p",{className:"text-sm font-medium text-gray-700",children:t.deviceInfo?.batteryLevel!==void 0?`${Math.round(t.deviceInfo.batteryLevel*100)}% ${t.deviceInfo.isCharging?"(Charging)":""}`:"Unknown"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-indigo-50 text-indigo-600 rounded-lg",children:e.jsx(re,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] uppercase font-bold text-gray-400 tracking-wider",children:"Network Info"}),e.jsx("p",{className:"text-sm font-medium text-gray-700 uppercase",children:t.deviceInfo?.connectionType||"Unknown"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-pink-50 text-pink-600 rounded-lg",children:e.jsx(S,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] uppercase font-bold text-gray-400 tracking-wider",children:"Public IP API"}),e.jsx("p",{className:"text-sm font-mono text-gray-700",children:t.deviceInfo?.ipAddress||"Not recorded"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-50 text-amber-600 rounded-lg",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] uppercase font-bold text-gray-400 tracking-wider",children:"Screen"}),e.jsx("p",{className:"text-sm font-medium text-gray-700",children:t.deviceInfo?.screenResolution||"Unknown"})]})]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"App Version"}),e.jsxs("span",{className:"font-medium text-gray-700",children:["v",t.deviceInfo?.appVersion||"Unknown"]})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Hardware Signature"}),e.jsx("span",{className:"font-mono text-gray-700 text-[10px]",children:t.deviceInfo?.canvas?`HW-${t.deviceInfo.canvas.slice(-8).toUpperCase()}`:"GENERIC-ID"})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"System ID"}),e.jsxs("span",{className:"font-mono text-gray-700",children:[t.id.slice(0,18),"..."]})]}),t.deviceInfo?.androidId&&e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Android ID"}),e.jsx("span",{className:"font-mono text-gray-700",children:t.deviceInfo.androidId})]})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx(z,{onClick:()=>h(null),variant:"secondary",className:"w-full",children:"Close"})})]})})]})};export{pe as U};
