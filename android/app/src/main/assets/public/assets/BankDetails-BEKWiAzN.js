import{d as A,S as q,e as b,f as w,u as F,h as P,k as U,c as M,o as O,_ as l,j as a,C as B}from"./index-D5q3SS3D.js";import{m as $,b as y}from"./react-vendor-BUaIliXj.js";import{F as E}from"./FormHeader-CSy2Sh-o.js";import{U as H}from"./UploadDocument-BAL6UInC.js";import{V as d}from"./VerifiedInput-CBziK85I.js";import"./ui-vendor-B8EvWqdc.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./utils-vendor-DmorxLnX.js";import"./supabase-7WG3J4rU.js";import"./CameraCaptureModal-DQDGRnEP.js";const k=u=>u?u.toLowerCase().replace(/\b(\w)/g,N=>N.toUpperCase()):"",R=b().matches(/^[a-zA-Z\s.'-]*$/,"Name can only contain letters and spaces").transform(k),G=A({accountHolderName:R.required("Account holder name is required"),accountNumber:b().required("Account number is required").matches(/^[0-9]+$/,"Must be only digits"),confirmAccountNumber:b().oneOf([w("accountNumber")],"Account numbers must match").required("Please confirm your account number"),ifscCode:b().required("IFSC code is required").transform(u=>u.toUpperCase()).matches(/^[A-Z]{4}0[A-Z0-9]{6}$/,"Invalid IFSC code format (e.g., SBIN0123456)"),bankName:b().required("Bank name is required"),branchName:b().required("Branch name is required"),bankProof:q().optional().nullable(),verifiedStatus:A().optional()}).defined(),ae=()=>{const{onValidated:u,setToast:N}=$(),{user:Z}=F(),{data:c,updateBank:f,setBankVerifiedStatus:C}=P(),I=U("(max-width: 767px)"),{register:o,handleSubmit:g,formState:{errors:i},control:S,setValue:s,watch:h,reset:V}=M({resolver:O(G),defaultValues:c.bank});y.useEffect(()=>{V(c.bank)},[c.bank,V]),y.useEffect(()=>{let e;const r=h(t=>{clearTimeout(e),e=window.setTimeout(()=>{f(t)},500)});return()=>{r.unsubscribe(),clearTimeout(e)}},[h,f]);const m=h(),j=async e=>{f(e),await u()},x=e=>{const r=e.target.value;s("accountHolderName",k(r),{shouldValidate:!0})},p=e=>{const r={};e.forEach(t=>{r[t]=!1}),C(r)},T=e=>{const r={},t={};if(e.accountHolderName){const n=k(e.accountHolderName);s("accountHolderName",n,{shouldValidate:!0}),r.accountHolderName=n,t.accountHolderName=!0}if(e.accountNumber){const n=e.accountNumber.replace(/\D/g,"");s("accountNumber",n,{shouldValidate:!0}),s("confirmAccountNumber",n,{shouldValidate:!0}),r.accountNumber=n,r.confirmAccountNumber=n,t.accountNumber=!0}if(e.ifscCode){const n=e.ifscCode.toUpperCase().replace(/\s/g,"");s("ifscCode",n,{shouldValidate:!0}),r.ifscCode=n,t.ifscCode=!0}e.bankName&&(s("bankName",e.bankName,{shouldValidate:!0}),r.bankName=e.bankName),e.branchName&&(s("branchName",e.branchName,{shouldValidate:!0}),r.branchName=e.branchName),Object.keys(r).length>0&&f(r),C(t),N({message:"Bank details extracted. Please review.",type:"success"})},v={type:l.OBJECT,properties:{accountHolderName:{type:l.STRING,description:"The account holder's full name."},accountNumber:{type:l.STRING,description:"The full bank account number."},ifscCode:{type:l.STRING,description:"The bank's IFSC code."},bankName:{type:l.STRING,description:"The name of the bank (e.g., 'State Bank of India')."},branchName:{type:l.STRING,description:"The name of the bank branch (e.g., 'Koramangala Branch')."}},required:["accountHolderName","accountNumber","ifscCode","bankName","branchName"]};return I?a.jsxs("form",{onSubmit:g(j),id:"bank-form",children:[a.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"Your salary will be credited to this account."}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("input",{placeholder:"Account Holder Name",...o("accountHolderName"),onBlur:x,className:"form-input"}),a.jsx("input",{placeholder:"Bank Name",...o("bankName"),className:"form-input"}),a.jsx("input",{placeholder:"Account Number",...o("accountNumber"),className:"form-input"}),a.jsx("input",{placeholder:"Confirm Account Number",...o("confirmAccountNumber"),className:"form-input"}),a.jsx("input",{placeholder:"IFSC Code",...o("ifscCode"),className:"form-input"}),a.jsx("input",{placeholder:"Branch Name",...o("branchName"),className:"form-input"}),a.jsx(B,{name:"bankProof",control:S,render:({field:e})=>a.jsx(H,{label:"Upload Bank Proof (Optional)",file:e.value,onFileChange:e.onChange,allowCapture:!0})})]})]}):a.jsxs("form",{onSubmit:g(j),id:"bank-form",children:[a.jsx(E,{title:"Bank Details",subtitle:"Your salary will be credited to this account."}),a.jsxs("div",{className:"space-y-6",children:[a.jsx(B,{name:"bankProof",control:S,render:({field:e})=>a.jsx(H,{label:"Upload Bank Proof (Cancelled Cheque/Passbook)",file:e.value,onFileChange:e.onChange,onOcrComplete:T,ocrSchema:v,setToast:N})}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 pt-6 border-t",children:[a.jsx(d,{label:"Account Holder Name",id:"accountHolderName",hasValue:!!m.accountHolderName,isVerified:c.bank.verifiedStatus?.accountHolderName===!0,onManualInput:()=>p(["accountHolderName"]),error:i.accountHolderName?.message,registration:o("accountHolderName"),onBlur:x}),a.jsx(d,{label:"Bank Name",id:"bankName",hasValue:!!m.bankName,isVerified:!1,error:i.bankName?.message,registration:o("bankName")}),a.jsx(d,{label:"Account Number",id:"accountNumber",hasValue:!!m.accountNumber,isVerified:c.bank.verifiedStatus?.accountNumber===!0,onManualInput:()=>p(["accountNumber"]),error:i.accountNumber?.message,registration:o("accountNumber")}),a.jsx(d,{label:"Confirm Account Number",id:"confirmAccountNumber",hasValue:!!m.confirmAccountNumber,isVerified:c.bank.verifiedStatus?.accountNumber===!0,onManualInput:()=>p(["accountNumber"]),error:i.confirmAccountNumber?.message,registration:o("confirmAccountNumber")}),a.jsx(d,{label:"IFSC Code",id:"ifscCode",hasValue:!!m.ifscCode,isVerified:c.bank.verifiedStatus?.ifscCode===!0,onManualInput:()=>p(["ifscCode"]),error:i.ifscCode?.message,registration:o("ifscCode")}),a.jsx(d,{label:"Branch Name",id:"branchName",hasValue:!!m.branchName,isVerified:!1,error:i.branchName?.message,registration:o("branchName")})]})]})]})};export{G as bankDetailsSchema,ae as default};
