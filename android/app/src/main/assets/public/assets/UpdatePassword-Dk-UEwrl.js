import{u as j,c as b,o as P,j as e,B as d,I as c,d as y,g as v,e as m,f as S}from"./index-D5q3SS3D.js";import{b as a,u as k,L as u}from"./react-vendor-BUaIliXj.js";import{d as C}from"./ui-vendor-B8EvWqdc.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./utils-vendor-DmorxLnX.js";import"./supabase-7WG3J4rU.js";const E=y({password:m().min(6,"Password must be at least 6 characters").required("Password is required"),confirmPassword:m().oneOf([S("password")],"Passwords must match").required("Please confirm your password")}).defined(),q=s=>{const t=s.toLowerCase();return t.includes("weak password")?"Password is too weak. Please use at least 6 characters.":t.includes("requires a recent login")?"For your security, please sign in again to continue.":(console.error("Unhandled auth error:",s),"Something went wrong. Please try again.")},z=()=>{const[s,t]=a.useState(""),[w,h]=a.useState(!1),o=k(),{user:r,logout:x}=j();a.useEffect(()=>{r||t("Invalid or expired password reset session. Please request a new password reset link.")},[r]);const{register:i,handleSubmit:p,formState:{errors:n,isSubmitting:g}}=b({resolver:P(E)}),f=async N=>{t("");const{error:l}=await v.updateUserPassword(N.password);l?t(q(l.message)):(h(!0),await x(),setTimeout(()=>o("/auth/login",{replace:!0}),2e3))};return w?e.jsxs("div",{className:"text-center",children:[e.jsx(C,{className:"mx-auto h-12 w-12 text-accent"}),e.jsx("h3",{className:"mt-4 text-lg font-semibold text-white",children:"Password Updated!"}),e.jsx("p",{className:"mt-2 text-sm text-gray-300",children:"Your password has been changed successfully. You will be redirected to the login page shortly."}),e.jsx("div",{className:"mt-6",children:e.jsx(u,{to:"/auth/login",className:"font-medium text-white/80 hover:text-white",children:"â† Back to Login Now"})})]}):s&&!r?e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-3xl font-bold text-white",children:"Link Expired"}),e.jsx("p",{className:"text-sm text-gray-300 mt-1",children:"This password reset link is no longer valid."}),e.jsxs("div",{className:"mt-6 flex flex-col gap-4",children:[e.jsx(u,{to:"/auth/forgot-password",className:"font-medium text-white/80 hover:text-white",children:"Request a new link"}),e.jsx("div",{className:"auth-separator",children:"OR"}),e.jsx(d,{onClick:()=>o("/auth/login"),className:"w-full",size:"lg",children:"Back to Sign In"})]})]}):e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-center text-gray-300 -mt-6 mb-6",children:["for ",e.jsx("span",{className:"font-semibold text-white",children:r?.email}),"."]}),e.jsxs("form",{onSubmit:p(f),className:"space-y-6",children:[e.jsx(c,{id:"password",type:"password",placeholder:"New Password","aria-label":"New Password",autoComplete:"new-password",registration:i("password"),error:n.password?.message,className:"pl-4 !bg-white/10 !text-white !border-white/20 placeholder:!text-gray-300"}),e.jsx(c,{id:"confirmPassword",type:"password",placeholder:"Confirm New Password","aria-label":"Confirm New Password",autoComplete:"new-password",registration:i("confirmPassword"),error:n.confirmPassword?.message,className:"pl-4 !bg-white/10 !text-white !border-white/20 placeholder:!text-gray-300"}),s&&e.jsx("p",{className:"text-sm text-red-400 text-center",children:s}),e.jsx("div",{children:e.jsx(d,{type:"submit",className:"w-full",isLoading:g,size:"lg",disabled:!r,children:"Update Password"})})]})]})};export{z as default};
