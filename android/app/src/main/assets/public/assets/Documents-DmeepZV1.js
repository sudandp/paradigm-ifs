import{u as R,h as U,k as M,_ as n,j as o,B as f}from"./index-D5q3SS3D.js";import{F as J}from"./FormHeader-CSy2Sh-o.js";import{U as s}from"./UploadDocument-BAL6UInC.js";import{m as Y,u as H}from"./react-vendor-BUaIliXj.js";import{ao as h}from"./ui-vendor-B8EvWqdc.js";import{f as k}from"./utils-vendor-DmorxLnX.js";import"./pdf-vendor-CB_F1AVu.js";import"./capacitor-vendor-CqiIOUn1.js";import"./supabase-7WG3J4rU.js";import"./CameraCaptureModal-DQDGRnEP.js";const m=d=>d?d.toLowerCase().replace(/\b(\w)/g,t=>t.toUpperCase()):"",Z=()=>{const{onValidated:d,setToast:t}=Y(),{user:Q}=R(),y=H(),{data:i,updatePersonal:l,updateBank:b,addEducationRecord:E,updateFamilyMember:N,updateEducationRecord:C,updateUan:p,updateEsi:P,updateGmc:A}=U(),v=M("(max-width: 767px)"),u=e=>{const a={};if(e.name){const r=e.name.split(" ");a.firstName=m(r.shift()||""),a.lastName=m(r.pop()||""),a.middleName=m(r.join(" "))}if(e.dob)try{const r=new Date(e.dob);isNaN(r.getTime())||(a.dob=k(r,"yyyy-MM-dd"))}catch{}e.aadhaarNumber&&(a.idProofNumber=e.aadhaarNumber.replace(/\s/g,""),a.idProofType="Aadhaar"),l(a)},x=e=>{const a={};if(e.accountHolderName&&(a.accountHolderName=m(e.accountHolderName)),e.accountNumber){const r=e.accountNumber.replace(/\D/g,"");a.accountNumber=r,a.confirmAccountNumber=r}e.ifscCode&&(a.ifscCode=e.ifscCode.toUpperCase().replace(/\s/g,"")),b(a)},g=e=>{const a={};e.uanNumber&&(a.uanNumber=e.uanNumber.replace(/\D/g,""),a.hasPreviousPf=!0),p(a)},S=e=>{const a={};e.esiNumber&&(a.esiNumber=e.esiNumber.replace(/\D/g,""),a.hasEsi=!0),P(a)},T=e=>a=>{const r={};if(a.name&&(r.name=m(a.name)),a.dob)try{const j=new Date(a.dob);isNaN(j.getTime())||(r.dob=k(j,"yyyy-MM-dd"))}catch{}N(e,r)},F=e=>a=>{const r={};a.degree&&(r.degree=a.degree),a.institution&&(r.institution=a.institution),a.endYear&&(r.endYear=a.endYear.toString()),C(e,r)},c={type:n.OBJECT,properties:{name:{type:n.STRING},dob:{type:n.STRING},aadhaarNumber:{type:n.STRING}}},O={type:n.OBJECT,properties:{accountHolderName:{type:n.STRING},accountNumber:{type:n.STRING},ifscCode:{type:n.STRING}}},w={type:n.OBJECT,properties:{uanNumber:{type:n.STRING,description:"The 12-digit Universal Account Number (UAN)."},pfNumber:{type:n.STRING,description:"The Provident Fund (PF) account number."},esiNumber:{type:n.STRING,description:"The 10 or 17-digit ESI number."}}},B={type:n.OBJECT,properties:{uanNumber:{type:n.STRING}}},G={type:n.OBJECT,properties:{esiNumber:{type:n.STRING}}},I={type:n.OBJECT,properties:{degree:{type:n.STRING},institution:{type:n.STRING},endYear:{type:n.STRING}}};return v?o.jsxs("form",{onSubmit:async e=>{e.preventDefault(),await d()},id:"documents-form",children:[o.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"Upload supporting documents. You can also do this within each relevant section."}),o.jsxs("div",{className:"space-y-4",children:[o.jsx(s,{label:"ID Proof (Front Side)",file:i.personal.idProofFront,onFileChange:e=>l({idProofFront:e}),onOcrComplete:u,ocrSchema:c,setToast:t,allowCapture:!0,docType:i.personal.idProofType||"Aadhaar"}),o.jsx(s,{label:"ID Proof (Back Side)",file:i.personal.idProofBack,onFileChange:e=>l({idProofBack:e}),onOcrComplete:u,ocrSchema:c,setToast:t,allowCapture:!0,docType:i.personal.idProofType||"Aadhaar"}),o.jsx(s,{label:"Profile Photo",file:i.personal.photo,onFileChange:e=>l({photo:e}),allowCapture:!0,allowedTypes:["image/jpeg","image/png","image/webp"]}),o.jsx(s,{label:"Bank Proof",file:i.bank.bankProof,onFileChange:e=>b({bankProof:e}),onOcrComplete:x,ocrSchema:O,setToast:t,allowCapture:!0,docType:"Bank"}),o.jsx(s,{label:"Latest Salary Slip (Optional, for UAN/ESI)",file:i.uan.salarySlip,onFileChange:e=>p({salarySlip:e}),onOcrComplete:e=>{g(e),S(e)},ocrSchema:w,setToast:t,allowCapture:!0,docType:"Salary"}),i.uan.hasPreviousPf&&o.jsx(s,{label:"UAN Document",file:i.uan.document,onFileChange:e=>p({document:e}),onOcrComplete:g,ocrSchema:B,setToast:t,allowCapture:!0,docType:"UAN"}),i.esi.hasEsi&&o.jsx(s,{label:"ESI Document",file:i.esi.document,onFileChange:e=>P({document:e}),onOcrComplete:S,ocrSchema:G,setToast:t,allowCapture:!0}),i.gmc.isOptedIn===!1&&o.jsx(s,{label:"GMC Policy Copy",file:i.gmc.gmcPolicyCopy,onFileChange:e=>A({gmcPolicyCopy:e}),allowCapture:!0}),o.jsxs("div",{className:"mt-6 pt-6 border-t border-[#374151]",children:[o.jsx("h4",{className:"form-header-title mb-4",children:"Education Certificates"}),o.jsxs("div",{className:"space-y-4",children:[i.education.map(e=>o.jsx(s,{label:`Certificate for ${e.degree||"Qualification"}`,file:e.document,onFileChange:a=>C(e.id,{document:a}),onOcrComplete:F(e.id),ocrSchema:I,setToast:t,allowCapture:!0},e.id)),o.jsxs(f,{type:"button",onClick:()=>y("/onboarding/add/education"),variant:"secondary",className:"w-full flex items-center justify-center",children:[o.jsx(h,{className:"mr-2 h-4 w-4"}),o.jsx("span",{children:"Add / Edit Qualifications"})]})]})]}),o.jsxs("div",{className:"mt-6 pt-6 border-t border-[#374151]",children:[o.jsx("h4",{className:"form-header-title mb-4",children:"Family Member Documents"}),o.jsxs("div",{className:"space-y-4",children:[i.family.map(e=>o.jsx(s,{label:`ID Proof for ${e.name||"Family Member"}`,file:e.idProof,onFileChange:a=>N(e.id,{idProof:a}),onOcrComplete:T(e.id),ocrSchema:c,setToast:t,allowCapture:!0,docType:"Aadhaar"},e.id)),i.family.length===0&&o.jsx("p",{className:"text-sm text-gray-400",children:"No family members added."}),o.jsxs(f,{type:"button",onClick:()=>y("/onboarding/add/family"),variant:"secondary",className:"w-full flex items-center justify-center",children:[o.jsx(h,{className:"mr-2 h-4 w-4"}),o.jsx("span",{children:"Add/Edit on Family Page"})]})]})]})]})]}):o.jsxs("form",{onSubmit:async e=>{e.preventDefault(),await d()},id:"documents-form",children:[o.jsx(J,{title:"Document Collection",subtitle:"Upload supporting documents. You can also do this within each relevant section."}),o.jsxs("div",{className:"space-y-6",children:[o.jsx("section",{children:o.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[o.jsx(s,{label:"Employee ID Proof (Aadhaar/PAN) - Front Side",file:i.personal.idProofFront,onFileChange:e=>l({idProofFront:e}),onOcrComplete:u,ocrSchema:c,setToast:t,docType:i.personal.idProofType||"Aadhaar"}),o.jsx(s,{label:"Employee ID Proof (Aadhaar/PAN) - Back Side",file:i.personal.idProofBack,onFileChange:e=>l({idProofBack:e}),onOcrComplete:u,ocrSchema:c,setToast:t,docType:i.personal.idProofType||"Aadhaar"}),o.jsx(s,{label:"Bank Proof (Passbook/Cancelled Cheque)",file:i.bank.bankProof,onFileChange:e=>b({bankProof:e}),onOcrComplete:x,ocrSchema:O,setToast:t,docType:"Bank"}),o.jsx(s,{label:"Latest Salary Slip (Optional, for UAN/ESI)",file:i.uan.salarySlip,onFileChange:e=>p({salarySlip:e}),onOcrComplete:e=>{g(e),S(e)},ocrSchema:w,setToast:t,docType:"Salary"})]})}),o.jsxs("section",{children:[o.jsx("h4",{className:"text-md font-semibold text-primary-text mb-4 border-b pb-2",children:"Education Certificates"}),o.jsxs("div",{className:"space-y-4",children:[i.education.map(e=>o.jsx(s,{label:`Certificate for ${e.degree||"New Qualification"}`,file:e.document,onFileChange:a=>C(e.id,{document:a}),onOcrComplete:F(e.id),ocrSchema:I,setToast:t},e.id)),o.jsxs(f,{type:"button",variant:"outline",onClick:()=>E(),children:[o.jsx(h,{className:"mr-2 h-4 w-4"})," Add Qualification"]})]})]}),o.jsxs("section",{children:[o.jsx("h4",{className:"text-md font-semibold text-primary-text mb-4 border-b pb-2",children:"Family Member Documents"}),o.jsxs("div",{className:"space-y-4",children:[i.family.map(e=>o.jsx(s,{label:`ID Proof for ${e.name||`(${e.relation})`}`,file:e.idProof,onFileChange:a=>N(e.id,{idProof:a}),onOcrComplete:T(e.id),ocrSchema:c,setToast:t,docType:"Aadhaar"},e.id)),i.family.length===0&&o.jsx("p",{className:"text-sm text-muted",children:"No family members added yet."}),o.jsxs(f,{type:"button",variant:"outline",onClick:()=>y("/onboarding/add/family"),children:[o.jsx(h,{className:"mr-2 h-4 w-4"})," Go to Family Page to Add/Edit"]})]})]})]})]})};export{Z as default};
